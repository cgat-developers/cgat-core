
<!doctype html>
<html lang="en" class="no-js">
  <head>
    

      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../s3_pipeline/">
      
      
        <link rel="next" href="../configuring_s3/">
      
      
      <link rel="icon" href="../../img/CGAT_logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
<meta name="theme-color" content="#A4216A">

    
      
        <title>S3 Decorators - CGAT-core Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a40c8224.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cgatcore-s3-decorators" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            
  <a href="https://github.com/cgat-developers/cgat-core">
    For updates follow <strong>@cgat-developers</strong> on
    <span class="twemoji github">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </span>
    <strong>GitHub</strong>
  </a>

          </div>
          
        </aside>
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="CGAT-core Documentation" class="md-header__button md-logo" aria-label="CGAT-core Documentation" data-md-component="logo">
      
  <img src="../../img/CGAT_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CGAT-core Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              S3 Decorators
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/cgat-developers/cgat-core" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    cgat-developers/cgat-core
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../getting_started/installation/" class="md-tabs__link">
          
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../defining_workflow/writing_workflows/" class="md-tabs__link">
          
  
  Building a Workflow

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../pipeline_modules/overview/" class="md-tabs__link">
          
  
  Pipeline Modules

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../container/tasks/" class="md-tabs__link">
          
  
  Container support

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../s3_pipeline/" class="md-tabs__link">
          
  
  S3 Cloud

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../remote/s3/" class="md-tabs__link">
          
  
  Working with Remote Files

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../function_doc/pipeline/" class="md-tabs__link">
          
  
  Core Functions

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../project_info/contributing/" class="md-tabs__link">
          
  
  Project Info

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="CGAT-core Documentation" class="md-nav__button md-logo" aria-label="CGAT-core Documentation" data-md-component="logo">
      
  <img src="../../img/CGAT_logo.png" alt="logo">

    </a>
    CGAT-core Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/cgat-developers/cgat-core" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    cgat-developers/cgat-core
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/run_parameters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cluster Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running a Pipeline
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running a Pipeline Tutorial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/run_parameters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cluster Configuration
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Building a Workflow
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Building a Workflow
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../defining_workflow/writing_workflows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Workflow Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../defining_workflow/tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Writing a Workflow Tutorial
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Pipeline Modules
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Pipeline Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pipeline_modules/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pipeline_modules/control/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Control
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pipeline_modules/database/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Database
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pipeline_modules/files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Files
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pipeline_modules/cluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cluster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pipeline_modules/execution/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Execution
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pipeline_modules/utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Utils
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pipeline_modules/parameters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parameters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pipeline_modules/executors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Executors
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pipeline_modules/farm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Farm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pipeline_modules/run_function/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run Functions
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Container support
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Container support
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../container/tasks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Individual tasks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../container/whole_pipeline/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Whole pipeline
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    S3 Cloud
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            S3 Cloud
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../s3_pipeline/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    S3 Pipeline
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    S3 Decorators
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    S3 Decorators
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      pipeline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline--pipelinepy-tools-for-cgat-ruffus-pipelines" class="md-nav__link">
    <span class="md-ellipsis">
      pipeline.py - Tools for CGAT Ruffus Pipelines
    </span>
  </a>
  
    <nav class="md-nav" aria-label="pipeline.py - Tools for CGAT Ruffus Pipelines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline--example-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Example Usage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.ContainerConfig" class="md-nav__link">
    <span class="md-ellipsis">
      ContainerConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ContainerConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.ContainerConfig.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.ContainerConfig.get_container_command" class="md-nav__link">
    <span class="md-ellipsis">
      get_container_command
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.DRMAACluster" class="md-nav__link">
    <span class="md-ellipsis">
      DRMAACluster
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DRMAACluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.DRMAACluster.collect_single_job_from_cluster" class="md-nav__link">
    <span class="md-ellipsis">
      collect_single_job_from_cluster
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.DRMAACluster.get_drmaa_job_stdout_stderr" class="md-nav__link">
    <span class="md-ellipsis">
      get_drmaa_job_stdout_stderr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.DRMAACluster.map_resource_usage" class="md-nav__link">
    <span class="md-ellipsis">
      map_resource_usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.DRMAACluster.set_drmaa_job_paths" class="md-nav__link">
    <span class="md-ellipsis">
      set_drmaa_job_paths
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.DRMAACluster.setup_drmaa_job_template" class="md-nav__link">
    <span class="md-ellipsis">
      setup_drmaa_job_template
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.EventPool" class="md-nav__link">
    <span class="md-ellipsis">
      EventPool
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EventPool">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.EventPool.__len__" class="md-nav__link">
    <span class="md-ellipsis">
      __len__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.Executor" class="md-nav__link">
    <span class="md-ellipsis">
      Executor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Executor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.Executor.build_job_script" class="md-nav__link">
    <span class="md-ellipsis">
      build_job_script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.Executor.cleanup_all_jobs" class="md-nav__link">
    <span class="md-ellipsis">
      cleanup_all_jobs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.Executor.cleanup_failed_job" class="md-nav__link">
    <span class="md-ellipsis">
      cleanup_failed_job
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.Executor.collect_benchmark_data" class="md-nav__link">
    <span class="md-ellipsis">
      collect_benchmark_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.Executor.expand_statement" class="md-nav__link">
    <span class="md-ellipsis">
      expand_statement
    </span>
  </a>
  
    <nav class="md-nav" aria-label="expand_statement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.Executor.expand_statement--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.Executor.expand_statement--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.Executor.finish_job" class="md-nav__link">
    <span class="md-ellipsis">
      finish_job
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.Executor.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.Executor.set_container_config" class="md-nav__link">
    <span class="md-ellipsis">
      set_container_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.Executor.setup_signal_handlers" class="md-nav__link">
    <span class="md-ellipsis">
      setup_signal_handlers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.Executor.start_job" class="md-nav__link">
    <span class="md-ellipsis">
      start_job
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.KubernetesExecutor" class="md-nav__link">
    <span class="md-ellipsis">
      KubernetesExecutor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="KubernetesExecutor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.KubernetesExecutor.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.KubernetesExecutor.collect_benchmark_data" class="md-nav__link">
    <span class="md-ellipsis">
      collect_benchmark_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.KubernetesExecutor.collect_metric_data" class="md-nav__link">
    <span class="md-ellipsis">
      collect_metric_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.KubernetesExecutor.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.LoggingFilterProgress" class="md-nav__link">
    <span class="md-ellipsis">
      LoggingFilterProgress
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LoggingFilterProgress">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.LoggingFilterProgress--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.LoggingFilterpipelineName" class="md-nav__link">
    <span class="md-ellipsis">
      LoggingFilterpipelineName
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.MultiLineFormatter" class="md-nav__link">
    <span class="md-ellipsis">
      MultiLineFormatter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.SGEExecutor" class="md-nav__link">
    <span class="md-ellipsis">
      SGEExecutor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SGEExecutor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.SGEExecutor.build_job_script" class="md-nav__link">
    <span class="md-ellipsis">
      build_job_script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.SGEExecutor.collect_benchmark_data" class="md-nav__link">
    <span class="md-ellipsis">
      collect_benchmark_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.SGEExecutor.monitor_job_completion" class="md-nav__link">
    <span class="md-ellipsis">
      monitor_job_completion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.SlurmExecutor" class="md-nav__link">
    <span class="md-ellipsis">
      SlurmExecutor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SlurmExecutor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.SlurmExecutor.build_job_script" class="md-nav__link">
    <span class="md-ellipsis">
      build_job_script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.SlurmExecutor.collect_benchmark_data" class="md-nav__link">
    <span class="md-ellipsis">
      collect_benchmark_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.SlurmExecutor.monitor_job_completion" class="md-nav__link">
    <span class="md-ellipsis">
      monitor_job_completion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.TorqueExecutor" class="md-nav__link">
    <span class="md-ellipsis">
      TorqueExecutor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TorqueExecutor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.TorqueExecutor.build_job_script" class="md-nav__link">
    <span class="md-ellipsis">
      build_job_script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.TorqueExecutor.collect_benchmark_data" class="md-nav__link">
    <span class="md-ellipsis">
      collect_benchmark_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.TorqueExecutor.monitor_job_completion" class="md-nav__link">
    <span class="md-ellipsis">
      monitor_job_completion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.add_doc" class="md-nav__link">
    <span class="md-ellipsis">
      add_doc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_doc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.add_doc--parameter" class="md-nav__link">
    <span class="md-ellipsis">
      Parameter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.as_list" class="md-nav__link">
    <span class="md-ellipsis">
      as_list
    </span>
  </a>
  
    <nav class="md-nav" aria-label="as_list">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.as_list--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.build_load_statement" class="md-nav__link">
    <span class="md-ellipsis">
      build_load_statement
    </span>
  </a>
  
    <nav class="md-nav" aria-label="build_load_statement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.build_load_statement--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.build_load_statement--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.check_executables" class="md-nav__link">
    <span class="md-ellipsis">
      check_executables
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.check_parameter" class="md-nav__link">
    <span class="md-ellipsis">
      check_parameter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.check_scripts" class="md-nav__link">
    <span class="md-ellipsis">
      check_scripts
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.clean" class="md-nav__link">
    <span class="md-ellipsis">
      clean
    </span>
  </a>
  
    <nav class="md-nav" aria-label="clean">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.clean--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.clone_pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      clone_pipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="clone_pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.clone_pipeline--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.close_session" class="md-nav__link">
    <span class="md-ellipsis">
      close_session
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.cluster_runnable" class="md-nav__link">
    <span class="md-ellipsis">
      cluster_runnable
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.concatenate_and_load" class="md-nav__link">
    <span class="md-ellipsis">
      concatenate_and_load
    </span>
  </a>
  
    <nav class="md-nav" aria-label="concatenate_and_load">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.concatenate_and_load--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.config_to_dictionary" class="md-nav__link">
    <span class="md-ellipsis">
      config_to_dictionary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="config_to_dictionary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.config_to_dictionary--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.connect" class="md-nav__link">
    <span class="md-ellipsis">
      connect
    </span>
  </a>
  
    <nav class="md-nav" aria-label="connect">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.connect--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.create_view" class="md-nav__link">
    <span class="md-ellipsis">
      create_view
    </span>
  </a>
  
    <nav class="md-nav" aria-label="create_view">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.create_view--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
    <nav class="md-nav" aria-label="execute">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.execute--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.execute--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.file_is_mounted" class="md-nav__link">
    <span class="md-ellipsis">
      file_is_mounted
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_caller" class="md-nav__link">
    <span class="md-ellipsis">
      get_caller
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_caller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_caller--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_caller--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_caller_locals" class="md-nav__link">
    <span class="md-ellipsis">
      get_caller_locals
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_caller_locals">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_caller_locals--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_caller_locals--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_calling_function" class="md-nav__link">
    <span class="md-ellipsis">
      get_calling_function
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_calling_function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_calling_function--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_calling_function--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_database_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_database_name
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_database_name">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_database_name--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_database_name--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_executor" class="md-nav__link">
    <span class="md-ellipsis">
      get_executor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_header" class="md-nav__link">
    <span class="md-ellipsis">
      get_header
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_mounted_location" class="md-nav__link">
    <span class="md-ellipsis">
      get_mounted_location
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_param_output" class="md-nav__link">
    <span class="md-ellipsis">
      get_param_output
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_param_section" class="md-nav__link">
    <span class="md-ellipsis">
      get_param_section
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      get_parameters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_parameters--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_parameters--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_parameters_as_namedtuple" class="md-nav__link">
    <span class="md-ellipsis">
      get_parameters_as_namedtuple
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_params" class="md-nav__link">
    <span class="md-ellipsis">
      get_params
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_s3_pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      get_s3_pipeline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_temp_dir" class="md-nav__link">
    <span class="md-ellipsis">
      get_temp_dir
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_temp_dir">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_temp_dir--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_temp_dir--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_temp_file" class="md-nav__link">
    <span class="md-ellipsis">
      get_temp_file
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_temp_file">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_temp_file--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_temp_file--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_temp_filename" class="md-nav__link">
    <span class="md-ellipsis">
      get_temp_filename
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_temp_filename">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_temp_filename--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_temp_filename--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.initialize" class="md-nav__link">
    <span class="md-ellipsis">
      initialize
    </span>
  </a>
  
    <nav class="md-nav" aria-label="initialize">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.initialize--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.input_validation" class="md-nav__link">
    <span class="md-ellipsis">
      input_validation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.interpolate_statement" class="md-nav__link">
    <span class="md-ellipsis">
      interpolate_statement
    </span>
  </a>
  
    <nav class="md-nav" aria-label="interpolate_statement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.interpolate_statement--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.interpolate_statement--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.interpolate_statement--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.is_test" class="md-nav__link">
    <span class="md-ellipsis">
      is_test
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.is_true" class="md-nav__link">
    <span class="md-ellipsis">
      is_true
    </span>
  </a>
  
    <nav class="md-nav" aria-label="is_true">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.is_true--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.is_true--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.join_statements" class="md-nav__link">
    <span class="md-ellipsis">
      join_statements
    </span>
  </a>
  
    <nav class="md-nav" aria-label="join_statements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.join_statements--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.join_statements--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.load" class="md-nav__link">
    <span class="md-ellipsis">
      load
    </span>
  </a>
  
    <nav class="md-nav" aria-label="load">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.load--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.load_from_iterator" class="md-nav__link">
    <span class="md-ellipsis">
      load_from_iterator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="load_from_iterator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.load_from_iterator--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
    <nav class="md-nav" aria-label="main">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.main--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.match_parameter" class="md-nav__link">
    <span class="md-ellipsis">
      match_parameter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="match_parameter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.match_parameter--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.match_parameter--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.match_parameter--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.merge_and_load" class="md-nav__link">
    <span class="md-ellipsis">
      merge_and_load
    </span>
  </a>
  
    <nav class="md-nav" aria-label="merge_and_load">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.merge_and_load--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.nested_update" class="md-nav__link">
    <span class="md-ellipsis">
      nested_update
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.parse_commandline" class="md-nav__link">
    <span class="md-ellipsis">
      parse_commandline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="parse_commandline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.parse_commandline--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.peek_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      peek_parameters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="peek_parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.peek_parameters--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.peek_parameters--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.print_config_files" class="md-nav__link">
    <span class="md-ellipsis">
      print_config_files
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
    <nav class="md-nav" aria-label="run">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.run--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.run_pickled" class="md-nav__link">
    <span class="md-ellipsis">
      run_pickled
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.shellquote" class="md-nav__link">
    <span class="md-ellipsis">
      shellquote
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.snip" class="md-nav__link">
    <span class="md-ellipsis">
      snip
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.start_session" class="md-nav__link">
    <span class="md-ellipsis">
      start_session
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.submit" class="md-nav__link">
    <span class="md-ellipsis">
      submit
    </span>
  </a>
  
    <nav class="md-nav" aria-label="submit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.submit--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.substitute_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      substitute_parameters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="substitute_parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.substitute_parameters--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.tablequote" class="md-nav__link">
    <span class="md-ellipsis">
      tablequote
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.to_table" class="md-nav__link">
    <span class="md-ellipsis">
      to_table
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_table">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.to_table--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.to_table--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.touch_file" class="md-nav__link">
    <span class="md-ellipsis">
      touch_file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.update_params_with_commandline_options" class="md-nav__link">
    <span class="md-ellipsis">
      update_params_with_commandline_options
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.write_config_files" class="md-nav__link">
    <span class="md-ellipsis">
      write_config_files
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuring_s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuring S3
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Working with Remote Files
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Working with Remote Files
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../remote/s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    S3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../remote/gc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Google Cloud
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../remote/azure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Core Functions
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Core Functions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../function_doc/pipeline/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pipeline
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2" >
        
          
          <label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Core
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2">
            <span class="md-nav__icon md-icon"></span>
            Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../function_doc/experiment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Experiment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../function_doc/csv2db/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    csv2db
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../function_doc/database/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Database
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../function_doc/iotools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IOTools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../function_doc/logfile/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logfile
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Project Info
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Project Info
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../project_info/contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../project_info/how_to_contribute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to Contribute
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../project_info/citations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Citations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../project_info/faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../project_info/license/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    License
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      pipeline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline--pipelinepy-tools-for-cgat-ruffus-pipelines" class="md-nav__link">
    <span class="md-ellipsis">
      pipeline.py - Tools for CGAT Ruffus Pipelines
    </span>
  </a>
  
    <nav class="md-nav" aria-label="pipeline.py - Tools for CGAT Ruffus Pipelines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline--example-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Example Usage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.ContainerConfig" class="md-nav__link">
    <span class="md-ellipsis">
      ContainerConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ContainerConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.ContainerConfig.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.ContainerConfig.get_container_command" class="md-nav__link">
    <span class="md-ellipsis">
      get_container_command
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.DRMAACluster" class="md-nav__link">
    <span class="md-ellipsis">
      DRMAACluster
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DRMAACluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.DRMAACluster.collect_single_job_from_cluster" class="md-nav__link">
    <span class="md-ellipsis">
      collect_single_job_from_cluster
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.DRMAACluster.get_drmaa_job_stdout_stderr" class="md-nav__link">
    <span class="md-ellipsis">
      get_drmaa_job_stdout_stderr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.DRMAACluster.map_resource_usage" class="md-nav__link">
    <span class="md-ellipsis">
      map_resource_usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.DRMAACluster.set_drmaa_job_paths" class="md-nav__link">
    <span class="md-ellipsis">
      set_drmaa_job_paths
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.DRMAACluster.setup_drmaa_job_template" class="md-nav__link">
    <span class="md-ellipsis">
      setup_drmaa_job_template
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.EventPool" class="md-nav__link">
    <span class="md-ellipsis">
      EventPool
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EventPool">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.EventPool.__len__" class="md-nav__link">
    <span class="md-ellipsis">
      __len__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.Executor" class="md-nav__link">
    <span class="md-ellipsis">
      Executor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Executor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.Executor.build_job_script" class="md-nav__link">
    <span class="md-ellipsis">
      build_job_script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.Executor.cleanup_all_jobs" class="md-nav__link">
    <span class="md-ellipsis">
      cleanup_all_jobs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.Executor.cleanup_failed_job" class="md-nav__link">
    <span class="md-ellipsis">
      cleanup_failed_job
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.Executor.collect_benchmark_data" class="md-nav__link">
    <span class="md-ellipsis">
      collect_benchmark_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.Executor.expand_statement" class="md-nav__link">
    <span class="md-ellipsis">
      expand_statement
    </span>
  </a>
  
    <nav class="md-nav" aria-label="expand_statement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.Executor.expand_statement--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.Executor.expand_statement--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.Executor.finish_job" class="md-nav__link">
    <span class="md-ellipsis">
      finish_job
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.Executor.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.Executor.set_container_config" class="md-nav__link">
    <span class="md-ellipsis">
      set_container_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.Executor.setup_signal_handlers" class="md-nav__link">
    <span class="md-ellipsis">
      setup_signal_handlers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.Executor.start_job" class="md-nav__link">
    <span class="md-ellipsis">
      start_job
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.KubernetesExecutor" class="md-nav__link">
    <span class="md-ellipsis">
      KubernetesExecutor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="KubernetesExecutor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.KubernetesExecutor.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.KubernetesExecutor.collect_benchmark_data" class="md-nav__link">
    <span class="md-ellipsis">
      collect_benchmark_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.KubernetesExecutor.collect_metric_data" class="md-nav__link">
    <span class="md-ellipsis">
      collect_metric_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.KubernetesExecutor.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.LoggingFilterProgress" class="md-nav__link">
    <span class="md-ellipsis">
      LoggingFilterProgress
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LoggingFilterProgress">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.LoggingFilterProgress--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.LoggingFilterpipelineName" class="md-nav__link">
    <span class="md-ellipsis">
      LoggingFilterpipelineName
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.MultiLineFormatter" class="md-nav__link">
    <span class="md-ellipsis">
      MultiLineFormatter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.SGEExecutor" class="md-nav__link">
    <span class="md-ellipsis">
      SGEExecutor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SGEExecutor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.SGEExecutor.build_job_script" class="md-nav__link">
    <span class="md-ellipsis">
      build_job_script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.SGEExecutor.collect_benchmark_data" class="md-nav__link">
    <span class="md-ellipsis">
      collect_benchmark_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.SGEExecutor.monitor_job_completion" class="md-nav__link">
    <span class="md-ellipsis">
      monitor_job_completion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.SlurmExecutor" class="md-nav__link">
    <span class="md-ellipsis">
      SlurmExecutor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SlurmExecutor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.SlurmExecutor.build_job_script" class="md-nav__link">
    <span class="md-ellipsis">
      build_job_script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.SlurmExecutor.collect_benchmark_data" class="md-nav__link">
    <span class="md-ellipsis">
      collect_benchmark_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.SlurmExecutor.monitor_job_completion" class="md-nav__link">
    <span class="md-ellipsis">
      monitor_job_completion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.TorqueExecutor" class="md-nav__link">
    <span class="md-ellipsis">
      TorqueExecutor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TorqueExecutor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.TorqueExecutor.build_job_script" class="md-nav__link">
    <span class="md-ellipsis">
      build_job_script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.TorqueExecutor.collect_benchmark_data" class="md-nav__link">
    <span class="md-ellipsis">
      collect_benchmark_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.TorqueExecutor.monitor_job_completion" class="md-nav__link">
    <span class="md-ellipsis">
      monitor_job_completion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.add_doc" class="md-nav__link">
    <span class="md-ellipsis">
      add_doc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_doc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.add_doc--parameter" class="md-nav__link">
    <span class="md-ellipsis">
      Parameter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.as_list" class="md-nav__link">
    <span class="md-ellipsis">
      as_list
    </span>
  </a>
  
    <nav class="md-nav" aria-label="as_list">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.as_list--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.build_load_statement" class="md-nav__link">
    <span class="md-ellipsis">
      build_load_statement
    </span>
  </a>
  
    <nav class="md-nav" aria-label="build_load_statement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.build_load_statement--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.build_load_statement--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.check_executables" class="md-nav__link">
    <span class="md-ellipsis">
      check_executables
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.check_parameter" class="md-nav__link">
    <span class="md-ellipsis">
      check_parameter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.check_scripts" class="md-nav__link">
    <span class="md-ellipsis">
      check_scripts
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.clean" class="md-nav__link">
    <span class="md-ellipsis">
      clean
    </span>
  </a>
  
    <nav class="md-nav" aria-label="clean">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.clean--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.clone_pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      clone_pipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="clone_pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.clone_pipeline--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.close_session" class="md-nav__link">
    <span class="md-ellipsis">
      close_session
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.cluster_runnable" class="md-nav__link">
    <span class="md-ellipsis">
      cluster_runnable
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.concatenate_and_load" class="md-nav__link">
    <span class="md-ellipsis">
      concatenate_and_load
    </span>
  </a>
  
    <nav class="md-nav" aria-label="concatenate_and_load">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.concatenate_and_load--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.config_to_dictionary" class="md-nav__link">
    <span class="md-ellipsis">
      config_to_dictionary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="config_to_dictionary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.config_to_dictionary--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.connect" class="md-nav__link">
    <span class="md-ellipsis">
      connect
    </span>
  </a>
  
    <nav class="md-nav" aria-label="connect">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.connect--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.create_view" class="md-nav__link">
    <span class="md-ellipsis">
      create_view
    </span>
  </a>
  
    <nav class="md-nav" aria-label="create_view">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.create_view--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
    <nav class="md-nav" aria-label="execute">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.execute--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.execute--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.file_is_mounted" class="md-nav__link">
    <span class="md-ellipsis">
      file_is_mounted
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_caller" class="md-nav__link">
    <span class="md-ellipsis">
      get_caller
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_caller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_caller--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_caller--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_caller_locals" class="md-nav__link">
    <span class="md-ellipsis">
      get_caller_locals
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_caller_locals">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_caller_locals--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_caller_locals--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_calling_function" class="md-nav__link">
    <span class="md-ellipsis">
      get_calling_function
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_calling_function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_calling_function--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_calling_function--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_database_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_database_name
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_database_name">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_database_name--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_database_name--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_executor" class="md-nav__link">
    <span class="md-ellipsis">
      get_executor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_header" class="md-nav__link">
    <span class="md-ellipsis">
      get_header
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_mounted_location" class="md-nav__link">
    <span class="md-ellipsis">
      get_mounted_location
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_param_output" class="md-nav__link">
    <span class="md-ellipsis">
      get_param_output
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_param_section" class="md-nav__link">
    <span class="md-ellipsis">
      get_param_section
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      get_parameters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_parameters--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_parameters--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_parameters_as_namedtuple" class="md-nav__link">
    <span class="md-ellipsis">
      get_parameters_as_namedtuple
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_params" class="md-nav__link">
    <span class="md-ellipsis">
      get_params
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_s3_pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      get_s3_pipeline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_temp_dir" class="md-nav__link">
    <span class="md-ellipsis">
      get_temp_dir
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_temp_dir">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_temp_dir--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_temp_dir--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_temp_file" class="md-nav__link">
    <span class="md-ellipsis">
      get_temp_file
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_temp_file">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_temp_file--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_temp_file--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_temp_filename" class="md-nav__link">
    <span class="md-ellipsis">
      get_temp_filename
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_temp_filename">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_temp_filename--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.get_temp_filename--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.initialize" class="md-nav__link">
    <span class="md-ellipsis">
      initialize
    </span>
  </a>
  
    <nav class="md-nav" aria-label="initialize">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.initialize--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.input_validation" class="md-nav__link">
    <span class="md-ellipsis">
      input_validation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.interpolate_statement" class="md-nav__link">
    <span class="md-ellipsis">
      interpolate_statement
    </span>
  </a>
  
    <nav class="md-nav" aria-label="interpolate_statement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.interpolate_statement--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.interpolate_statement--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.interpolate_statement--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.is_test" class="md-nav__link">
    <span class="md-ellipsis">
      is_test
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.is_true" class="md-nav__link">
    <span class="md-ellipsis">
      is_true
    </span>
  </a>
  
    <nav class="md-nav" aria-label="is_true">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.is_true--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.is_true--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.join_statements" class="md-nav__link">
    <span class="md-ellipsis">
      join_statements
    </span>
  </a>
  
    <nav class="md-nav" aria-label="join_statements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.join_statements--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.join_statements--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.load" class="md-nav__link">
    <span class="md-ellipsis">
      load
    </span>
  </a>
  
    <nav class="md-nav" aria-label="load">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.load--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.load_from_iterator" class="md-nav__link">
    <span class="md-ellipsis">
      load_from_iterator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="load_from_iterator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.load_from_iterator--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
    <nav class="md-nav" aria-label="main">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.main--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.match_parameter" class="md-nav__link">
    <span class="md-ellipsis">
      match_parameter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="match_parameter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.match_parameter--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.match_parameter--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.match_parameter--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.merge_and_load" class="md-nav__link">
    <span class="md-ellipsis">
      merge_and_load
    </span>
  </a>
  
    <nav class="md-nav" aria-label="merge_and_load">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.merge_and_load--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.nested_update" class="md-nav__link">
    <span class="md-ellipsis">
      nested_update
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.parse_commandline" class="md-nav__link">
    <span class="md-ellipsis">
      parse_commandline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="parse_commandline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.parse_commandline--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.peek_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      peek_parameters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="peek_parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.peek_parameters--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.peek_parameters--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.print_config_files" class="md-nav__link">
    <span class="md-ellipsis">
      print_config_files
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
    <nav class="md-nav" aria-label="run">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.run--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.run_pickled" class="md-nav__link">
    <span class="md-ellipsis">
      run_pickled
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.shellquote" class="md-nav__link">
    <span class="md-ellipsis">
      shellquote
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.snip" class="md-nav__link">
    <span class="md-ellipsis">
      snip
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.start_session" class="md-nav__link">
    <span class="md-ellipsis">
      start_session
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.submit" class="md-nav__link">
    <span class="md-ellipsis">
      submit
    </span>
  </a>
  
    <nav class="md-nav" aria-label="submit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.submit--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.substitute_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      substitute_parameters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="substitute_parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.substitute_parameters--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.tablequote" class="md-nav__link">
    <span class="md-ellipsis">
      tablequote
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.to_table" class="md-nav__link">
    <span class="md-ellipsis">
      to_table
    </span>
  </a>
  
    <nav class="md-nav" aria-label="to_table">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.to_table--arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cgatcore.pipeline.to_table--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.touch_file" class="md-nav__link">
    <span class="md-ellipsis">
      touch_file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.update_params_with_commandline_options" class="md-nav__link">
    <span class="md-ellipsis">
      update_params_with_commandline_options
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cgatcore.pipeline.write_config_files" class="md-nav__link">
    <span class="md-ellipsis">
      write_config_files
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="cgatcore-s3-decorators">CGATcore S3 decorators<a class="headerlink" href="#cgatcore-s3-decorators" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<a id="cgatcore.pipeline"></a>
    <div class="doc doc-contents first">

        <h2 id="cgatcore.pipeline--pipelinepy-tools-for-cgat-ruffus-pipelines">pipeline.py - Tools for CGAT Ruffus Pipelines<a class="headerlink" href="#cgatcore.pipeline--pipelinepy-tools-for-cgat-ruffus-pipelines" title="Permanent link">&para;</a></h2>
<p>This module provides a comprehensive set of tools to facilitate the creation and management
of data processing pipelines using CGAT Ruffus. It includes functionalities for:</p>
<ol>
<li>Pipeline Control</li>
<li>Task execution and dependency management</li>
<li>Command-line interface for pipeline operations</li>
<li>
<p>Logging and error handling</p>
</li>
<li>
<p>Resource Management</p>
</li>
<li>Cluster job submission and monitoring</li>
<li>Memory and CPU allocation</li>
<li>
<p>Temporary file handling</p>
</li>
<li>
<p>Configuration</p>
</li>
<li>Parameter management via YAML configuration</li>
<li>Cluster settings customization</li>
<li>
<p>Pipeline state persistence</p>
</li>
<li>
<p>Cloud Integration</p>
</li>
<li>AWS S3 support for input/output files</li>
<li>Cloud-aware pipeline decorators</li>
<li>Remote file handling</li>
</ol>
<h3 id="cgatcore.pipeline--example-usage">Example Usage<a class="headerlink" href="#cgatcore.pipeline--example-usage" title="Permanent link">&para;</a></h3>
<p>A basic pipeline using local files:</p>
<p>.. code-block:: python</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">cgatcore</span><span class="w"> </span><span class="kn">import</span> <span class="n">pipeline</span> <span class="k">as</span> <span class="n">P</span>

<span class="c1"># Standard pipeline task</span>
<span class="nd">@P</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s2">&quot;input.txt&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="p">(</span><span class="s2">&quot;.txt&quot;</span><span class="p">),</span> <span class="s2">&quot;.processed&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">process_local_file</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">outfile</span><span class="p">):</span>
    <span class="c1"># Processing logic here</span>
    <span class="k">pass</span>
</code></pre></div>

<p>Using S3 integration:</p>
<p>.. code-block:: python</p>
<div class="codehilite"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="n">S3</span><span class="o">-</span><span class="n">aware</span><span class="w"> </span><span class="n">pipeline</span><span class="w"> </span><span class="n">task</span>
<span class="nv">@P</span><span class="p">.</span><span class="n">s3_transform</span><span class="p">(</span><span class="ss">&quot;s3://bucket/input.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">suffix</span><span class="p">(</span><span class="ss">&quot;.txt&quot;</span><span class="p">),</span><span class="w"> </span><span class="ss">&quot;.processed&quot;</span><span class="p">)</span>
<span class="n">def</span><span class="w"> </span><span class="n">process_s3_file</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span><span class="w"> </span><span class="n">outfile</span><span class="p">)</span><span class="err">:</span>
<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">Processing</span><span class="w"> </span><span class="n">logic</span><span class="w"> </span><span class="n">here</span>
<span class="w">    </span><span class="n">pass</span>
</code></pre></div>

<p>For detailed documentation, see: https://cgat-core.readthedocs.io/</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="cgatcore.pipeline.ContainerConfig" class="doc doc-heading">
            <code>ContainerConfig</code>


<a href="#cgatcore.pipeline.ContainerConfig" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>Container configuration for pipeline execution.</p>






              <details class="quote">
                <summary>Source code in <code>cgatcore/pipeline/execution.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="k">class</span><span class="w"> </span><span class="nc">ContainerConfig</span><span class="p">:</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Container configuration for pipeline execution.&quot;&quot;&quot;</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">volumes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">env_vars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="s2">&quot;docker&quot;</span><span class="p">):</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">            image (str): Container image (e.g., &quot;ubuntu:20.04&quot;).</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">            volumes (list): Volume mappings (e.g., [&#39;/data:/data&#39;]).</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">            env_vars (dict): Environment variables for the container.</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">            runtime (str): Container runtime (&quot;docker&quot; or &quot;singularity&quot;).</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">volumes</span> <span class="o">=</span> <span class="n">volumes</span> <span class="ow">or</span> <span class="p">[]</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">env_vars</span> <span class="o">=</span> <span class="n">env_vars</span> <span class="ow">or</span> <span class="p">{}</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">runtime</span> <span class="o">=</span> <span class="n">runtime</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>  <span class="c1"># Normalise to lowercase</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">runtime</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;docker&quot;</span><span class="p">,</span> <span class="s2">&quot;singularity&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported container runtime: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">runtime</span><span class="p">))</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_container_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">):</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a statement to run inside a container.&quot;&quot;&quot;</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">:</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>            <span class="k">return</span> <span class="n">statement</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">runtime</span> <span class="o">==</span> <span class="s2">&quot;docker&quot;</span><span class="p">:</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_docker_command</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">runtime</span> <span class="o">==</span> <span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_singularity_command</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported container runtime: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">runtime</span><span class="p">))</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_docker_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">):</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a Docker command.&quot;&quot;&quot;</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="n">volume_args</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;-v </span><span class="si">{</span><span class="n">volume</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">volumes</span><span class="p">]</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="n">env_args</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;-e </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env_vars</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>            <span class="s2">&quot;docker&quot;</span><span class="p">,</span> <span class="s2">&quot;run&quot;</span><span class="p">,</span> <span class="s2">&quot;--rm&quot;</span><span class="p">,</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>            <span class="o">*</span><span class="n">volume_args</span><span class="p">,</span> <span class="o">*</span><span class="n">env_args</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="s2">&quot;/bin/bash&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">statement</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="p">])</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_singularity_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">):</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a Singularity command.&quot;&quot;&quot;</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="n">volume_args</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;--bind </span><span class="si">{</span><span class="n">volume</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">volumes</span><span class="p">]</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="n">env_args</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;--env </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env_vars</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>            <span class="s2">&quot;singularity&quot;</span><span class="p">,</span> <span class="s2">&quot;exec&quot;</span><span class="p">,</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>            <span class="o">*</span><span class="n">volume_args</span><span class="p">,</span> <span class="o">*</span><span class="n">env_args</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>            <span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">statement</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>        <span class="p">])</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.ContainerConfig.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">volumes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">env_vars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="s1">&#39;docker&#39;</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.ContainerConfig.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Container image (e.g., "ubuntu:20.04").</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>volumes</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Volume mappings (e.g., ['/data:/data']).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>env_vars</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment variables for the container.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>runtime</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Container runtime ("docker" or "singularity").</p>
              </div>
            </td>
            <td>
                  <code>&#39;docker&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">volumes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">env_vars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="s2">&quot;docker&quot;</span><span class="p">):</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">        image (str): Container image (e.g., &quot;ubuntu:20.04&quot;).</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">        volumes (list): Volume mappings (e.g., [&#39;/data:/data&#39;]).</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">        env_vars (dict): Environment variables for the container.</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">        runtime (str): Container runtime (&quot;docker&quot; or &quot;singularity&quot;).</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">volumes</span> <span class="o">=</span> <span class="n">volumes</span> <span class="ow">or</span> <span class="p">[]</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">env_vars</span> <span class="o">=</span> <span class="n">env_vars</span> <span class="ow">or</span> <span class="p">{}</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">runtime</span> <span class="o">=</span> <span class="n">runtime</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>  <span class="c1"># Normalise to lowercase</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">runtime</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;docker&quot;</span><span class="p">,</span> <span class="s2">&quot;singularity&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported container runtime: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">runtime</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.ContainerConfig.get_container_command" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_container_command</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.ContainerConfig.get_container_command" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Convert a statement to run inside a container.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_container_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">):</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a statement to run inside a container.&quot;&quot;&quot;</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">:</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="k">return</span> <span class="n">statement</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">runtime</span> <span class="o">==</span> <span class="s2">&quot;docker&quot;</span><span class="p">:</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_docker_command</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">runtime</span> <span class="o">==</span> <span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_singularity_command</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported container runtime: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">runtime</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cgatcore.pipeline.DRMAACluster" class="doc doc-heading">
            <code>DRMAACluster</code>


<a href="#cgatcore.pipeline.DRMAACluster" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>







              <details class="quote">
                <summary>Source code in <code>cgatcore/pipeline/cluster.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="k">class</span><span class="w"> </span><span class="nc">DRMAACluster</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="c1"># dictionary mapping resource usage fields returned by DRMAA</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="c1"># to a common set of names.</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="n">map_drmaa2benchmark_data</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">session</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ignore_errors</span> <span class="o">=</span> <span class="n">ignore_errors</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_resource_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">,</span> <span class="n">retval</span><span class="p">,</span> <span class="n">hostname</span><span class="p">):</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="n">retval</span><span class="o">.</span><span class="n">resourceUsage</span><span class="p">[</span><span class="s2">&quot;hostname&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hostname</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="k">return</span> <span class="p">[</span><span class="n">retval</span><span class="p">]</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_drmaa_job_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>                                 <span class="n">drmaa_session</span><span class="p">,</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>                                 <span class="n">job_name</span><span class="p">,</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>                                 <span class="n">job_memory</span><span class="p">,</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>                                 <span class="n">job_threads</span><span class="p">,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>                                 <span class="n">working_directory</span><span class="p">,</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>                                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;Sets up a Drmma job template. Currently SGE, SLURM, Torque and PBSPro are</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">        supported&#39;&#39;&#39;</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">job_memory</span><span class="p">:</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Job memory must be specified when running&quot;</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>                             <span class="s2">&quot;DRMAA jobs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="n">jt</span> <span class="o">=</span> <span class="n">drmaa_session</span><span class="o">.</span><span class="n">createJobTemplate</span><span class="p">()</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="n">jt</span><span class="o">.</span><span class="n">workingDirectory</span> <span class="o">=</span> <span class="n">working_directory</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="n">jt</span><span class="o">.</span><span class="n">jobEnvironment</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;BASH_ENV&#39;</span><span class="p">:</span> <span class="s1">&#39;~/.bashrc&#39;</span><span class="p">}</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="n">jt</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;[a-zA-Z]&quot;</span><span class="p">,</span> <span class="n">job_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>            <span class="n">job_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">job_name</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_native_specification</span><span class="p">(</span><span class="n">job_name</span><span class="p">,</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>                                             <span class="n">job_memory</span><span class="p">,</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>                                             <span class="n">job_threads</span><span class="p">,</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>                                             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="n">jt</span><span class="o">.</span><span class="n">nativeSpecification</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="c1"># keep stdout and stderr separate</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="n">jt</span><span class="o">.</span><span class="n">joinFiles</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_template</span><span class="p">(</span><span class="n">jt</span><span class="p">)</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="k">return</span> <span class="n">jt</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jt</span><span class="p">):</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="k">pass</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">collect_single_job_from_cluster</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>                                        <span class="n">job_id</span><span class="p">,</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>                                        <span class="n">statement</span><span class="p">,</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>                                        <span class="n">stdout_path</span><span class="p">,</span> <span class="n">stderr_path</span><span class="p">,</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>                                        <span class="n">job_path</span><span class="p">):</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;collects a single job on the cluster.</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">        This method waits until a job has completed and returns</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">        stdout, stderr and resource usage.</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">        &#39;&#39;&#39;</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="n">retval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>                <span class="n">job_id</span><span class="p">,</span> <span class="n">drmaa</span><span class="o">.</span><span class="n">Session</span><span class="o">.</span><span class="n">TIMEOUT_WAIT_FOREVER</span><span class="p">)</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="c1"># ignore message 24, indicates jobs that have been qdel&#39;ed</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;code 24&quot;</span><span class="p">):</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>                <span class="k">raise</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>            <span class="n">retval</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_drmaa_job_stdout_stderr</span><span class="p">(</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>            <span class="n">stdout_path</span><span class="p">,</span> <span class="n">stderr_path</span><span class="p">)</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="k">if</span> <span class="n">retval</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="k">if</span> <span class="n">retval</span><span class="o">.</span><span class="n">exitStatus</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>                <span class="k">if</span> <span class="n">retval</span><span class="o">.</span><span class="n">wasAborted</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>                    <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>                        <span class="s2">&quot;Job </span><span class="si">{}</span><span class="s2"> has exit status 0, but marked as hasAborted=True, hasExited=</span><span class="si">{}</span><span class="s2"> &quot;</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>                        <span class="s2">&quot;(Job may have been cancelled by the user or the scheduler due to memory constraints)&quot;</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>                        <span class="s2">&quot;The stderr was </span><span class="se">\n</span><span class="si">{}</span><span class="se">\n</span><span class="s2">statement = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>                            <span class="n">job_id</span><span class="p">,</span> <span class="n">retval</span><span class="o">.</span><span class="n">hasExited</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stderr</span><span class="p">),</span> <span class="n">statement</span><span class="p">))</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>                <span class="k">if</span> <span class="n">retval</span><span class="o">.</span><span class="n">hasSignal</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>                    <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Job </span><span class="si">{}</span><span class="s2"> has zero exitStatus </span><span class="si">{}</span><span class="s2"> but received signal: hasExited=</span><span class="si">{}</span><span class="s2">,  wasAborted=</span><span class="si">{}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>                                 <span class="s2">&quot;hasSignal=</span><span class="si">{}</span><span class="s2">, terminatedSignal=&#39;</span><span class="si">{}</span><span class="s2">&#39; &quot;</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>                                 <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">statement = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>                                     <span class="n">job_id</span><span class="p">,</span> <span class="n">retval</span><span class="o">.</span><span class="n">exitStatus</span><span class="p">,</span> <span class="n">retval</span><span class="o">.</span><span class="n">hasExited</span><span class="p">,</span> <span class="n">retval</span><span class="o">.</span><span class="n">wasAborted</span><span class="p">,</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>                                     <span class="n">retval</span><span class="o">.</span><span class="n">hasSignal</span><span class="p">,</span> <span class="n">retval</span><span class="o">.</span><span class="n">terminatedSignal</span><span class="p">,</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>                                     <span class="n">statement</span><span class="p">))</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>                <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Job </span><span class="si">{}</span><span class="s2"> has non-zero exitStatus </span><span class="si">{}</span><span class="s2">: hasExited=</span><span class="si">{}</span><span class="s2">,  wasAborted=</span><span class="si">{}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>                             <span class="s2">&quot;hasSignal=</span><span class="si">{}</span><span class="s2">, terminatedSignal=&#39;</span><span class="si">{}</span><span class="s2">&#39; &quot;</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>                             <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">statement = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>                                 <span class="n">job_id</span><span class="p">,</span> <span class="n">retval</span><span class="o">.</span><span class="n">exitStatus</span><span class="p">,</span> <span class="n">retval</span><span class="o">.</span><span class="n">hasExited</span><span class="p">,</span> <span class="n">retval</span><span class="o">.</span><span class="n">wasAborted</span><span class="p">,</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>                                 <span class="n">retval</span><span class="o">.</span><span class="n">hasSignal</span><span class="p">,</span> <span class="n">retval</span><span class="o">.</span><span class="n">terminatedSignal</span><span class="p">,</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>                                 <span class="n">statement</span><span class="p">))</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>            <span class="k">if</span> <span class="n">error_msg</span><span class="p">:</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>                <span class="k">if</span> <span class="n">stderr</span><span class="p">:</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>                    <span class="n">error_msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> stderr = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stderr</span><span class="p">))</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_errors</span><span class="p">:</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>                    <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>                    <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>            <span class="n">retval</span> <span class="o">=</span> <span class="n">JobInfo</span><span class="p">(</span><span class="n">job_id</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="c1"># get hostname from job script</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>            <span class="n">hostname</span> <span class="o">=</span> <span class="n">stdout</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>            <span class="n">hostname</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>            <span class="n">resource_usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource_usage</span><span class="p">(</span><span class="n">job_id</span><span class="p">,</span> <span class="n">retval</span><span class="p">,</span> <span class="n">hostname</span><span class="p">)</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">)</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>            <span class="n">E</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;could not collect resource usage for job </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_id</span><span class="p">,</span> <span class="n">ex</span><span class="p">))</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>            <span class="n">retval</span><span class="o">.</span><span class="n">resourceUsage</span><span class="p">[</span><span class="s2">&quot;hostname&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hostname</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>            <span class="n">resource_usage</span> <span class="o">=</span> <span class="p">[</span><span class="n">retval</span><span class="p">]</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">job_path</span><span class="p">)</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>                <span class="p">(</span><span class="s2">&quot;temporary job file </span><span class="si">%s</span><span class="s2"> not present for &quot;</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>                 <span class="s2">&quot;clean-up - ignored&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">job_path</span><span class="p">)</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="k">return</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">,</span> <span class="n">resource_usage</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_drmaa_job_stdout_stderr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stdout_path</span><span class="p">,</span> <span class="n">stderr_path</span><span class="p">,</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>                                    <span class="n">tries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">):</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;get stdout/stderr allowing for some lag.</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">        Try at most *tries* times. If unsuccessfull, throw OSError</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">        Removes the files once they are read.</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">        Returns tuple of stdout and stderr as unicode strings.</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="sd">        &#39;&#39;&#39;</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">tries</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="k">while</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">stdout_path</span><span class="p">):</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>                <span class="k">break</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>            <span class="n">gevent</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">GEVENT_TIMEOUT_WAIT</span><span class="p">)</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>            <span class="n">x</span> <span class="o">-=</span> <span class="mi">1</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">tries</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="k">while</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">stderr_path</span><span class="p">):</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>                <span class="k">break</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>            <span class="n">gevent</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">GEVENT_TIMEOUT_WAIT</span><span class="p">)</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>            <span class="n">x</span> <span class="o">-=</span> <span class="mi">1</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">stdout_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">inf</span><span class="p">:</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>                <span class="n">stdout</span> <span class="o">=</span> <span class="n">inf</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>            <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;could not open stdout: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>            <span class="n">stdout</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">stderr_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">inf</span><span class="p">:</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>                <span class="n">stderr</span> <span class="o">=</span> <span class="n">inf</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>            <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;could not open stdout: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>            <span class="n">stderr</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">stdout_path</span><span class="p">)</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">stderr_path</span><span class="p">)</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>            <span class="k">pass</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="k">return</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_drmaa_job_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_template</span><span class="p">,</span> <span class="n">job_path</span><span class="p">):</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;Adds the job_path, stdout_path and stderr_paths</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">           to the job_template.</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="sd">        &#39;&#39;&#39;</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="n">job_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">job_path</span><span class="p">)</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">job_path</span><span class="p">,</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IRWXG</span> <span class="o">|</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IRWXU</span><span class="p">)</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="n">stdout_path</span> <span class="o">=</span> <span class="n">job_path</span> <span class="o">+</span> <span class="s2">&quot;.stdout&quot;</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>        <span class="n">stderr_path</span> <span class="o">=</span> <span class="n">job_path</span> <span class="o">+</span> <span class="s2">&quot;.stderr&quot;</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>        <span class="n">job_template</span><span class="o">.</span><span class="n">remoteCommand</span> <span class="o">=</span> <span class="n">job_path</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>        <span class="n">job_template</span><span class="o">.</span><span class="n">outputPath</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="n">stdout_path</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>        <span class="n">job_template</span><span class="o">.</span><span class="n">errorPath</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="n">stderr_path</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>        <span class="k">return</span> <span class="n">stdout_path</span><span class="p">,</span> <span class="n">stderr_path</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">map_resource_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource_usage</span><span class="p">,</span> <span class="n">data2type</span><span class="p">):</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;return job metrics mapped to common name and converted to right type.&quot;&quot;&quot;</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">_convert</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">tpe</span><span class="p">):</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>                <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>                    <span class="k">return</span> <span class="n">tpe</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>                    <span class="n">E</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;could not convert </span><span class="si">{}</span><span class="s2"> with value &#39;</span><span class="si">{}</span><span class="s2">&#39; to </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>                        <span class="n">key</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">tpe</span><span class="p">,</span> <span class="n">ex</span><span class="p">))</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>                    <span class="k">return</span> <span class="n">v</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">key</span><span class="p">,</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>                      <span class="n">_convert</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">resource_usage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_drmaa2benchmark_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">key</span><span class="p">),</span> <span class="kc">None</span><span class="p">),</span> <span class="n">tpe</span><span class="p">))</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>                     <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">tpe</span> <span class="ow">in</span> <span class="n">data2type</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.DRMAACluster.collect_single_job_from_cluster" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">collect_single_job_from_cluster</span><span class="p">(</span><span class="n">job_id</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span> <span class="n">stdout_path</span><span class="p">,</span> <span class="n">stderr_path</span><span class="p">,</span> <span class="n">job_path</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.DRMAACluster.collect_single_job_from_cluster" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>collects a single job on the cluster.</p>
<p>This method waits until a job has completed and returns
stdout, stderr and resource usage.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/cluster.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="k">def</span><span class="w"> </span><span class="nf">collect_single_job_from_cluster</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>                                    <span class="n">job_id</span><span class="p">,</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>                                    <span class="n">statement</span><span class="p">,</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>                                    <span class="n">stdout_path</span><span class="p">,</span> <span class="n">stderr_path</span><span class="p">,</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>                                    <span class="n">job_path</span><span class="p">):</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;collects a single job on the cluster.</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">    This method waits until a job has completed and returns</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">    stdout, stderr and resource usage.</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="n">retval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="n">job_id</span><span class="p">,</span> <span class="n">drmaa</span><span class="o">.</span><span class="n">Session</span><span class="o">.</span><span class="n">TIMEOUT_WAIT_FOREVER</span><span class="p">)</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="c1"># ignore message 24, indicates jobs that have been qdel&#39;ed</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;code 24&quot;</span><span class="p">):</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="k">raise</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="n">retval</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_drmaa_job_stdout_stderr</span><span class="p">(</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="n">stdout_path</span><span class="p">,</span> <span class="n">stderr_path</span><span class="p">)</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>    <span class="k">if</span> <span class="n">retval</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="n">error_msg</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="k">if</span> <span class="n">retval</span><span class="o">.</span><span class="n">exitStatus</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>            <span class="k">if</span> <span class="n">retval</span><span class="o">.</span><span class="n">wasAborted</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>                <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>                    <span class="s2">&quot;Job </span><span class="si">{}</span><span class="s2"> has exit status 0, but marked as hasAborted=True, hasExited=</span><span class="si">{}</span><span class="s2"> &quot;</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>                    <span class="s2">&quot;(Job may have been cancelled by the user or the scheduler due to memory constraints)&quot;</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>                    <span class="s2">&quot;The stderr was </span><span class="se">\n</span><span class="si">{}</span><span class="se">\n</span><span class="s2">statement = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>                        <span class="n">job_id</span><span class="p">,</span> <span class="n">retval</span><span class="o">.</span><span class="n">hasExited</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stderr</span><span class="p">),</span> <span class="n">statement</span><span class="p">))</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>            <span class="k">if</span> <span class="n">retval</span><span class="o">.</span><span class="n">hasSignal</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>                <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Job </span><span class="si">{}</span><span class="s2"> has zero exitStatus </span><span class="si">{}</span><span class="s2"> but received signal: hasExited=</span><span class="si">{}</span><span class="s2">,  wasAborted=</span><span class="si">{}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>                             <span class="s2">&quot;hasSignal=</span><span class="si">{}</span><span class="s2">, terminatedSignal=&#39;</span><span class="si">{}</span><span class="s2">&#39; &quot;</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>                             <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">statement = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>                                 <span class="n">job_id</span><span class="p">,</span> <span class="n">retval</span><span class="o">.</span><span class="n">exitStatus</span><span class="p">,</span> <span class="n">retval</span><span class="o">.</span><span class="n">hasExited</span><span class="p">,</span> <span class="n">retval</span><span class="o">.</span><span class="n">wasAborted</span><span class="p">,</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>                                 <span class="n">retval</span><span class="o">.</span><span class="n">hasSignal</span><span class="p">,</span> <span class="n">retval</span><span class="o">.</span><span class="n">terminatedSignal</span><span class="p">,</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>                                 <span class="n">statement</span><span class="p">))</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Job </span><span class="si">{}</span><span class="s2"> has non-zero exitStatus </span><span class="si">{}</span><span class="s2">: hasExited=</span><span class="si">{}</span><span class="s2">,  wasAborted=</span><span class="si">{}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>                         <span class="s2">&quot;hasSignal=</span><span class="si">{}</span><span class="s2">, terminatedSignal=&#39;</span><span class="si">{}</span><span class="s2">&#39; &quot;</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>                         <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">statement = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>                             <span class="n">job_id</span><span class="p">,</span> <span class="n">retval</span><span class="o">.</span><span class="n">exitStatus</span><span class="p">,</span> <span class="n">retval</span><span class="o">.</span><span class="n">hasExited</span><span class="p">,</span> <span class="n">retval</span><span class="o">.</span><span class="n">wasAborted</span><span class="p">,</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>                             <span class="n">retval</span><span class="o">.</span><span class="n">hasSignal</span><span class="p">,</span> <span class="n">retval</span><span class="o">.</span><span class="n">terminatedSignal</span><span class="p">,</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>                             <span class="n">statement</span><span class="p">))</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="k">if</span> <span class="n">error_msg</span><span class="p">:</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>            <span class="k">if</span> <span class="n">stderr</span><span class="p">:</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>                <span class="n">error_msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> stderr = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stderr</span><span class="p">))</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_errors</span><span class="p">:</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>                <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>                <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="n">retval</span> <span class="o">=</span> <span class="n">JobInfo</span><span class="p">(</span><span class="n">job_id</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="c1"># get hostname from job script</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="n">hostname</span> <span class="o">=</span> <span class="n">stdout</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="n">hostname</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="n">resource_usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource_usage</span><span class="p">(</span><span class="n">job_id</span><span class="p">,</span> <span class="n">retval</span><span class="p">,</span> <span class="n">hostname</span><span class="p">)</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">)</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="n">E</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;could not collect resource usage for job </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_id</span><span class="p">,</span> <span class="n">ex</span><span class="p">))</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>        <span class="n">retval</span><span class="o">.</span><span class="n">resourceUsage</span><span class="p">[</span><span class="s2">&quot;hostname&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hostname</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="n">resource_usage</span> <span class="o">=</span> <span class="p">[</span><span class="n">retval</span><span class="p">]</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">job_path</span><span class="p">)</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>            <span class="p">(</span><span class="s2">&quot;temporary job file </span><span class="si">%s</span><span class="s2"> not present for &quot;</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>             <span class="s2">&quot;clean-up - ignored&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">job_path</span><span class="p">)</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>    <span class="k">return</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">,</span> <span class="n">resource_usage</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.DRMAACluster.get_drmaa_job_stdout_stderr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_drmaa_job_stdout_stderr</span><span class="p">(</span><span class="n">stdout_path</span><span class="p">,</span> <span class="n">stderr_path</span><span class="p">,</span> <span class="n">tries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.DRMAACluster.get_drmaa_job_stdout_stderr" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>get stdout/stderr allowing for some lag.</p>
<p>Try at most <em>tries</em> times. If unsuccessfull, throw OSError</p>
<p>Removes the files once they are read.</p>
<p>Returns tuple of stdout and stderr as unicode strings.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/cluster.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_drmaa_job_stdout_stderr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stdout_path</span><span class="p">,</span> <span class="n">stderr_path</span><span class="p">,</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>                                <span class="n">tries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">):</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;get stdout/stderr allowing for some lag.</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">    Try at most *tries* times. If unsuccessfull, throw OSError</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">    Removes the files once they are read.</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">    Returns tuple of stdout and stderr as unicode strings.</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">tries</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="k">while</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">stdout_path</span><span class="p">):</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>            <span class="k">break</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="n">gevent</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">GEVENT_TIMEOUT_WAIT</span><span class="p">)</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="n">x</span> <span class="o">-=</span> <span class="mi">1</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">tries</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>    <span class="k">while</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">stderr_path</span><span class="p">):</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>            <span class="k">break</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>        <span class="n">gevent</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">GEVENT_TIMEOUT_WAIT</span><span class="p">)</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="n">x</span> <span class="o">-=</span> <span class="mi">1</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">stdout_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">inf</span><span class="p">:</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>            <span class="n">stdout</span> <span class="o">=</span> <span class="n">inf</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>    <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>        <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;could not open stdout: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>        <span class="n">stdout</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">stderr_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">inf</span><span class="p">:</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>            <span class="n">stderr</span> <span class="o">=</span> <span class="n">inf</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>    <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;could not open stdout: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>        <span class="n">stderr</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">stdout_path</span><span class="p">)</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">stderr_path</span><span class="p">)</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>        <span class="k">pass</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>    <span class="k">return</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.DRMAACluster.map_resource_usage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">map_resource_usage</span><span class="p">(</span><span class="n">resource_usage</span><span class="p">,</span> <span class="n">data2type</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.DRMAACluster.map_resource_usage" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>return job metrics mapped to common name and converted to right type.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/cluster.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="k">def</span><span class="w"> </span><span class="nf">map_resource_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource_usage</span><span class="p">,</span> <span class="n">data2type</span><span class="p">):</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;return job metrics mapped to common name and converted to right type.&quot;&quot;&quot;</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_convert</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">tpe</span><span class="p">):</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>                <span class="k">return</span> <span class="n">tpe</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>                <span class="n">E</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;could not convert </span><span class="si">{}</span><span class="s2"> with value &#39;</span><span class="si">{}</span><span class="s2">&#39; to </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>                    <span class="n">key</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">tpe</span><span class="p">,</span> <span class="n">ex</span><span class="p">))</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>                <span class="k">return</span> <span class="n">v</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>    <span class="k">return</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">key</span><span class="p">,</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>                  <span class="n">_convert</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">resource_usage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_drmaa2benchmark_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">key</span><span class="p">),</span> <span class="kc">None</span><span class="p">),</span> <span class="n">tpe</span><span class="p">))</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>                 <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">tpe</span> <span class="ow">in</span> <span class="n">data2type</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.DRMAACluster.set_drmaa_job_paths" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_drmaa_job_paths</span><span class="p">(</span><span class="n">job_template</span><span class="p">,</span> <span class="n">job_path</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.DRMAACluster.set_drmaa_job_paths" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Adds the job_path, stdout_path and stderr_paths
to the job_template.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/cluster.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="k">def</span><span class="w"> </span><span class="nf">set_drmaa_job_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_template</span><span class="p">,</span> <span class="n">job_path</span><span class="p">):</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Adds the job_path, stdout_path and stderr_paths</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">       to the job_template.</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>    <span class="n">job_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">job_path</span><span class="p">)</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>    <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">job_path</span><span class="p">,</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IRWXG</span> <span class="o">|</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IRWXU</span><span class="p">)</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>    <span class="n">stdout_path</span> <span class="o">=</span> <span class="n">job_path</span> <span class="o">+</span> <span class="s2">&quot;.stdout&quot;</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>    <span class="n">stderr_path</span> <span class="o">=</span> <span class="n">job_path</span> <span class="o">+</span> <span class="s2">&quot;.stderr&quot;</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>    <span class="n">job_template</span><span class="o">.</span><span class="n">remoteCommand</span> <span class="o">=</span> <span class="n">job_path</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>    <span class="n">job_template</span><span class="o">.</span><span class="n">outputPath</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="n">stdout_path</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>    <span class="n">job_template</span><span class="o">.</span><span class="n">errorPath</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="n">stderr_path</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>    <span class="k">return</span> <span class="n">stdout_path</span><span class="p">,</span> <span class="n">stderr_path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.DRMAACluster.setup_drmaa_job_template" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_drmaa_job_template</span><span class="p">(</span><span class="n">drmaa_session</span><span class="p">,</span> <span class="n">job_name</span><span class="p">,</span> <span class="n">job_memory</span><span class="p">,</span> <span class="n">job_threads</span><span class="p">,</span> <span class="n">working_directory</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.DRMAACluster.setup_drmaa_job_template" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Sets up a Drmma job template. Currently SGE, SLURM, Torque and PBSPro are
supported</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/cluster.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="k">def</span><span class="w"> </span><span class="nf">setup_drmaa_job_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>                             <span class="n">drmaa_session</span><span class="p">,</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>                             <span class="n">job_name</span><span class="p">,</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>                             <span class="n">job_memory</span><span class="p">,</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>                             <span class="n">job_threads</span><span class="p">,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>                             <span class="n">working_directory</span><span class="p">,</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>                             <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Sets up a Drmma job template. Currently SGE, SLURM, Torque and PBSPro are</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">    supported&#39;&#39;&#39;</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">job_memory</span><span class="p">:</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Job memory must be specified when running&quot;</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>                         <span class="s2">&quot;DRMAA jobs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="n">jt</span> <span class="o">=</span> <span class="n">drmaa_session</span><span class="o">.</span><span class="n">createJobTemplate</span><span class="p">()</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="n">jt</span><span class="o">.</span><span class="n">workingDirectory</span> <span class="o">=</span> <span class="n">working_directory</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="n">jt</span><span class="o">.</span><span class="n">jobEnvironment</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;BASH_ENV&#39;</span><span class="p">:</span> <span class="s1">&#39;~/.bashrc&#39;</span><span class="p">}</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="n">jt</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;[a-zA-Z]&quot;</span><span class="p">,</span> <span class="n">job_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="n">job_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">job_name</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_native_specification</span><span class="p">(</span><span class="n">job_name</span><span class="p">,</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>                                         <span class="n">job_memory</span><span class="p">,</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>                                         <span class="n">job_threads</span><span class="p">,</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>                                         <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="n">jt</span><span class="o">.</span><span class="n">nativeSpecification</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="c1"># keep stdout and stderr separate</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="n">jt</span><span class="o">.</span><span class="n">joinFiles</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">update_template</span><span class="p">(</span><span class="n">jt</span><span class="p">)</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="k">return</span> <span class="n">jt</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cgatcore.pipeline.EventPool" class="doc doc-heading">
            <code>EventPool</code>


<a href="#cgatcore.pipeline.EventPool" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="gevent.pool.Pool">Pool</span></code></p>







              <details class="quote">
                <summary>Source code in <code>cgatcore/pipeline/control.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="k">class</span><span class="w"> </span><span class="nc">EventPool</span><span class="p">(</span><span class="n">gevent</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">Pool</span><span class="p">):</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;make sure that pool always evaluates to true.&quot;&quot;&quot;</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="n">line</span> <span class="o">=</span> <span class="n">gevent</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">Pool</span><span class="o">.</span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="k">return</span> <span class="mi">1</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="k">return</span> <span class="n">line</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="k">pass</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">terminate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.EventPool.__len__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__len__</span><span class="p">()</span></code>

<a href="#cgatcore.pipeline.EventPool.__len__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>make sure that pool always evaluates to true.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/control.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span>
<span class="normal"><a href="#__codelineno-0-96">96</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;make sure that pool always evaluates to true.&quot;&quot;&quot;</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="n">line</span> <span class="o">=</span> <span class="n">gevent</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">Pool</span><span class="o">.</span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="k">return</span> <span class="mi">1</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="k">return</span> <span class="n">line</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cgatcore.pipeline.Executor" class="doc doc-heading">
            <code>Executor</code>


<a href="#cgatcore.pipeline.Executor" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>







              <details class="quote">
                <summary>Source code in <code>cgatcore/pipeline/execution.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-557"> 557</a></span>
<span class="normal"><a href="#__codelineno-0-558"> 558</a></span>
<span class="normal"><a href="#__codelineno-0-559"> 559</a></span>
<span class="normal"><a href="#__codelineno-0-560"> 560</a></span>
<span class="normal"><a href="#__codelineno-0-561"> 561</a></span>
<span class="normal"><a href="#__codelineno-0-562"> 562</a></span>
<span class="normal"><a href="#__codelineno-0-563"> 563</a></span>
<span class="normal"><a href="#__codelineno-0-564"> 564</a></span>
<span class="normal"><a href="#__codelineno-0-565"> 565</a></span>
<span class="normal"><a href="#__codelineno-0-566"> 566</a></span>
<span class="normal"><a href="#__codelineno-0-567"> 567</a></span>
<span class="normal"><a href="#__codelineno-0-568"> 568</a></span>
<span class="normal"><a href="#__codelineno-0-569"> 569</a></span>
<span class="normal"><a href="#__codelineno-0-570"> 570</a></span>
<span class="normal"><a href="#__codelineno-0-571"> 571</a></span>
<span class="normal"><a href="#__codelineno-0-572"> 572</a></span>
<span class="normal"><a href="#__codelineno-0-573"> 573</a></span>
<span class="normal"><a href="#__codelineno-0-574"> 574</a></span>
<span class="normal"><a href="#__codelineno-0-575"> 575</a></span>
<span class="normal"><a href="#__codelineno-0-576"> 576</a></span>
<span class="normal"><a href="#__codelineno-0-577"> 577</a></span>
<span class="normal"><a href="#__codelineno-0-578"> 578</a></span>
<span class="normal"><a href="#__codelineno-0-579"> 579</a></span>
<span class="normal"><a href="#__codelineno-0-580"> 580</a></span>
<span class="normal"><a href="#__codelineno-0-581"> 581</a></span>
<span class="normal"><a href="#__codelineno-0-582"> 582</a></span>
<span class="normal"><a href="#__codelineno-0-583"> 583</a></span>
<span class="normal"><a href="#__codelineno-0-584"> 584</a></span>
<span class="normal"><a href="#__codelineno-0-585"> 585</a></span>
<span class="normal"><a href="#__codelineno-0-586"> 586</a></span>
<span class="normal"><a href="#__codelineno-0-587"> 587</a></span>
<span class="normal"><a href="#__codelineno-0-588"> 588</a></span>
<span class="normal"><a href="#__codelineno-0-589"> 589</a></span>
<span class="normal"><a href="#__codelineno-0-590"> 590</a></span>
<span class="normal"><a href="#__codelineno-0-591"> 591</a></span>
<span class="normal"><a href="#__codelineno-0-592"> 592</a></span>
<span class="normal"><a href="#__codelineno-0-593"> 593</a></span>
<span class="normal"><a href="#__codelineno-0-594"> 594</a></span>
<span class="normal"><a href="#__codelineno-0-595"> 595</a></span>
<span class="normal"><a href="#__codelineno-0-596"> 596</a></span>
<span class="normal"><a href="#__codelineno-0-597"> 597</a></span>
<span class="normal"><a href="#__codelineno-0-598"> 598</a></span>
<span class="normal"><a href="#__codelineno-0-599"> 599</a></span>
<span class="normal"><a href="#__codelineno-0-600"> 600</a></span>
<span class="normal"><a href="#__codelineno-0-601"> 601</a></span>
<span class="normal"><a href="#__codelineno-0-602"> 602</a></span>
<span class="normal"><a href="#__codelineno-0-603"> 603</a></span>
<span class="normal"><a href="#__codelineno-0-604"> 604</a></span>
<span class="normal"><a href="#__codelineno-0-605"> 605</a></span>
<span class="normal"><a href="#__codelineno-0-606"> 606</a></span>
<span class="normal"><a href="#__codelineno-0-607"> 607</a></span>
<span class="normal"><a href="#__codelineno-0-608"> 608</a></span>
<span class="normal"><a href="#__codelineno-0-609"> 609</a></span>
<span class="normal"><a href="#__codelineno-0-610"> 610</a></span>
<span class="normal"><a href="#__codelineno-0-611"> 611</a></span>
<span class="normal"><a href="#__codelineno-0-612"> 612</a></span>
<span class="normal"><a href="#__codelineno-0-613"> 613</a></span>
<span class="normal"><a href="#__codelineno-0-614"> 614</a></span>
<span class="normal"><a href="#__codelineno-0-615"> 615</a></span>
<span class="normal"><a href="#__codelineno-0-616"> 616</a></span>
<span class="normal"><a href="#__codelineno-0-617"> 617</a></span>
<span class="normal"><a href="#__codelineno-0-618"> 618</a></span>
<span class="normal"><a href="#__codelineno-0-619"> 619</a></span>
<span class="normal"><a href="#__codelineno-0-620"> 620</a></span>
<span class="normal"><a href="#__codelineno-0-621"> 621</a></span>
<span class="normal"><a href="#__codelineno-0-622"> 622</a></span>
<span class="normal"><a href="#__codelineno-0-623"> 623</a></span>
<span class="normal"><a href="#__codelineno-0-624"> 624</a></span>
<span class="normal"><a href="#__codelineno-0-625"> 625</a></span>
<span class="normal"><a href="#__codelineno-0-626"> 626</a></span>
<span class="normal"><a href="#__codelineno-0-627"> 627</a></span>
<span class="normal"><a href="#__codelineno-0-628"> 628</a></span>
<span class="normal"><a href="#__codelineno-0-629"> 629</a></span>
<span class="normal"><a href="#__codelineno-0-630"> 630</a></span>
<span class="normal"><a href="#__codelineno-0-631"> 631</a></span>
<span class="normal"><a href="#__codelineno-0-632"> 632</a></span>
<span class="normal"><a href="#__codelineno-0-633"> 633</a></span>
<span class="normal"><a href="#__codelineno-0-634"> 634</a></span>
<span class="normal"><a href="#__codelineno-0-635"> 635</a></span>
<span class="normal"><a href="#__codelineno-0-636"> 636</a></span>
<span class="normal"><a href="#__codelineno-0-637"> 637</a></span>
<span class="normal"><a href="#__codelineno-0-638"> 638</a></span>
<span class="normal"><a href="#__codelineno-0-639"> 639</a></span>
<span class="normal"><a href="#__codelineno-0-640"> 640</a></span>
<span class="normal"><a href="#__codelineno-0-641"> 641</a></span>
<span class="normal"><a href="#__codelineno-0-642"> 642</a></span>
<span class="normal"><a href="#__codelineno-0-643"> 643</a></span>
<span class="normal"><a href="#__codelineno-0-644"> 644</a></span>
<span class="normal"><a href="#__codelineno-0-645"> 645</a></span>
<span class="normal"><a href="#__codelineno-0-646"> 646</a></span>
<span class="normal"><a href="#__codelineno-0-647"> 647</a></span>
<span class="normal"><a href="#__codelineno-0-648"> 648</a></span>
<span class="normal"><a href="#__codelineno-0-649"> 649</a></span>
<span class="normal"><a href="#__codelineno-0-650"> 650</a></span>
<span class="normal"><a href="#__codelineno-0-651"> 651</a></span>
<span class="normal"><a href="#__codelineno-0-652"> 652</a></span>
<span class="normal"><a href="#__codelineno-0-653"> 653</a></span>
<span class="normal"><a href="#__codelineno-0-654"> 654</a></span>
<span class="normal"><a href="#__codelineno-0-655"> 655</a></span>
<span class="normal"><a href="#__codelineno-0-656"> 656</a></span>
<span class="normal"><a href="#__codelineno-0-657"> 657</a></span>
<span class="normal"><a href="#__codelineno-0-658"> 658</a></span>
<span class="normal"><a href="#__codelineno-0-659"> 659</a></span>
<span class="normal"><a href="#__codelineno-0-660"> 660</a></span>
<span class="normal"><a href="#__codelineno-0-661"> 661</a></span>
<span class="normal"><a href="#__codelineno-0-662"> 662</a></span>
<span class="normal"><a href="#__codelineno-0-663"> 663</a></span>
<span class="normal"><a href="#__codelineno-0-664"> 664</a></span>
<span class="normal"><a href="#__codelineno-0-665"> 665</a></span>
<span class="normal"><a href="#__codelineno-0-666"> 666</a></span>
<span class="normal"><a href="#__codelineno-0-667"> 667</a></span>
<span class="normal"><a href="#__codelineno-0-668"> 668</a></span>
<span class="normal"><a href="#__codelineno-0-669"> 669</a></span>
<span class="normal"><a href="#__codelineno-0-670"> 670</a></span>
<span class="normal"><a href="#__codelineno-0-671"> 671</a></span>
<span class="normal"><a href="#__codelineno-0-672"> 672</a></span>
<span class="normal"><a href="#__codelineno-0-673"> 673</a></span>
<span class="normal"><a href="#__codelineno-0-674"> 674</a></span>
<span class="normal"><a href="#__codelineno-0-675"> 675</a></span>
<span class="normal"><a href="#__codelineno-0-676"> 676</a></span>
<span class="normal"><a href="#__codelineno-0-677"> 677</a></span>
<span class="normal"><a href="#__codelineno-0-678"> 678</a></span>
<span class="normal"><a href="#__codelineno-0-679"> 679</a></span>
<span class="normal"><a href="#__codelineno-0-680"> 680</a></span>
<span class="normal"><a href="#__codelineno-0-681"> 681</a></span>
<span class="normal"><a href="#__codelineno-0-682"> 682</a></span>
<span class="normal"><a href="#__codelineno-0-683"> 683</a></span>
<span class="normal"><a href="#__codelineno-0-684"> 684</a></span>
<span class="normal"><a href="#__codelineno-0-685"> 685</a></span>
<span class="normal"><a href="#__codelineno-0-686"> 686</a></span>
<span class="normal"><a href="#__codelineno-0-687"> 687</a></span>
<span class="normal"><a href="#__codelineno-0-688"> 688</a></span>
<span class="normal"><a href="#__codelineno-0-689"> 689</a></span>
<span class="normal"><a href="#__codelineno-0-690"> 690</a></span>
<span class="normal"><a href="#__codelineno-0-691"> 691</a></span>
<span class="normal"><a href="#__codelineno-0-692"> 692</a></span>
<span class="normal"><a href="#__codelineno-0-693"> 693</a></span>
<span class="normal"><a href="#__codelineno-0-694"> 694</a></span>
<span class="normal"><a href="#__codelineno-0-695"> 695</a></span>
<span class="normal"><a href="#__codelineno-0-696"> 696</a></span>
<span class="normal"><a href="#__codelineno-0-697"> 697</a></span>
<span class="normal"><a href="#__codelineno-0-698"> 698</a></span>
<span class="normal"><a href="#__codelineno-0-699"> 699</a></span>
<span class="normal"><a href="#__codelineno-0-700"> 700</a></span>
<span class="normal"><a href="#__codelineno-0-701"> 701</a></span>
<span class="normal"><a href="#__codelineno-0-702"> 702</a></span>
<span class="normal"><a href="#__codelineno-0-703"> 703</a></span>
<span class="normal"><a href="#__codelineno-0-704"> 704</a></span>
<span class="normal"><a href="#__codelineno-0-705"> 705</a></span>
<span class="normal"><a href="#__codelineno-0-706"> 706</a></span>
<span class="normal"><a href="#__codelineno-0-707"> 707</a></span>
<span class="normal"><a href="#__codelineno-0-708"> 708</a></span>
<span class="normal"><a href="#__codelineno-0-709"> 709</a></span>
<span class="normal"><a href="#__codelineno-0-710"> 710</a></span>
<span class="normal"><a href="#__codelineno-0-711"> 711</a></span>
<span class="normal"><a href="#__codelineno-0-712"> 712</a></span>
<span class="normal"><a href="#__codelineno-0-713"> 713</a></span>
<span class="normal"><a href="#__codelineno-0-714"> 714</a></span>
<span class="normal"><a href="#__codelineno-0-715"> 715</a></span>
<span class="normal"><a href="#__codelineno-0-716"> 716</a></span>
<span class="normal"><a href="#__codelineno-0-717"> 717</a></span>
<span class="normal"><a href="#__codelineno-0-718"> 718</a></span>
<span class="normal"><a href="#__codelineno-0-719"> 719</a></span>
<span class="normal"><a href="#__codelineno-0-720"> 720</a></span>
<span class="normal"><a href="#__codelineno-0-721"> 721</a></span>
<span class="normal"><a href="#__codelineno-0-722"> 722</a></span>
<span class="normal"><a href="#__codelineno-0-723"> 723</a></span>
<span class="normal"><a href="#__codelineno-0-724"> 724</a></span>
<span class="normal"><a href="#__codelineno-0-725"> 725</a></span>
<span class="normal"><a href="#__codelineno-0-726"> 726</a></span>
<span class="normal"><a href="#__codelineno-0-727"> 727</a></span>
<span class="normal"><a href="#__codelineno-0-728"> 728</a></span>
<span class="normal"><a href="#__codelineno-0-729"> 729</a></span>
<span class="normal"><a href="#__codelineno-0-730"> 730</a></span>
<span class="normal"><a href="#__codelineno-0-731"> 731</a></span>
<span class="normal"><a href="#__codelineno-0-732"> 732</a></span>
<span class="normal"><a href="#__codelineno-0-733"> 733</a></span>
<span class="normal"><a href="#__codelineno-0-734"> 734</a></span>
<span class="normal"><a href="#__codelineno-0-735"> 735</a></span>
<span class="normal"><a href="#__codelineno-0-736"> 736</a></span>
<span class="normal"><a href="#__codelineno-0-737"> 737</a></span>
<span class="normal"><a href="#__codelineno-0-738"> 738</a></span>
<span class="normal"><a href="#__codelineno-0-739"> 739</a></span>
<span class="normal"><a href="#__codelineno-0-740"> 740</a></span>
<span class="normal"><a href="#__codelineno-0-741"> 741</a></span>
<span class="normal"><a href="#__codelineno-0-742"> 742</a></span>
<span class="normal"><a href="#__codelineno-0-743"> 743</a></span>
<span class="normal"><a href="#__codelineno-0-744"> 744</a></span>
<span class="normal"><a href="#__codelineno-0-745"> 745</a></span>
<span class="normal"><a href="#__codelineno-0-746"> 746</a></span>
<span class="normal"><a href="#__codelineno-0-747"> 747</a></span>
<span class="normal"><a href="#__codelineno-0-748"> 748</a></span>
<span class="normal"><a href="#__codelineno-0-749"> 749</a></span>
<span class="normal"><a href="#__codelineno-0-750"> 750</a></span>
<span class="normal"><a href="#__codelineno-0-751"> 751</a></span>
<span class="normal"><a href="#__codelineno-0-752"> 752</a></span>
<span class="normal"><a href="#__codelineno-0-753"> 753</a></span>
<span class="normal"><a href="#__codelineno-0-754"> 754</a></span>
<span class="normal"><a href="#__codelineno-0-755"> 755</a></span>
<span class="normal"><a href="#__codelineno-0-756"> 756</a></span>
<span class="normal"><a href="#__codelineno-0-757"> 757</a></span>
<span class="normal"><a href="#__codelineno-0-758"> 758</a></span>
<span class="normal"><a href="#__codelineno-0-759"> 759</a></span>
<span class="normal"><a href="#__codelineno-0-760"> 760</a></span>
<span class="normal"><a href="#__codelineno-0-761"> 761</a></span>
<span class="normal"><a href="#__codelineno-0-762"> 762</a></span>
<span class="normal"><a href="#__codelineno-0-763"> 763</a></span>
<span class="normal"><a href="#__codelineno-0-764"> 764</a></span>
<span class="normal"><a href="#__codelineno-0-765"> 765</a></span>
<span class="normal"><a href="#__codelineno-0-766"> 766</a></span>
<span class="normal"><a href="#__codelineno-0-767"> 767</a></span>
<span class="normal"><a href="#__codelineno-0-768"> 768</a></span>
<span class="normal"><a href="#__codelineno-0-769"> 769</a></span>
<span class="normal"><a href="#__codelineno-0-770"> 770</a></span>
<span class="normal"><a href="#__codelineno-0-771"> 771</a></span>
<span class="normal"><a href="#__codelineno-0-772"> 772</a></span>
<span class="normal"><a href="#__codelineno-0-773"> 773</a></span>
<span class="normal"><a href="#__codelineno-0-774"> 774</a></span>
<span class="normal"><a href="#__codelineno-0-775"> 775</a></span>
<span class="normal"><a href="#__codelineno-0-776"> 776</a></span>
<span class="normal"><a href="#__codelineno-0-777"> 777</a></span>
<span class="normal"><a href="#__codelineno-0-778"> 778</a></span>
<span class="normal"><a href="#__codelineno-0-779"> 779</a></span>
<span class="normal"><a href="#__codelineno-0-780"> 780</a></span>
<span class="normal"><a href="#__codelineno-0-781"> 781</a></span>
<span class="normal"><a href="#__codelineno-0-782"> 782</a></span>
<span class="normal"><a href="#__codelineno-0-783"> 783</a></span>
<span class="normal"><a href="#__codelineno-0-784"> 784</a></span>
<span class="normal"><a href="#__codelineno-0-785"> 785</a></span>
<span class="normal"><a href="#__codelineno-0-786"> 786</a></span>
<span class="normal"><a href="#__codelineno-0-787"> 787</a></span>
<span class="normal"><a href="#__codelineno-0-788"> 788</a></span>
<span class="normal"><a href="#__codelineno-0-789"> 789</a></span>
<span class="normal"><a href="#__codelineno-0-790"> 790</a></span>
<span class="normal"><a href="#__codelineno-0-791"> 791</a></span>
<span class="normal"><a href="#__codelineno-0-792"> 792</a></span>
<span class="normal"><a href="#__codelineno-0-793"> 793</a></span>
<span class="normal"><a href="#__codelineno-0-794"> 794</a></span>
<span class="normal"><a href="#__codelineno-0-795"> 795</a></span>
<span class="normal"><a href="#__codelineno-0-796"> 796</a></span>
<span class="normal"><a href="#__codelineno-0-797"> 797</a></span>
<span class="normal"><a href="#__codelineno-0-798"> 798</a></span>
<span class="normal"><a href="#__codelineno-0-799"> 799</a></span>
<span class="normal"><a href="#__codelineno-0-800"> 800</a></span>
<span class="normal"><a href="#__codelineno-0-801"> 801</a></span>
<span class="normal"><a href="#__codelineno-0-802"> 802</a></span>
<span class="normal"><a href="#__codelineno-0-803"> 803</a></span>
<span class="normal"><a href="#__codelineno-0-804"> 804</a></span>
<span class="normal"><a href="#__codelineno-0-805"> 805</a></span>
<span class="normal"><a href="#__codelineno-0-806"> 806</a></span>
<span class="normal"><a href="#__codelineno-0-807"> 807</a></span>
<span class="normal"><a href="#__codelineno-0-808"> 808</a></span>
<span class="normal"><a href="#__codelineno-0-809"> 809</a></span>
<span class="normal"><a href="#__codelineno-0-810"> 810</a></span>
<span class="normal"><a href="#__codelineno-0-811"> 811</a></span>
<span class="normal"><a href="#__codelineno-0-812"> 812</a></span>
<span class="normal"><a href="#__codelineno-0-813"> 813</a></span>
<span class="normal"><a href="#__codelineno-0-814"> 814</a></span>
<span class="normal"><a href="#__codelineno-0-815"> 815</a></span>
<span class="normal"><a href="#__codelineno-0-816"> 816</a></span>
<span class="normal"><a href="#__codelineno-0-817"> 817</a></span>
<span class="normal"><a href="#__codelineno-0-818"> 818</a></span>
<span class="normal"><a href="#__codelineno-0-819"> 819</a></span>
<span class="normal"><a href="#__codelineno-0-820"> 820</a></span>
<span class="normal"><a href="#__codelineno-0-821"> 821</a></span>
<span class="normal"><a href="#__codelineno-0-822"> 822</a></span>
<span class="normal"><a href="#__codelineno-0-823"> 823</a></span>
<span class="normal"><a href="#__codelineno-0-824"> 824</a></span>
<span class="normal"><a href="#__codelineno-0-825"> 825</a></span>
<span class="normal"><a href="#__codelineno-0-826"> 826</a></span>
<span class="normal"><a href="#__codelineno-0-827"> 827</a></span>
<span class="normal"><a href="#__codelineno-0-828"> 828</a></span>
<span class="normal"><a href="#__codelineno-0-829"> 829</a></span>
<span class="normal"><a href="#__codelineno-0-830"> 830</a></span>
<span class="normal"><a href="#__codelineno-0-831"> 831</a></span>
<span class="normal"><a href="#__codelineno-0-832"> 832</a></span>
<span class="normal"><a href="#__codelineno-0-833"> 833</a></span>
<span class="normal"><a href="#__codelineno-0-834"> 834</a></span>
<span class="normal"><a href="#__codelineno-0-835"> 835</a></span>
<span class="normal"><a href="#__codelineno-0-836"> 836</a></span>
<span class="normal"><a href="#__codelineno-0-837"> 837</a></span>
<span class="normal"><a href="#__codelineno-0-838"> 838</a></span>
<span class="normal"><a href="#__codelineno-0-839"> 839</a></span>
<span class="normal"><a href="#__codelineno-0-840"> 840</a></span>
<span class="normal"><a href="#__codelineno-0-841"> 841</a></span>
<span class="normal"><a href="#__codelineno-0-842"> 842</a></span>
<span class="normal"><a href="#__codelineno-0-843"> 843</a></span>
<span class="normal"><a href="#__codelineno-0-844"> 844</a></span>
<span class="normal"><a href="#__codelineno-0-845"> 845</a></span>
<span class="normal"><a href="#__codelineno-0-846"> 846</a></span>
<span class="normal"><a href="#__codelineno-0-847"> 847</a></span>
<span class="normal"><a href="#__codelineno-0-848"> 848</a></span>
<span class="normal"><a href="#__codelineno-0-849"> 849</a></span>
<span class="normal"><a href="#__codelineno-0-850"> 850</a></span>
<span class="normal"><a href="#__codelineno-0-851"> 851</a></span>
<span class="normal"><a href="#__codelineno-0-852"> 852</a></span>
<span class="normal"><a href="#__codelineno-0-853"> 853</a></span>
<span class="normal"><a href="#__codelineno-0-854"> 854</a></span>
<span class="normal"><a href="#__codelineno-0-855"> 855</a></span>
<span class="normal"><a href="#__codelineno-0-856"> 856</a></span>
<span class="normal"><a href="#__codelineno-0-857"> 857</a></span>
<span class="normal"><a href="#__codelineno-0-858"> 858</a></span>
<span class="normal"><a href="#__codelineno-0-859"> 859</a></span>
<span class="normal"><a href="#__codelineno-0-860"> 860</a></span>
<span class="normal"><a href="#__codelineno-0-861"> 861</a></span>
<span class="normal"><a href="#__codelineno-0-862"> 862</a></span>
<span class="normal"><a href="#__codelineno-0-863"> 863</a></span>
<span class="normal"><a href="#__codelineno-0-864"> 864</a></span>
<span class="normal"><a href="#__codelineno-0-865"> 865</a></span>
<span class="normal"><a href="#__codelineno-0-866"> 866</a></span>
<span class="normal"><a href="#__codelineno-0-867"> 867</a></span>
<span class="normal"><a href="#__codelineno-0-868"> 868</a></span>
<span class="normal"><a href="#__codelineno-0-869"> 869</a></span>
<span class="normal"><a href="#__codelineno-0-870"> 870</a></span>
<span class="normal"><a href="#__codelineno-0-871"> 871</a></span>
<span class="normal"><a href="#__codelineno-0-872"> 872</a></span>
<span class="normal"><a href="#__codelineno-0-873"> 873</a></span>
<span class="normal"><a href="#__codelineno-0-874"> 874</a></span>
<span class="normal"><a href="#__codelineno-0-875"> 875</a></span>
<span class="normal"><a href="#__codelineno-0-876"> 876</a></span>
<span class="normal"><a href="#__codelineno-0-877"> 877</a></span>
<span class="normal"><a href="#__codelineno-0-878"> 878</a></span>
<span class="normal"><a href="#__codelineno-0-879"> 879</a></span>
<span class="normal"><a href="#__codelineno-0-880"> 880</a></span>
<span class="normal"><a href="#__codelineno-0-881"> 881</a></span>
<span class="normal"><a href="#__codelineno-0-882"> 882</a></span>
<span class="normal"><a href="#__codelineno-0-883"> 883</a></span>
<span class="normal"><a href="#__codelineno-0-884"> 884</a></span>
<span class="normal"><a href="#__codelineno-0-885"> 885</a></span>
<span class="normal"><a href="#__codelineno-0-886"> 886</a></span>
<span class="normal"><a href="#__codelineno-0-887"> 887</a></span>
<span class="normal"><a href="#__codelineno-0-888"> 888</a></span>
<span class="normal"><a href="#__codelineno-0-889"> 889</a></span>
<span class="normal"><a href="#__codelineno-0-890"> 890</a></span>
<span class="normal"><a href="#__codelineno-0-891"> 891</a></span>
<span class="normal"><a href="#__codelineno-0-892"> 892</a></span>
<span class="normal"><a href="#__codelineno-0-893"> 893</a></span>
<span class="normal"><a href="#__codelineno-0-894"> 894</a></span>
<span class="normal"><a href="#__codelineno-0-895"> 895</a></span>
<span class="normal"><a href="#__codelineno-0-896"> 896</a></span>
<span class="normal"><a href="#__codelineno-0-897"> 897</a></span>
<span class="normal"><a href="#__codelineno-0-898"> 898</a></span>
<span class="normal"><a href="#__codelineno-0-899"> 899</a></span>
<span class="normal"><a href="#__codelineno-0-900"> 900</a></span>
<span class="normal"><a href="#__codelineno-0-901"> 901</a></span>
<span class="normal"><a href="#__codelineno-0-902"> 902</a></span>
<span class="normal"><a href="#__codelineno-0-903"> 903</a></span>
<span class="normal"><a href="#__codelineno-0-904"> 904</a></span>
<span class="normal"><a href="#__codelineno-0-905"> 905</a></span>
<span class="normal"><a href="#__codelineno-0-906"> 906</a></span>
<span class="normal"><a href="#__codelineno-0-907"> 907</a></span>
<span class="normal"><a href="#__codelineno-0-908"> 908</a></span>
<span class="normal"><a href="#__codelineno-0-909"> 909</a></span>
<span class="normal"><a href="#__codelineno-0-910"> 910</a></span>
<span class="normal"><a href="#__codelineno-0-911"> 911</a></span>
<span class="normal"><a href="#__codelineno-0-912"> 912</a></span>
<span class="normal"><a href="#__codelineno-0-913"> 913</a></span>
<span class="normal"><a href="#__codelineno-0-914"> 914</a></span>
<span class="normal"><a href="#__codelineno-0-915"> 915</a></span>
<span class="normal"><a href="#__codelineno-0-916"> 916</a></span>
<span class="normal"><a href="#__codelineno-0-917"> 917</a></span>
<span class="normal"><a href="#__codelineno-0-918"> 918</a></span>
<span class="normal"><a href="#__codelineno-0-919"> 919</a></span>
<span class="normal"><a href="#__codelineno-0-920"> 920</a></span>
<span class="normal"><a href="#__codelineno-0-921"> 921</a></span>
<span class="normal"><a href="#__codelineno-0-922"> 922</a></span>
<span class="normal"><a href="#__codelineno-0-923"> 923</a></span>
<span class="normal"><a href="#__codelineno-0-924"> 924</a></span>
<span class="normal"><a href="#__codelineno-0-925"> 925</a></span>
<span class="normal"><a href="#__codelineno-0-926"> 926</a></span>
<span class="normal"><a href="#__codelineno-0-927"> 927</a></span>
<span class="normal"><a href="#__codelineno-0-928"> 928</a></span>
<span class="normal"><a href="#__codelineno-0-929"> 929</a></span>
<span class="normal"><a href="#__codelineno-0-930"> 930</a></span>
<span class="normal"><a href="#__codelineno-0-931"> 931</a></span>
<span class="normal"><a href="#__codelineno-0-932"> 932</a></span>
<span class="normal"><a href="#__codelineno-0-933"> 933</a></span>
<span class="normal"><a href="#__codelineno-0-934"> 934</a></span>
<span class="normal"><a href="#__codelineno-0-935"> 935</a></span>
<span class="normal"><a href="#__codelineno-0-936"> 936</a></span>
<span class="normal"><a href="#__codelineno-0-937"> 937</a></span>
<span class="normal"><a href="#__codelineno-0-938"> 938</a></span>
<span class="normal"><a href="#__codelineno-0-939"> 939</a></span>
<span class="normal"><a href="#__codelineno-0-940"> 940</a></span>
<span class="normal"><a href="#__codelineno-0-941"> 941</a></span>
<span class="normal"><a href="#__codelineno-0-942"> 942</a></span>
<span class="normal"><a href="#__codelineno-0-943"> 943</a></span>
<span class="normal"><a href="#__codelineno-0-944"> 944</a></span>
<span class="normal"><a href="#__codelineno-0-945"> 945</a></span>
<span class="normal"><a href="#__codelineno-0-946"> 946</a></span>
<span class="normal"><a href="#__codelineno-0-947"> 947</a></span>
<span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-557" name="__codelineno-0-557"></a><span class="k">class</span><span class="w"> </span><span class="nc">Executor</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">()</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">queue_manager</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">run_on_cluster</span> <span class="o">=</span> <span class="n">will_run_on_cluster</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">job_threads</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;job_threads&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_jobs</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># List to track active jobs</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>        <span class="k">if</span> <span class="s2">&quot;job_memory&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s2">&quot;job_total_memory&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>                <span class="s2">&quot;both job_memory and job_total_memory have been given&quot;</span><span class="p">)</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">job_total_memory</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;job_total_memory&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">job_memory</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;job_memory&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_total_memory</span> <span class="o">==</span> <span class="s2">&quot;unlimited&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_memory</span> <span class="o">==</span> <span class="s2">&quot;unlimited&quot;</span><span class="p">:</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">job_total_memory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_memory</span> <span class="o">=</span> <span class="s2">&quot;unlimited&quot;</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_total_memory</span><span class="p">:</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">job_memory</span> <span class="o">=</span> <span class="n">iotools</span><span class="o">.</span><span class="n">bytes2human</span><span class="p">(</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>                    <span class="n">iotools</span><span class="o">.</span><span class="n">human2bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_total_memory</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_threads</span><span class="p">)</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_memory</span><span class="p">:</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">job_total_memory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_memory</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_threads</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">job_memory</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">()[</span><span class="s2">&quot;cluster&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>                    <span class="s2">&quot;memory_default&quot;</span><span class="p">,</span> <span class="s2">&quot;4G&quot;</span><span class="p">)</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_memory</span> <span class="o">==</span> <span class="s2">&quot;unlimited&quot;</span><span class="p">:</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">job_total_memory</span> <span class="o">=</span> <span class="s2">&quot;unlimited&quot;</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">job_total_memory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_memory</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_threads</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ignore_pipe_errors</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ignore_pipe_errors&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ignore_errors</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ignore_errors&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">job_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;job_name&quot;</span><span class="p">,</span> <span class="s2">&quot;unknow_job_name&quot;</span><span class="p">)</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">task_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_name&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown_task_name&quot;</span><span class="p">)</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>        <span class="c1"># deduce output directory/directories, requires somewhat</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>        <span class="c1"># consistent naming in the calling function.</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>        <span class="n">outfiles</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>        <span class="k">if</span> <span class="s2">&quot;outfile&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>            <span class="n">outfiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;outfile&quot;</span><span class="p">])</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>        <span class="k">if</span> <span class="s2">&quot;outfiles&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>            <span class="n">outfiles</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;outfiles&quot;</span><span class="p">])</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_directories</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>            <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">outfiles</span><span class="p">]))</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">kwargs</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">work_dir</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">()[</span><span class="s2">&quot;work_dir&quot;</span><span class="p">]</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">shellfile</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;shell_logfile&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shellfile</span><span class="p">:</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">shellfile</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">):</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">shellfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shellfile</span><span class="p">))</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">monitor_interval_queued</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;monitor_interval_queued&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor_interval_queued</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">monitor_interval_queued</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">()[</span><span class="s2">&quot;cluster&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>                <span class="s1">&#39;monitor_interval_queued_default&#39;</span><span class="p">,</span> <span class="n">GEVENT_TIMEOUT_WAIT</span><span class="p">)</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">monitor_interval_running</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;monitor_interval_running&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor_interval_running</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">monitor_interval_running</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">()[</span><span class="s2">&quot;cluster&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>                <span class="s1">&#39;monitor_interval_running_default&#39;</span><span class="p">,</span> <span class="n">GEVENT_TIMEOUT_WAIT</span><span class="p">)</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>        <span class="c1"># Set up signal handlers for clean-up on interruption</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">setup_signal_handlers</span><span class="p">()</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>        <span class="k">return</span> <span class="bp">self</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>        <span class="k">pass</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">expand_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">):</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;add generic commands before and after statement.</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a><span class="sd">        The method scans the statement for arvados mount points and</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a><span class="sd">        inserts appropriate prefixes to make sure that the mount point</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a><span class="sd">        exists.</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a><span class="sd">        Arguments</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a><span class="sd">        ---------</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a><span class="sd">        statement : string</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a><span class="sd">            Command line statement to expand</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a><span class="sd">        -------</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a><span class="sd">        statement : string</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a><span class="sd">            The expanded statement.</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a><span class="sd">        &#39;&#39;&#39;</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>        <span class="n">setup_cmds</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>        <span class="n">teardown_cmds</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>        <span class="n">cleanup_funcs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>        <span class="n">setup_cmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;umask 002&quot;</span><span class="p">)</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;MKL_NUM_THREADS&quot;</span><span class="p">,</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>                    <span class="s2">&quot;OPENBLAS_NUM_THREADS&quot;</span><span class="p">,</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>                    <span class="s2">&quot;OMP_NUM_THREADS&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>            <span class="n">setup_cmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;export </span><span class="si">{}</span><span class="s2">=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>                <span class="n">var</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;job_threads&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>        <span class="k">if</span> <span class="s2">&quot;arv=&quot;</span> <span class="ow">in</span> <span class="n">statement</span><span class="p">:</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>            <span class="c1"># Todo: permit setting this in params</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>            <span class="n">arvados_api_token</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ARVADOS_API_TOKEN&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>            <span class="n">arvados_api_host</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ARVADOS_API_HOST&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">arvados_api_token</span><span class="p">:</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>                    <span class="s2">&quot;arvados mount encountered in statement </span><span class="si">{}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>                    <span class="s2">&quot;but ARVADOS_API_TOKEN not defined&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">statement</span><span class="p">))</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">arvados_api_host</span><span class="p">:</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>                    <span class="s2">&quot;arvados mount encountered in statement </span><span class="si">{}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>                    <span class="s2">&quot;but ARVADOS_API_HOST not defined&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">statement</span><span class="p">))</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>            <span class="n">mountpoint</span> <span class="o">=</span> <span class="n">get_temp_filename</span><span class="p">(</span><span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>            <span class="n">arvados_options</span> <span class="o">=</span> <span class="s2">&quot;--disable-event-listening --read-only&quot;</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>            <span class="n">setup_cmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>                <span class="p">(</span><span class="s1">&#39;export ARVADOS_API_TOKEN=&quot;</span><span class="si">{arvados_api_token}</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a>                 <span class="s1">&#39;export ARVADOS_API_HOST=&quot;</span><span class="si">{arvados_api_host}</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>                 <span class="s1">&#39;export ARVADOS_API_HOST_INSECURE=true&#39;</span><span class="p">,</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>                 <span class="s1">&#39;export ARVADOS_MOUNT_POINT=&quot;</span><span class="si">{mountpoint}</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>                 <span class="s1">&#39;mkdir -p &quot;</span><span class="si">{mountpoint}</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>                 <span class="s1">&#39;arv-mount </span><span class="si">{arvados_options}</span><span class="s1"> &quot;</span><span class="si">{mountpoint}</span><span class="s1">&quot; 2&gt;&gt; /dev/null&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>            <span class="n">statement</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;arv=&quot;</span><span class="p">,</span> <span class="n">mountpoint</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">statement</span><span class="p">)</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>            <span class="c1"># &quot;arv-mount --unmount {mountpoint}&quot; not available in newer</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>            <span class="c1"># arvados installs (0.1.20170707152712), so keep using</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>            <span class="c1"># fusermount. However, do not fail if you can&#39;t clean up, as</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>            <span class="c1"># there are arvados racing issues.</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>            <span class="n">cleanup_funcs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;unmount_arvados&quot;</span><span class="p">,</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a><span class="w">                                  </span><span class="sd">&#39;&#39;&#39;{{</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a><span class="sd">                                  set +e &amp;&amp;</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a><span class="sd">                                  fusermount -u {mountpoint} &amp;&amp;</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a><span class="sd">                                  rm -rf {mountpoint} &amp;&amp;</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a><span class="sd">                                  set -e</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a><span class="sd">                                  }}&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())))</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>        <span class="k">if</span> <span class="s2">&quot;job_condaenv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>            <span class="c1"># In conda &lt; 4.4 there is an issue with parallel activations,</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>            <span class="c1"># see https://github.com/conda/conda/issues/2837 .</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>            <span class="c1"># This has been fixed in conda 4.4, but we are on conda</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>            <span class="c1"># 4.3, presumably because we are still on py35. A work-around</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>            <span class="c1"># to source activate is to add the explicit path of the environment</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>            <span class="c1"># in version &gt;= 4.4, do</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>            <span class="c1"># setup_cmds.append(</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>            <span class="c1">#     &quot;conda activate {}&quot;.format(self.options[&quot;job_condaenv&quot;]))</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>            <span class="c1"># For old conda versions (note this will not work for tools that require</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>            <span class="c1"># additional environment variables)</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>            <span class="n">setup_cmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>                <span class="s2">&quot;export PATH=</span><span class="si">{}</span><span class="s2">:$PATH&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>                        <span class="n">get_conda_environment_directory</span><span class="p">(</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;job_condaenv&quot;</span><span class="p">]),</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>                        <span class="s2">&quot;bin&quot;</span><span class="p">)))</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>        <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">setup_cmds</span><span class="p">),</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>            <span class="n">statement</span><span class="p">,</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">teardown_cmds</span><span class="p">)))</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>        <span class="k">return</span> <span class="n">statement</span><span class="p">,</span> <span class="n">cleanup_funcs</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">build_job_script</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>                         <span class="n">statement</span><span class="p">):</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;build job script from statement.</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a><span class="sd">        returns (name_of_script, stdout_path, stderr_path)</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a><span class="sd">        &#39;&#39;&#39;</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>        <span class="n">tmpfilename</span> <span class="o">=</span> <span class="n">get_temp_filename</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>        <span class="n">tmpfilename</span> <span class="o">=</span> <span class="n">tmpfilename</span> <span class="o">+</span> <span class="s2">&quot;.sh&quot;</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>        <span class="n">expanded_statement</span><span class="p">,</span> <span class="n">cleanup_funcs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_statement</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tmpfilename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmpfile</span><span class="p">:</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>            <span class="c1"># disabled: -l -O expand_aliases\n&quot; )</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>            <span class="c1"># make executable</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>            <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;#!/bin/bash -eu</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_pipe_errors</span><span class="p">:</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>                <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;set -o pipefail</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>            <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">tmpfilename</span><span class="p">,</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IRWXG</span> <span class="o">|</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IRWXU</span><span class="p">)</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>            <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">cd </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">work_dir</span><span class="p">))</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directories</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>                <span class="k">for</span> <span class="n">outdir</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directories</span><span class="p">:</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>                    <span class="k">if</span> <span class="n">outdir</span><span class="p">:</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>                        <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">mkdir -p </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">outdir</span><span class="p">))</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>            <span class="c1"># create and set system scratch dir for temporary files</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>            <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;umask 002</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>            <span class="n">cluster_tmpdir</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">()[</span><span class="s2">&quot;cluster_tmpdir&quot;</span><span class="p">]</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_on_cluster</span> <span class="ow">and</span> <span class="n">cluster_tmpdir</span><span class="p">:</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>                <span class="n">tmpdir</span> <span class="o">=</span> <span class="n">cluster_tmpdir</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>                <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;TMPDIR=`mktemp -d -p </span><span class="si">{}</span><span class="s2">`</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">))</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>                <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;export TMPDIR</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>                <span class="n">tmpdir</span> <span class="o">=</span> <span class="n">get_temp_dir</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="n">get_params</span><span class="p">()[</span><span class="s2">&quot;tmpdir&quot;</span><span class="p">],</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>                                      <span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>                <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;mkdir -p </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">))</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>                <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;export TMPDIR=</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">))</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>            <span class="n">cleanup_funcs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>                <span class="p">(</span><span class="s2">&quot;clean_temp&quot;</span><span class="p">,</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>                 <span class="s2">&quot;{{ rm -rf </span><span class="si">{}</span><span class="s2">; }}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)))</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>            <span class="c1"># output times whenever script exits, preserving</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>            <span class="c1"># return status</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>            <span class="n">cleanup_funcs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;info&quot;</span><span class="p">,</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>                                  <span class="s2">&quot;{ echo &#39;benchmark&#39;; hostname; times; }&quot;</span><span class="p">))</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>            <span class="k">for</span> <span class="n">cleanup_func</span><span class="p">,</span> <span class="n">cleanup_code</span> <span class="ow">in</span> <span class="n">cleanup_funcs</span><span class="p">:</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>                <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{}</span><span class="s2">() </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cleanup_func</span><span class="p">,</span> <span class="n">cleanup_code</span><span class="p">))</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>            <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">clean_all() {{ </span><span class="si">{}</span><span class="s2">; }}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>                <span class="s2">&quot;; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cleanup_funcs</span><span class="p">])))</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>            <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">trap clean_all EXIT</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_memory</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;unlimited&quot;</span><span class="p">,</span> <span class="s2">&quot;etc&quot;</span><span class="p">)</span> <span class="ow">and</span> \
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>               <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cluster_memory_ulimit&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>                <span class="c1"># restrict virtual memory</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>                <span class="c1"># Note that there are resources in SGE which could do this directly</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>                <span class="c1"># such as v_hmem.</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>                <span class="c1"># Note that limiting resident set sizes (RSS) with ulimit is not</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>                <span class="c1"># possible in newer kernels.</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>                <span class="c1"># -v and -m accept memory in kb</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>                <span class="n">requested_memory_kb</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>                    <span class="mi">1000</span><span class="p">,</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>                    <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>                        <span class="n">iotools</span><span class="o">.</span><span class="n">human2bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_memory</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_threads</span><span class="p">)))</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>                <span class="c1"># unsetting error exit as often not permissions</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>                <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;set +e</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>                <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ulimit -v </span><span class="si">{}</span><span class="s2"> &gt; /dev/null </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>                    <span class="n">requested_memory_kb</span><span class="p">))</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>                <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ulimit -m </span><span class="si">{}</span><span class="s2"> &gt; /dev/null </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>                    <span class="n">requested_memory_kb</span><span class="p">))</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>                <span class="c1"># set as hard limit</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>                <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ulimit -H -v &gt; /dev/null </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>                <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;set -e</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shellfile</span><span class="p">:</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>                <span class="c1"># make sure path exists that we want to write to</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>                <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;mkdir -p $(dirname </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">shellfile</span><span class="p">))</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>                <span class="c1"># output low-level debugging information to a shell log file</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>                <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>                    <span class="s1">&#39;echo &quot;</span><span class="si">%s</span><span class="s1"> : START -&gt; </span><span class="si">%s</span><span class="s1">&quot; &gt;&gt; </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="p">,</span> <span class="n">tmpfilename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shellfile</span><span class="p">))</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>                <span class="c1"># disabled - problems with quoting</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>                <span class="c1"># tmpfile.write( &#39;&#39;&#39;echo &#39;statement=%s&#39; &gt;&gt; %s\n&#39;&#39;&#39; %</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>                <span class="c1"># (shellquote(statement), self.shellfile) )</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>                <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;set | sed &#39;s/^/</span><span class="si">%s</span><span class="s2"> : /&#39; &gt;&gt; </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>                              <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shellfile</span><span class="p">))</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>                <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;pwd | sed &#39;s/^/</span><span class="si">%s</span><span class="s2"> : /&#39; &gt;&gt; </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>                              <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shellfile</span><span class="p">))</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>                <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;hostname | sed &#39;s/^/</span><span class="si">%s</span><span class="s2">: /&#39; &gt;&gt; </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>                              <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shellfile</span><span class="p">))</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>                <span class="c1"># cat /proc/meminfo is Linux specific</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>                <span class="k">if</span> <span class="n">get_params</span><span class="p">()[</span><span class="s1">&#39;os&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Linux&#39;</span><span class="p">:</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>                    <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;cat /proc/meminfo | sed &#39;s/^/</span><span class="si">%s</span><span class="s2">: /&#39; &gt;&gt; </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>                                  <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shellfile</span><span class="p">))</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>                <span class="k">elif</span> <span class="n">get_params</span><span class="p">()[</span><span class="s1">&#39;os&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Darwin&#39;</span><span class="p">:</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>                    <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;vm_stat | sed &#39;s/^/</span><span class="si">%s</span><span class="s2">: /&#39; &gt;&gt; </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>                                  <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shellfile</span><span class="p">))</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>                <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>                    <span class="s1">&#39;echo &quot;</span><span class="si">%s</span><span class="s1"> : END -&gt; </span><span class="si">%s</span><span class="s1">&quot; &gt;&gt; </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="p">,</span> <span class="n">tmpfilename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shellfile</span><span class="p">))</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>                <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ulimit | sed &#39;s/^/</span><span class="si">%s</span><span class="s2">: /&#39; &gt;&gt; </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>                              <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shellfile</span><span class="p">))</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>            <span class="n">job_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">tmpfilename</span><span class="p">)</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>            <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">expanded_statement</span><span class="p">)</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>            <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>            <span class="n">tmpfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>        <span class="k">return</span> <span class="n">statement</span><span class="p">,</span> <span class="n">job_path</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">collect_benchmark_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>                               <span class="n">statements</span><span class="p">,</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>                               <span class="n">resource_usage</span><span class="p">):</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;collect benchmark data from a job&#39;s stdout and any resource usage</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a><span class="sd">        information that might be present.</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a><span class="sd">        If time_data is given, read output from time command.</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>        <span class="n">benchmark_data</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">get_val</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">alt</span><span class="p">):</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>            <span class="n">val</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">alt</span><span class="p">)</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>            <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="s2">&quot;unknown&quot;</span> <span class="ow">or</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>                <span class="n">val</span> <span class="o">=</span> <span class="n">alt</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>            <span class="k">return</span> <span class="n">val</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>        <span class="c1"># build resource usage data structure - part native, part</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>        <span class="c1"># mapped to common fields</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>        <span class="k">for</span> <span class="n">jobinfo</span><span class="p">,</span> <span class="n">statement</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">resource_usage</span><span class="p">,</span> <span class="n">statements</span><span class="p">):</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>            <span class="k">if</span> <span class="n">resource_usage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>                <span class="n">E</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;no resource usage for </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_name</span><span class="p">))</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>                <span class="k">continue</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>            <span class="c1"># add some common fields</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;task&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_name</span><span class="p">,</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>                    <span class="s2">&quot;engine&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>                    <span class="s2">&quot;statement&quot;</span><span class="p">:</span> <span class="n">statement</span><span class="p">,</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>                    <span class="s2">&quot;job_id&quot;</span><span class="p">:</span> <span class="n">jobinfo</span><span class="o">.</span><span class="n">jobId</span><span class="p">,</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>                    <span class="s2">&quot;slots&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_threads</span><span class="p">}</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>            <span class="c1"># native specs</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>            <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">jobinfo</span><span class="o">.</span><span class="n">resourceUsage</span><span class="p">)</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>            <span class="c1"># translate specs</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue_manager</span><span class="p">:</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>                <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">queue_manager</span><span class="o">.</span><span class="n">map_resource_usage</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">DATA2TYPE</span><span class="p">))</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>            <span class="n">cpu_time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">get_val</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;cpu_t&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>            <span class="n">start_time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">get_val</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;start_time&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>            <span class="n">end_time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">get_val</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;end_time&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a>            <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>                <span class="c1"># avoid division by 0 error</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>                <span class="s2">&quot;percent_cpu&quot;</span><span class="p">:</span> <span class="p">(</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>                    <span class="mf">100.0</span> <span class="o">*</span> <span class="n">cpu_time</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">(</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_threads</span><span class="p">),</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>                <span class="s2">&quot;total_t&quot;</span><span class="p">:</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>            <span class="p">})</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>            <span class="n">benchmark_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>        <span class="k">return</span> <span class="n">benchmark_data</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_container_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">volumes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">env_vars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="s2">&quot;docker&quot;</span><span class="p">):</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set container configuration for all tasks executed by this executor.&quot;&quot;&quot;</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">image</span><span class="p">:</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;An image must be specified for the container configuration.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">container_config</span> <span class="o">=</span> <span class="n">ContainerConfig</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">volumes</span><span class="o">=</span><span class="n">volumes</span><span class="p">,</span> <span class="n">env_vars</span><span class="o">=</span><span class="n">env_vars</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="n">runtime</span><span class="p">)</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_info</span><span class="p">):</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a job to active_jobs list when it starts.&quot;&quot;&quot;</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job_info</span><span class="p">)</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job started: </span><span class="si">{</span><span class="n">job_info</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">finish_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_info</span><span class="p">):</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a job from active_jobs list when it finishes.&quot;&quot;&quot;</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>        <span class="k">if</span> <span class="n">job_info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_jobs</span><span class="p">:</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">active_jobs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">job_info</span><span class="p">)</span>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job completed: </span><span class="si">{</span><span class="n">job_info</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cleanup_all_jobs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean up all remaining active jobs on interruption.&quot;&quot;&quot;</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleaning up all job outputs due to pipeline interruption&quot;</span><span class="p">)</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>        <span class="k">for</span> <span class="n">job_info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_jobs</span><span class="p">:</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cleanup_failed_job</span><span class="p">(</span><span class="n">job_info</span><span class="p">)</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_jobs</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Clear the list after cleanup</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_signal_handlers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set up signal handlers to clean up jobs on SIGINT and SIGTERM.&quot;&quot;&quot;</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">signal_handler</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received signal </span><span class="si">{</span><span class="n">signum</span><span class="si">}</span><span class="s2">. Starting clean-up.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cleanup_all_jobs</span><span class="p">()</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>            <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>        <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">signal_handler</span><span class="p">)</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>        <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGTERM</span><span class="p">,</span> <span class="n">signal_handler</span><span class="p">)</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cleanup_failed_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_info</span><span class="p">):</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean up files generated by a failed job.&quot;&quot;&quot;</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>        <span class="k">if</span> <span class="s2">&quot;outfile&quot;</span> <span class="ow">in</span> <span class="n">job_info</span><span class="p">:</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>            <span class="n">outfiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">job_info</span><span class="p">[</span><span class="s2">&quot;outfile&quot;</span><span class="p">]]</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a>        <span class="k">elif</span> <span class="s2">&quot;outfiles&quot;</span> <span class="ow">in</span> <span class="n">job_info</span><span class="p">:</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>            <span class="n">outfiles</span> <span class="o">=</span> <span class="n">job_info</span><span class="p">[</span><span class="s2">&quot;outfiles&quot;</span><span class="p">]</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No output files found for job </span><span class="si">{</span><span class="n">job_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;job_name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>            <span class="k">return</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>        <span class="k">for</span> <span class="n">outfile</span> <span class="ow">in</span> <span class="n">outfiles</span><span class="p">:</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outfile</span><span class="p">):</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed failed job output file: </span><span class="si">{</span><span class="n">outfile</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>                <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error removing file </span><span class="si">{</span><span class="n">outfile</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output file not found (already removed or not created): </span><span class="si">{</span><span class="n">outfile</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>            <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>            <span class="n">statement_list</span><span class="p">,</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>            <span class="n">job_memory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>            <span class="n">job_threads</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a>            <span class="n">container_runtime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>            <span class="n">image</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>            <span class="n">volumes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a>            <span class="n">env_vars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>            <span class="o">**</span><span class="n">kwargs</span><span class="p">,):</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a><span class="sd">        Execute a list of statements with optional container support.</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a><span class="sd">            Args:</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a><span class="sd">                statement_list (list): List of commands to execute.</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a><span class="sd">                job_memory (str): Memory requirements (e.g., &quot;4G&quot;).</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a><span class="sd">                job_threads (int): Number of threads to use.</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a><span class="sd">                container_runtime (str): Container runtime (&quot;docker&quot; or &quot;singularity&quot;).</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a><span class="sd">                image (str): Container image to use.</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a><span class="sd">                volumes (list): Volume mappings (e.g., [&#39;/data:/data&#39;]).</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a><span class="sd">                env_vars (dict): Environment variables for the container.</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a><span class="sd">                **kwargs: Additional arguments.</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>        <span class="c1"># Validation checks</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>        <span class="k">if</span> <span class="n">container_runtime</span> <span class="ow">and</span> <span class="n">container_runtime</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;docker&quot;</span><span class="p">,</span> <span class="s2">&quot;singularity&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid container_runtime: </span><span class="si">{</span><span class="n">container_runtime</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Container runtime must be &#39;docker&#39; or &#39;singularity&#39;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>        <span class="k">if</span> <span class="n">container_runtime</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">image</span><span class="p">:</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Container runtime specified without an image: </span><span class="si">{</span><span class="n">container_runtime</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;An image must be specified when using a container runtime&quot;</span><span class="p">)</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>        <span class="n">benchmark_data</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>        <span class="k">for</span> <span class="n">statement</span> <span class="ow">in</span> <span class="n">statement_list</span><span class="p">:</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>            <span class="n">job_info</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;statement&quot;</span><span class="p">:</span> <span class="n">statement</span><span class="p">}</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start_job</span><span class="p">(</span><span class="n">job_info</span><span class="p">)</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>                <span class="c1"># Prepare containerized execution</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>                <span class="k">if</span> <span class="n">container_runtime</span><span class="p">:</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_container_config</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">volumes</span><span class="o">=</span><span class="n">volumes</span><span class="p">,</span> <span class="n">env_vars</span><span class="o">=</span><span class="n">env_vars</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="n">container_runtime</span><span class="p">)</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>                    <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">container_config</span><span class="o">.</span><span class="n">get_container_command</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>                <span class="c1"># Add memory and thread environment variables</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>                <span class="k">if</span> <span class="n">job_memory</span><span class="p">:</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>                    <span class="n">env_vars</span> <span class="o">=</span> <span class="n">env_vars</span> <span class="ow">or</span> <span class="p">{}</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>                    <span class="n">env_vars</span><span class="p">[</span><span class="s2">&quot;JOB_MEMORY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">job_memory</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>                <span class="k">if</span> <span class="n">job_threads</span><span class="p">:</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>                    <span class="n">env_vars</span> <span class="o">=</span> <span class="n">env_vars</span> <span class="ow">or</span> <span class="p">{}</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>                    <span class="n">env_vars</span><span class="p">[</span><span class="s2">&quot;JOB_THREADS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">job_threads</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>                <span class="c1"># Debugging: Log the constructed command</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Executing command: </span><span class="si">{</span><span class="n">statement</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>                <span class="c1"># Build and execute the statement</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>                <span class="n">full_statement</span><span class="p">,</span> <span class="n">job_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_job_script</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>                <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>                    <span class="n">full_statement</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>                <span class="p">)</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>                <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>                <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>                    <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>                        <span class="sa">f</span><span class="s2">&quot;Job failed with return code </span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">returncode</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>                        <span class="sa">f</span><span class="s2">&quot;stderr: </span><span class="si">{</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">command: </span><span class="si">{</span><span class="n">statement</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>                <span class="c1"># Collect benchmark data for successful jobs</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>                <span class="n">benchmark_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">collect_benchmark_data</span><span class="p">(</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>                        <span class="n">statement</span><span class="p">,</span> <span class="n">resource_usage</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;job_id&quot;</span><span class="p">:</span> <span class="n">process</span><span class="o">.</span><span class="n">pid</span><span class="p">}</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>                <span class="p">)</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">finish_job</span><span class="p">(</span><span class="n">job_info</span><span class="p">)</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cleanup_failed_job</span><span class="p">(</span><span class="n">job_info</span><span class="p">)</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_errors</span><span class="p">:</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>                    <span class="k">raise</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>        <span class="k">return</span> <span class="n">benchmark_data</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.Executor.build_job_script" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">build_job_script</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.Executor.build_job_script" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>build job script from statement.</p>
<p>returns (name_of_script, stdout_path, stderr_path)</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span>
<span class="normal"><a href="#__codelineno-0-839">839</a></span>
<span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span>
<span class="normal"><a href="#__codelineno-0-842">842</a></span>
<span class="normal"><a href="#__codelineno-0-843">843</a></span>
<span class="normal"><a href="#__codelineno-0-844">844</a></span>
<span class="normal"><a href="#__codelineno-0-845">845</a></span>
<span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-730" name="__codelineno-0-730"></a><span class="k">def</span><span class="w"> </span><span class="nf">build_job_script</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>                     <span class="n">statement</span><span class="p">):</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;build job script from statement.</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a><span class="sd">    returns (name_of_script, stdout_path, stderr_path)</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>    <span class="n">tmpfilename</span> <span class="o">=</span> <span class="n">get_temp_filename</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>    <span class="n">tmpfilename</span> <span class="o">=</span> <span class="n">tmpfilename</span> <span class="o">+</span> <span class="s2">&quot;.sh&quot;</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>    <span class="n">expanded_statement</span><span class="p">,</span> <span class="n">cleanup_funcs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_statement</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tmpfilename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmpfile</span><span class="p">:</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>        <span class="c1"># disabled: -l -O expand_aliases\n&quot; )</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>        <span class="c1"># make executable</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>        <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;#!/bin/bash -eu</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_pipe_errors</span><span class="p">:</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>            <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;set -o pipefail</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>        <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">tmpfilename</span><span class="p">,</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IRWXG</span> <span class="o">|</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IRWXU</span><span class="p">)</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>        <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">cd </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">work_dir</span><span class="p">))</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directories</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>            <span class="k">for</span> <span class="n">outdir</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_directories</span><span class="p">:</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>                <span class="k">if</span> <span class="n">outdir</span><span class="p">:</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>                    <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">mkdir -p </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">outdir</span><span class="p">))</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>        <span class="c1"># create and set system scratch dir for temporary files</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>        <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;umask 002</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>        <span class="n">cluster_tmpdir</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">()[</span><span class="s2">&quot;cluster_tmpdir&quot;</span><span class="p">]</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_on_cluster</span> <span class="ow">and</span> <span class="n">cluster_tmpdir</span><span class="p">:</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>            <span class="n">tmpdir</span> <span class="o">=</span> <span class="n">cluster_tmpdir</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>            <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;TMPDIR=`mktemp -d -p </span><span class="si">{}</span><span class="s2">`</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">))</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>            <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;export TMPDIR</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>            <span class="n">tmpdir</span> <span class="o">=</span> <span class="n">get_temp_dir</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="n">get_params</span><span class="p">()[</span><span class="s2">&quot;tmpdir&quot;</span><span class="p">],</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>                                  <span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>            <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;mkdir -p </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">))</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>            <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;export TMPDIR=</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">))</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>        <span class="n">cleanup_funcs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>            <span class="p">(</span><span class="s2">&quot;clean_temp&quot;</span><span class="p">,</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>             <span class="s2">&quot;{{ rm -rf </span><span class="si">{}</span><span class="s2">; }}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)))</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>        <span class="c1"># output times whenever script exits, preserving</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>        <span class="c1"># return status</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>        <span class="n">cleanup_funcs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;info&quot;</span><span class="p">,</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>                              <span class="s2">&quot;{ echo &#39;benchmark&#39;; hostname; times; }&quot;</span><span class="p">))</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>        <span class="k">for</span> <span class="n">cleanup_func</span><span class="p">,</span> <span class="n">cleanup_code</span> <span class="ow">in</span> <span class="n">cleanup_funcs</span><span class="p">:</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>            <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{}</span><span class="s2">() </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cleanup_func</span><span class="p">,</span> <span class="n">cleanup_code</span><span class="p">))</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>        <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">clean_all() {{ </span><span class="si">{}</span><span class="s2">; }}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>            <span class="s2">&quot;; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cleanup_funcs</span><span class="p">])))</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>        <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">trap clean_all EXIT</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_memory</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;unlimited&quot;</span><span class="p">,</span> <span class="s2">&quot;etc&quot;</span><span class="p">)</span> <span class="ow">and</span> \
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>           <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cluster_memory_ulimit&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>            <span class="c1"># restrict virtual memory</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>            <span class="c1"># Note that there are resources in SGE which could do this directly</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>            <span class="c1"># such as v_hmem.</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>            <span class="c1"># Note that limiting resident set sizes (RSS) with ulimit is not</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>            <span class="c1"># possible in newer kernels.</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>            <span class="c1"># -v and -m accept memory in kb</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>            <span class="n">requested_memory_kb</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>                <span class="mi">1000</span><span class="p">,</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>                <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>                    <span class="n">iotools</span><span class="o">.</span><span class="n">human2bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_memory</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_threads</span><span class="p">)))</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>            <span class="c1"># unsetting error exit as often not permissions</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>            <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;set +e</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>            <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ulimit -v </span><span class="si">{}</span><span class="s2"> &gt; /dev/null </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>                <span class="n">requested_memory_kb</span><span class="p">))</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>            <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ulimit -m </span><span class="si">{}</span><span class="s2"> &gt; /dev/null </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>                <span class="n">requested_memory_kb</span><span class="p">))</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>            <span class="c1"># set as hard limit</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>            <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ulimit -H -v &gt; /dev/null </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>            <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;set -e</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shellfile</span><span class="p">:</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>            <span class="c1"># make sure path exists that we want to write to</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>            <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;mkdir -p $(dirname </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">shellfile</span><span class="p">))</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>            <span class="c1"># output low-level debugging information to a shell log file</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>            <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>                <span class="s1">&#39;echo &quot;</span><span class="si">%s</span><span class="s1"> : START -&gt; </span><span class="si">%s</span><span class="s1">&quot; &gt;&gt; </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="p">,</span> <span class="n">tmpfilename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shellfile</span><span class="p">))</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>            <span class="c1"># disabled - problems with quoting</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>            <span class="c1"># tmpfile.write( &#39;&#39;&#39;echo &#39;statement=%s&#39; &gt;&gt; %s\n&#39;&#39;&#39; %</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>            <span class="c1"># (shellquote(statement), self.shellfile) )</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>            <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;set | sed &#39;s/^/</span><span class="si">%s</span><span class="s2"> : /&#39; &gt;&gt; </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>                          <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shellfile</span><span class="p">))</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>            <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;pwd | sed &#39;s/^/</span><span class="si">%s</span><span class="s2"> : /&#39; &gt;&gt; </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>                          <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shellfile</span><span class="p">))</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>            <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;hostname | sed &#39;s/^/</span><span class="si">%s</span><span class="s2">: /&#39; &gt;&gt; </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>                          <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shellfile</span><span class="p">))</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>            <span class="c1"># cat /proc/meminfo is Linux specific</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>            <span class="k">if</span> <span class="n">get_params</span><span class="p">()[</span><span class="s1">&#39;os&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Linux&#39;</span><span class="p">:</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>                <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;cat /proc/meminfo | sed &#39;s/^/</span><span class="si">%s</span><span class="s2">: /&#39; &gt;&gt; </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>                              <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shellfile</span><span class="p">))</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>            <span class="k">elif</span> <span class="n">get_params</span><span class="p">()[</span><span class="s1">&#39;os&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Darwin&#39;</span><span class="p">:</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>                <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;vm_stat | sed &#39;s/^/</span><span class="si">%s</span><span class="s2">: /&#39; &gt;&gt; </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>                              <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shellfile</span><span class="p">))</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>            <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>                <span class="s1">&#39;echo &quot;</span><span class="si">%s</span><span class="s1"> : END -&gt; </span><span class="si">%s</span><span class="s1">&quot; &gt;&gt; </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="p">,</span> <span class="n">tmpfilename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shellfile</span><span class="p">))</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>            <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ulimit | sed &#39;s/^/</span><span class="si">%s</span><span class="s2">: /&#39; &gt;&gt; </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>                          <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shellfile</span><span class="p">))</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>        <span class="n">job_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">tmpfilename</span><span class="p">)</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>        <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">expanded_statement</span><span class="p">)</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>        <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>        <span class="n">tmpfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>    <span class="k">return</span> <span class="n">statement</span><span class="p">,</span> <span class="n">job_path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.Executor.cleanup_all_jobs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cleanup_all_jobs</span><span class="p">()</span></code>

<a href="#cgatcore.pipeline.Executor.cleanup_all_jobs" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Clean up all remaining active jobs on interruption.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-921">921</a></span>
<span class="normal"><a href="#__codelineno-0-922">922</a></span>
<span class="normal"><a href="#__codelineno-0-923">923</a></span>
<span class="normal"><a href="#__codelineno-0-924">924</a></span>
<span class="normal"><a href="#__codelineno-0-925">925</a></span>
<span class="normal"><a href="#__codelineno-0-926">926</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-921" name="__codelineno-0-921"></a><span class="k">def</span><span class="w"> </span><span class="nf">cleanup_all_jobs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Clean up all remaining active jobs on interruption.&quot;&quot;&quot;</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cleaning up all job outputs due to pipeline interruption&quot;</span><span class="p">)</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>    <span class="k">for</span> <span class="n">job_info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_jobs</span><span class="p">:</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cleanup_failed_job</span><span class="p">(</span><span class="n">job_info</span><span class="p">)</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">active_jobs</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Clear the list after cleanup</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.Executor.cleanup_failed_job" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cleanup_failed_job</span><span class="p">(</span><span class="n">job_info</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.Executor.cleanup_failed_job" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Clean up files generated by a failed job.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-939">939</a></span>
<span class="normal"><a href="#__codelineno-0-940">940</a></span>
<span class="normal"><a href="#__codelineno-0-941">941</a></span>
<span class="normal"><a href="#__codelineno-0-942">942</a></span>
<span class="normal"><a href="#__codelineno-0-943">943</a></span>
<span class="normal"><a href="#__codelineno-0-944">944</a></span>
<span class="normal"><a href="#__codelineno-0-945">945</a></span>
<span class="normal"><a href="#__codelineno-0-946">946</a></span>
<span class="normal"><a href="#__codelineno-0-947">947</a></span>
<span class="normal"><a href="#__codelineno-0-948">948</a></span>
<span class="normal"><a href="#__codelineno-0-949">949</a></span>
<span class="normal"><a href="#__codelineno-0-950">950</a></span>
<span class="normal"><a href="#__codelineno-0-951">951</a></span>
<span class="normal"><a href="#__codelineno-0-952">952</a></span>
<span class="normal"><a href="#__codelineno-0-953">953</a></span>
<span class="normal"><a href="#__codelineno-0-954">954</a></span>
<span class="normal"><a href="#__codelineno-0-955">955</a></span>
<span class="normal"><a href="#__codelineno-0-956">956</a></span>
<span class="normal"><a href="#__codelineno-0-957">957</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-939" name="__codelineno-0-939"></a><span class="k">def</span><span class="w"> </span><span class="nf">cleanup_failed_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_info</span><span class="p">):</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Clean up files generated by a failed job.&quot;&quot;&quot;</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>    <span class="k">if</span> <span class="s2">&quot;outfile&quot;</span> <span class="ow">in</span> <span class="n">job_info</span><span class="p">:</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>        <span class="n">outfiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">job_info</span><span class="p">[</span><span class="s2">&quot;outfile&quot;</span><span class="p">]]</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a>    <span class="k">elif</span> <span class="s2">&quot;outfiles&quot;</span> <span class="ow">in</span> <span class="n">job_info</span><span class="p">:</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>        <span class="n">outfiles</span> <span class="o">=</span> <span class="n">job_info</span><span class="p">[</span><span class="s2">&quot;outfiles&quot;</span><span class="p">]</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No output files found for job </span><span class="si">{</span><span class="n">job_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;job_name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>        <span class="k">return</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>    <span class="k">for</span> <span class="n">outfile</span> <span class="ow">in</span> <span class="n">outfiles</span><span class="p">:</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outfile</span><span class="p">):</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed failed job output file: </span><span class="si">{</span><span class="n">outfile</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error removing file </span><span class="si">{</span><span class="n">outfile</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output file not found (already removed or not created): </span><span class="si">{</span><span class="n">outfile</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.Executor.collect_benchmark_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">collect_benchmark_data</span><span class="p">(</span><span class="n">statements</span><span class="p">,</span> <span class="n">resource_usage</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.Executor.collect_benchmark_data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>collect benchmark data from a job's stdout and any resource usage
information that might be present.</p>
<p>If time_data is given, read output from time command.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span>
<span class="normal"><a href="#__codelineno-0-853">853</a></span>
<span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span>
<span class="normal"><a href="#__codelineno-0-865">865</a></span>
<span class="normal"><a href="#__codelineno-0-866">866</a></span>
<span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span>
<span class="normal"><a href="#__codelineno-0-869">869</a></span>
<span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span>
<span class="normal"><a href="#__codelineno-0-876">876</a></span>
<span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span>
<span class="normal"><a href="#__codelineno-0-881">881</a></span>
<span class="normal"><a href="#__codelineno-0-882">882</a></span>
<span class="normal"><a href="#__codelineno-0-883">883</a></span>
<span class="normal"><a href="#__codelineno-0-884">884</a></span>
<span class="normal"><a href="#__codelineno-0-885">885</a></span>
<span class="normal"><a href="#__codelineno-0-886">886</a></span>
<span class="normal"><a href="#__codelineno-0-887">887</a></span>
<span class="normal"><a href="#__codelineno-0-888">888</a></span>
<span class="normal"><a href="#__codelineno-0-889">889</a></span>
<span class="normal"><a href="#__codelineno-0-890">890</a></span>
<span class="normal"><a href="#__codelineno-0-891">891</a></span>
<span class="normal"><a href="#__codelineno-0-892">892</a></span>
<span class="normal"><a href="#__codelineno-0-893">893</a></span>
<span class="normal"><a href="#__codelineno-0-894">894</a></span>
<span class="normal"><a href="#__codelineno-0-895">895</a></span>
<span class="normal"><a href="#__codelineno-0-896">896</a></span>
<span class="normal"><a href="#__codelineno-0-897">897</a></span>
<span class="normal"><a href="#__codelineno-0-898">898</a></span>
<span class="normal"><a href="#__codelineno-0-899">899</a></span>
<span class="normal"><a href="#__codelineno-0-900">900</a></span>
<span class="normal"><a href="#__codelineno-0-901">901</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-850" name="__codelineno-0-850"></a><span class="k">def</span><span class="w"> </span><span class="nf">collect_benchmark_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>                           <span class="n">statements</span><span class="p">,</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>                           <span class="n">resource_usage</span><span class="p">):</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;collect benchmark data from a job&#39;s stdout and any resource usage</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a><span class="sd">    information that might be present.</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a><span class="sd">    If time_data is given, read output from time command.</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>    <span class="n">benchmark_data</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_val</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">alt</span><span class="p">):</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>        <span class="n">val</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">alt</span><span class="p">)</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>        <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="s2">&quot;unknown&quot;</span> <span class="ow">or</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>            <span class="n">val</span> <span class="o">=</span> <span class="n">alt</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>        <span class="k">return</span> <span class="n">val</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>    <span class="c1"># build resource usage data structure - part native, part</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>    <span class="c1"># mapped to common fields</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>    <span class="k">for</span> <span class="n">jobinfo</span><span class="p">,</span> <span class="n">statement</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">resource_usage</span><span class="p">,</span> <span class="n">statements</span><span class="p">):</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>        <span class="k">if</span> <span class="n">resource_usage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>            <span class="n">E</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;no resource usage for </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_name</span><span class="p">))</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>            <span class="k">continue</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>        <span class="c1"># add some common fields</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;task&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_name</span><span class="p">,</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>                <span class="s2">&quot;engine&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>                <span class="s2">&quot;statement&quot;</span><span class="p">:</span> <span class="n">statement</span><span class="p">,</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>                <span class="s2">&quot;job_id&quot;</span><span class="p">:</span> <span class="n">jobinfo</span><span class="o">.</span><span class="n">jobId</span><span class="p">,</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>                <span class="s2">&quot;slots&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_threads</span><span class="p">}</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>        <span class="c1"># native specs</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>        <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">jobinfo</span><span class="o">.</span><span class="n">resourceUsage</span><span class="p">)</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>        <span class="c1"># translate specs</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue_manager</span><span class="p">:</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>            <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">queue_manager</span><span class="o">.</span><span class="n">map_resource_usage</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">DATA2TYPE</span><span class="p">))</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>        <span class="n">cpu_time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">get_val</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;cpu_t&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>        <span class="n">start_time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">get_val</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;start_time&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>        <span class="n">end_time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">get_val</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;end_time&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a>        <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>            <span class="c1"># avoid division by 0 error</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>            <span class="s2">&quot;percent_cpu&quot;</span><span class="p">:</span> <span class="p">(</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>                <span class="mf">100.0</span> <span class="o">*</span> <span class="n">cpu_time</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">(</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_threads</span><span class="p">),</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>            <span class="s2">&quot;total_t&quot;</span><span class="p">:</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>        <span class="p">})</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>        <span class="n">benchmark_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>    <span class="k">return</span> <span class="n">benchmark_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.Executor.expand_statement" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">expand_statement</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.Executor.expand_statement" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>add generic commands before and after statement.</p>
<p>The method scans the statement for arvados mount points and
inserts appropriate prefixes to make sure that the mount point
exists.</p>
<h5 id="cgatcore.pipeline.Executor.expand_statement--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.Executor.expand_statement--arguments" title="Permanent link">&para;</a></h5>
<p>statement : string
    Command line statement to expand</p>
<h5 id="cgatcore.pipeline.Executor.expand_statement--returns">Returns<a class="headerlink" href="#cgatcore.pipeline.Executor.expand_statement--returns" title="Permanent link">&para;</a></h5>
<p>statement : string
    The expanded statement.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-634" name="__codelineno-0-634"></a><span class="k">def</span><span class="w"> </span><span class="nf">expand_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">):</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;add generic commands before and after statement.</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a><span class="sd">    The method scans the statement for arvados mount points and</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a><span class="sd">    inserts appropriate prefixes to make sure that the mount point</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a><span class="sd">    exists.</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a><span class="sd">    statement : string</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a><span class="sd">        Command line statement to expand</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a><span class="sd">    -------</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a><span class="sd">    statement : string</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a><span class="sd">        The expanded statement.</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>    <span class="n">setup_cmds</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>    <span class="n">teardown_cmds</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>    <span class="n">cleanup_funcs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>    <span class="n">setup_cmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;umask 002&quot;</span><span class="p">)</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;MKL_NUM_THREADS&quot;</span><span class="p">,</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>                <span class="s2">&quot;OPENBLAS_NUM_THREADS&quot;</span><span class="p">,</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>                <span class="s2">&quot;OMP_NUM_THREADS&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>        <span class="n">setup_cmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;export </span><span class="si">{}</span><span class="s2">=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>            <span class="n">var</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;job_threads&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>    <span class="k">if</span> <span class="s2">&quot;arv=&quot;</span> <span class="ow">in</span> <span class="n">statement</span><span class="p">:</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>        <span class="c1"># Todo: permit setting this in params</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>        <span class="n">arvados_api_token</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ARVADOS_API_TOKEN&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>        <span class="n">arvados_api_host</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ARVADOS_API_HOST&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">arvados_api_token</span><span class="p">:</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>                <span class="s2">&quot;arvados mount encountered in statement </span><span class="si">{}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>                <span class="s2">&quot;but ARVADOS_API_TOKEN not defined&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">statement</span><span class="p">))</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">arvados_api_host</span><span class="p">:</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>                <span class="s2">&quot;arvados mount encountered in statement </span><span class="si">{}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>                <span class="s2">&quot;but ARVADOS_API_HOST not defined&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">statement</span><span class="p">))</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>        <span class="n">mountpoint</span> <span class="o">=</span> <span class="n">get_temp_filename</span><span class="p">(</span><span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>        <span class="n">arvados_options</span> <span class="o">=</span> <span class="s2">&quot;--disable-event-listening --read-only&quot;</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>        <span class="n">setup_cmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>            <span class="p">(</span><span class="s1">&#39;export ARVADOS_API_TOKEN=&quot;</span><span class="si">{arvados_api_token}</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a>             <span class="s1">&#39;export ARVADOS_API_HOST=&quot;</span><span class="si">{arvados_api_host}</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>             <span class="s1">&#39;export ARVADOS_API_HOST_INSECURE=true&#39;</span><span class="p">,</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>             <span class="s1">&#39;export ARVADOS_MOUNT_POINT=&quot;</span><span class="si">{mountpoint}</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>             <span class="s1">&#39;mkdir -p &quot;</span><span class="si">{mountpoint}</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>             <span class="s1">&#39;arv-mount </span><span class="si">{arvados_options}</span><span class="s1"> &quot;</span><span class="si">{mountpoint}</span><span class="s1">&quot; 2&gt;&gt; /dev/null&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>        <span class="n">statement</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;arv=&quot;</span><span class="p">,</span> <span class="n">mountpoint</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">statement</span><span class="p">)</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>        <span class="c1"># &quot;arv-mount --unmount {mountpoint}&quot; not available in newer</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>        <span class="c1"># arvados installs (0.1.20170707152712), so keep using</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>        <span class="c1"># fusermount. However, do not fail if you can&#39;t clean up, as</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>        <span class="c1"># there are arvados racing issues.</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>        <span class="n">cleanup_funcs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;unmount_arvados&quot;</span><span class="p">,</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a><span class="w">                              </span><span class="sd">&#39;&#39;&#39;{{</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a><span class="sd">                              set +e &amp;&amp;</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a><span class="sd">                              fusermount -u {mountpoint} &amp;&amp;</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a><span class="sd">                              rm -rf {mountpoint} &amp;&amp;</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a><span class="sd">                              set -e</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a><span class="sd">                              }}&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())))</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>    <span class="k">if</span> <span class="s2">&quot;job_condaenv&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>        <span class="c1"># In conda &lt; 4.4 there is an issue with parallel activations,</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>        <span class="c1"># see https://github.com/conda/conda/issues/2837 .</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>        <span class="c1"># This has been fixed in conda 4.4, but we are on conda</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>        <span class="c1"># 4.3, presumably because we are still on py35. A work-around</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>        <span class="c1"># to source activate is to add the explicit path of the environment</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>        <span class="c1"># in version &gt;= 4.4, do</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>        <span class="c1"># setup_cmds.append(</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>        <span class="c1">#     &quot;conda activate {}&quot;.format(self.options[&quot;job_condaenv&quot;]))</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>        <span class="c1"># For old conda versions (note this will not work for tools that require</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>        <span class="c1"># additional environment variables)</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>        <span class="n">setup_cmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>            <span class="s2">&quot;export PATH=</span><span class="si">{}</span><span class="s2">:$PATH&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>                    <span class="n">get_conda_environment_directory</span><span class="p">(</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;job_condaenv&quot;</span><span class="p">]),</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>                    <span class="s2">&quot;bin&quot;</span><span class="p">)))</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>    <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">setup_cmds</span><span class="p">),</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>        <span class="n">statement</span><span class="p">,</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">teardown_cmds</span><span class="p">)))</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>    <span class="k">return</span> <span class="n">statement</span><span class="p">,</span> <span class="n">cleanup_funcs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.Executor.finish_job" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">finish_job</span><span class="p">(</span><span class="n">job_info</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.Executor.finish_job" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Remove a job from active_jobs list when it finishes.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-915">915</a></span>
<span class="normal"><a href="#__codelineno-0-916">916</a></span>
<span class="normal"><a href="#__codelineno-0-917">917</a></span>
<span class="normal"><a href="#__codelineno-0-918">918</a></span>
<span class="normal"><a href="#__codelineno-0-919">919</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-915" name="__codelineno-0-915"></a><span class="k">def</span><span class="w"> </span><span class="nf">finish_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_info</span><span class="p">):</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove a job from active_jobs list when it finishes.&quot;&quot;&quot;</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>    <span class="k">if</span> <span class="n">job_info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_jobs</span><span class="p">:</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">active_jobs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">job_info</span><span class="p">)</span>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job completed: </span><span class="si">{</span><span class="n">job_info</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.Executor.run" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run</span><span class="p">(</span><span class="n">statement_list</span><span class="p">,</span> <span class="n">job_memory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">job_threads</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">container_runtime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">volumes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">env_vars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.Executor.run" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Execute a list of statements with optional container support.</p>
<div class="codehilite"><pre><span></span><code><span class="n">Args</span><span class="o">:</span>
<span class="w">    </span><span class="n">statement_list</span><span class="w"> </span><span class="o">(</span><span class="n">list</span><span class="o">):</span><span class="w"> </span><span class="n">List</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">execute</span><span class="o">.</span>
<span class="w">    </span><span class="n">job_memory</span><span class="w"> </span><span class="o">(</span><span class="n">str</span><span class="o">):</span><span class="w"> </span><span class="n">Memory</span><span class="w"> </span><span class="n">requirements</span><span class="w"> </span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">g</span><span class="o">.,</span><span class="w"> </span><span class="s2">&quot;4G&quot;</span><span class="o">).</span>
<span class="w">    </span><span class="n">job_threads</span><span class="w"> </span><span class="o">(</span><span class="n">int</span><span class="o">):</span><span class="w"> </span><span class="n">Number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">threads</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">use</span><span class="o">.</span>
<span class="w">    </span><span class="n">container_runtime</span><span class="w"> </span><span class="o">(</span><span class="n">str</span><span class="o">):</span><span class="w"> </span><span class="n">Container</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="o">(</span><span class="s2">&quot;docker&quot;</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="s2">&quot;singularity&quot;</span><span class="o">).</span>
<span class="w">    </span><span class="n">image</span><span class="w"> </span><span class="o">(</span><span class="n">str</span><span class="o">):</span><span class="w"> </span><span class="n">Container</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">use</span><span class="o">.</span>
<span class="w">    </span><span class="n">volumes</span><span class="w"> </span><span class="o">(</span><span class="n">list</span><span class="o">):</span><span class="w"> </span><span class="n">Volume</span><span class="w"> </span><span class="n">mappings</span><span class="w"> </span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">g</span><span class="o">.,</span><span class="w"> </span><span class="o">[</span><span class="s1">&#39;/data:/data&#39;</span><span class="o">]).</span>
<span class="w">    </span><span class="n">env_vars</span><span class="w"> </span><span class="o">(</span><span class="n">dict</span><span class="o">):</span><span class="w"> </span><span class="n">Environment</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">container</span><span class="o">.</span>
<span class="w">    </span><span class="o">**</span><span class="n">kwargs</span><span class="o">:</span><span class="w"> </span><span class="n">Additional</span><span class="w"> </span><span class="k">arguments</span><span class="o">.</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-959" name="__codelineno-0-959"></a><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>        <span class="n">statement_list</span><span class="p">,</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>        <span class="n">job_memory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>        <span class="n">job_threads</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a>        <span class="n">container_runtime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>        <span class="n">image</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>        <span class="n">volumes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a>        <span class="n">env_vars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,):</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a><span class="sd">    Execute a list of statements with optional container support.</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a><span class="sd">            statement_list (list): List of commands to execute.</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a><span class="sd">            job_memory (str): Memory requirements (e.g., &quot;4G&quot;).</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a><span class="sd">            job_threads (int): Number of threads to use.</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a><span class="sd">            container_runtime (str): Container runtime (&quot;docker&quot; or &quot;singularity&quot;).</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a><span class="sd">            image (str): Container image to use.</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a><span class="sd">            volumes (list): Volume mappings (e.g., [&#39;/data:/data&#39;]).</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a><span class="sd">            env_vars (dict): Environment variables for the container.</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a><span class="sd">            **kwargs: Additional arguments.</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>    <span class="c1"># Validation checks</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>    <span class="k">if</span> <span class="n">container_runtime</span> <span class="ow">and</span> <span class="n">container_runtime</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;docker&quot;</span><span class="p">,</span> <span class="s2">&quot;singularity&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid container_runtime: </span><span class="si">{</span><span class="n">container_runtime</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Container runtime must be &#39;docker&#39; or &#39;singularity&#39;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>    <span class="k">if</span> <span class="n">container_runtime</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">image</span><span class="p">:</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Container runtime specified without an image: </span><span class="si">{</span><span class="n">container_runtime</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;An image must be specified when using a container runtime&quot;</span><span class="p">)</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>    <span class="n">benchmark_data</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>    <span class="k">for</span> <span class="n">statement</span> <span class="ow">in</span> <span class="n">statement_list</span><span class="p">:</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>        <span class="n">job_info</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;statement&quot;</span><span class="p">:</span> <span class="n">statement</span><span class="p">}</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start_job</span><span class="p">(</span><span class="n">job_info</span><span class="p">)</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>            <span class="c1"># Prepare containerized execution</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>            <span class="k">if</span> <span class="n">container_runtime</span><span class="p">:</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_container_config</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">volumes</span><span class="o">=</span><span class="n">volumes</span><span class="p">,</span> <span class="n">env_vars</span><span class="o">=</span><span class="n">env_vars</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="n">container_runtime</span><span class="p">)</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>                <span class="n">statement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">container_config</span><span class="o">.</span><span class="n">get_container_command</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>            <span class="c1"># Add memory and thread environment variables</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>            <span class="k">if</span> <span class="n">job_memory</span><span class="p">:</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>                <span class="n">env_vars</span> <span class="o">=</span> <span class="n">env_vars</span> <span class="ow">or</span> <span class="p">{}</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>                <span class="n">env_vars</span><span class="p">[</span><span class="s2">&quot;JOB_MEMORY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">job_memory</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>            <span class="k">if</span> <span class="n">job_threads</span><span class="p">:</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>                <span class="n">env_vars</span> <span class="o">=</span> <span class="n">env_vars</span> <span class="ow">or</span> <span class="p">{}</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>                <span class="n">env_vars</span><span class="p">[</span><span class="s2">&quot;JOB_THREADS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">job_threads</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>            <span class="c1"># Debugging: Log the constructed command</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Executing command: </span><span class="si">{</span><span class="n">statement</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>            <span class="c1"># Build and execute the statement</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>            <span class="n">full_statement</span><span class="p">,</span> <span class="n">job_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_job_script</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>            <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>                <span class="n">full_statement</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>            <span class="p">)</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>            <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>            <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>                <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>                    <span class="sa">f</span><span class="s2">&quot;Job failed with return code </span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">returncode</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>                    <span class="sa">f</span><span class="s2">&quot;stderr: </span><span class="si">{</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">command: </span><span class="si">{</span><span class="n">statement</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>                <span class="p">)</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>            <span class="c1"># Collect benchmark data for successful jobs</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>            <span class="n">benchmark_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">collect_benchmark_data</span><span class="p">(</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>                    <span class="n">statement</span><span class="p">,</span> <span class="n">resource_usage</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;job_id&quot;</span><span class="p">:</span> <span class="n">process</span><span class="o">.</span><span class="n">pid</span><span class="p">}</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>                <span class="p">)</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>            <span class="p">)</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">finish_job</span><span class="p">(</span><span class="n">job_info</span><span class="p">)</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cleanup_failed_job</span><span class="p">(</span><span class="n">job_info</span><span class="p">)</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_errors</span><span class="p">:</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>                <span class="k">raise</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>    <span class="k">return</span> <span class="n">benchmark_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.Executor.set_container_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_container_config</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">volumes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">env_vars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="s1">&#39;docker&#39;</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.Executor.set_container_config" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Set container configuration for all tasks executed by this executor.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-903">903</a></span>
<span class="normal"><a href="#__codelineno-0-904">904</a></span>
<span class="normal"><a href="#__codelineno-0-905">905</a></span>
<span class="normal"><a href="#__codelineno-0-906">906</a></span>
<span class="normal"><a href="#__codelineno-0-907">907</a></span>
<span class="normal"><a href="#__codelineno-0-908">908</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-903" name="__codelineno-0-903"></a><span class="k">def</span><span class="w"> </span><span class="nf">set_container_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">volumes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">env_vars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="s2">&quot;docker&quot;</span><span class="p">):</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Set container configuration for all tasks executed by this executor.&quot;&quot;&quot;</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">image</span><span class="p">:</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;An image must be specified for the container configuration.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">container_config</span> <span class="o">=</span> <span class="n">ContainerConfig</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">volumes</span><span class="o">=</span><span class="n">volumes</span><span class="p">,</span> <span class="n">env_vars</span><span class="o">=</span><span class="n">env_vars</span><span class="p">,</span> <span class="n">runtime</span><span class="o">=</span><span class="n">runtime</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.Executor.setup_signal_handlers" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_signal_handlers</span><span class="p">()</span></code>

<a href="#cgatcore.pipeline.Executor.setup_signal_handlers" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Set up signal handlers to clean up jobs on SIGINT and SIGTERM.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-928">928</a></span>
<span class="normal"><a href="#__codelineno-0-929">929</a></span>
<span class="normal"><a href="#__codelineno-0-930">930</a></span>
<span class="normal"><a href="#__codelineno-0-931">931</a></span>
<span class="normal"><a href="#__codelineno-0-932">932</a></span>
<span class="normal"><a href="#__codelineno-0-933">933</a></span>
<span class="normal"><a href="#__codelineno-0-934">934</a></span>
<span class="normal"><a href="#__codelineno-0-935">935</a></span>
<span class="normal"><a href="#__codelineno-0-936">936</a></span>
<span class="normal"><a href="#__codelineno-0-937">937</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-928" name="__codelineno-0-928"></a><span class="k">def</span><span class="w"> </span><span class="nf">setup_signal_handlers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up signal handlers to clean up jobs on SIGINT and SIGTERM.&quot;&quot;&quot;</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">signal_handler</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received signal </span><span class="si">{</span><span class="n">signum</span><span class="si">}</span><span class="s2">. Starting clean-up.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cleanup_all_jobs</span><span class="p">()</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>    <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">signal_handler</span><span class="p">)</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>    <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGTERM</span><span class="p">,</span> <span class="n">signal_handler</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.Executor.start_job" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">start_job</span><span class="p">(</span><span class="n">job_info</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.Executor.start_job" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Add a job to active_jobs list when it starts.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-910">910</a></span>
<span class="normal"><a href="#__codelineno-0-911">911</a></span>
<span class="normal"><a href="#__codelineno-0-912">912</a></span>
<span class="normal"><a href="#__codelineno-0-913">913</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-910" name="__codelineno-0-910"></a><span class="k">def</span><span class="w"> </span><span class="nf">start_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_info</span><span class="p">):</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a job to active_jobs list when it starts.&quot;&quot;&quot;</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">active_jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job_info</span><span class="p">)</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job started: </span><span class="si">{</span><span class="n">job_info</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cgatcore.pipeline.KubernetesExecutor" class="doc doc-heading">
            <code>KubernetesExecutor</code>


<a href="#cgatcore.pipeline.KubernetesExecutor" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="cgatcore.pipeline.base_executor.BaseExecutor">BaseExecutor</span></code></p>


        <p>Executor for managing and running jobs on a Kubernetes cluster.</p>
<p>This class is responsible for submitting jobs to a Kubernetes cluster, monitoring their execution,
and collecting benchmark data related to their performance.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="cgatcore.pipeline.KubernetesExecutor.namespace">namespace</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Kubernetes namespace in which to run the jobs. Defaults to 'default'.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cgatcore.pipeline.KubernetesExecutor.api">api</span></code></td>
            <td>
                  <code>CoreV1Api</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Kubernetes Core API client for interacting with the cluster.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cgatcore.pipeline.KubernetesExecutor.batch_api">batch_api</span></code></td>
            <td>
                  <code>BatchV1Api</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Kubernetes Batch API client for managing jobs.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>cgatcore/pipeline/kubernetes.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-0-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-0-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="k">class</span><span class="w"> </span><span class="nc">KubernetesExecutor</span><span class="p">(</span><span class="n">BaseExecutor</span><span class="p">):</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Executor for managing and running jobs on a Kubernetes cluster.</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">    This class is responsible for submitting jobs to a Kubernetes cluster, monitoring their execution,</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">    and collecting benchmark data related to their performance.</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">    Attributes:</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">        namespace (str): The Kubernetes namespace in which to run the jobs. Defaults to &#39;default&#39;.</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">        api (CoreV1Api): The Kubernetes Core API client for interacting with the cluster.</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">        batch_api (BatchV1Api): The Kubernetes Batch API client for managing jobs.</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the KubernetesExecutor with the specified configuration options.</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">            **kwargs: Additional configuration options, including the namespace.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">namespace</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;namespace&quot;</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">)</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>        <span class="c1"># Load Kubernetes configuration</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>            <span class="n">config</span><span class="o">.</span><span class="n">load_kube_config</span><span class="p">()</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">api</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">CoreV1Api</span><span class="p">()</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">batch_api</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">BatchV1Api</span><span class="p">()</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Kubernetes configuration loaded successfully.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="k">except</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">ConfigException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to load Kubernetes configuration&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>            <span class="k">raise</span> <span class="n">e</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span> <span class="n">job_path</span><span class="p">,</span> <span class="n">job_condaenv</span><span class="p">):</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Submits a job to the Kubernetes cluster to run the specified command.</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        This method creates a Kubernetes Job object and submits it to the cluster. The job runs the</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        specified command in a container, using the provided Conda environment.</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">            statement (str): The command to execute in the job.</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">            job_path (str): The path to the job script.</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">            job_condaenv (str): The name of the Conda environment to use.</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="n">job_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;cgat-</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">job_path</span><span class="p">)</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="n">container_image</span> <span class="o">=</span> <span class="s2">&quot;your-docker-image:tag&quot;</span>  <span class="c1"># Replace with your Docker image</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="c1"># Define Kubernetes Job spec</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="n">job_spec</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">V1Job</span><span class="p">(</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>            <span class="n">metadata</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">V1ObjectMeta</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">job_name</span><span class="p">),</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>            <span class="n">spec</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">V1JobSpec</span><span class="p">(</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>                <span class="n">template</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">V1PodTemplateSpec</span><span class="p">(</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>                    <span class="n">spec</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">V1PodSpec</span><span class="p">(</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>                        <span class="n">containers</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>                            <span class="n">client</span><span class="o">.</span><span class="n">V1Container</span><span class="p">(</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>                                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cgat-job&quot;</span><span class="p">,</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>                                <span class="n">image</span><span class="o">=</span><span class="n">container_image</span><span class="p">,</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>                                <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;/bin/bash&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">statement</span><span class="p">],</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>                                <span class="n">env</span><span class="o">=</span><span class="p">[</span><span class="n">client</span><span class="o">.</span><span class="n">V1EnvVar</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;CONDA_ENV&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">job_condaenv</span><span class="p">)],</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>                            <span class="p">)</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>                        <span class="p">],</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>                        <span class="n">restart_policy</span><span class="o">=</span><span class="s2">&quot;Never&quot;</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>                    <span class="p">)</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>                <span class="p">),</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>                <span class="n">backoff_limit</span><span class="o">=</span><span class="mi">4</span>  <span class="c1"># Retry policy in case of transient failures</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>            <span class="p">)</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="p">)</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="c1"># Create and monitor Kubernetes Job</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating Kubernetes Job &#39;</span><span class="si">{</span><span class="n">job_name</span><span class="si">}</span><span class="s2">&#39; in namespace &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>            <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">batch_api</span><span class="o">.</span><span class="n">create_namespaced_job</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="p">,</span> <span class="n">job_spec</span><span class="p">)</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_job_completion</span><span class="p">(</span><span class="n">job_name</span><span class="p">)</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>            <span class="n">end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>            <span class="n">logs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pod_logs</span><span class="p">(</span><span class="n">job_name</span><span class="p">)</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">collect_metric_data</span><span class="p">(</span><span class="s2">&quot;Kubernetes Job&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="s2">&quot;time_data.json&quot;</span><span class="p">)</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_cleanup_job</span><span class="p">(</span><span class="n">job_name</span><span class="p">)</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="k">return</span> <span class="n">logs</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_wait_for_job_completion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_name</span><span class="p">):</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Wait until the job completes or fails.&quot;&quot;&quot;</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>            <span class="n">job_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_api</span><span class="o">.</span><span class="n">read_namespaced_job_status</span><span class="p">(</span><span class="n">job_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="p">)</span><span class="o">.</span><span class="n">status</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="k">if</span> <span class="n">job_status</span><span class="o">.</span><span class="n">succeeded</span><span class="p">:</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job &#39;</span><span class="si">{</span><span class="n">job_name</span><span class="si">}</span><span class="s2">&#39; completed successfully.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>                <span class="k">return</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="k">if</span> <span class="n">job_status</span><span class="o">.</span><span class="n">failed</span><span class="p">:</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job &#39;</span><span class="si">{</span><span class="n">job_name</span><span class="si">}</span><span class="s2">&#39; failed.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Kubernetes Job </span><span class="si">{</span><span class="n">job_name</span><span class="si">}</span><span class="s2"> failed.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_pod_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_name</span><span class="p">):</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve logs from the Job&#39;s pod.&quot;&quot;&quot;</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="n">pods</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">list_namespaced_pod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="p">,</span> <span class="n">label_selector</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;job-name=</span><span class="si">{</span><span class="n">job_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">pods</span><span class="p">:</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No pod found for job &#39;</span><span class="si">{</span><span class="n">job_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No pod found for job &#39;</span><span class="si">{</span><span class="n">job_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="n">pod_name</span> <span class="o">=</span> <span class="n">pods</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fetching logs from pod &#39;</span><span class="si">{</span><span class="n">pod_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">read_namespaced_pod_log</span><span class="p">(</span><span class="n">pod_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="p">)</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_cleanup_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_name</span><span class="p">):</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete the Job and its pods.&quot;&quot;&quot;</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">batch_api</span><span class="o">.</span><span class="n">delete_namespaced_job</span><span class="p">(</span><span class="n">job_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="p">,</span> <span class="n">propagation_policy</span><span class="o">=</span><span class="s2">&quot;Background&quot;</span><span class="p">)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job &#39;</span><span class="si">{</span><span class="n">job_name</span><span class="si">}</span><span class="s2">&#39; cleaned up successfully.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="k">except</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">ApiException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to delete Job &#39;</span><span class="si">{</span><span class="n">job_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">collect_benchmark_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statements</span><span class="p">,</span> <span class="n">resource_usage</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Collect benchmark data for Kubernetes jobs.</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">        This method gathers information about the executed statements and any resource usage data.</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">            statements (list): List of executed statements.</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">            resource_usage (list, optional): Resource usage data.</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">            dict: A dictionary containing the task name, total execution time, executed statements,</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">                  and resource usage data.</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>            <span class="s2">&quot;task&quot;</span><span class="p">:</span> <span class="s2">&quot;kubernetes_task&quot;</span><span class="p">,</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="s2">&quot;total_t&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>  <span class="c1"># Example value, adjust as needed</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="s2">&quot;statements&quot;</span><span class="p">:</span> <span class="n">statements</span><span class="p">,</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="s2">&quot;resource_usage&quot;</span><span class="p">:</span> <span class="n">resource_usage</span> <span class="ow">or</span> <span class="p">[]</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="p">}</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">collect_metric_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="n">time_data_file</span><span class="p">):</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">        Collects metric data related to job duration and writes it to a file.</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">        - process (str): Process name for tracking purposes.</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">        - start_time (datetime): Timestamp when the job started.</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">        - end_time (datetime): Timestamp when the job ended.</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">        - time_data_file (str): Path to a file where timing data will be saved.</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="n">duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="n">metric_data</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>            <span class="s2">&quot;process&quot;</span><span class="p">:</span> <span class="n">process</span><span class="p">,</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>            <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="n">start_time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>            <span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="n">end_time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="s2">&quot;duration_seconds&quot;</span><span class="p">:</span> <span class="n">duration</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="p">}</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="c1"># Log metric data</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>            <span class="sa">f</span><span class="s2">&quot;Metric data collected for process &#39;</span><span class="si">{</span><span class="n">process</span><span class="si">}</span><span class="s2">&#39;: start time = </span><span class="si">{</span><span class="n">start_time</span><span class="si">}</span><span class="s2">, end time = </span><span class="si">{</span><span class="n">end_time</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>            <span class="sa">f</span><span class="s2">&quot;duration = </span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s2"> seconds.&quot;</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="p">)</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="c1"># Write metric data to file</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">time_data_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">metric_data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Metric data saved to </span><span class="si">{</span><span class="n">time_data_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error writing metric data to file&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>            <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.KubernetesExecutor.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.KubernetesExecutor.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initializes the KubernetesExecutor with the specified configuration options.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional configuration options, including the namespace.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/kubernetes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes the KubernetesExecutor with the specified configuration options.</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        **kwargs: Additional configuration options, including the namespace.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">namespace</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;namespace&quot;</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">)</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="c1"># Load Kubernetes configuration</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>        <span class="n">config</span><span class="o">.</span><span class="n">load_kube_config</span><span class="p">()</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">api</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">CoreV1Api</span><span class="p">()</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">batch_api</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">BatchV1Api</span><span class="p">()</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Kubernetes configuration loaded successfully.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="k">except</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">ConfigException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to load Kubernetes configuration&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.KubernetesExecutor.collect_benchmark_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">collect_benchmark_data</span><span class="p">(</span><span class="n">statements</span><span class="p">,</span> <span class="n">resource_usage</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.KubernetesExecutor.collect_benchmark_data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Collect benchmark data for Kubernetes jobs.</p>
<p>This method gathers information about the executed statements and any resource usage data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>statements</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of executed statements.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>resource_usage</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Resource usage data.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the task name, total execution time, executed statements,
  and resource usage data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/kubernetes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="k">def</span><span class="w"> </span><span class="nf">collect_benchmark_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statements</span><span class="p">,</span> <span class="n">resource_usage</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Collect benchmark data for Kubernetes jobs.</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    This method gathers information about the executed statements and any resource usage data.</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        statements (list): List of executed statements.</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">        resource_usage (list, optional): Resource usage data.</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">        dict: A dictionary containing the task name, total execution time, executed statements,</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">              and resource usage data.</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="s2">&quot;task&quot;</span><span class="p">:</span> <span class="s2">&quot;kubernetes_task&quot;</span><span class="p">,</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="s2">&quot;total_t&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>  <span class="c1"># Example value, adjust as needed</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="s2">&quot;statements&quot;</span><span class="p">:</span> <span class="n">statements</span><span class="p">,</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="s2">&quot;resource_usage&quot;</span><span class="p">:</span> <span class="n">resource_usage</span> <span class="ow">or</span> <span class="p">[]</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.KubernetesExecutor.collect_metric_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">collect_metric_data</span><span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="n">time_data_file</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.KubernetesExecutor.collect_metric_data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Collects metric data related to job duration and writes it to a file.</p>
<p>Parameters:
- process (str): Process name for tracking purposes.
- start_time (datetime): Timestamp when the job started.
- end_time (datetime): Timestamp when the job ended.
- time_data_file (str): Path to a file where timing data will be saved.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/kubernetes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="k">def</span><span class="w"> </span><span class="nf">collect_metric_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="n">time_data_file</span><span class="p">):</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">    Collects metric data related to job duration and writes it to a file.</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">    - process (str): Process name for tracking purposes.</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">    - start_time (datetime): Timestamp when the job started.</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">    - end_time (datetime): Timestamp when the job ended.</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">    - time_data_file (str): Path to a file where timing data will be saved.</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>    <span class="n">duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>    <span class="n">metric_data</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="s2">&quot;process&quot;</span><span class="p">:</span> <span class="n">process</span><span class="p">,</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="n">start_time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="n">end_time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="s2">&quot;duration_seconds&quot;</span><span class="p">:</span> <span class="n">duration</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>    <span class="p">}</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="c1"># Log metric data</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="sa">f</span><span class="s2">&quot;Metric data collected for process &#39;</span><span class="si">{</span><span class="n">process</span><span class="si">}</span><span class="s2">&#39;: start time = </span><span class="si">{</span><span class="n">start_time</span><span class="si">}</span><span class="s2">, end time = </span><span class="si">{</span><span class="n">end_time</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="sa">f</span><span class="s2">&quot;duration = </span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s2"> seconds.&quot;</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>    <span class="p">)</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>    <span class="c1"># Write metric data to file</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">time_data_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">metric_data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Metric data saved to </span><span class="si">{</span><span class="n">time_data_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error writing metric data to file&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.KubernetesExecutor.run" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">job_path</span><span class="p">,</span> <span class="n">job_condaenv</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.KubernetesExecutor.run" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Submits a job to the Kubernetes cluster to run the specified command.</p>
<p>This method creates a Kubernetes Job object and submits it to the cluster. The job runs the
specified command in a container, using the provided Conda environment.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>statement</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The command to execute in the job.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>job_path</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the job script.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>job_condaenv</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the Conda environment to use.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/kubernetes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span> <span class="n">job_path</span><span class="p">,</span> <span class="n">job_condaenv</span><span class="p">):</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Submits a job to the Kubernetes cluster to run the specified command.</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    This method creates a Kubernetes Job object and submits it to the cluster. The job runs the</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">    specified command in a container, using the provided Conda environment.</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        statement (str): The command to execute in the job.</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        job_path (str): The path to the job script.</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        job_condaenv (str): The name of the Conda environment to use.</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="n">job_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;cgat-</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">job_path</span><span class="p">)</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="n">container_image</span> <span class="o">=</span> <span class="s2">&quot;your-docker-image:tag&quot;</span>  <span class="c1"># Replace with your Docker image</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="c1"># Define Kubernetes Job spec</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="n">job_spec</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">V1Job</span><span class="p">(</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="n">metadata</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">V1ObjectMeta</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">job_name</span><span class="p">),</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="n">spec</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">V1JobSpec</span><span class="p">(</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>            <span class="n">template</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">V1PodTemplateSpec</span><span class="p">(</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>                <span class="n">spec</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">V1PodSpec</span><span class="p">(</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>                    <span class="n">containers</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>                        <span class="n">client</span><span class="o">.</span><span class="n">V1Container</span><span class="p">(</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>                            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cgat-job&quot;</span><span class="p">,</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>                            <span class="n">image</span><span class="o">=</span><span class="n">container_image</span><span class="p">,</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>                            <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;/bin/bash&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">statement</span><span class="p">],</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>                            <span class="n">env</span><span class="o">=</span><span class="p">[</span><span class="n">client</span><span class="o">.</span><span class="n">V1EnvVar</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;CONDA_ENV&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">job_condaenv</span><span class="p">)],</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>                        <span class="p">)</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>                    <span class="p">],</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>                    <span class="n">restart_policy</span><span class="o">=</span><span class="s2">&quot;Never&quot;</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>                <span class="p">)</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>            <span class="p">),</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>            <span class="n">backoff_limit</span><span class="o">=</span><span class="mi">4</span>  <span class="c1"># Retry policy in case of transient failures</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="p">)</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="p">)</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>    <span class="c1"># Create and monitor Kubernetes Job</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating Kubernetes Job &#39;</span><span class="si">{</span><span class="n">job_name</span><span class="si">}</span><span class="s2">&#39; in namespace &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">batch_api</span><span class="o">.</span><span class="n">create_namespaced_job</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="p">,</span> <span class="n">job_spec</span><span class="p">)</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_job_completion</span><span class="p">(</span><span class="n">job_name</span><span class="p">)</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="n">end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="n">logs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pod_logs</span><span class="p">(</span><span class="n">job_name</span><span class="p">)</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collect_metric_data</span><span class="p">(</span><span class="s2">&quot;Kubernetes Job&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="s2">&quot;time_data.json&quot;</span><span class="p">)</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cleanup_job</span><span class="p">(</span><span class="n">job_name</span><span class="p">)</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="k">return</span> <span class="n">logs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cgatcore.pipeline.LoggingFilterProgress" class="doc doc-heading">
            <code>LoggingFilterProgress</code>


<a href="#cgatcore.pipeline.LoggingFilterProgress" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="logging.Filter">Filter</span></code></p>


        <p>add progress information to the log-stream.</p>
<p>A :term:<code>task</code> is a ruffus_ decorated function, which will execute
one or more :term:<code>jobs</code>.</p>
<p>Valid task/job status:
update
   task/job needs updating
completed
   task/job completed successfully
failed
   task/job failed
running
   task/job is running
ignore
   ignore task/job (is up-to-date)</p>
<p>This filter adds the following context to a log record:</p>
<p>task
   task_name</p>
<p>task_status
   task status</p>
<p>task_total
   number of jobs in task</p>
<p>task_completed
   number of jobs in task completed</p>
<p>task_completed_percent
   percentage of task completed</p>
<p>The filter will also generate an additional log message in json format
with the fields above.</p>
<h4 id="cgatcore.pipeline.LoggingFilterProgress--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.LoggingFilterProgress--arguments" title="Permanent link">&para;</a></h4>
<p>ruffus_text : string
    Log messages from ruffus.pipeline_printout. These are used
    to collect all tasks that will be executed during pipeline
    execution.</p>






              <details class="quote">
                <summary>Source code in <code>cgatcore/pipeline/control.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-999" name="__codelineno-0-999"></a><span class="k">class</span><span class="w"> </span><span class="nc">LoggingFilterProgress</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Filter</span><span class="p">):</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;add progress information to the log-stream.</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a><span class="sd">    A :term:`task` is a ruffus_ decorated function, which will execute</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a><span class="sd">    one or more :term:`jobs`.</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a><span class="sd">    Valid task/job status:</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a><span class="sd">    update</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a><span class="sd">       task/job needs updating</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a><span class="sd">    completed</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a><span class="sd">       task/job completed successfully</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a><span class="sd">    failed</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a><span class="sd">       task/job failed</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a><span class="sd">    running</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a><span class="sd">       task/job is running</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a><span class="sd">    ignore</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a><span class="sd">       ignore task/job (is up-to-date)</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a><span class="sd">    This filter adds the following context to a log record:</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a><span class="sd">    task</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a><span class="sd">       task_name</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a><span class="sd">    task_status</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a><span class="sd">       task status</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a><span class="sd">    task_total</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a><span class="sd">       number of jobs in task</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a><span class="sd">    task_completed</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a><span class="sd">       number of jobs in task completed</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a><span class="sd">    task_completed_percent</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a><span class="sd">       percentage of task completed</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a><span class="sd">    The filter will also generate an additional log message in json format</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a><span class="sd">    with the fields above.</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a><span class="sd">    ruffus_text : string</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a><span class="sd">        Log messages from ruffus.pipeline_printout. These are used</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a><span class="sd">        to collect all tasks that will be executed during pipeline</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a><span class="sd">        execution.</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>                 <span class="n">ruffus_text</span><span class="p">):</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a>        <span class="c1"># dictionary of jobs to run</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">map_job2task</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">()</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">split_by_job</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>            <span class="c1"># ignore optional docstring at beginning (is bracketed by &#39;&quot;&#39;)</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a>            <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\&quot;[^&quot;]+\&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Job\s+=&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a>                <span class="k">if</span> <span class="s2">&quot;Make missing directories&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>                    <span class="c1"># long file names cause additional wrapping and</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>                    <span class="c1"># additional white-space characters</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>                    <span class="n">job_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>                        <span class="sa">r</span><span class="s2">&quot;\[.*-&gt; ([^\]]+)\]&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>                    <span class="c1"># raise AttributeError(&quot;could not parse &#39;%s&#39;&quot; % line)</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>                <span class="n">job_status</span> <span class="o">=</span> <span class="s2">&quot;ignore&quot;</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>                <span class="k">if</span> <span class="s2">&quot;Job needs update&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>                    <span class="n">job_status</span> <span class="o">=</span> <span class="s2">&quot;update&quot;</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>                <span class="k">yield</span> <span class="n">job_name</span><span class="p">,</span> <span class="n">job_status</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">split_by_task</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>            <span class="n">block</span><span class="p">,</span> <span class="n">task_name</span> <span class="o">=</span> <span class="p">[],</span> <span class="kc">None</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>            <span class="n">task_status</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Tasks which will be run&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a>                    <span class="n">task_status</span> <span class="o">=</span> <span class="s2">&quot;update&quot;</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a>                    <span class="n">block</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>                <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Tasks which are up-to-date&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>                    <span class="n">task_status</span> <span class="o">=</span> <span class="s2">&quot;ignore&quot;</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>                    <span class="n">block</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Task = &quot;</span><span class="p">):</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>                    <span class="k">if</span> <span class="n">task_name</span><span class="p">:</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>                        <span class="k">yield</span> <span class="n">task_name</span><span class="p">,</span> <span class="n">task_status</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">split_by_job</span><span class="p">(</span><span class="n">block</span><span class="p">))</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>                    <span class="n">block</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>                    <span class="n">task_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;Task = (.*)&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>                <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>                    <span class="n">block</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>            <span class="k">if</span> <span class="n">task_name</span><span class="p">:</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>                <span class="k">yield</span> <span class="n">task_name</span><span class="p">,</span> <span class="n">task_status</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">split_by_job</span><span class="p">(</span><span class="n">block</span><span class="p">))</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>        <span class="c1"># populate with initial messages</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>        <span class="k">for</span> <span class="n">task_name</span><span class="p">,</span> <span class="n">task_status</span><span class="p">,</span> <span class="n">jobs</span> <span class="ow">in</span> <span class="n">split_by_task</span><span class="p">(</span><span class="n">ruffus_text</span><span class="p">):</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>            <span class="k">if</span> <span class="n">task_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;(mkdir&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>                <span class="k">continue</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a>            <span class="n">to_run</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>            <span class="k">for</span> <span class="n">job_name</span><span class="p">,</span> <span class="n">job_status</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">[</span><span class="n">job_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">task_name</span><span class="p">,</span> <span class="n">job_name</span><span class="p">)</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a>                <span class="k">if</span> <span class="n">job_status</span> <span class="o">==</span> <span class="s2">&quot;update&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>                    <span class="n">to_run</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">map_job2task</span><span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">job_name</span><span class="p">)]</span> <span class="o">=</span> <span class="n">task_name</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">task_status</span><span class="p">,</span>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a>                                     <span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">),</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a>                                     <span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span> <span class="o">-</span> <span class="n">to_run</span><span class="p">]</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">record</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;task.py&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>            <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>        <span class="c1"># update task counts and status</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>        <span class="n">job_name</span><span class="p">,</span> <span class="n">task_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a>        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Job\s+=&quot;</span><span class="p">,</span> <span class="n">record</span><span class="o">.</span><span class="n">msg</span><span class="p">):</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a>                <span class="n">job_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>                    <span class="sa">r</span><span class="s2">&quot;\[.*-&gt; ([^\]]+)\]&quot;</span><span class="p">,</span> <span class="n">record</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a>            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a>                <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a>            <span class="n">job_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">job_name</span><span class="p">)</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a>            <span class="n">task_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_job2task</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">job_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a>            <span class="k">if</span> <span class="n">task_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a>                <span class="k">return</span>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a>            <span class="k">if</span> <span class="s2">&quot;completed&quot;</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">msg</span><span class="p">:</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a>        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Task\s+=&quot;</span><span class="p">,</span> <span class="n">record</span><span class="o">.</span><span class="n">msg</span><span class="p">):</span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a>                <span class="n">before</span><span class="p">,</span> <span class="n">task_name</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; = &quot;</span><span class="p">)</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a>            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>                <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a>            <span class="c1"># ignore the mkdir, etc tasks</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a>            <span class="k">if</span> <span class="n">task_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">:</span>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>                <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a>            <span class="k">if</span> <span class="n">before</span> <span class="o">==</span> <span class="s2">&quot;Task enters queue&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;running&quot;</span>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a>            <span class="k">elif</span> <span class="n">before</span> <span class="o">==</span> <span class="s2">&quot;Completed Task&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;completed&quot;</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a>            <span class="k">elif</span> <span class="n">before</span> <span class="o">==</span> <span class="s2">&quot;Uptodate Task&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;uptodate&quot;</span>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a>                <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a>            <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a>        <span class="k">if</span> <span class="n">task_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a>            <span class="k">return</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a>        <span class="c1"># update log record</span>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a>        <span class="n">task_status</span><span class="p">,</span> <span class="n">task_total</span><span class="p">,</span> <span class="n">task_completed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>        <span class="k">if</span> <span class="n">task_total</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a>            <span class="n">task_completed_percent</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="o">*</span> <span class="n">task_completed</span> <span class="o">/</span> <span class="n">task_total</span>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a>            <span class="n">task_completed_percent</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a>        <span class="c1"># ignore prefix:: in task_name for output</span>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a>        <span class="n">task_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;^[^:]+::&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">task_name</span><span class="p">)</span>
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a>            <span class="s2">&quot;task&quot;</span><span class="p">:</span> <span class="n">task_name</span><span class="p">,</span>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a>            <span class="s2">&quot;task_status&quot;</span><span class="p">:</span> <span class="n">task_status</span><span class="p">,</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a>            <span class="s2">&quot;task_total&quot;</span><span class="p">:</span> <span class="n">task_total</span><span class="p">,</span>
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a>            <span class="s2">&quot;task_completed&quot;</span><span class="p">:</span> <span class="n">task_completed</span><span class="p">,</span>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a>            <span class="s2">&quot;task_completed_percent&quot;</span><span class="p">:</span> <span class="n">task_completed_percent</span><span class="p">}</span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a>
<a id="__codelineno-0-1179" name="__codelineno-0-1179"></a>        <span class="n">record</span><span class="o">.</span><span class="n">task_status</span> <span class="o">=</span> <span class="n">task_status</span>
<a id="__codelineno-0-1180" name="__codelineno-0-1180"></a>        <span class="n">record</span><span class="o">.</span><span class="n">task_total</span> <span class="o">=</span> <span class="n">task_total</span>
<a id="__codelineno-0-1181" name="__codelineno-0-1181"></a>        <span class="n">record</span><span class="o">.</span><span class="n">task_completed</span> <span class="o">=</span> <span class="n">task_completed</span>
<a id="__codelineno-0-1182" name="__codelineno-0-1182"></a>        <span class="n">record</span><span class="o">.</span><span class="n">task_completed_percent</span> <span class="o">=</span> <span class="n">task_completed_percent</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a>        <span class="c1"># log status</span>
<a id="__codelineno-0-1185" name="__codelineno-0-1185"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<a id="__codelineno-0-1186" name="__codelineno-0-1186"></a>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a>        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cgatcore.pipeline.LoggingFilterpipelineName" class="doc doc-heading">
            <code>LoggingFilterpipelineName</code>


<a href="#cgatcore.pipeline.LoggingFilterpipelineName" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="logging.Filter">Filter</span></code></p>


        <p>add pipeline name to log message.</p>
<p>With this filter, %(app_name)s can be used in log formats.</p>






              <details class="quote">
                <summary>Source code in <code>cgatcore/pipeline/control.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="k">class</span><span class="w"> </span><span class="nc">LoggingFilterpipelineName</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Filter</span><span class="p">):</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;add pipeline name to log message.</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a><span class="sd">    With this filter, %(app_name)s can be used in log formats.</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">app_name</span> <span class="o">=</span> <span class="n">name</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>        <span class="n">record</span><span class="o">.</span><span class="n">app_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_name</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">getMessage</span><span class="p">()</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>        <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;- {&quot;</span><span class="p">):</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>            <span class="n">json_message</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">message</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>        <span class="k">elif</span> <span class="n">message</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">):</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>            <span class="n">json_message</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>            <span class="n">json_message</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>        <span class="k">if</span> <span class="n">json_message</span><span class="p">:</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">json_message</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>                <span class="nb">setattr</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cgatcore.pipeline.MultiLineFormatter" class="doc doc-heading">
            <code>MultiLineFormatter</code>


<a href="#cgatcore.pipeline.MultiLineFormatter" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="logging.Formatter">Formatter</span></code></p>


        <p>logfile formatter: add identation for multi-line entries.</p>






              <details class="quote">
                <summary>Source code in <code>cgatcore/experiment.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-642" name="__codelineno-0-642"></a><span class="k">class</span><span class="w"> </span><span class="nc">MultiLineFormatter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">):</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;logfile formatter: add identation for multi-line entries.&#39;&#39;&#39;</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">)</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>            <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;#&quot;</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>            <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>        <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">message</span><span class="p">:</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>            <span class="n">header</span><span class="p">,</span> <span class="n">footer</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; </span><span class="se">\\\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>        <span class="k">return</span> <span class="n">s</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cgatcore.pipeline.SGEExecutor" class="doc doc-heading">
            <code>SGEExecutor</code>


<a href="#cgatcore.pipeline.SGEExecutor" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="cgatcore.pipeline.base_executor.BaseExecutor">BaseExecutor</span></code></p>







              <details class="quote">
                <summary>Source code in <code>cgatcore/pipeline/executors.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">SGEExecutor</span><span class="p">(</span><span class="n">BaseExecutor</span><span class="p">):</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">task_name</span> <span class="o">=</span> <span class="s2">&quot;sge_task&quot;</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default_total_time</span> <span class="o">=</span> <span class="mi">8</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement_list</span><span class="p">):</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>        <span class="n">benchmark_data</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>        <span class="k">for</span> <span class="n">statement</span> <span class="ow">in</span> <span class="n">statement_list</span><span class="p">:</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running statement on SGE: </span><span class="si">{</span><span class="n">statement</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>            <span class="n">full_statement</span><span class="p">,</span> <span class="n">job_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_job_script</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>            <span class="c1"># Build the SGE job submission command</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>            <span class="n">sge_command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;qsub -N </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;job_name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;default_job&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> -cwd -o </span><span class="si">{</span><span class="n">job_path</span><span class="si">}</span><span class="s2">.o -e </span><span class="si">{</span><span class="n">job_path</span><span class="si">}</span><span class="s2">.e </span><span class="si">{</span><span class="n">job_path</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>            <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">sge_command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>            <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SGE job submission failed: </span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SGE job submission failed: </span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SGE job submitted: </span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>            <span class="c1"># Monitor job completion</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">monitor_job_completion</span><span class="p">(</span><span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>            <span class="n">benchmark_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collect_benchmark_data</span><span class="p">([</span><span class="n">statement</span><span class="p">],</span> <span class="n">resource_usage</span><span class="o">=</span><span class="p">[]))</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>        <span class="k">return</span> <span class="n">benchmark_data</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">build_job_script</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">):</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Custom build job script for SGE.&quot;&quot;&quot;</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">build_job_script</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">monitor_job_completion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Monitor the completion of an SGE job.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">            job_id (str): The SGE job ID to monitor.</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">            RuntimeError: If the job fails or times out.</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>            <span class="c1"># Use qstat to get job status</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;qstat -j </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>            <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>            <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>                <span class="c1"># Job not found in qstat could mean it&#39;s completed</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>                <span class="c1"># Use qacct to get final status</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;qacct -j </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>                <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>                <span class="k">if</span> <span class="s2">&quot;exit_status&quot;</span> <span class="ow">in</span> <span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>                    <span class="n">exit_status</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;exit_status&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>                    <span class="k">if</span> <span class="n">exit_status</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span><span class="p">:</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> completed successfully&quot;</span><span class="p">)</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>                        <span class="k">break</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> failed with exit status: </span><span class="si">{</span><span class="n">exit_status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> failed with exit status: </span><span class="si">{</span><span class="n">exit_status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get job status: </span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get job status: </span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>            <span class="c1"># Wait before checking again</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">collect_benchmark_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statements</span><span class="p">,</span> <span class="n">resource_usage</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Collect benchmark data for SGE jobs.</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">            statements (list): List of executed statements</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">            resource_usage (list, optional): Resource usage data</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">            dict: Benchmark data including task name and execution time</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>            <span class="s2">&quot;task&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_name</span><span class="p">,</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="s2">&quot;total_t&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_total_time</span><span class="p">,</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="s2">&quot;statements&quot;</span><span class="p">:</span> <span class="n">statements</span><span class="p">,</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="s2">&quot;resource_usage&quot;</span><span class="p">:</span> <span class="n">resource_usage</span> <span class="ow">or</span> <span class="p">[]</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="p">}</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.SGEExecutor.build_job_script" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">build_job_script</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.SGEExecutor.build_job_script" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Custom build job script for SGE.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/executors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="k">def</span><span class="w"> </span><span class="nf">build_job_script</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">):</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom build job script for SGE.&quot;&quot;&quot;</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">build_job_script</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.SGEExecutor.collect_benchmark_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">collect_benchmark_data</span><span class="p">(</span><span class="n">statements</span><span class="p">,</span> <span class="n">resource_usage</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.SGEExecutor.collect_benchmark_data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Collect benchmark data for SGE jobs.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>statements</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of executed statements</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>resource_usage</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Resource usage data</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Benchmark data including task name and execution time</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/executors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="k">def</span><span class="w"> </span><span class="nf">collect_benchmark_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statements</span><span class="p">,</span> <span class="n">resource_usage</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Collect benchmark data for SGE jobs.</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        statements (list): List of executed statements</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        resource_usage (list, optional): Resource usage data</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">        dict: Benchmark data including task name and execution time</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="s2">&quot;task&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_name</span><span class="p">,</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="s2">&quot;total_t&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_total_time</span><span class="p">,</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="s2">&quot;statements&quot;</span><span class="p">:</span> <span class="n">statements</span><span class="p">,</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="s2">&quot;resource_usage&quot;</span><span class="p">:</span> <span class="n">resource_usage</span> <span class="ow">or</span> <span class="p">[]</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.SGEExecutor.monitor_job_completion" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">monitor_job_completion</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.SGEExecutor.monitor_job_completion" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Monitor the completion of an SGE job.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>job_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The SGE job ID to monitor.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>RuntimeError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the job fails or times out.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/executors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="k">def</span><span class="w"> </span><span class="nf">monitor_job_completion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Monitor the completion of an SGE job.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        job_id (str): The SGE job ID to monitor.</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        RuntimeError: If the job fails or times out.</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>        <span class="c1"># Use qstat to get job status</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>        <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;qstat -j </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>            <span class="c1"># Job not found in qstat could mean it&#39;s completed</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>            <span class="c1"># Use qacct to get final status</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;qacct -j </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>            <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>            <span class="k">if</span> <span class="s2">&quot;exit_status&quot;</span> <span class="ow">in</span> <span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>                <span class="n">exit_status</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;exit_status&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>                <span class="k">if</span> <span class="n">exit_status</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span><span class="p">:</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> completed successfully&quot;</span><span class="p">)</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>                    <span class="k">break</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> failed with exit status: </span><span class="si">{</span><span class="n">exit_status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> failed with exit status: </span><span class="si">{</span><span class="n">exit_status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get job status: </span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get job status: </span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="c1"># Wait before checking again</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cgatcore.pipeline.SlurmExecutor" class="doc doc-heading">
            <code>SlurmExecutor</code>


<a href="#cgatcore.pipeline.SlurmExecutor" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="cgatcore.pipeline.base_executor.BaseExecutor">BaseExecutor</span></code></p>


        <p>Executor for running jobs on Slurm cluster.</p>






              <details class="quote">
                <summary>Source code in <code>cgatcore/pipeline/executors.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="k">class</span><span class="w"> </span><span class="nc">SlurmExecutor</span><span class="p">(</span><span class="n">BaseExecutor</span><span class="p">):</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Executor for running jobs on Slurm cluster.&quot;&quot;&quot;</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">task_name</span> <span class="o">=</span> <span class="s2">&quot;slurm_task&quot;</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default_total_time</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement_list</span><span class="p">):</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="n">benchmark_data</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="k">for</span> <span class="n">statement</span> <span class="ow">in</span> <span class="n">statement_list</span><span class="p">:</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running statement on Slurm: </span><span class="si">{</span><span class="n">statement</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="n">full_statement</span><span class="p">,</span> <span class="n">job_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_job_script</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>            <span class="c1"># Build the Slurm job submission command</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>            <span class="n">slurm_command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sbatch --job-name=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;job_name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;default_job&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> --output=</span><span class="si">{</span><span class="n">job_path</span><span class="si">}</span><span class="s2">.o --error=</span><span class="si">{</span><span class="n">job_path</span><span class="si">}</span><span class="s2">.e </span><span class="si">{</span><span class="n">job_path</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>            <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">slurm_command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Slurm job submission failed: </span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Slurm job submission failed: </span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="n">job_id</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Slurm job submitted with ID: </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>            <span class="c1"># Monitor job completion</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">monitor_job_completion</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>            <span class="n">benchmark_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collect_benchmark_data</span><span class="p">([</span><span class="n">statement</span><span class="p">],</span> <span class="n">resource_usage</span><span class="o">=</span><span class="p">[]))</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="k">return</span> <span class="n">benchmark_data</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">build_job_script</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">):</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Custom build job script for Slurm.&quot;&quot;&quot;</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">build_job_script</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">monitor_job_completion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Monitor the completion of a Slurm job.</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">            job_id (str): The Slurm job ID to monitor.</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">            RuntimeError: If the job fails or times out.</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="c1"># Use sacct to get job status</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sacct -j </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> --format=State --noheader --parsable2&quot;</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>            <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get job status: </span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get job status: </span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>            <span class="n">status</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>            <span class="c1"># Check job status</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="k">if</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;COMPLETED&quot;</span><span class="p">,</span> <span class="s2">&quot;COMPLETED+&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> completed successfully&quot;</span><span class="p">)</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>                <span class="k">break</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>            <span class="k">elif</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;FAILED&quot;</span><span class="p">,</span> <span class="s2">&quot;TIMEOUT&quot;</span><span class="p">,</span> <span class="s2">&quot;CANCELLED&quot;</span><span class="p">,</span> <span class="s2">&quot;NODE_FAIL&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> failed with status: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> failed with status: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>            <span class="c1"># Wait before checking again</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">collect_benchmark_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statements</span><span class="p">,</span> <span class="n">resource_usage</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Collect benchmark data for Slurm jobs.</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">            statements (list): List of executed statements</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">            resource_usage (list, optional): Resource usage data</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">            dict: Benchmark data including task name and execution time</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>            <span class="s2">&quot;task&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_name</span><span class="p">,</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>            <span class="s2">&quot;total_t&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_total_time</span><span class="p">,</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>            <span class="s2">&quot;statements&quot;</span><span class="p">:</span> <span class="n">statements</span><span class="p">,</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>            <span class="s2">&quot;resource_usage&quot;</span><span class="p">:</span> <span class="n">resource_usage</span> <span class="ow">or</span> <span class="p">[]</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>        <span class="p">}</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.SlurmExecutor.build_job_script" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">build_job_script</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.SlurmExecutor.build_job_script" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Custom build job script for Slurm.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/executors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="k">def</span><span class="w"> </span><span class="nf">build_job_script</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">):</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom build job script for Slurm.&quot;&quot;&quot;</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">build_job_script</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.SlurmExecutor.collect_benchmark_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">collect_benchmark_data</span><span class="p">(</span><span class="n">statements</span><span class="p">,</span> <span class="n">resource_usage</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.SlurmExecutor.collect_benchmark_data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Collect benchmark data for Slurm jobs.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>statements</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of executed statements</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>resource_usage</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Resource usage data</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Benchmark data including task name and execution time</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/executors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="k">def</span><span class="w"> </span><span class="nf">collect_benchmark_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statements</span><span class="p">,</span> <span class="n">resource_usage</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Collect benchmark data for Slurm jobs.</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">        statements (list): List of executed statements</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">        resource_usage (list, optional): Resource usage data</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">        dict: Benchmark data including task name and execution time</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="s2">&quot;task&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_name</span><span class="p">,</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="s2">&quot;total_t&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_total_time</span><span class="p">,</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="s2">&quot;statements&quot;</span><span class="p">:</span> <span class="n">statements</span><span class="p">,</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="s2">&quot;resource_usage&quot;</span><span class="p">:</span> <span class="n">resource_usage</span> <span class="ow">or</span> <span class="p">[]</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.SlurmExecutor.monitor_job_completion" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">monitor_job_completion</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.SlurmExecutor.monitor_job_completion" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Monitor the completion of a Slurm job.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>job_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Slurm job ID to monitor.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>RuntimeError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the job fails or times out.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/executors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="k">def</span><span class="w"> </span><span class="nf">monitor_job_completion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Monitor the completion of a Slurm job.</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">        job_id (str): The Slurm job ID to monitor.</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">        RuntimeError: If the job fails or times out.</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="c1"># Use sacct to get job status</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sacct -j </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> --format=State --noheader --parsable2&quot;</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get job status: </span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get job status: </span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="n">status</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="c1"># Check job status</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="k">if</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;COMPLETED&quot;</span><span class="p">,</span> <span class="s2">&quot;COMPLETED+&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> completed successfully&quot;</span><span class="p">)</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>            <span class="k">break</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="k">elif</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;FAILED&quot;</span><span class="p">,</span> <span class="s2">&quot;TIMEOUT&quot;</span><span class="p">,</span> <span class="s2">&quot;CANCELLED&quot;</span><span class="p">,</span> <span class="s2">&quot;NODE_FAIL&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> failed with status: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> failed with status: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>        <span class="c1"># Wait before checking again</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cgatcore.pipeline.TorqueExecutor" class="doc doc-heading">
            <code>TorqueExecutor</code>


<a href="#cgatcore.pipeline.TorqueExecutor" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="cgatcore.pipeline.base_executor.BaseExecutor">BaseExecutor</span></code></p>


        <p>Executor for running jobs on Torque cluster.</p>






              <details class="quote">
                <summary>Source code in <code>cgatcore/pipeline/executors.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="k">class</span><span class="w"> </span><span class="nc">TorqueExecutor</span><span class="p">(</span><span class="n">BaseExecutor</span><span class="p">):</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Executor for running jobs on Torque cluster.&quot;&quot;&quot;</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">task_name</span> <span class="o">=</span> <span class="s2">&quot;torque_task&quot;</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default_total_time</span> <span class="o">=</span> <span class="mi">7</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement_list</span><span class="p">):</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>        <span class="n">benchmark_data</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="k">for</span> <span class="n">statement</span> <span class="ow">in</span> <span class="n">statement_list</span><span class="p">:</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running statement on Torque: </span><span class="si">{</span><span class="n">statement</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>            <span class="n">full_statement</span><span class="p">,</span> <span class="n">job_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_job_script</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>            <span class="c1"># Build the Torque job submission command</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>            <span class="n">torque_command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;qsub -N </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;job_name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;default_job&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> -o </span><span class="si">{</span><span class="n">job_path</span><span class="si">}</span><span class="s2">.o -e </span><span class="si">{</span><span class="n">job_path</span><span class="si">}</span><span class="s2">.e </span><span class="si">{</span><span class="n">job_path</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>            <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">torque_command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>            <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Torque job submission failed: </span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Torque job submission failed: </span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>            <span class="n">job_id</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Torque job submitted with ID: </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>            <span class="c1"># Monitor job completion</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">monitor_job_completion</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>            <span class="n">benchmark_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collect_benchmark_data</span><span class="p">([</span><span class="n">statement</span><span class="p">],</span> <span class="n">resource_usage</span><span class="o">=</span><span class="p">[]))</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="k">return</span> <span class="n">benchmark_data</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">build_job_script</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">):</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Custom build job script for Torque.&quot;&quot;&quot;</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">build_job_script</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">monitor_job_completion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Monitor the completion of a Torque job.</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">            job_id (str): The Torque job ID to monitor.</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">            RuntimeError: If the job fails or times out.</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>            <span class="c1"># Use qstat to get job status</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;qstat -f </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>            <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>            <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>                <span class="c1"># Job not found in qstat could mean it&#39;s completed</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>                <span class="c1"># Use tracejob to get final status</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>                <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;tracejob </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>                <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>                <span class="k">if</span> <span class="s2">&quot;Exit_status=&quot;</span> <span class="ow">in</span> <span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>                    <span class="k">if</span> <span class="s2">&quot;Exit_status=0&quot;</span> <span class="ow">in</span> <span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> completed successfully&quot;</span><span class="p">)</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>                        <span class="k">break</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>                        <span class="n">status</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;Exit_status=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> failed with exit status: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> failed with exit status: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get job status: </span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get job status: </span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>            <span class="c1"># Wait before checking again</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">collect_benchmark_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statements</span><span class="p">,</span> <span class="n">resource_usage</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Collect benchmark data for Torque jobs.</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="sd">            statements (list): List of executed statements</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="sd">            resource_usage (list, optional): Resource usage data</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="sd">            dict: Benchmark data including task name and execution time</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>        <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>            <span class="s2">&quot;task&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_name</span><span class="p">,</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>            <span class="s2">&quot;total_t&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_total_time</span><span class="p">,</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>            <span class="s2">&quot;statements&quot;</span><span class="p">:</span> <span class="n">statements</span><span class="p">,</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>            <span class="s2">&quot;resource_usage&quot;</span><span class="p">:</span> <span class="n">resource_usage</span> <span class="ow">or</span> <span class="p">[]</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>        <span class="p">}</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.TorqueExecutor.build_job_script" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">build_job_script</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.TorqueExecutor.build_job_script" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Custom build job script for Torque.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/executors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="k">def</span><span class="w"> </span><span class="nf">build_job_script</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">):</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom build job script for Torque.&quot;&quot;&quot;</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">build_job_script</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.TorqueExecutor.collect_benchmark_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">collect_benchmark_data</span><span class="p">(</span><span class="n">statements</span><span class="p">,</span> <span class="n">resource_usage</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.TorqueExecutor.collect_benchmark_data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Collect benchmark data for Torque jobs.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>statements</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of executed statements</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>resource_usage</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Resource usage data</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Benchmark data including task name and execution time</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/executors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="k">def</span><span class="w"> </span><span class="nf">collect_benchmark_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statements</span><span class="p">,</span> <span class="n">resource_usage</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Collect benchmark data for Torque jobs.</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="sd">        statements (list): List of executed statements</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="sd">        resource_usage (list, optional): Resource usage data</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="sd">        dict: Benchmark data including task name and execution time</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>        <span class="s2">&quot;task&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_name</span><span class="p">,</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>        <span class="s2">&quot;total_t&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_total_time</span><span class="p">,</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>        <span class="s2">&quot;statements&quot;</span><span class="p">:</span> <span class="n">statements</span><span class="p">,</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>        <span class="s2">&quot;resource_usage&quot;</span><span class="p">:</span> <span class="n">resource_usage</span> <span class="ow">or</span> <span class="p">[]</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cgatcore.pipeline.TorqueExecutor.monitor_job_completion" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">monitor_job_completion</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.TorqueExecutor.monitor_job_completion" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Monitor the completion of a Torque job.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>job_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Torque job ID to monitor.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>RuntimeError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the job fails or times out.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/executors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="k">def</span><span class="w"> </span><span class="nf">monitor_job_completion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Monitor the completion of a Torque job.</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">        job_id (str): The Torque job ID to monitor.</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">        RuntimeError: If the job fails or times out.</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="c1"># Use qstat to get job status</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;qstat -f </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>            <span class="c1"># Job not found in qstat could mean it&#39;s completed</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>            <span class="c1"># Use tracejob to get final status</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;tracejob </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>            <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>            <span class="k">if</span> <span class="s2">&quot;Exit_status=&quot;</span> <span class="ow">in</span> <span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>                <span class="k">if</span> <span class="s2">&quot;Exit_status=0&quot;</span> <span class="ow">in</span> <span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> completed successfully&quot;</span><span class="p">)</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>                    <span class="k">break</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>                    <span class="n">status</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;Exit_status=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> failed with exit status: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> failed with exit status: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get job status: </span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get job status: </span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>        <span class="c1"># Wait before checking again</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.add_doc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_doc</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.add_doc" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>add doc string of value to function that is decorated.</p>
<p>The original doc-string is added as the first paragraph(s)
inside the new doc-string.</p>
<h4 id="cgatcore.pipeline.add_doc--parameter">Parameter<a class="headerlink" href="#cgatcore.pipeline.add_doc--parameter" title="Permanent link">&para;</a></h4>


<details class="replace-" open>
  <summary>bool</summary>
  <p>If True, replace documentation rather than appending</p>
</details>
            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="k">def</span><span class="w"> </span><span class="nf">add_doc</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;add doc string of value to function that is decorated.</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">    The original doc-string is added as the first paragraph(s)</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">    inside the new doc-string.</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">    Parameter</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">    replace : bool</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">       If True, replace documentation rather than appending</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_doc</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="k">if</span> <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">:</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>            <span class="n">lines</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="vm">__doc__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>                    <span class="k">break</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="c1"># insert appropriate indentiation</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="c1"># currently hard-coded, can be derived</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="c1"># from doc string?</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">replace</span><span class="p">:</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>                <span class="n">lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>                <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>                <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="vm">__doc__</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="vm">__doc__</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="k">return</span> <span class="n">func</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="k">return</span> <span class="n">_doc</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.as_list" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">as_list</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.as_list" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>return a value as a list.</p>
<p>If the value is a string and contains a <code>,</code>, the string will
be split at <code>,</code>.</p>
<h4 id="cgatcore.pipeline.as_list--returns">Returns<a class="headerlink" href="#cgatcore.pipeline.as_list--returns" title="Permanent link">&para;</a></h4>
<p>list</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/parameters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-502" name="__codelineno-0-502"></a><span class="k">def</span><span class="w"> </span><span class="nf">as_list</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;return a value as a list.</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="sd">    If the value is a string and contains a ``,``, the string will</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a><span class="sd">    be split at ``,``.</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a><span class="sd">    -------</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a><span class="sd">    list</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>        <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">values</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>        <span class="k">return</span> <span class="n">value</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>        <span class="k">return</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.build_load_statement" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">build_load_statement</span><span class="p">(</span><span class="n">tablename</span><span class="p">,</span> <span class="n">retry</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.build_load_statement" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>build a command line statement to upload data.</p>
<p>Upload is performed via the :doc:<code>csv2db</code> script.</p>
<p>The returned statement is suitable to use in pipe expression.
This method is aware of the configuration values for database
access and the chosen database backend.</p>
<p>For example::</p>
<div class="codehilite"><pre><span></span><code><span class="n">load_statement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P</span><span class="o">.</span><span class="n">build_load_statement</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
<span class="n">statement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;cat data.txt | </span><span class="si">%(load_statement)s</span><span class="s2">&quot;</span>
<span class="n">P</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
</code></pre></div>

<h4 id="cgatcore.pipeline.build_load_statement--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.build_load_statement--arguments" title="Permanent link">&para;</a></h4>
<p>tablename : string
    Tablename for upload
retry : bool
    Add the <code>--retry</code> option to <code>csv2db.py</code>
options : string
    Command line options to be passed on to <code>csv2db.py</code></p>
<h4 id="cgatcore.pipeline.build_load_statement--returns">Returns<a class="headerlink" href="#cgatcore.pipeline.build_load_statement--returns" title="Permanent link">&para;</a></h4>
<p>string</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="k">def</span><span class="w"> </span><span class="nf">build_load_statement</span><span class="p">(</span><span class="n">tablename</span><span class="p">,</span> <span class="n">retry</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;build a command line statement to upload data.</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">    Upload is performed via the :doc:`csv2db` script.</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    The returned statement is suitable to use in pipe expression.</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    This method is aware of the configuration values for database</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    access and the chosen database backend.</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    For example::</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        load_statement = P.build_load_statement(&quot;data&quot;)</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        statement = &quot;cat data.txt | %(load_statement)s&quot;</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        P.run(statement)</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    tablename : string</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        Tablename for upload</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">    retry : bool</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">        Add the ``--retry`` option to `csv2db.py`</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">    options : string</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">        Command line options to be passed on to `csv2db.py`</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    -------</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    string</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="n">opts</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="k">if</span> <span class="n">retry</span><span class="p">:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="n">opts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; --retry &quot;</span><span class="p">)</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="n">params</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">()</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="n">opts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;--database-url=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;database&quot;</span><span class="p">][</span><span class="s2">&quot;url&quot;</span><span class="p">]))</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="n">db_options</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="n">load_statement</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="s2">&quot;python -m cgatcore.csv2db </span><span class="si">{db_options}</span><span class="s2"> </span><span class="si">{options}</span><span class="s2"> --table=</span><span class="si">{tablename}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="k">return</span> <span class="n">load_statement</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.check_executables" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_executables</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.check_executables" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>check for the presence/absence of executables</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/files.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="k">def</span><span class="w"> </span><span class="nf">check_executables</span><span class="p">(</span><span class="n">filenames</span><span class="p">):</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;check for the presence/absence of executables&quot;&quot;&quot;</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="n">missing</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">iotools</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;missing executables: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.check_parameter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_parameter</span><span class="p">(</span><span class="n">param</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.check_parameter" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>check if parameter <code>key</code> is set</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/parameters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="k">def</span><span class="w"> </span><span class="nf">check_parameter</span><span class="p">(</span><span class="n">param</span><span class="p">):</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;check if parameter ``key`` is set&quot;&quot;&quot;</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>    <span class="k">if</span> <span class="n">param</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">PARAMS</span><span class="p">:</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;need `</span><span class="si">%s</span><span class="s2">` to be set&quot;</span> <span class="o">%</span> <span class="n">param</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.check_scripts" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_scripts</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.check_scripts" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>check for the presence/absence of scripts</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/files.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="k">def</span><span class="w"> </span><span class="nf">check_scripts</span><span class="p">(</span><span class="n">filenames</span><span class="p">):</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;check for the presence/absence of scripts&quot;&quot;&quot;</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="n">missing</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>    <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;missing scripts: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.clean" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clean</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">logfile</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.clean" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>clean up files given by glob expressions.</p>
<p>Files are cleaned up by zapping, i.e. the files are set to size
0. Links to files are replaced with place-holders.</p>
<p>Information about the original file is written to <code>logfile</code>.</p>
<h4 id="cgatcore.pipeline.clean--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.clean--arguments" title="Permanent link">&para;</a></h4>
<p>files : list
    List of glob expressions of files to clean up.
logfile : string
    Filename of logfile.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/control.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="k">def</span><span class="w"> </span><span class="nf">clean</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">logfile</span><span class="p">):</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;clean up files given by glob expressions.</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">    Files are cleaned up by zapping, i.e. the files are set to size</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">    0. Links to files are replaced with place-holders.</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">    Information about the original file is written to `logfile`.</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">    files : list</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="sd">        List of glob expressions of files to clean up.</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a><span class="sd">    logfile : string</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="sd">        Filename of logfile.</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>    <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;st_atime&#39;</span><span class="p">,</span> <span class="s1">&#39;st_blksize&#39;</span><span class="p">,</span> <span class="s1">&#39;st_blocks&#39;</span><span class="p">,</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>              <span class="s1">&#39;st_ctime&#39;</span><span class="p">,</span> <span class="s1">&#39;st_dev&#39;</span><span class="p">,</span> <span class="s1">&#39;st_gid&#39;</span><span class="p">,</span> <span class="s1">&#39;st_ino&#39;</span><span class="p">,</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>              <span class="s1">&#39;st_mode&#39;</span><span class="p">,</span> <span class="s1">&#39;st_mtime&#39;</span><span class="p">,</span> <span class="s1">&#39;st_nlink&#39;</span><span class="p">,</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>              <span class="s1">&#39;st_rdev&#39;</span><span class="p">,</span> <span class="s1">&#39;st_size&#39;</span><span class="p">,</span> <span class="s1">&#39;st_uid&#39;</span><span class="p">)</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>    <span class="n">dry_run</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dryrun&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">dry_run</span><span class="p">:</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">logfile</span><span class="p">):</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>            <span class="n">outfile</span> <span class="o">=</span> <span class="n">iotools</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">logfile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;filename</span><span class="se">\t</span><span class="s2">zapped</span><span class="se">\t</span><span class="s2">linkdest</span><span class="se">\t</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>                          <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fields</span><span class="p">))</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>            <span class="n">outfile</span> <span class="o">=</span> <span class="n">iotools</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">logfile</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>    <span class="n">c</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">Counter</span><span class="p">()</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>    <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>        <span class="n">c</span><span class="o">.</span><span class="n">files</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">dry_run</span><span class="p">:</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>            <span class="n">stat</span><span class="p">,</span> <span class="n">linkdest</span> <span class="o">=</span> <span class="n">iotools</span><span class="o">.</span><span class="n">zap_file</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>            <span class="k">if</span> <span class="n">stat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>                <span class="n">c</span><span class="o">.</span><span class="n">zapped</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>                <span class="k">if</span> <span class="n">linkdest</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>                    <span class="n">c</span><span class="o">.</span><span class="n">links</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>                <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>                    <span class="n">fn</span><span class="p">,</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>                    <span class="n">time</span><span class="o">.</span><span class="n">asctime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())),</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>                    <span class="n">linkdest</span><span class="p">,</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>                    <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">stat</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">])))</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>    <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;zapped: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="p">))</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>    <span class="n">outfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>    <span class="k">return</span> <span class="n">c</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.clone_pipeline" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clone_pipeline</span><span class="p">(</span><span class="n">srcdir</span><span class="p">,</span> <span class="n">destdir</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.clone_pipeline" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>clone a pipeline.</p>
<p>Cloning entails creating a mirror of the source pipeline.
Generally, data files are mirrored by linking. Configuration
files and the pipeline database will be copied.</p>
<p>Without modification of any files, building the cloned pipeline in
<code>destdir</code> should not re-run any commands. However, on deleting
selected files, the pipeline should run from the appropriate
point.  Newly created files will not affect the original pipeline.</p>
<p>Cloning pipelines permits sharing partial results between
pipelines, for example for parameter optimization.</p>
<h4 id="cgatcore.pipeline.clone_pipeline--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.clone_pipeline--arguments" title="Permanent link">&para;</a></h4>
<p>scrdir : string
    Source directory
destdir : string
    Destination directory. If None, use the current directory.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/control.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="k">def</span><span class="w"> </span><span class="nf">clone_pipeline</span><span class="p">(</span><span class="n">srcdir</span><span class="p">,</span> <span class="n">destdir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;clone a pipeline.</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">    Cloning entails creating a mirror of the source pipeline.</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">    Generally, data files are mirrored by linking. Configuration</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">    files and the pipeline database will be copied.</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">    Without modification of any files, building the cloned pipeline in</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">    `destdir` should not re-run any commands. However, on deleting</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">    selected files, the pipeline should run from the appropriate</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">    point.  Newly created files will not affect the original pipeline.</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">    Cloning pipelines permits sharing partial results between</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">    pipelines, for example for parameter optimization.</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">    scrdir : string</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">        Source directory</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">    destdir : string</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">        Destination directory. If None, use the current directory.</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>    <span class="k">if</span> <span class="n">destdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="n">destdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">curdir</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>    <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;cloning pipeline from </span><span class="si">%s</span><span class="s2"> to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">srcdir</span><span class="p">,</span> <span class="n">destdir</span><span class="p">))</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>    <span class="n">copy_files</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;conf.py&quot;</span><span class="p">,</span> <span class="s2">&quot;pipeline.yml&quot;</span><span class="p">,</span> <span class="s2">&quot;benchmark.yml&quot;</span><span class="p">,</span> <span class="s2">&quot;csvdb&quot;</span><span class="p">)</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="n">ignore_prefix</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="s2">&quot;report&quot;</span><span class="p">,</span> <span class="s2">&quot;_cache&quot;</span><span class="p">,</span> <span class="s2">&quot;export&quot;</span><span class="p">,</span> <span class="s2">&quot;tmp&quot;</span><span class="p">,</span> <span class="s2">&quot;ctmp&quot;</span><span class="p">,</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="s2">&quot;_static&quot;</span><span class="p">,</span> <span class="s2">&quot;_templates&quot;</span><span class="p">,</span> <span class="s2">&quot;shell.log&quot;</span><span class="p">,</span> <span class="s2">&quot;pipeline.log&quot;</span><span class="p">,</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>        <span class="s2">&quot;results.commit&quot;</span><span class="p">)</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_ignore</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ignore_prefix</span><span class="p">:</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>                <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">srcdir</span><span class="p">):</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="n">relpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">srcdir</span><span class="p">)</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="k">if</span> <span class="n">_ignore</span><span class="p">(</span><span class="n">relpath</span><span class="p">):</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>            <span class="k">continue</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>            <span class="k">if</span> <span class="n">_ignore</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>                <span class="k">continue</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>            <span class="n">dest</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destdir</span><span class="p">,</span> <span class="n">relpath</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>            <span class="c1"># touch</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>            <span class="n">s</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>            <span class="n">os</span><span class="o">.</span><span class="n">utime</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">st_atime</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">))</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>            <span class="k">if</span> <span class="n">_ignore</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>                <span class="k">continue</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>            <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>            <span class="n">dest_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destdir</span><span class="p">,</span> <span class="n">relpath</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>            <span class="k">if</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">copy_files</span><span class="p">:</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">dest_fn</span><span class="p">)</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>                <span class="c1"># realpath resolves links - thus links will be linked to</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>                <span class="c1"># the original target</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>                <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">fn</span><span class="p">),</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>                           <span class="n">dest_fn</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.close_session" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">close_session</span><span class="p">()</span></code>

<a href="#cgatcore.pipeline.close_session" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>close the global DRMAA session.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="k">def</span><span class="w"> </span><span class="nf">close_session</span><span class="p">():</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;close the global DRMAA session.&quot;&quot;&quot;</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>    <span class="k">global</span> <span class="n">GLOBAL_SESSION</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>    <span class="k">if</span> <span class="n">GLOBAL_SESSION</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>        <span class="n">GLOBAL_SESSION</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>        <span class="n">GLOBAL_SESSION</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.cluster_runnable" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cluster_runnable</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.cluster_runnable" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>A dectorator that allows a function to be run on the cluster.</p>
<p>The decorated function now takes extra arguments. The most important
is <em>submit</em>. If set to true, it will submit the function to the cluster
via the pipeline.submit framework. Arguments to the function are
pickled, so this will only work if arguments are picklable. Other
arguments to submit are also accepted.</p>
<p>Note that this allows the unusal combination of <em>submit</em> false,
and <em>to_cluster</em> true. This will submit the function as an external
job, but run it on the local machine.</p>
<p>Note: all arguments in the decorated function must be passed as
key-word arguments.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1612">1612</a></span>
<span class="normal"><a href="#__codelineno-0-1613">1613</a></span>
<span class="normal"><a href="#__codelineno-0-1614">1614</a></span>
<span class="normal"><a href="#__codelineno-0-1615">1615</a></span>
<span class="normal"><a href="#__codelineno-0-1616">1616</a></span>
<span class="normal"><a href="#__codelineno-0-1617">1617</a></span>
<span class="normal"><a href="#__codelineno-0-1618">1618</a></span>
<span class="normal"><a href="#__codelineno-0-1619">1619</a></span>
<span class="normal"><a href="#__codelineno-0-1620">1620</a></span>
<span class="normal"><a href="#__codelineno-0-1621">1621</a></span>
<span class="normal"><a href="#__codelineno-0-1622">1622</a></span>
<span class="normal"><a href="#__codelineno-0-1623">1623</a></span>
<span class="normal"><a href="#__codelineno-0-1624">1624</a></span>
<span class="normal"><a href="#__codelineno-0-1625">1625</a></span>
<span class="normal"><a href="#__codelineno-0-1626">1626</a></span>
<span class="normal"><a href="#__codelineno-0-1627">1627</a></span>
<span class="normal"><a href="#__codelineno-0-1628">1628</a></span>
<span class="normal"><a href="#__codelineno-0-1629">1629</a></span>
<span class="normal"><a href="#__codelineno-0-1630">1630</a></span>
<span class="normal"><a href="#__codelineno-0-1631">1631</a></span>
<span class="normal"><a href="#__codelineno-0-1632">1632</a></span>
<span class="normal"><a href="#__codelineno-0-1633">1633</a></span>
<span class="normal"><a href="#__codelineno-0-1634">1634</a></span>
<span class="normal"><a href="#__codelineno-0-1635">1635</a></span>
<span class="normal"><a href="#__codelineno-0-1636">1636</a></span>
<span class="normal"><a href="#__codelineno-0-1637">1637</a></span>
<span class="normal"><a href="#__codelineno-0-1638">1638</a></span>
<span class="normal"><a href="#__codelineno-0-1639">1639</a></span>
<span class="normal"><a href="#__codelineno-0-1640">1640</a></span>
<span class="normal"><a href="#__codelineno-0-1641">1641</a></span>
<span class="normal"><a href="#__codelineno-0-1642">1642</a></span>
<span class="normal"><a href="#__codelineno-0-1643">1643</a></span>
<span class="normal"><a href="#__codelineno-0-1644">1644</a></span>
<span class="normal"><a href="#__codelineno-0-1645">1645</a></span>
<span class="normal"><a href="#__codelineno-0-1646">1646</a></span>
<span class="normal"><a href="#__codelineno-0-1647">1647</a></span>
<span class="normal"><a href="#__codelineno-0-1648">1648</a></span>
<span class="normal"><a href="#__codelineno-0-1649">1649</a></span>
<span class="normal"><a href="#__codelineno-0-1650">1650</a></span>
<span class="normal"><a href="#__codelineno-0-1651">1651</a></span>
<span class="normal"><a href="#__codelineno-0-1652">1652</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1612" name="__codelineno-0-1612"></a><span class="k">def</span><span class="w"> </span><span class="nf">cluster_runnable</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<a id="__codelineno-0-1613" name="__codelineno-0-1613"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;A dectorator that allows a function to be run on the cluster.</span>
<a id="__codelineno-0-1614" name="__codelineno-0-1614"></a>
<a id="__codelineno-0-1615" name="__codelineno-0-1615"></a><span class="sd">    The decorated function now takes extra arguments. The most important</span>
<a id="__codelineno-0-1616" name="__codelineno-0-1616"></a><span class="sd">    is *submit*. If set to true, it will submit the function to the cluster</span>
<a id="__codelineno-0-1617" name="__codelineno-0-1617"></a><span class="sd">    via the pipeline.submit framework. Arguments to the function are</span>
<a id="__codelineno-0-1618" name="__codelineno-0-1618"></a><span class="sd">    pickled, so this will only work if arguments are picklable. Other</span>
<a id="__codelineno-0-1619" name="__codelineno-0-1619"></a><span class="sd">    arguments to submit are also accepted.</span>
<a id="__codelineno-0-1620" name="__codelineno-0-1620"></a>
<a id="__codelineno-0-1621" name="__codelineno-0-1621"></a><span class="sd">    Note that this allows the unusal combination of *submit* false,</span>
<a id="__codelineno-0-1622" name="__codelineno-0-1622"></a><span class="sd">    and *to_cluster* true. This will submit the function as an external</span>
<a id="__codelineno-0-1623" name="__codelineno-0-1623"></a><span class="sd">    job, but run it on the local machine.</span>
<a id="__codelineno-0-1624" name="__codelineno-0-1624"></a>
<a id="__codelineno-0-1625" name="__codelineno-0-1625"></a><span class="sd">    Note: all arguments in the decorated function must be passed as</span>
<a id="__codelineno-0-1626" name="__codelineno-0-1626"></a><span class="sd">    key-word arguments.</span>
<a id="__codelineno-0-1627" name="__codelineno-0-1627"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-1628" name="__codelineno-0-1628"></a>
<a id="__codelineno-0-1629" name="__codelineno-0-1629"></a>    <span class="c1"># MM: when decorating functions with cluster_runnable, provide</span>
<a id="__codelineno-0-1630" name="__codelineno-0-1630"></a>    <span class="c1"># them as kwargs, else will throw attribute error</span>
<a id="__codelineno-0-1631" name="__codelineno-0-1631"></a>
<a id="__codelineno-0-1632" name="__codelineno-0-1632"></a>    <span class="n">function_name</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
<a id="__codelineno-0-1633" name="__codelineno-0-1633"></a>
<a id="__codelineno-0-1634" name="__codelineno-0-1634"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">submit_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-1635" name="__codelineno-0-1635"></a>
<a id="__codelineno-0-1636" name="__codelineno-0-1636"></a>        <span class="k">if</span> <span class="s2">&quot;submit&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;submit&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-1637" name="__codelineno-0-1637"></a>            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;submit&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1638" name="__codelineno-0-1638"></a>            <span class="n">submit_args</span><span class="p">,</span> <span class="n">args_file</span> <span class="o">=</span> <span class="n">_pickle_args</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-1639" name="__codelineno-0-1639"></a>            <span class="n">module_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
<a id="__codelineno-0-1640" name="__codelineno-0-1640"></a>                <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">func</span><span class="o">.</span><span class="vm">__module__</span><span class="p">]</span><span class="o">.</span><span class="vm">__file__</span><span class="p">)</span>
<a id="__codelineno-0-1641" name="__codelineno-0-1641"></a>            <span class="n">submit</span><span class="p">(</span><span class="n">iotools</span><span class="o">.</span><span class="n">snip</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span>
<a id="__codelineno-0-1642" name="__codelineno-0-1642"></a>                   <span class="s2">&quot;run_pickled&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1643" name="__codelineno-0-1643"></a>                   <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">iotools</span><span class="o">.</span><span class="n">snip</span><span class="p">(</span><span class="n">module_file</span><span class="p">),</span> <span class="n">function_name</span><span class="p">,</span> <span class="n">args_file</span><span class="p">],</span>
<a id="__codelineno-0-1644" name="__codelineno-0-1644"></a>                   <span class="o">**</span><span class="n">submit_args</span><span class="p">)</span>
<a id="__codelineno-0-1645" name="__codelineno-0-1645"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1646" name="__codelineno-0-1646"></a>            <span class="c1"># remove job contral options before running function</span>
<a id="__codelineno-0-1647" name="__codelineno-0-1647"></a>            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;submit&quot;</span><span class="p">,</span> <span class="s2">&quot;job_options&quot;</span><span class="p">,</span> <span class="s2">&quot;job_queue&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1648" name="__codelineno-0-1648"></a>                <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
<a id="__codelineno-0-1649" name="__codelineno-0-1649"></a>                    <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
<a id="__codelineno-0-1650" name="__codelineno-0-1650"></a>            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-1651" name="__codelineno-0-1651"></a>
<a id="__codelineno-0-1652" name="__codelineno-0-1652"></a>    <span class="k">return</span> <span class="n">submit_function</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.concatenate_and_load" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">concatenate_and_load</span><span class="p">(</span><span class="n">infiles</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">regex_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cat</span><span class="o">=</span><span class="s1">&#39;track&#39;</span><span class="p">,</span> <span class="n">has_titles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">missing_value</span><span class="o">=</span><span class="s1">&#39;na&#39;</span><span class="p">,</span> <span class="n">retry</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tablename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">job_memory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">to_cluster</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.concatenate_and_load" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>concatenate multiple tab-separated files and upload into database.</p>
<p>The table name is given by outfile without the
".load" suffix.</p>
<p>A typical concatenate and load task in ruffus would look like this::</p>
<div class="codehilite"><pre><span></span><code><span class="err">@</span><span class="n">merge</span><span class="p">(</span><span class="s2">&quot;*.tsv.gz&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;.load&quot;</span><span class="p">)</span>
<span class="n">def</span><span class="w"> </span><span class="n">loadData</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span><span class="w"> </span><span class="n">outfile</span><span class="p">):</span>
<span class="w">    </span><span class="n">P</span><span class="o">.</span><span class="n">concatenateAndLoad</span><span class="p">(</span><span class="n">infiles</span><span class="p">,</span><span class="w"> </span><span class="n">outfile</span><span class="p">)</span>
</code></pre></div>

<p>Upload is performed via the :doc:<code>csv2db</code> script.</p>
<h4 id="cgatcore.pipeline.concatenate_and_load--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.concatenate_and_load--arguments" title="Permanent link">&para;</a></h4>
<p>infiles : list
    Filenames of the input data
outfile : string
    Output filename. This will contain the logging information. The
    table name is derived from <code>outfile</code>.
regex_filename : string
    If given, <em>regex_filename</em> is applied to the filename to extract
    the track name. If the pattern contains multiple groups, they are
    added as additional columns. For example, if <code>cat</code> is set to
    <code>track,method</code> and <code>regex_filename</code> is <code>(.*)_(.*).tsv.gz</code>
    it will add the columns <code>track</code> and method to the table.
header : string
    Comma-separated list of values for header.
cat : string
    Column title for column containing the track name. The track name
    is derived from the filename, see <code>regex_filename</code>.
has_titles : bool
    If True, files are expected to have column titles in their first row.
missing_value : string
    String to use for missing values.
retry : bool
    If True, multiple attempts will be made if the data can
    not be loaded at the first try, for example if a table is locked.
tablename: string
    Name to use for table. If unset derive from outfile.
options : string
    Command line options for the <code>csv2db.py</code> script.
job_memory : string
    Amount of memory to allocate for job. If unset, uses the global
    default. Implies to_cluster=True.
to_cluster : bool
    By default load jobs are not submitted to the cluster as they sometimes
    become blocked. Setting this true will override this behavoir.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="k">def</span><span class="w"> </span><span class="nf">concatenate_and_load</span><span class="p">(</span><span class="n">infiles</span><span class="p">,</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>                         <span class="n">outfile</span><span class="p">,</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>                         <span class="n">regex_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>                         <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>                         <span class="n">cat</span><span class="o">=</span><span class="s2">&quot;track&quot;</span><span class="p">,</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>                         <span class="n">has_titles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>                         <span class="n">missing_value</span><span class="o">=</span><span class="s2">&quot;na&quot;</span><span class="p">,</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>                         <span class="n">retry</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>                         <span class="n">tablename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>                         <span class="n">options</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>                         <span class="n">job_memory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>                         <span class="n">to_cluster</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;concatenate multiple tab-separated files and upload into database.</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">    The table name is given by outfile without the</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">    &quot;.load&quot; suffix.</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">    A typical concatenate and load task in ruffus would look like this::</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">        @merge(&quot;*.tsv.gz&quot;, &quot;.load&quot;)</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">        def loadData(infile, outfile):</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">            P.concatenateAndLoad(infiles, outfile)</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">    Upload is performed via the :doc:`csv2db` script.</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">    infiles : list</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">        Filenames of the input data</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">    outfile : string</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">        Output filename. This will contain the logging information. The</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">        table name is derived from `outfile`.</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">    regex_filename : string</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">        If given, *regex_filename* is applied to the filename to extract</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">        the track name. If the pattern contains multiple groups, they are</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">        added as additional columns. For example, if `cat` is set to</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">        ``track,method`` and `regex_filename` is ``(.*)_(.*).tsv.gz``</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">        it will add the columns ``track`` and method to the table.</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">    header : string</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">        Comma-separated list of values for header.</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">    cat : string</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">        Column title for column containing the track name. The track name</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">        is derived from the filename, see `regex_filename`.</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">    has_titles : bool</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">        If True, files are expected to have column titles in their first row.</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">    missing_value : string</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">        String to use for missing values.</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">    retry : bool</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">        If True, multiple attempts will be made if the data can</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">        not be loaded at the first try, for example if a table is locked.</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="sd">    tablename: string</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">        Name to use for table. If unset derive from outfile.</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">    options : string</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">        Command line options for the `csv2db.py` script.</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">    job_memory : string</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">        Amount of memory to allocate for job. If unset, uses the global</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">        default. Implies to_cluster=True.</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">    to_cluster : bool</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">        By default load jobs are not submitted to the cluster as they sometimes</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">        become blocked. Setting this true will override this behavoir.</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>    <span class="k">if</span> <span class="n">job_memory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="n">job_memory</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">()[</span><span class="s2">&quot;cluster_memory_default&quot;</span><span class="p">]</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>    <span class="k">if</span> <span class="n">tablename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="n">tablename</span> <span class="o">=</span> <span class="n">to_table</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>    <span class="n">infiles</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">infiles</span><span class="p">)</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>    <span class="n">passed_options</span> <span class="o">=</span> <span class="n">options</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>    <span class="n">load_options</span><span class="p">,</span> <span class="n">cat_options</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;--add-index=track&quot;</span><span class="p">],</span> <span class="p">[]</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>    <span class="k">if</span> <span class="n">regex_filename</span><span class="p">:</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>        <span class="n">cat_options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;--regex-filename=&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">regex_filename</span><span class="p">)</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>    <span class="k">if</span> <span class="n">header</span><span class="p">:</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>        <span class="n">load_options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;--header-names=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">header</span><span class="p">)</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_titles</span><span class="p">:</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>        <span class="n">cat_options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;--no-titles&quot;</span><span class="p">)</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>    <span class="n">cat_options</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cat_options</span><span class="p">)</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>    <span class="n">load_options</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">load_options</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">passed_options</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>    <span class="n">load_statement</span> <span class="o">=</span> <span class="n">build_load_statement</span><span class="p">(</span><span class="n">tablename</span><span class="p">,</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>                                          <span class="n">options</span><span class="o">=</span><span class="n">load_options</span><span class="p">,</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>                                          <span class="n">retry</span><span class="o">=</span><span class="n">retry</span><span class="p">)</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>    <span class="n">statement</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;python -m cgatcore.tables</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="s1">    --cat=</span><span class="si">%(cat)s</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="s1">    --missing-value=</span><span class="si">%(missing_value)s</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="s1">    </span><span class="si">%(cat_options)s</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="s1">    </span><span class="si">%(infiles)s</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="s1">    | </span><span class="si">%(load_statement)s</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="s1">    &gt; </span><span class="si">%(outfile)s</span><span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>    <span class="n">run</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.config_to_dictionary" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">config_to_dictionary</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.config_to_dictionary" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>convert the contents of a :py:class:<code>ConfigParser.ConfigParser</code>
object to a dictionary</p>
<p>This method works by iterating over all configuration values in a
:py:class:<code>ConfigParser.ConfigParser</code> object and inserting values
into a dictionary. Section names are prefixed using and underscore.
Thus::</p>
<div class="codehilite"><pre><span></span><code><span class="k">[sample]</span>
<span class="na">name</span><span class="o">=</span><span class="s">12</span>
</code></pre></div>

<p>is entered as <code>sample_name=12</code> into the dictionary. The sections
<code>general</code> and <code>DEFAULT</code> are treated specially in that both
the prefixed and the unprefixed values are inserted: ::</p>
<p>[general]
   genome=hg19</p>
<p>will be added as <code>general_genome=hg19</code> and <code>genome=hg19</code>.</p>
<p>Numbers will be automatically recognized as such and converted into
integers or floats.</p>
<h4 id="cgatcore.pipeline.config_to_dictionary--returns">Returns<a class="headerlink" href="#cgatcore.pipeline.config_to_dictionary--returns" title="Permanent link">&para;</a></h4>
<p>config : dict
    A dictionary of configuration values</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/parameters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="k">def</span><span class="w"> </span><span class="nf">config_to_dictionary</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;convert the contents of a :py:class:`ConfigParser.ConfigParser`</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">    object to a dictionary</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    This method works by iterating over all configuration values in a</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">    :py:class:`ConfigParser.ConfigParser` object and inserting values</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    into a dictionary. Section names are prefixed using and underscore.</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">    Thus::</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        [sample]</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">        name=12</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">    is entered as ``sample_name=12`` into the dictionary. The sections</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">    ``general`` and ``DEFAULT`` are treated specially in that both</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">    the prefixed and the unprefixed values are inserted: ::</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">       [general]</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">       genome=hg19</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">    will be added as ``general_genome=hg19`` and ``genome=hg19``.</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">    Numbers will be automatically recognized as such and converted into</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">    integers or floats.</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">    -------</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">    config : dict</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">        A dictionary of configuration values</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">TriggeredDefaultFactory</span><span class="p">()))</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>    <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">sections</span><span class="p">():</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="n">section</span><span class="p">):</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>                <span class="n">v</span> <span class="o">=</span> <span class="n">iotools</span><span class="o">.</span><span class="n">str2val</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>                <span class="n">E</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;error converting key </span><span class="si">%s</span><span class="s2">, value </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>                <span class="n">E</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Possible multiple concurrent attempts to &quot;</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>                        <span class="s2">&quot;read configuration&quot;</span><span class="p">)</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>                <span class="k">raise</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>            <span class="n">p</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>            <span class="c1"># IMS: new heirarchical format</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>                <span class="n">p</span><span class="p">[</span><span class="n">section</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>                <span class="c1"># fails with things like genome_dir=abc</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>                <span class="c1"># if [genome] does not exist.</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>                <span class="k">continue</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>            <span class="k">if</span> <span class="n">section</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;general&quot;</span><span class="p">,</span> <span class="s2">&quot;DEFAULT&quot;</span><span class="p">):</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>                <span class="n">p</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">defaults</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="n">p</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">iotools</span><span class="o">.</span><span class="n">str2val</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>    <span class="k">return</span> <span class="n">p</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.connect" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">connect</span><span class="p">()</span></code>

<a href="#cgatcore.pipeline.connect" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>connect to SQLite database used in this pipeline.</p>
<p>.. note::
   This method is currently only implemented for sqlite
   databases. It needs refactoring for generic access.
   Alternatively, use an full or partial ORM.</p>
<p>If <code>annotations_database</code> is in params, this method
will attach the named database as <code>annotations</code>.</p>
<h4 id="cgatcore.pipeline.connect--returns">Returns<a class="headerlink" href="#cgatcore.pipeline.connect--returns" title="Permanent link">&para;</a></h4>
<p>dbh
   a database handle</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">():</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;connect to SQLite database used in this pipeline.</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="sd">    .. note::</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="sd">       This method is currently only implemented for sqlite</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">       databases. It needs refactoring for generic access.</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a><span class="sd">       Alternatively, use an full or partial ORM.</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a><span class="sd">    If ``annotations_database`` is in params, this method</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a><span class="sd">    will attach the named database as ``annotations``.</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">    -------</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="sd">    dbh</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">       a database handle</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>    <span class="c1"># Note that in the future this might return an sqlalchemy or</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>    <span class="c1"># db.py handle.</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>    <span class="n">url</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">()[</span><span class="s2">&quot;database&quot;</span><span class="p">][</span><span class="s2">&quot;url&quot;</span><span class="p">]</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>    <span class="n">is_sqlite3</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;sqlite&quot;</span><span class="p">)</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>    <span class="k">if</span> <span class="n">is_sqlite3</span><span class="p">:</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>        <span class="n">connect_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;check_same_thread&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>        <span class="n">connect_args</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>    <span class="n">creator</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>    <span class="k">if</span> <span class="n">is_sqlite3</span> <span class="ow">and</span> <span class="s2">&quot;annotations_dir&quot;</span> <span class="ow">in</span> <span class="n">get_params</span><span class="p">():</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>        <span class="c1"># not sure what the correct way is for url</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>        <span class="c1"># sqlite:///./csvdb -&gt; ./csvdb</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>        <span class="c1"># sqlite:////path/to/csvdb -&gt; /path/to/csvdb</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="s2">&quot;sqlite:///&quot;</span><span class="p">):])</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">creator</span><span class="p">():</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>            <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>            <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;ATTACH DATABASE &#39;</span><span class="si">{}</span><span class="s2">&#39; as annotations&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_params</span><span class="p">()[</span><span class="s2">&quot;annotations_dir&quot;</span><span class="p">],</span> <span class="s2">&quot;csvdb&quot;</span><span class="p">)))</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>            <span class="k">return</span> <span class="n">conn</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>    <span class="n">engine</span> <span class="o">=</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">create_engine</span><span class="p">(</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>        <span class="n">url</span><span class="p">,</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>        <span class="n">connect_args</span><span class="o">=</span><span class="n">connect_args</span><span class="p">,</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>        <span class="n">creator</span><span class="o">=</span><span class="n">creator</span><span class="p">)</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>    <span class="k">return</span> <span class="n">engine</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.create_view" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_view</span><span class="p">(</span><span class="n">dbhandle</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">tablename</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">view_type</span><span class="o">=</span><span class="s1">&#39;TABLE&#39;</span><span class="p">,</span> <span class="n">ignore_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.create_view" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>create a database view for a list of tables.</p>
<p>This method performs a join across multiple tables and stores the
result either as a view or a table in the database.</p>
<h4 id="cgatcore.pipeline.create_view--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.create_view--arguments" title="Permanent link">&para;</a></h4>
<p>dbhandle :
    A database handle.
tables : list of tuples
    Tables to merge. Each tuple contains the name of a table and
    the field to join with the first table. For example::</p>
<div class="codehilite"><pre><span></span><code>    tables = (
        &quot;reads_summary&quot;, &quot;track&quot;,
        &quot;bam_stats&quot;, &quot;track&quot;,
        &quot;context_stats&quot;, &quot;track&quot;,
        &quot;picard_stats_alignment_summary_metrics&quot;, &quot;track&quot;)
</code></pre></div>


<details class="tablename-" open>
  <summary>string</summary>
  <p>Name of the view or table to be created.</p>
</details>        <p>outfile : string
    Output filename for status information.
view_type : string
    Type of view, either <code>VIEW</code> or <code>TABLE</code>.  If a view is to be
    created across multiple databases, use <code>TABLE</code>.
ignore_duplicates : bool
    If set to False, duplicate column names will be added with the
    tablename as prefix. The default is to ignore.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_view</span><span class="p">(</span><span class="n">dbhandle</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">tablename</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>                <span class="n">view_type</span><span class="o">=</span><span class="s2">&quot;TABLE&quot;</span><span class="p">,</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>                <span class="n">ignore_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;create a database view for a list of tables.</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a><span class="sd">    This method performs a join across multiple tables and stores the</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a><span class="sd">    result either as a view or a table in the database.</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a><span class="sd">    dbhandle :</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a><span class="sd">        A database handle.</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a><span class="sd">    tables : list of tuples</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a><span class="sd">        Tables to merge. Each tuple contains the name of a table and</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a><span class="sd">        the field to join with the first table. For example::</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a><span class="sd">            tables = (</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a><span class="sd">                &quot;reads_summary&quot;, &quot;track&quot;,</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a><span class="sd">                &quot;bam_stats&quot;, &quot;track&quot;,</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a><span class="sd">                &quot;context_stats&quot;, &quot;track&quot;,</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a><span class="sd">                &quot;picard_stats_alignment_summary_metrics&quot;, &quot;track&quot;)</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a><span class="sd">    tablename : string</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a><span class="sd">        Name of the view or table to be created.</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="sd">    outfile : string</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a><span class="sd">        Output filename for status information.</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a><span class="sd">    view_type : string</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a><span class="sd">        Type of view, either ``VIEW`` or ``TABLE``.  If a view is to be</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a><span class="sd">        created across multiple databases, use ``TABLE``.</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="sd">    ignore_duplicates : bool</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a><span class="sd">        If set to False, duplicate column names will be added with the</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a><span class="sd">        tablename as prefix. The default is to ignore.</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>    <span class="n">database</span><span class="o">.</span><span class="n">executewait</span><span class="p">(</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>        <span class="n">dbhandle</span><span class="p">,</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>        <span class="s2">&quot;DROP </span><span class="si">%(view_type)s</span><span class="s2"> IF EXISTS </span><span class="si">%(tablename)s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">locals</span><span class="p">())</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>    <span class="n">tracks</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>    <span class="n">tablenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">]</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>    <span class="k">for</span> <span class="n">table</span><span class="p">,</span> <span class="n">track</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">executewait</span><span class="p">(</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>            <span class="n">dbhandle</span><span class="p">,</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>            <span class="s2">&quot;SELECT COUNT(DISTINCT </span><span class="si">%s</span><span class="s2">) FROM </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">track</span><span class="p">,</span> <span class="n">table</span><span class="p">))</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>        <span class="n">tracks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>        <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>            <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">database</span><span class="o">.</span><span class="n">getColumnNames</span><span class="p">(</span><span class="n">dbhandle</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>             <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">track</span><span class="p">])</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>    <span class="n">E</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;creating </span><span class="si">%s</span><span class="s2"> from the following tables: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>           <span class="p">(</span><span class="n">tablename</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">tablenames</span><span class="p">,</span> <span class="n">tracks</span><span class="p">)))))</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>    <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">tracks</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">max</span><span class="p">(</span><span class="n">tracks</span><span class="p">):</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>            <span class="s2">&quot;number of rows not identical - will not create view&quot;</span><span class="p">)</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>    <span class="n">from_statement</span> <span class="o">=</span> <span class="s2">&quot; , &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>        <span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> as t</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tables</span><span class="p">)])</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>    <span class="n">f</span> <span class="o">=</span> <span class="n">tables</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>    <span class="n">where_statement</span> <span class="o">=</span> <span class="s2">&quot; AND &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>        <span class="p">[</span><span class="s2">&quot;t0.</span><span class="si">%s</span><span class="s2"> = t</span><span class="si">%i</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>         <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">:])])</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>    <span class="n">all_columns</span><span class="p">,</span> <span class="n">taken</span> <span class="o">=</span> <span class="p">[],</span> <span class="nb">set</span><span class="p">()</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">columns</span><span class="p">):</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>        <span class="n">i</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">taken</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>        <span class="k">if</span> <span class="n">i</span><span class="p">:</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>            <span class="n">E</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;duplicate column names: </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_duplicates</span><span class="p">:</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>                <span class="n">table</span> <span class="o">=</span> <span class="n">tables</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>                <span class="n">all_columns</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>                    <span class="p">[</span><span class="s2">&quot;t</span><span class="si">%i</span><span class="s2">.</span><span class="si">%s</span><span class="s2"> AS </span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">i</span><span class="p">])</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>                <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">c</span> <span class="k">if</span> <span class="n">y</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>        <span class="n">all_columns</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;t</span><span class="si">%i</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">c</span><span class="p">])</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>        <span class="n">taken</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>    <span class="n">all_columns</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">all_columns</span><span class="p">)</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>    <span class="n">statement</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a><span class="s1">    CREATE </span><span class="si">%(view_type)s</span><span class="s1"> </span><span class="si">%(tablename)s</span><span class="s1"> AS SELECT t0.track, </span><span class="si">%(all_columns)s</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a><span class="s1">    FROM </span><span class="si">%(from_statement)s</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a><span class="s1">    WHERE </span><span class="si">%(where_statement)s</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="s1">    &#39;&#39;&#39;</span> <span class="o">%</span> <span class="nb">locals</span><span class="p">()</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>    <span class="n">database</span><span class="o">.</span><span class="n">executewait</span><span class="p">(</span><span class="n">dbhandle</span><span class="p">,</span> <span class="n">statement</span><span class="p">)</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>    <span class="n">nrows</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">executewait</span><span class="p">(</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>        <span class="n">dbhandle</span><span class="p">,</span> <span class="s2">&quot;SELECT COUNT(*) FROM view_mapping&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>    <span class="k">if</span> <span class="n">nrows</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>            <span class="s2">&quot;empty view mapping, check statement = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>            <span class="p">(</span><span class="n">statement</span> <span class="o">%</span> <span class="nb">locals</span><span class="p">()))</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>    <span class="k">if</span> <span class="n">nrows</span> <span class="o">!=</span> <span class="nb">min</span><span class="p">(</span><span class="n">tracks</span><span class="p">):</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>        <span class="n">E</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;view creates duplicate rows, got </span><span class="si">%i</span><span class="s2">, expected </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>               <span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">tracks</span><span class="p">)))</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>    <span class="n">E</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;created view_mapping with </span><span class="si">%i</span><span class="s2"> rows&quot;</span> <span class="o">%</span> <span class="n">nrows</span><span class="p">)</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>    <span class="n">touch_file</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.execute" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.execute" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>execute a statement locally.</p>
<p>This method implements the same parameter interpolation
as the function :func:<code>run</code>.</p>
<h4 id="cgatcore.pipeline.execute--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.execute--arguments" title="Permanent link">&para;</a></h4>
<p>statement : string
    Command line statement to run.</p>
<h4 id="cgatcore.pipeline.execute--returns">Returns<a class="headerlink" href="#cgatcore.pipeline.execute--returns" title="Permanent link">&para;</a></h4>
<p>stdout : string
    Data sent to standard output by command
stderr : string
    Data sent to standard error by command</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;execute a statement locally.</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="sd">    This method implements the same parameter interpolation</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="sd">    as the function :func:`run`.</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="sd">    statement : string</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">        Command line statement to run.</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">    -------</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">    stdout : string</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="sd">        Data sent to standard output by command</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">    stderr : string</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="sd">        Data sent to standard error by command</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">:</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">get_caller_locals</span><span class="p">()</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>    <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">get_params</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">()</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;running </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">statement</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">))</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>    <span class="k">if</span> <span class="s2">&quot;cwd&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>        <span class="n">cwd</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">()[</span><span class="s2">&quot;work_dir&quot;</span><span class="p">]</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>        <span class="n">cwd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;cwd&quot;</span><span class="p">]</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>    <span class="c1"># cleaning up of statement</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>    <span class="c1"># remove new lines and superfluous spaces and tabs</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>    <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">+&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">statement</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>    <span class="k">if</span> <span class="n">statement</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">):</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="n">statement</span> <span class="o">=</span> <span class="n">statement</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>    <span class="c1"># always use bash</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>        <span class="p">{</span><span class="s1">&#39;BASH_ENV&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span> <span class="s1">&#39;.bashrc&#39;</span><span class="p">)})</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>    <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">statement</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>                               <span class="n">cwd</span><span class="o">=</span><span class="n">cwd</span><span class="p">,</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>                               <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>                               <span class="n">stdin</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">,</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>                               <span class="n">stdout</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>                               <span class="n">stderr</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>                               <span class="n">env</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>                               <span class="n">executable</span><span class="o">=</span><span class="s2">&quot;/bin/bash&quot;</span><span class="p">)</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>    <span class="c1"># process.stdin.close()</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>    <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>    <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>        <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>            <span class="s2">&quot;Child was terminated by signal </span><span class="si">%i</span><span class="s2">: </span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>            <span class="s2">&quot;The stderr was: </span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>            <span class="p">(</span><span class="o">-</span><span class="n">process</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="n">stderr</span><span class="p">,</span> <span class="n">statement</span><span class="p">))</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>    <span class="k">return</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.file_is_mounted" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">file_is_mounted</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.file_is_mounted" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>return True if filename is mounted.</p>
<p>A file is likely to be mounted if it is located
inside a subdirectory of the local scratch directory.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="k">def</span><span class="w"> </span><span class="nf">file_is_mounted</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;return True if filename is mounted.</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="sd">    A file is likely to be mounted if it is located</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="sd">    inside a subdirectory of the local scratch directory.</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>    <span class="k">if</span> <span class="n">get_params</span><span class="p">()[</span><span class="s2">&quot;mount_point&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">get_params</span><span class="p">()[</span><span class="s2">&quot;mount_point&quot;</span><span class="p">])</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.get_caller" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_caller</span><span class="p">(</span><span class="n">decorators</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.get_caller" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>return the name of the calling class/module</p>
<h4 id="cgatcore.pipeline.get_caller--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.get_caller--arguments" title="Permanent link">&para;</a></h4>
<p>decorators : int
    Number of contexts to go up to reach calling function
    of interest.</p>
<h4 id="cgatcore.pipeline.get_caller--returns">Returns<a class="headerlink" href="#cgatcore.pipeline.get_caller--returns" title="Permanent link">&para;</a></h4>
<p>mod : object
    The calling module/class</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_caller</span><span class="p">(</span><span class="n">decorators</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;return the name of the calling class/module</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    decorators : int</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        Number of contexts to go up to reach calling function</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        of interest.</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    -------</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    mod : object</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        The calling module/class</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="n">frm</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="k">return</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmodule</span><span class="p">(</span><span class="n">frm</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">decorators</span><span class="p">]</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.get_caller_locals" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_caller_locals</span><span class="p">(</span><span class="n">decorators</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.get_caller_locals" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>returns the locals of the calling function.</p>
<p>from http://pylab.blogspot.com/2009/02/
     python-accessing-caller-locals-from.html</p>
<h4 id="cgatcore.pipeline.get_caller_locals--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.get_caller_locals--arguments" title="Permanent link">&para;</a></h4>
<p>decorators : int
    Number of contexts to go up to reach calling function
    of interest.</p>
<h4 id="cgatcore.pipeline.get_caller_locals--returns">Returns<a class="headerlink" href="#cgatcore.pipeline.get_caller_locals--returns" title="Permanent link">&para;</a></h4>
<p>locals : dict
    Dictionary of variable defined in the context of the
    calling function.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_caller_locals</span><span class="p">(</span><span class="n">decorators</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;returns the locals of the calling function.</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    from http://pylab.blogspot.com/2009/02/</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">         python-accessing-caller-locals-from.html</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    decorators : int</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        Number of contexts to go up to reach calling function</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        of interest.</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">    -------</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    locals : dict</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">        Dictionary of variable defined in the context of the</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">        calling function.</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="n">f</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="n">decorators</span><span class="p">)</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="n">args</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getargvalues</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="k">return</span> <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.get_calling_function" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_calling_function</span><span class="p">(</span><span class="n">decorators</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.get_calling_function" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>return the name of the calling function</p>
<h4 id="cgatcore.pipeline.get_calling_function--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.get_calling_function--arguments" title="Permanent link">&para;</a></h4>
<p>decorators : int
    Number of contexts to go up to reach calling function
    of interest.</p>
<h4 id="cgatcore.pipeline.get_calling_function--returns">Returns<a class="headerlink" href="#cgatcore.pipeline.get_calling_function--returns" title="Permanent link">&para;</a></h4>
<p>mod : object
    The calling module</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_calling_function</span><span class="p">(</span><span class="n">decorators</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;return the name of the calling function</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">    decorators : int</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        Number of contexts to go up to reach calling function</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">        of interest.</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">    -------</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    mod : object</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        The calling module</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="n">frm</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="k">return</span> <span class="n">frm</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">decorators</span><span class="p">]</span><span class="o">.</span><span class="n">function</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.get_database_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_database_name</span><span class="p">()</span></code>

<a href="#cgatcore.pipeline.get_database_name" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Return the database name associated with the pipeline.</p>
<p>This method lookis in different sections in the ini file to permit
both old style <code>database</code> and new style <code>database_name</code>.</p>
<p>This method has been implemented for backwards compatibility.</p>
<h4 id="cgatcore.pipeline.get_database_name--returns">Returns<a class="headerlink" href="#cgatcore.pipeline.get_database_name--returns" title="Permanent link">&para;</a></h4>
<p>databasename : string
    database name. Returns empty string if not found.</p>
<h4 id="cgatcore.pipeline.get_database_name--raises">Raises<a class="headerlink" href="#cgatcore.pipeline.get_database_name--raises" title="Permanent link">&para;</a></h4>
<p>KeyError
   If no database name is found</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-576" name="__codelineno-0-576"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_database_name</span><span class="p">():</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Return the database name associated with the pipeline.</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a><span class="sd">    This method lookis in different sections in the ini file to permit</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a><span class="sd">    both old style ``database`` and new style ``database_name``.</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="sd">    This method has been implemented for backwards compatibility.</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a><span class="sd">    -------</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a><span class="sd">    databasename : string</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a><span class="sd">        database name. Returns empty string if not found.</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="sd">    ------</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">    KeyError</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a><span class="sd">       If no database name is found</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>    <span class="n">locations</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;database_name&quot;</span><span class="p">,</span> <span class="s2">&quot;database&quot;</span><span class="p">]</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>    <span class="n">params</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">()</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>    <span class="k">for</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">locations</span><span class="p">:</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>        <span class="n">database</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>        <span class="k">if</span> <span class="n">database</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>            <span class="k">return</span> <span class="n">database</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;database name not found&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.get_executor" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_executor</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.get_executor" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Return an executor instance based on the specified queue manager in options.</p>
        <ul>
<li>options (dict): Dictionary containing execution options, 
                  including "cluster_queue_manager".</li>
</ul>
<p>Returns:
- Executor instance appropriate for the specified queue manager.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-433" name="__codelineno-0-433"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_executor</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a><span class="sd">    Return an executor instance based on the specified queue manager in options.</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">    - options (dict): Dictionary containing execution options, </span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">                      including &quot;cluster_queue_manager&quot;.</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="sd">    - Executor instance appropriate for the specified queue manager.</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>    <span class="k">if</span> <span class="n">options</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>        <span class="n">options</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">()</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;testing&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>        <span class="k">return</span> <span class="n">LocalExecutor</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>    <span class="c1"># Check if to_cluster is explicitly set to False</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;to_cluster&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>  <span class="c1"># Defaults to True if not specified</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>        <span class="k">return</span> <span class="n">LocalExecutor</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>    <span class="n">queue_manager</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cluster_queue_manager&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>    <span class="c1"># Check for KubernetesExecutor</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>    <span class="k">if</span> <span class="n">queue_manager</span> <span class="o">==</span> <span class="s2">&quot;kubernetes&quot;</span> <span class="ow">and</span> <span class="n">KubernetesExecutor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>        <span class="k">return</span> <span class="n">KubernetesExecutor</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>    <span class="c1"># Check for SGEExecutor (Sun Grid Engine)</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>    <span class="k">elif</span> <span class="n">queue_manager</span> <span class="o">==</span> <span class="s2">&quot;sge&quot;</span> <span class="ow">and</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;qsub&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>        <span class="k">return</span> <span class="n">SGEExecutor</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>    <span class="c1"># Check for SlurmExecutor</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>    <span class="k">elif</span> <span class="n">queue_manager</span> <span class="o">==</span> <span class="s2">&quot;slurm&quot;</span> <span class="ow">and</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;sbatch&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>        <span class="k">return</span> <span class="n">SlurmExecutor</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>    <span class="c1"># Check for TorqueExecutor</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>    <span class="k">elif</span> <span class="n">queue_manager</span> <span class="o">==</span> <span class="s2">&quot;torque&quot;</span> <span class="ow">and</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;qsub&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>        <span class="k">return</span> <span class="n">TorqueExecutor</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>    <span class="c1"># Fallback to LocalExecutor, not sure if this should raise an error though, feels like it should</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>        <span class="k">return</span> <span class="n">LocalExecutor</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.get_header" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_header</span><span class="p">()</span></code>

<a href="#cgatcore.pipeline.get_header" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>return a header string with command line options and timestamp</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/experiment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_header</span><span class="p">():</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;return a header string with command line options and timestamp</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>    <span class="n">system</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">machine</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">uname</span><span class="p">()</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>    <span class="k">return</span> <span class="s2">&quot;output generated by </span><span class="si">%s</span><span class="se">\n</span><span class="s2">job started at </span><span class="si">%s</span><span class="s2"> on </span><span class="si">%s</span><span class="s2"> -- </span><span class="si">%s</span><span class="se">\n</span><span class="s2">pid: </span><span class="si">%i</span><span class="s2">, system: </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>\
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>           <span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">),</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>            <span class="n">time</span><span class="o">.</span><span class="n">asctime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())),</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>            <span class="n">host</span><span class="p">,</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>            <span class="n">global_id</span><span class="p">,</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>            <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">(),</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>            <span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">machine</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.get_mounted_location" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_mounted_location</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.get_mounted_location" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>return location of filename within mounted directory</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_mounted_location</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;return location of filename within mounted directory</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="nb">len</span><span class="p">(</span><span class="n">get_params</span><span class="p">()[</span><span class="s2">&quot;mount_point&quot;</span><span class="p">]):]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.get_param_output" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_param_output</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.get_param_output" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>return a string containing script parameters.</p>
<p>Parameters are all variables that start with <code>param_</code>.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/control.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_param_output</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;return a string containing script parameters.</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">    Parameters are all variables that start with ``param_``.</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="k">if</span> <span class="n">options</span><span class="p">:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="n">members</span> <span class="o">=</span> <span class="n">options</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">members</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%-40s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="nb">vars</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span><span class="o">.</span><span class="n">f_locals</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">vars</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;param_&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)]:</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%-40s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>                          <span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">vars</span><span class="p">[</span><span class="n">var</span><span class="p">])))</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="k">return</span> <span class="s2">&quot;# no parameters.&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.get_param_section" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_param_section</span><span class="p">(</span><span class="n">section</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.get_param_section" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>return config values in section</p>
<p>Sections are built by common prefixes.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/parameters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-576" name="__codelineno-0-576"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_param_section</span><span class="p">(</span><span class="n">section</span><span class="p">):</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;return config values in section</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a><span class="sd">    Sections are built by common prefixes.</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">section</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">):</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>        <span class="n">section</span> <span class="o">=</span> <span class="n">section</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>    <span class="k">return</span> <span class="p">[(</span><span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="p">:],</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">PARAMS</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">section</span><span class="p">)]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.get_parameters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_parameters</span><span class="p">(</span><span class="n">filenames</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">site_ini</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">only_import</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.get_parameters" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>read one or more config files and build global PARAMS configuration
dictionary.</p>
<h4 id="cgatcore.pipeline.get_parameters--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.get_parameters--arguments" title="Permanent link">&para;</a></h4>
<p>filenames : list
   List of filenames of the configuration files to read.
defaults : dict
   Dictionary with default values. These will be overwrite
   any hard-coded parameters, but will be overwritten by user
   specified parameters in the configuration files.
user : bool
   If set, configuration files will also be read from a
   file called :file:<code>.cgat.yml</code> in the user<code>s
   home directory.
only_import : bool
   If set to a boolean, the parameter dictionary will be a
   defaultcollection. This is useful for pipelines that are
   imported (for example for documentation generation) but not
   executed as there might not be an appropriate .yml file
   available. If</code>only_import` is None, it will be set to the
   default, which is to raise an exception unless the calling
   script is imported or the option <code>--is-test</code> has been passed
   at the command line.</p>
<h4 id="cgatcore.pipeline.get_parameters--returns">Returns<a class="headerlink" href="#cgatcore.pipeline.get_parameters--returns" title="Permanent link">&para;</a></h4>
<p>params : dict
   Global configuration dictionary.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/parameters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_parameters</span><span class="p">(</span><span class="n">filenames</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>                   <span class="n">defaults</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>                   <span class="n">site_ini</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>                   <span class="n">user</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>                   <span class="n">only_import</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;read one or more config files and build global PARAMS configuration</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="sd">    dictionary.</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">    filenames : list</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="sd">       List of filenames of the configuration files to read.</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">    defaults : dict</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">       Dictionary with default values. These will be overwrite</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">       any hard-coded parameters, but will be overwritten by user</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">       specified parameters in the configuration files.</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">    user : bool</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">       If set, configuration files will also be read from a</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="sd">       file called :file:`.cgat.yml` in the user`s</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">       home directory.</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">    only_import : bool</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">       If set to a boolean, the parameter dictionary will be a</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">       defaultcollection. This is useful for pipelines that are</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">       imported (for example for documentation generation) but not</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">       executed as there might not be an appropriate .yml file</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">       available. If `only_import` is None, it will be set to the</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">       default, which is to raise an exception unless the calling</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">       script is imported or the option ``--is-test`` has been passed</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">       at the command line.</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">    -------</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">    params : dict</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="sd">       Global configuration dictionary.</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>    <span class="k">global</span> <span class="n">PARAMS</span><span class="p">,</span> <span class="n">HAVE_INITIALIZED</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>    <span class="c1"># only execute function once</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>    <span class="k">if</span> <span class="n">HAVE_INITIALIZED</span><span class="p">:</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>        <span class="k">return</span> <span class="n">PARAMS</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>    <span class="k">if</span> <span class="n">filenames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;pipeline.yml&quot;</span><span class="p">,</span> <span class="s2">&quot;cgat.yml&quot;</span><span class="p">]</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filenames</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">filenames</span><span class="p">]</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>    <span class="n">old_id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">PARAMS</span><span class="p">)</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>    <span class="n">caller_locals</span> <span class="o">=</span> <span class="n">get_caller_locals</span><span class="p">()</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>    <span class="c1"># check if this is only for import</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>    <span class="k">if</span> <span class="n">only_import</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>        <span class="n">only_import</span> <span class="o">=</span> <span class="n">is_test</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;__name__&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">caller_locals</span> <span class="ow">or</span> \
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>            <span class="n">caller_locals</span><span class="p">[</span><span class="s2">&quot;__name__&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;__main__&quot;</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>    <span class="c1"># important: only update the PARAMS variable as</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>    <span class="c1"># it is referenced in other modules. Thus the type</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>    <span class="c1"># needs to be fixed at import. Raise error where this</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>    <span class="c1"># is not the case.</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>    <span class="c1"># Note: Parameter sharing in the pipeline module needs</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>    <span class="c1"># to be reorganized.</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>    <span class="k">if</span> <span class="n">only_import</span><span class="p">:</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>        <span class="c1"># turn on default dictionary</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>        <span class="n">TriggeredDefaultFactory</span><span class="o">.</span><span class="n">with_default</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>    <span class="c1"># check if the pipeline is in testing mode</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>    <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>    <span class="k">if</span> <span class="s1">&#39;argv&#39;</span> <span class="ow">in</span> <span class="n">caller_locals</span> <span class="ow">and</span> <span class="n">caller_locals</span><span class="p">[</span><span class="s1">&#39;argv&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">caller_locals</span><span class="p">[</span><span class="s1">&#39;argv&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>            <span class="k">if</span> <span class="s1">&#39;template_pipeline.py&#39;</span> <span class="ow">in</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>                <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>    <span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;testing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;self&#39;</span> <span class="ow">in</span> <span class="n">caller_locals</span> <span class="ow">or</span> <span class="n">found</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>    <span class="k">if</span> <span class="n">site_ini</span><span class="p">:</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>        <span class="c1"># read configuration from /etc/cgat/pipeline.yml</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>        <span class="n">fn</span> <span class="o">=</span> <span class="s2">&quot;/etc/cgat/pipeline.yml&quot;</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>            <span class="n">filenames</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>    <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>        <span class="c1"># read configuration from a users home directory</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>        <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">),</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>                          <span class="s2">&quot;.cgat.yml&quot;</span><span class="p">)</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>            <span class="k">if</span> <span class="s1">&#39;pipeline.yml&#39;</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>                <span class="n">filenames</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">filenames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;pipeline.yml&#39;</span><span class="p">),</span> <span class="n">fn</span><span class="p">)</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>                <span class="n">filenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>    <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">filenames</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>    <span class="c1"># save list of config files</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>    <span class="n">PARAMS</span><span class="p">[</span><span class="s2">&quot;pipeline_yml&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filenames</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>    <span class="c1"># update with hard-coded PARAMS</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>    <span class="n">nested_update</span><span class="p">(</span><span class="n">PARAMS</span><span class="p">,</span> <span class="n">HARDCODED_PARAMS</span><span class="p">)</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>    <span class="k">if</span> <span class="n">defaults</span><span class="p">:</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>        <span class="n">nested_update</span><span class="p">(</span><span class="n">PARAMS</span><span class="p">,</span> <span class="n">defaults</span><span class="p">)</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>    <span class="c1"># reset working directory. Set in PARAMS to prevent repeated calls to</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>    <span class="c1"># os.getcwd() failing if network is busy</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>    <span class="n">PARAMS</span><span class="p">[</span><span class="s2">&quot;start_dir&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>    <span class="c1"># location of pipelines - set via location of top frame (cgatflow command)</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>    <span class="k">if</span> <span class="s1">&#39;__file__&#39;</span> <span class="ow">in</span> <span class="n">caller_locals</span><span class="p">:</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>        <span class="n">PARAMS</span><span class="p">[</span><span class="s2">&quot;pipelinedir&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">caller_locals</span><span class="p">[</span><span class="s2">&quot;__file__&quot;</span><span class="p">])</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>        <span class="n">PARAMS</span><span class="p">[</span><span class="s2">&quot;pipelinedir&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>            <span class="k">continue</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>        <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;reading config from file </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>            <span class="n">filename</span><span class="p">))</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inf</span><span class="p">:</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>            <span class="n">p</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">inf</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>            <span class="k">if</span> <span class="n">p</span><span class="p">:</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>                <span class="n">nested_update</span><span class="p">(</span><span class="n">PARAMS</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>    <span class="c1"># for backwards compatibility - normalize dictionaries</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>    <span class="n">p</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">PARAMS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>            <span class="k">for</span> <span class="n">kk</span><span class="p">,</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>                <span class="n">new_key</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">kk</span><span class="p">)</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>                <span class="k">if</span> <span class="n">new_key</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>                        <span class="s2">&quot;key </span><span class="si">{}</span><span class="s2"> does already exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_key</span><span class="p">))</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>                <span class="n">p</span><span class="p">[</span><span class="n">new_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">vv</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>    <span class="n">nested_update</span><span class="p">(</span><span class="n">PARAMS</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>    <span class="c1"># interpolate some params with other parameters</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">INTERPOLATE_PARAMS</span><span class="p">:</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>            <span class="n">PARAMS</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="n">PARAMS</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">%</span> <span class="n">PARAMS</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;could not interpolate </span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>                            <span class="p">(</span><span class="n">PARAMS</span><span class="p">[</span><span class="n">param</span><span class="p">],</span> <span class="n">msg</span><span class="p">))</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>    <span class="c1"># expand directory pathnames</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>    <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">PARAMS</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;dir&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)):</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>            <span class="n">PARAMS</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>    <span class="c1"># make sure that the dictionary reference has not changed</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>    <span class="k">assert</span> <span class="nb">id</span><span class="p">(</span><span class="n">PARAMS</span><span class="p">)</span> <span class="o">==</span> <span class="n">old_id</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>    <span class="n">HAVE_INITIALIZED</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>    <span class="k">return</span> <span class="n">PARAMS</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.get_parameters_as_namedtuple" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_parameters_as_namedtuple</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.get_parameters_as_namedtuple" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>return PARAM dictionary as a namedtuple.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/parameters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-569" name="__codelineno-0-569"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_parameters_as_namedtuple</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;return PARAM dictionary as a namedtuple.</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>    <span class="n">d</span> <span class="o">=</span> <span class="n">get_parameters</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>    <span class="k">return</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;GenericDict&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()))(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.get_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_params</span><span class="p">()</span></code>

<a href="#cgatcore.pipeline.get_params" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>return handle to global parameter dictionary</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/parameters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-564" name="__codelineno-0-564"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_params</span><span class="p">():</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;return handle to global parameter dictionary&quot;&quot;&quot;</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>    <span class="k">return</span> <span class="n">PARAMS</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.get_s3_pipeline" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_s3_pipeline</span><span class="p">()</span></code>

<a href="#cgatcore.pipeline.get_s3_pipeline" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Instantiate and return the S3Pipeline instance, lazy-loaded to avoid circular imports.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_s3_pipeline</span><span class="p">():</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Instantiate and return the S3Pipeline instance, lazy-loaded to avoid circular imports.&quot;&quot;&quot;</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="c1"># Use get_remote() to access the remote functionality</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="n">remote</span> <span class="o">=</span> <span class="n">cgatcore</span><span class="o">.</span><span class="n">get_remote</span><span class="p">()</span>  <span class="c1"># Now properly calls the method to initialize remote if needed</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="k">return</span> <span class="n">remote</span><span class="o">.</span><span class="n">file_handler</span><span class="o">.</span><span class="n">S3Pipeline</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.get_temp_dir" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_temp_dir</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shared</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.get_temp_dir" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>get a temporary directory.</p>
<p>The directory is created and the caller needs to delete the temporary
directory once it is not used any more.</p>
<p>If dir does not exist, it will be created.</p>
<h4 id="cgatcore.pipeline.get_temp_dir--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.get_temp_dir--arguments" title="Permanent link">&para;</a></h4>
<p>dir : string
    Directory of the temporary directory and if not given is set to the
    default temporary location in the global configuration dictionary.
shared : bool
    If set, the tempory directory will be in a shared temporary
    location.</p>
<h4 id="cgatcore.pipeline.get_temp_dir--returns">Returns<a class="headerlink" href="#cgatcore.pipeline.get_temp_dir--returns" title="Permanent link">&para;</a></h4>
<p>filename : string
    Absolute pathname of temporary file.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/files.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_temp_dir</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shared</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;get a temporary directory.</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">    The directory is created and the caller needs to delete the temporary</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">    directory once it is not used any more.</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">    If dir does not exist, it will be created.</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">    dir : string</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        Directory of the temporary directory and if not given is set to the</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">        default temporary location in the global configuration dictionary.</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">    shared : bool</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">        If set, the tempory directory will be in a shared temporary</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">        location.</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">    -------</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">    filename : string</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">        Absolute pathname of temporary file.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="k">if</span> <span class="nb">dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="k">if</span> <span class="n">shared</span><span class="p">:</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>            <span class="nb">dir</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">()[</span><span class="s1">&#39;shared_tmpdir&#39;</span><span class="p">]</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>            <span class="nb">dir</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">()[</span><span class="s1">&#39;tmpdir&#39;</span><span class="p">]</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="nb">dir</span><span class="p">):</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="n">tmpdir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="nb">dir</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;ctmp&quot;</span><span class="p">)</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="k">if</span> <span class="n">clear</span><span class="p">:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="n">os</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="k">return</span> <span class="n">tmpdir</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.get_temp_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_temp_file</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shared</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.get_temp_file" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>get a temporary file.</p>
<p>The file is created and the caller needs to close and delete the
temporary file once it is not used any more. By default, the file
is opened as a text file (mode <code>w+</code>) with encoding <code>utf-8</code>
instead of the default mode <code>w+b</code> used in
:class:<code>tempfile.NamedTemporaryFile</code></p>
<p>If dir does not exist, it will be created.</p>
<h4 id="cgatcore.pipeline.get_temp_file--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.get_temp_file--arguments" title="Permanent link">&para;</a></h4>
<p>dir : string
    Directory of the temporary file and if not given is set to the
    default temporary location in the global configuration dictionary.
shared : bool
    If set, the tempory file will be in a shared temporary
    location (given by the global configuration directory).
suffix : string
    Filename suffix</p>
<h4 id="cgatcore.pipeline.get_temp_file--returns">Returns<a class="headerlink" href="#cgatcore.pipeline.get_temp_file--returns" title="Permanent link">&para;</a></h4>
<p>file : File
    A file object of the temporary file.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/files.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_temp_file</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shared</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w+&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">):</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;get a temporary file.</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">    The file is created and the caller needs to close and delete the</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    temporary file once it is not used any more. By default, the file</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">    is opened as a text file (mode ``w+``) with encoding ``utf-8``</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    instead of the default mode ``w+b`` used in</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    :class:`tempfile.NamedTemporaryFile`</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    If dir does not exist, it will be created.</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    dir : string</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">        Directory of the temporary file and if not given is set to the</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        default temporary location in the global configuration dictionary.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    shared : bool</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        If set, the tempory file will be in a shared temporary</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        location (given by the global configuration directory).</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    suffix : string</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        Filename suffix</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    -------</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    file : File</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">        A file object of the temporary file.</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="k">if</span> <span class="nb">dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="k">if</span> <span class="n">shared</span><span class="p">:</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>            <span class="nb">dir</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">()[</span><span class="s1">&#39;shared_tmpdir&#39;</span><span class="p">]</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>            <span class="nb">dir</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">()[</span><span class="s1">&#39;tmpdir&#39;</span><span class="p">]</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="nb">dir</span><span class="p">):</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>            <span class="c1"># avoid race condition when several processes try to create</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>            <span class="c1"># temporary directory.</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>            <span class="k">pass</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="nb">dir</span><span class="p">):</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>                <span class="s2">&quot;temporary directory </span><span class="si">{}</span><span class="s2"> could not be created&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">dir</span><span class="p">))</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="k">return</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="nb">dir</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;ctmp&quot;</span><span class="p">,</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>                                       <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>                                       <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.get_temp_filename" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_temp_filename</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shared</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.get_temp_filename" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>return a temporary filename.</p>
<p>The file is created and the caller needs to delete the temporary
file once it is not used any more (unless <code>clear</code> is set`).</p>
<p>If dir does not exist, it will be created.</p>
<h4 id="cgatcore.pipeline.get_temp_filename--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.get_temp_filename--arguments" title="Permanent link">&para;</a></h4>
<p>dir : string
    Directory of the temporary file and if not given is set to the
    default temporary location in the global configuration dictionary.
shared : bool
    If set, the tempory file will be in a shared temporary
    location.
clear : bool
    If set, remove the temporary file after creation.
suffix : string
    Filename suffix</p>
<h4 id="cgatcore.pipeline.get_temp_filename--returns">Returns<a class="headerlink" href="#cgatcore.pipeline.get_temp_filename--returns" title="Permanent link">&para;</a></h4>
<p>filename : string
    Absolute pathname of temporary file.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/files.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span>
<span class="normal"><a href="#__codelineno-0-96">96</a></span>
<span class="normal"><a href="#__codelineno-0-97">97</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_temp_filename</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shared</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;return a temporary filename.</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">    The file is created and the caller needs to delete the temporary</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    file once it is not used any more (unless `clear` is set`).</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    If dir does not exist, it will be created.</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">    dir : string</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        Directory of the temporary file and if not given is set to the</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">        default temporary location in the global configuration dictionary.</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    shared : bool</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        If set, the tempory file will be in a shared temporary</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        location.</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    clear : bool</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        If set, remove the temporary file after creation.</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    suffix : string</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        Filename suffix</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">    -------</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">    filename : string</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        Absolute pathname of temporary file.</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="n">tmpfile</span> <span class="o">=</span> <span class="n">get_temp_file</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="nb">dir</span><span class="p">,</span> <span class="n">shared</span><span class="o">=</span><span class="n">shared</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">)</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="n">tmpfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="k">if</span> <span class="n">clear</span><span class="p">:</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">tmpfile</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="k">return</span> <span class="n">tmpfile</span><span class="o">.</span><span class="n">name</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.initialize" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">initialize</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">optparse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.initialize" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>setup the pipeline framework.</p>
<h4 id="cgatcore.pipeline.initialize--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.initialize--arguments" title="Permanent link">&para;</a></h4>
<p>options: object
    Container for command line arguments.
args : list
    List of command line arguments.
defaults : dictionary
    Dictionary with default values to be added to global
    parameters dictionary.</p>
<p>Additional keyword arguments will be passed to the
:func:<code>~.parse_commandline</code> function to set command-line defaults.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/control.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span>
<span class="normal"><a href="#__codelineno-0-1224">1224</a></span>
<span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span>
<span class="normal"><a href="#__codelineno-0-1229">1229</a></span>
<span class="normal"><a href="#__codelineno-0-1230">1230</a></span>
<span class="normal"><a href="#__codelineno-0-1231">1231</a></span>
<span class="normal"><a href="#__codelineno-0-1232">1232</a></span>
<span class="normal"><a href="#__codelineno-0-1233">1233</a></span>
<span class="normal"><a href="#__codelineno-0-1234">1234</a></span>
<span class="normal"><a href="#__codelineno-0-1235">1235</a></span>
<span class="normal"><a href="#__codelineno-0-1236">1236</a></span>
<span class="normal"><a href="#__codelineno-0-1237">1237</a></span>
<span class="normal"><a href="#__codelineno-0-1238">1238</a></span>
<span class="normal"><a href="#__codelineno-0-1239">1239</a></span>
<span class="normal"><a href="#__codelineno-0-1240">1240</a></span>
<span class="normal"><a href="#__codelineno-0-1241">1241</a></span>
<span class="normal"><a href="#__codelineno-0-1242">1242</a></span>
<span class="normal"><a href="#__codelineno-0-1243">1243</a></span>
<span class="normal"><a href="#__codelineno-0-1244">1244</a></span>
<span class="normal"><a href="#__codelineno-0-1245">1245</a></span>
<span class="normal"><a href="#__codelineno-0-1246">1246</a></span>
<span class="normal"><a href="#__codelineno-0-1247">1247</a></span>
<span class="normal"><a href="#__codelineno-0-1248">1248</a></span>
<span class="normal"><a href="#__codelineno-0-1249">1249</a></span>
<span class="normal"><a href="#__codelineno-0-1250">1250</a></span>
<span class="normal"><a href="#__codelineno-0-1251">1251</a></span>
<span class="normal"><a href="#__codelineno-0-1252">1252</a></span>
<span class="normal"><a href="#__codelineno-0-1253">1253</a></span>
<span class="normal"><a href="#__codelineno-0-1254">1254</a></span>
<span class="normal"><a href="#__codelineno-0-1255">1255</a></span>
<span class="normal"><a href="#__codelineno-0-1256">1256</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1190" name="__codelineno-0-1190"></a><span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">optparse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-1191" name="__codelineno-0-1191"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;setup the pipeline framework.</span>
<a id="__codelineno-0-1192" name="__codelineno-0-1192"></a>
<a id="__codelineno-0-1193" name="__codelineno-0-1193"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-1194" name="__codelineno-0-1194"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-1195" name="__codelineno-0-1195"></a><span class="sd">    options: object</span>
<a id="__codelineno-0-1196" name="__codelineno-0-1196"></a><span class="sd">        Container for command line arguments.</span>
<a id="__codelineno-0-1197" name="__codelineno-0-1197"></a><span class="sd">    args : list</span>
<a id="__codelineno-0-1198" name="__codelineno-0-1198"></a><span class="sd">        List of command line arguments.</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199"></a><span class="sd">    defaults : dictionary</span>
<a id="__codelineno-0-1200" name="__codelineno-0-1200"></a><span class="sd">        Dictionary with default values to be added to global</span>
<a id="__codelineno-0-1201" name="__codelineno-0-1201"></a><span class="sd">        parameters dictionary.</span>
<a id="__codelineno-0-1202" name="__codelineno-0-1202"></a>
<a id="__codelineno-0-1203" name="__codelineno-0-1203"></a><span class="sd">    Additional keyword arguments will be passed to the</span>
<a id="__codelineno-0-1204" name="__codelineno-0-1204"></a><span class="sd">    :func:`~.parse_commandline` function to set command-line defaults.</span>
<a id="__codelineno-0-1205" name="__codelineno-0-1205"></a>
<a id="__codelineno-0-1206" name="__codelineno-0-1206"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1207" name="__codelineno-0-1207"></a>    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1208" name="__codelineno-0-1208"></a>        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span>
<a id="__codelineno-0-1209" name="__codelineno-0-1209"></a>
<a id="__codelineno-0-1210" name="__codelineno-0-1210"></a>    <span class="c1"># load default options from config files</span>
<a id="__codelineno-0-1211" name="__codelineno-0-1211"></a>    <span class="k">if</span> <span class="n">caller</span><span class="p">:</span>
<a id="__codelineno-0-1212" name="__codelineno-0-1212"></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">caller</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1213" name="__codelineno-0-1213"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1214" name="__codelineno-0-1214"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1215" name="__codelineno-0-1215"></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">get_caller</span><span class="p">()</span><span class="o">.</span><span class="vm">__file__</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1216" name="__codelineno-0-1216"></a>        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
<a id="__codelineno-0-1217" name="__codelineno-0-1217"></a>            <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a>
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a>    <span class="n">parse_commandline</span><span class="p">(</span><span class="n">argv</span><span class="p">,</span> <span class="n">optparse</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-1220" name="__codelineno-0-1220"></a>    <span class="n">args</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">get_args</span><span class="p">()</span>
<a id="__codelineno-0-1221" name="__codelineno-0-1221"></a>    <span class="n">get_parameters</span><span class="p">(</span>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a>        <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;pipeline.yml&quot;</span><span class="p">),</span>
<a id="__codelineno-0-1223" name="__codelineno-0-1223"></a>         <span class="s2">&quot;../pipeline.yml&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1224" name="__codelineno-0-1224"></a>         <span class="n">args</span><span class="o">.</span><span class="n">config_file</span><span class="p">],</span>
<a id="__codelineno-0-1225" name="__codelineno-0-1225"></a>        <span class="n">defaults</span><span class="o">=</span><span class="n">defaults</span><span class="p">)</span>
<a id="__codelineno-0-1226" name="__codelineno-0-1226"></a>
<a id="__codelineno-0-1227" name="__codelineno-0-1227"></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;cgatcore.pipeline&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1228" name="__codelineno-0-1228"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;started in directory: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-1229" name="__codelineno-0-1229"></a>        <span class="n">get_params</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_dir&quot;</span><span class="p">)))</span>
<a id="__codelineno-0-1230" name="__codelineno-0-1230"></a>
<a id="__codelineno-0-1231" name="__codelineno-0-1231"></a>    <span class="c1"># At this point, the PARAMS dictionary has already been</span>
<a id="__codelineno-0-1232" name="__codelineno-0-1232"></a>    <span class="c1"># built. It now needs to be updated with selected command</span>
<a id="__codelineno-0-1233" name="__codelineno-0-1233"></a>    <span class="c1"># line options as these should always take precedence over</span>
<a id="__codelineno-0-1234" name="__codelineno-0-1234"></a>    <span class="c1"># configuration files.</span>
<a id="__codelineno-0-1235" name="__codelineno-0-1235"></a>    <span class="n">update_params_with_commandline_options</span><span class="p">(</span><span class="n">get_params</span><span class="p">(),</span> <span class="n">args</span><span class="p">)</span>
<a id="__codelineno-0-1236" name="__codelineno-0-1236"></a>
<a id="__codelineno-0-1237" name="__codelineno-0-1237"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">get_header</span><span class="p">())</span>
<a id="__codelineno-0-1238" name="__codelineno-0-1238"></a>
<a id="__codelineno-0-1239" name="__codelineno-0-1239"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">get_param_output</span><span class="p">(</span><span class="n">get_params</span><span class="p">()))</span>
<a id="__codelineno-0-1240" name="__codelineno-0-1240"></a>
<a id="__codelineno-0-1241" name="__codelineno-0-1241"></a>    <span class="n">code_location</span><span class="p">,</span> <span class="n">version</span> <span class="o">=</span> <span class="n">get_version</span><span class="p">()</span>
<a id="__codelineno-0-1242" name="__codelineno-0-1242"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;code location: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">code_location</span><span class="p">))</span>
<a id="__codelineno-0-1243" name="__codelineno-0-1243"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;code version: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">version</span><span class="p">))</span>
<a id="__codelineno-0-1244" name="__codelineno-0-1244"></a>
<a id="__codelineno-0-1245" name="__codelineno-0-1245"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;working directory is: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-1246" name="__codelineno-0-1246"></a>        <span class="n">get_params</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;work_dir&quot;</span><span class="p">)))</span>
<a id="__codelineno-0-1247" name="__codelineno-0-1247"></a>    <span class="n">work_dir</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;work_dir&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1248" name="__codelineno-0-1248"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">work_dir</span><span class="p">):</span>
<a id="__codelineno-0-1249" name="__codelineno-0-1249"></a>        <span class="n">E</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;working directory </span><span class="si">{}</span><span class="s2"> does not exist - creating&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">work_dir</span><span class="p">))</span>
<a id="__codelineno-0-1250" name="__codelineno-0-1250"></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">work_dir</span><span class="p">)</span>
<a id="__codelineno-0-1251" name="__codelineno-0-1251"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;changing directory to </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">work_dir</span><span class="p">))</span>
<a id="__codelineno-0-1252" name="__codelineno-0-1252"></a>    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">work_dir</span><span class="p">)</span>
<a id="__codelineno-0-1253" name="__codelineno-0-1253"></a>
<a id="__codelineno-0-1254" name="__codelineno-0-1254"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;pipeline has been initialized&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1255" name="__codelineno-0-1255"></a>
<a id="__codelineno-0-1256" name="__codelineno-0-1256"></a>    <span class="k">return</span> <span class="n">args</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.input_validation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">input_validation</span><span class="p">(</span><span class="n">PARAMS</span><span class="p">,</span> <span class="n">pipeline_script</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.input_validation" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Inspects the PARAMS dictionary looking for problematic input values.</p>
<p>So far we just check that:</p>
<div class="codehilite"><pre><span></span><code><span class="o">*</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="mi">3</span><span class="n">rd</span><span class="w"> </span><span class="n">party</span><span class="w"> </span><span class="n">tools</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">PATH</span>

<span class="o">*</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">empty</span>

<span class="o">*</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">contain</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s2">&quot;?&quot;</span><span class="w"> </span><span class="n">character</span><span class="w"> </span><span class="p">(</span><span class="n">used</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">a</span>
<span class="w">  </span><span class="n">placeholder</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">pipelines</span><span class="p">)</span>

<span class="o">*</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">check</span><span class="w"> </span><span class="n">whether</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">exists</span><span class="w"> </span><span class="ow">and</span>
<span class="w">  </span><span class="k">is</span><span class="w"> </span><span class="n">readable</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/parameters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="k">def</span><span class="w"> </span><span class="nf">input_validation</span><span class="p">(</span><span class="n">PARAMS</span><span class="p">,</span> <span class="n">pipeline_script</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Inspects the PARAMS dictionary looking for problematic input values.</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">    So far we just check that:</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">        * all required 3rd party tools are on the PATH</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">        * input parameters are not empty</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">        * input parameters do not contain the &quot;?&quot; character (used as a</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">          placeholder in different pipelines)</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">        * if the input is a file, check whether it exists and</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">          is readable</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>    <span class="n">E</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;input Validation starting&#39;&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="n">E</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;checking 3rd party dependencies&#39;&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>    <span class="c1"># check 3rd party dependencies</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipeline_script</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="c1"># this import requires the PYTHONPATH in the following order</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="c1"># PYTHONPATH=&lt;src&gt;/CGATpipelines:&lt;src&gt;/cgat</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">scripts.cgat_check_deps</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cd</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="n">deps</span><span class="p">,</span> <span class="n">check_path_failures</span> <span class="o">=</span> <span class="n">cd</span><span class="o">.</span><span class="n">checkDepedencies</span><span class="p">(</span><span class="n">pipeline_script</span><span class="p">)</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="c1"># print info about dependencies</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">deps</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>            <span class="n">E</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;no dependencies found&#39;</span><span class="p">)</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>            <span class="c1"># print dictionary ordered by value</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">deps</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">deps</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>                <span class="n">E</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Program: </span><span class="si">{0!s}</span><span class="s1"> used </span><span class="si">{1}</span><span class="s1"> time(s)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">deps</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>            <span class="n">n_failures</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">check_path_failures</span><span class="p">)</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>            <span class="k">if</span> <span class="n">n_failures</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>                <span class="n">E</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;All required programs are available on your PATH&#39;</span><span class="p">)</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>                <span class="n">E</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;The following programs are not on your PATH&#39;</span><span class="p">)</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">check_path_failures</span><span class="p">:</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>                    <span class="n">E</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0!s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>    <span class="c1"># check PARAMS</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>    <span class="n">num_missing</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>    <span class="n">num_questions</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>    <span class="n">E</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;checking pipeline configuration&#39;&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">PARAMS</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="n">key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="c1"># check for missing values</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>            <span class="n">E</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&quot;</span><span class="si">{}</span><span class="s1">&quot; is empty, is that expected?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>            <span class="n">num_missing</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>        <span class="c1"># check for a question mark in the dictironary (indicates</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="c1"># that there is a missing input parameter)</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="k">if</span> <span class="s2">&quot;?&quot;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>            <span class="n">E</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&quot;</span><span class="si">{}</span><span class="s1">&quot; is not defined (?), is that expected?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>            <span class="n">num_questions</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="c1"># validate input files listed in PARAMS</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">value</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.gz&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">value</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.gtf&quot;</span><span class="p">))</span> <span class="ow">and</span> <span class="s2">&quot;,&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>                <span class="n">E</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&quot;</span><span class="si">{}</span><span class="s1">&quot;: &quot;</span><span class="si">{}</span><span class="s1">&quot; is not readable&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>    <span class="k">if</span> <span class="n">num_missing</span> <span class="ow">or</span> <span class="n">num_questions</span><span class="p">:</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;pipeline has configuration issues&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.interpolate_statement" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">interpolate_statement</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.interpolate_statement" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>interpolate command line statement with parameters</p>
<p>The skeleton of the statement should be defined in kwargs.  The
method then applies string interpolation using a dictionary built
from the global configuration dictionary PARAMS, but augmented by
<code>kwargs</code>. The latter takes precedence.</p>
<h4 id="cgatcore.pipeline.interpolate_statement--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.interpolate_statement--arguments" title="Permanent link">&para;</a></h4>
<p>statement: string
    Command line statement to be interpolated.
kwargs : dict
    Keyword arguments that are used for parameter interpolation.</p>
<h4 id="cgatcore.pipeline.interpolate_statement--returns">Returns<a class="headerlink" href="#cgatcore.pipeline.interpolate_statement--returns" title="Permanent link">&para;</a></h4>
<p>statement : string
    The command line statement with interpolated parameters.</p>
<h4 id="cgatcore.pipeline.interpolate_statement--raises">Raises<a class="headerlink" href="#cgatcore.pipeline.interpolate_statement--raises" title="Permanent link">&para;</a></h4>
<p>KeyError
    If <code>statement</code> contains unresolved references.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-379" name="__codelineno-0-379"></a><span class="k">def</span><span class="w"> </span><span class="nf">interpolate_statement</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;interpolate command line statement with parameters</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a><span class="sd">    The skeleton of the statement should be defined in kwargs.  The</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a><span class="sd">    method then applies string interpolation using a dictionary built</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="sd">    from the global configuration dictionary PARAMS, but augmented by</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="sd">    `kwargs`. The latter takes precedence.</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="sd">    statement: string</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="sd">        Command line statement to be interpolated.</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">    kwargs : dict</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="sd">        Keyword arguments that are used for parameter interpolation.</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">    -------</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">    statement : string</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">        The command line statement with interpolated parameters.</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">    ------</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">    KeyError</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">        If ``statement`` contains unresolved references.</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>    <span class="n">local_params</span> <span class="o">=</span> <span class="n">substitute_parameters</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>    <span class="c1"># build the statement</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>        <span class="n">statement</span> <span class="o">=</span> <span class="n">statement</span> <span class="o">%</span> <span class="n">local_params</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>    <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>            <span class="s2">&quot;Error when creating command: could not &quot;</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>            <span class="s2">&quot;find </span><span class="si">%s</span><span class="s2"> in dictionaries&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>            <span class="s2">&quot;Error when creating command: </span><span class="si">%s</span><span class="s2">, statement = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>                <span class="n">msg</span><span class="p">,</span> <span class="n">statement</span><span class="p">))</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>    <span class="c1"># cleaning up of statement</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>    <span class="c1"># remove new lines and superfluous spaces and tabs</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>    <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">+&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">statement</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>    <span class="k">if</span> <span class="n">statement</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">):</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>        <span class="n">statement</span> <span class="o">=</span> <span class="n">statement</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>    <span class="c1"># mark arvados mount points in statement</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>    <span class="k">if</span> <span class="n">get_params</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mount_point&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>        <span class="n">statement</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">get_params</span><span class="p">()[</span><span class="s2">&quot;mount_point&quot;</span><span class="p">],</span> <span class="s2">&quot;arv=&quot;</span><span class="p">,</span> <span class="n">statement</span><span class="p">)</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>    <span class="k">return</span> <span class="n">statement</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.is_test" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_test</span><span class="p">()</span></code>

<a href="#cgatcore.pipeline.is_test" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>return True if the pipeline is run in a "testing" mode.</p>
<p>This method checks if <code>-is-test</code> has been given as a
command line option.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="k">def</span><span class="w"> </span><span class="nf">is_test</span><span class="p">():</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;return True if the pipeline is run in a &quot;testing&quot; mode.</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    This method checks if ``-is-test`` has been given as a</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    command line option.</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="k">return</span> <span class="s2">&quot;--is-test&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.is_true" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_true</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.is_true" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>return True if param has a True value.</p>
<p>A parameter is False if it is:</p>
<ul>
<li>not set</li>
<li>0</li>
<li>the empty string</li>
<li>false or False</li>
</ul>
<p>Otherwise the value is True.</p>
<h4 id="cgatcore.pipeline.is_true--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.is_true--arguments" title="Permanent link">&para;</a></h4>
<p>param : string
    Parameter to be tested
kwargs : dict
    Dictionary of local configuration values. These will be passed
    to :func:<code>substitute_parameters</code> before evaluating <code>param</code></p>
<h4 id="cgatcore.pipeline.is_true--returns">Returns<a class="headerlink" href="#cgatcore.pipeline.is_true--returns" title="Permanent link">&para;</a></h4>
<p>bool</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/parameters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-525" name="__codelineno-0-525"></a><span class="k">def</span><span class="w"> </span><span class="nf">is_true</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;return True if param has a True value.</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a><span class="sd">    A parameter is False if it is:</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a><span class="sd">    * not set</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="sd">    * 0</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a><span class="sd">    * the empty string</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a><span class="sd">    * false or False</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a><span class="sd">    Otherwise the value is True.</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a><span class="sd">    param : string</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a><span class="sd">        Parameter to be tested</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a><span class="sd">    kwargs : dict</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a><span class="sd">        Dictionary of local configuration values. These will be passed</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="sd">        to :func:`substitute_parameters` before evaluating `param`</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a><span class="sd">    -------</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="sd">    bool</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>    <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">substitute_parameters</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">PARAMS</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>    <span class="n">value</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>    <span class="k">return</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span> <span class="s1">&#39;False&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.join_statements" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">join_statements</span><span class="p">(</span><span class="n">statements</span><span class="p">,</span> <span class="n">infile</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.join_statements" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>join a chain of statements into a single statement.</p>
<p>Each statement contains an @IN@ or a @OUT@ placeholder or both.
These will be replaced by the names of successive temporary files.</p>
<p>In the first statement, @IN@ is replaced with <code>infile</code> and, if given,
the @OUT@ is replaced by outfile in the last statement.</p>
<h4 id="cgatcore.pipeline.join_statements--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.join_statements--arguments" title="Permanent link">&para;</a></h4>
<p>statements : list
    A list of command line statements.
infile : string
    Filename of the first data set.
outfile : string
    Filename of the target data set.</p>
<h4 id="cgatcore.pipeline.join_statements--returns">Returns<a class="headerlink" href="#cgatcore.pipeline.join_statements--returns" title="Permanent link">&para;</a></h4>
<p>last_file : string
    Filename of last file created, outfile, if given.
statement : string
    A command line statement built from merging the statements
cleanup : string
    A command line statement for cleaning up.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-477" name="__codelineno-0-477"></a><span class="k">def</span><span class="w"> </span><span class="nf">join_statements</span><span class="p">(</span><span class="n">statements</span><span class="p">,</span> <span class="n">infile</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;join a chain of statements into a single statement.</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a><span class="sd">    Each statement contains an @IN@ or a @OUT@ placeholder or both.</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a><span class="sd">    These will be replaced by the names of successive temporary files.</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a><span class="sd">    In the first statement, @IN@ is replaced with `infile` and, if given,</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="sd">    the @OUT@ is replaced by outfile in the last statement.</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a><span class="sd">    statements : list</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a><span class="sd">        A list of command line statements.</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a><span class="sd">    infile : string</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a><span class="sd">        Filename of the first data set.</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a><span class="sd">    outfile : string</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a><span class="sd">        Filename of the target data set.</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a><span class="sd">    -------</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a><span class="sd">    last_file : string</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a><span class="sd">        Filename of last file created, outfile, if given.</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a><span class="sd">    statement : string</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="sd">        A command line statement built from merging the statements</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a><span class="sd">    cleanup : string</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a><span class="sd">        A command line statement for cleaning up.</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>    <span class="n">prefix</span> <span class="o">=</span> <span class="n">get_temp_filename</span><span class="p">()</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>    <span class="n">pattern</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%%</span><span class="s2">i&quot;</span> <span class="o">%</span> <span class="n">prefix</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">statement</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">statements</span><span class="p">):</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">statement</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>            <span class="k">if</span> <span class="n">infile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>                <span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;@IN@&quot;</span><span class="p">,</span> <span class="n">infile</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>            <span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;@IN@&quot;</span><span class="p">,</span> <span class="n">pattern</span> <span class="o">%</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>            <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>                <span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;@IN-2@&quot;</span><span class="p">,</span> <span class="n">pattern</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">2</span><span class="p">),</span> <span class="n">s</span><span class="p">)</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>            <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>                <span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;@IN-1@&quot;</span><span class="p">,</span> <span class="n">pattern</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">s</span><span class="p">)</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;@OUT@&quot;</span><span class="p">,</span> <span class="n">pattern</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">):</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>    <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>    <span class="n">last_file</span> <span class="o">=</span> <span class="n">pattern</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>    <span class="k">if</span> <span class="n">outfile</span><span class="p">:</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">last_file</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>        <span class="n">last_file</span> <span class="o">=</span> <span class="n">outfile</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>    <span class="k">assert</span> <span class="n">prefix</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>    <span class="k">return</span> <span class="n">last_file</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="s2">&quot;rm -f </span><span class="si">%s</span><span class="s2">*&quot;</span> <span class="o">%</span> <span class="n">prefix</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.load" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">collapse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">transpose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tablename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">retry</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">job_memory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">to_cluster</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.load" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>import data from a tab-separated file into database.</p>
<p>The table name is given by outfile without the
".load" suffix.</p>
<p>A typical load task in ruffus would look like this::</p>
<div class="codehilite"><pre><span></span><code><span class="err">@</span><span class="n">transform</span><span class="p">(</span><span class="s2">&quot;*.tsv.gz&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">suffix</span><span class="p">(</span><span class="s2">&quot;.tsv.gz&quot;</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;.load&quot;</span><span class="p">)</span>
<span class="n">def</span><span class="w"> </span><span class="n">loadData</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span><span class="w"> </span><span class="n">outfile</span><span class="p">):</span>
<span class="w">    </span><span class="n">P</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span><span class="w"> </span><span class="n">outfile</span><span class="p">)</span>
</code></pre></div>

<p>Upload is performed via the :doc:<code>csv2db</code> script.</p>
<h4 id="cgatcore.pipeline.load--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.load--arguments" title="Permanent link">&para;</a></h4>
<p>infile : string
    Filename of the input data
outfile : string
    Output filename. This will contain the logging information. The
    table name is derived from <code>outfile</code> if <code>tablename</code> is not set.
options : string
    Command line options for the <code>csv2db.py</code> script.
collapse : string
    If set, the table will be collapsed before loading. This
    transforms a data set with two columns where the first column
    is the row name into a multi-column table.  The value of
    collapse is the value used for missing values.
transpose : string
    If set, the table will be transposed before loading. The first
    column in the first row will be set to the string within
    transpose.
retry : bool
    If True, multiple attempts will be made if the data can
    not be loaded at the first try, for example if a table is locked.
limit : int
    If set, only load the first n lines.
shuffle : bool
    If set, randomize lines before loading. Together with <code>limit</code>
    this permits loading a sample of rows.
job_memory : string
    Amount of memory to allocate for job. If unset, uses the global
    default. Implies to_cluster=True.
to_cluster : bool
    By default load jobs are not submitted to the cluster as they sometimes
    become blocked. Setting this true will override this behavoir.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>         <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>         <span class="n">options</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>         <span class="n">collapse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>         <span class="n">transpose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>         <span class="n">tablename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>         <span class="n">retry</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>         <span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>         <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>         <span class="n">job_memory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>         <span class="n">to_cluster</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;import data from a tab-separated file into database.</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">    The table name is given by outfile without the</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">    &quot;.load&quot; suffix.</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">    A typical load task in ruffus would look like this::</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">        @transform(&quot;*.tsv.gz&quot;, suffix(&quot;.tsv.gz&quot;), &quot;.load&quot;)</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        def loadData(infile, outfile):</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">            P.load(infile, outfile)</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">    Upload is performed via the :doc:`csv2db` script.</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">    infile : string</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">        Filename of the input data</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    outfile : string</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">        Output filename. This will contain the logging information. The</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        table name is derived from `outfile` if `tablename` is not set.</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">    options : string</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">        Command line options for the `csv2db.py` script.</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">    collapse : string</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">        If set, the table will be collapsed before loading. This</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">        transforms a data set with two columns where the first column</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        is the row name into a multi-column table.  The value of</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">        collapse is the value used for missing values.</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">    transpose : string</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">        If set, the table will be transposed before loading. The first</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        column in the first row will be set to the string within</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">        transpose.</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">    retry : bool</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">        If True, multiple attempts will be made if the data can</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">        not be loaded at the first try, for example if a table is locked.</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">    limit : int</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">        If set, only load the first n lines.</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">    shuffle : bool</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">        If set, randomize lines before loading. Together with `limit`</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">        this permits loading a sample of rows.</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">    job_memory : string</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">        Amount of memory to allocate for job. If unset, uses the global</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">        default. Implies to_cluster=True.</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">    to_cluster : bool</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">        By default load jobs are not submitted to the cluster as they sometimes</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">        become blocked. Setting this true will override this behavoir.</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="k">if</span> <span class="n">job_memory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="n">job_memory</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">()[</span><span class="s2">&quot;cluster_memory_default&quot;</span><span class="p">]</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">tablename</span><span class="p">:</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="n">tablename</span> <span class="o">=</span> <span class="n">to_table</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>    <span class="n">statement</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>    <span class="k">if</span> <span class="n">infile</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.gz&quot;</span><span class="p">):</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="n">statement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;zcat </span><span class="si">%(infile)s</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="n">statement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;cat </span><span class="si">%(infile)s</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>    <span class="k">if</span> <span class="n">collapse</span><span class="p">:</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="n">statement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>            <span class="s2">&quot;python -m cgatcore.table &quot;</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>            <span class="s2">&quot;--log=</span><span class="si">%(outfile)s</span><span class="s2">.collapse.log &quot;</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>            <span class="s2">&quot;--collapse=</span><span class="si">%(collapse)s</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="n">statement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>            <span class="s2">&quot;python -m cgatcore.table &quot;</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>            <span class="s2">&quot;--log=</span><span class="si">%(outfile)s</span><span class="s2">.transpose.log &quot;</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>            <span class="s2">&quot;--transpose &quot;</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>            <span class="s2">&quot;--set-transpose-field=</span><span class="si">%(transpose)s</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="k">if</span> <span class="n">shuffle</span><span class="p">:</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="n">statement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>            <span class="s2">&quot;python -m cgatcore.table &quot;</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>            <span class="s2">&quot;--log=</span><span class="si">%(outfile)s</span><span class="s2">.shuffle.log &quot;</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>            <span class="s2">&quot;--method=randomize-rows&quot;</span><span class="p">)</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>    <span class="k">if</span> <span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="c1"># use awk to filter in order to avoid a pipeline broken error from head</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>        <span class="n">statement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;awk &#39;NR &gt; </span><span class="si">%i</span><span class="s2"> {exit(0)} </span><span class="si">{print}</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">limit</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>        <span class="c1"># ignore errors from cat or zcat due to broken pipe</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="n">ignore_pipe_errors</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="n">statement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">build_load_statement</span><span class="p">(</span><span class="n">tablename</span><span class="p">,</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>                                          <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>                                          <span class="n">retry</span><span class="o">=</span><span class="n">retry</span><span class="p">))</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>    <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &gt; </span><span class="si">%(outfile)s</span><span class="s2">&quot;</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>    <span class="n">run</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.load_from_iterator" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_from_iterator</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">tablename</span><span class="p">,</span> <span class="n">iterator</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.load_from_iterator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>import data from an iterator into a database.</p>
<h4 id="cgatcore.pipeline.load_from_iterator--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.load_from_iterator--arguments" title="Permanent link">&para;</a></h4>
<p>outfile : string
    Output file name
tablename : string
    Table name
iterator : iterator
    Iterator to import data from. The iterator should
    yield either list/tuples or dictionaries for each
    row in the table.
columns : list
    Column names. If not given, the assumption is that
    iterator will dictionaries and column names are derived
    from that.
indices : list
    List of column names to add indices on.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-606" name="__codelineno-0-606"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_from_iterator</span><span class="p">(</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>        <span class="n">outfile</span><span class="p">,</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>        <span class="n">tablename</span><span class="p">,</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>        <span class="n">iterator</span><span class="p">,</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>        <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>        <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;import data from an iterator into a database.</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a><span class="sd">    outfile : string</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a><span class="sd">        Output file name</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a><span class="sd">    tablename : string</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a><span class="sd">        Table name</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a><span class="sd">    iterator : iterator</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a><span class="sd">        Iterator to import data from. The iterator should</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a><span class="sd">        yield either list/tuples or dictionaries for each</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a><span class="sd">        row in the table.</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a><span class="sd">    columns : list</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a><span class="sd">        Column names. If not given, the assumption is that</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a><span class="sd">        iterator will dictionaries and column names are derived</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a><span class="sd">        from that.</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a><span class="sd">    indices : list</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a><span class="sd">        List of column names to add indices on.</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>    <span class="n">tmpfile</span> <span class="o">=</span> <span class="n">get_temp_file</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>    <span class="k">if</span> <span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>        <span class="n">keys</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="n">columns</span><span class="o">.</span><span class="n">items</span><span class="p">())))</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>        <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>            <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>            <span class="n">values</span> <span class="o">=</span> <span class="n">keys</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>            <span class="n">columns</span> <span class="o">=</span> <span class="n">keys</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>            <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>        <span class="n">tmpfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>    <span class="n">tmpfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>    <span class="k">if</span> <span class="n">indices</span><span class="p">:</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>        <span class="n">indices</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;--add-index=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">)</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>        <span class="n">indices</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>    <span class="n">load</span><span class="p">(</span><span class="n">tmpfile</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>         <span class="n">outfile</span><span class="p">,</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>         <span class="n">tablename</span><span class="o">=</span><span class="n">tablename</span><span class="p">,</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>         <span class="n">options</span><span class="o">=</span><span class="n">indices</span><span class="p">)</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>    <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">tmpfile</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.main" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">main</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.main" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>command line control function for a pipeline.</p>
<p>This method defines command line options for the pipeline and
updates the global configuration dictionary correspondingly.</p>
<p>It then provides a command parser to execute particular tasks
using the ruffus pipeline control functions. See the generated
command line help for usage.</p>
<p>To use it, add::</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">CGAT.pipeline</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">P</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">))</span>
</code></pre></div>

<p>to your pipeline script.</p>
<h4 id="cgatcore.pipeline.main--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.main--arguments" title="Permanent link">&para;</a></h4>
<p>args : list
    List of command line arguments.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/control.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1412">1412</a></span>
<span class="normal"><a href="#__codelineno-0-1413">1413</a></span>
<span class="normal"><a href="#__codelineno-0-1414">1414</a></span>
<span class="normal"><a href="#__codelineno-0-1415">1415</a></span>
<span class="normal"><a href="#__codelineno-0-1416">1416</a></span>
<span class="normal"><a href="#__codelineno-0-1417">1417</a></span>
<span class="normal"><a href="#__codelineno-0-1418">1418</a></span>
<span class="normal"><a href="#__codelineno-0-1419">1419</a></span>
<span class="normal"><a href="#__codelineno-0-1420">1420</a></span>
<span class="normal"><a href="#__codelineno-0-1421">1421</a></span>
<span class="normal"><a href="#__codelineno-0-1422">1422</a></span>
<span class="normal"><a href="#__codelineno-0-1423">1423</a></span>
<span class="normal"><a href="#__codelineno-0-1424">1424</a></span>
<span class="normal"><a href="#__codelineno-0-1425">1425</a></span>
<span class="normal"><a href="#__codelineno-0-1426">1426</a></span>
<span class="normal"><a href="#__codelineno-0-1427">1427</a></span>
<span class="normal"><a href="#__codelineno-0-1428">1428</a></span>
<span class="normal"><a href="#__codelineno-0-1429">1429</a></span>
<span class="normal"><a href="#__codelineno-0-1430">1430</a></span>
<span class="normal"><a href="#__codelineno-0-1431">1431</a></span>
<span class="normal"><a href="#__codelineno-0-1432">1432</a></span>
<span class="normal"><a href="#__codelineno-0-1433">1433</a></span>
<span class="normal"><a href="#__codelineno-0-1434">1434</a></span>
<span class="normal"><a href="#__codelineno-0-1435">1435</a></span>
<span class="normal"><a href="#__codelineno-0-1436">1436</a></span>
<span class="normal"><a href="#__codelineno-0-1437">1437</a></span>
<span class="normal"><a href="#__codelineno-0-1438">1438</a></span>
<span class="normal"><a href="#__codelineno-0-1439">1439</a></span>
<span class="normal"><a href="#__codelineno-0-1440">1440</a></span>
<span class="normal"><a href="#__codelineno-0-1441">1441</a></span>
<span class="normal"><a href="#__codelineno-0-1442">1442</a></span>
<span class="normal"><a href="#__codelineno-0-1443">1443</a></span>
<span class="normal"><a href="#__codelineno-0-1444">1444</a></span>
<span class="normal"><a href="#__codelineno-0-1445">1445</a></span>
<span class="normal"><a href="#__codelineno-0-1446">1446</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1412" name="__codelineno-0-1412"></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-1413" name="__codelineno-0-1413"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;command line control function for a pipeline.</span>
<a id="__codelineno-0-1414" name="__codelineno-0-1414"></a>
<a id="__codelineno-0-1415" name="__codelineno-0-1415"></a><span class="sd">    This method defines command line options for the pipeline and</span>
<a id="__codelineno-0-1416" name="__codelineno-0-1416"></a><span class="sd">    updates the global configuration dictionary correspondingly.</span>
<a id="__codelineno-0-1417" name="__codelineno-0-1417"></a>
<a id="__codelineno-0-1418" name="__codelineno-0-1418"></a><span class="sd">    It then provides a command parser to execute particular tasks</span>
<a id="__codelineno-0-1419" name="__codelineno-0-1419"></a><span class="sd">    using the ruffus pipeline control functions. See the generated</span>
<a id="__codelineno-0-1420" name="__codelineno-0-1420"></a><span class="sd">    command line help for usage.</span>
<a id="__codelineno-0-1421" name="__codelineno-0-1421"></a>
<a id="__codelineno-0-1422" name="__codelineno-0-1422"></a><span class="sd">    To use it, add::</span>
<a id="__codelineno-0-1423" name="__codelineno-0-1423"></a>
<a id="__codelineno-0-1424" name="__codelineno-0-1424"></a><span class="sd">        import CGAT.pipeline as P</span>
<a id="__codelineno-0-1425" name="__codelineno-0-1425"></a>
<a id="__codelineno-0-1426" name="__codelineno-0-1426"></a><span class="sd">        if __name__ == &quot;__main__&quot;:</span>
<a id="__codelineno-0-1427" name="__codelineno-0-1427"></a><span class="sd">            sys.exit(P.main(sys.argv))</span>
<a id="__codelineno-0-1428" name="__codelineno-0-1428"></a>
<a id="__codelineno-0-1429" name="__codelineno-0-1429"></a><span class="sd">    to your pipeline script.</span>
<a id="__codelineno-0-1430" name="__codelineno-0-1430"></a>
<a id="__codelineno-0-1431" name="__codelineno-0-1431"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-1432" name="__codelineno-0-1432"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-1433" name="__codelineno-0-1433"></a><span class="sd">    args : list</span>
<a id="__codelineno-0-1434" name="__codelineno-0-1434"></a><span class="sd">        List of command line arguments.</span>
<a id="__codelineno-0-1435" name="__codelineno-0-1435"></a>
<a id="__codelineno-0-1436" name="__codelineno-0-1436"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1437" name="__codelineno-0-1437"></a>
<a id="__codelineno-0-1438" name="__codelineno-0-1438"></a>    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1439" name="__codelineno-0-1439"></a>        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span>
<a id="__codelineno-0-1440" name="__codelineno-0-1440"></a>
<a id="__codelineno-0-1441" name="__codelineno-0-1441"></a>    <span class="k">if</span> <span class="n">E</span><span class="o">.</span><span class="n">get_args</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1442" name="__codelineno-0-1442"></a>        <span class="n">initialize</span><span class="p">(</span><span class="n">caller</span><span class="o">=</span><span class="n">get_caller</span><span class="p">()</span><span class="o">.</span><span class="vm">__file__</span><span class="p">)</span>
<a id="__codelineno-0-1443" name="__codelineno-0-1443"></a>
<a id="__codelineno-0-1444" name="__codelineno-0-1444"></a>    <span class="n">args</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">get_args</span><span class="p">()</span>
<a id="__codelineno-0-1445" name="__codelineno-0-1445"></a>
<a id="__codelineno-0-1446" name="__codelineno-0-1446"></a>    <span class="n">run_workflow</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.match_parameter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">match_parameter</span><span class="p">(</span><span class="n">param</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.match_parameter" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>find an exact match or prefix-match in the global
configuration dictionary param.</p>
<h4 id="cgatcore.pipeline.match_parameter--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.match_parameter--arguments" title="Permanent link">&para;</a></h4>
<p>param : string
    Parameter to search for.</p>
<h4 id="cgatcore.pipeline.match_parameter--returns">Returns<a class="headerlink" href="#cgatcore.pipeline.match_parameter--returns" title="Permanent link">&para;</a></h4>
<p>name : string
    The full parameter name.</p>
<h4 id="cgatcore.pipeline.match_parameter--raises">Raises<a class="headerlink" href="#cgatcore.pipeline.match_parameter--raises" title="Permanent link">&para;</a></h4>
<p>KeyError if param can't be matched.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/parameters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-416" name="__codelineno-0-416"></a><span class="k">def</span><span class="w"> </span><span class="nf">match_parameter</span><span class="p">(</span><span class="n">param</span><span class="p">):</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;find an exact match or prefix-match in the global</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a><span class="sd">    configuration dictionary param.</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="sd">    param : string</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="sd">        Parameter to search for.</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a><span class="sd">    -------</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="sd">    name : string</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a><span class="sd">        The full parameter name.</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="sd">    Raises</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="sd">    ------</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">    KeyError if param can&#39;t be matched.</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>    <span class="k">if</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">PARAMS</span><span class="p">:</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>        <span class="k">return</span> <span class="n">param</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">PARAMS</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>        <span class="k">if</span> <span class="s2">&quot;%&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>            <span class="n">rx</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="s2">&quot;.*&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>            <span class="k">if</span> <span class="n">rx</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">param</span><span class="p">):</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>                <span class="k">return</span> <span class="n">key</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;parameter &#39;</span><span class="si">%s</span><span class="s2">&#39; can not be matched in dictionary&quot;</span> <span class="o">%</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>                   <span class="n">param</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.merge_and_load" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">merge_and_load</span><span class="p">(</span><span class="n">infiles</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">row_wise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">retry</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">prefixes</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.merge_and_load" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>merge multiple categorical tables and load into a database.</p>
<p>The tables are merged and entered row-wise, i.e, the contents of
each file are a row.</p>
<p>For example, the statement::</p>
<div class="codehilite"><pre><span></span><code><span class="n">mergeAndLoad</span><span class="p">([</span><span class="s1">&#39;file1.txt&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;file2.txt&#39;</span><span class="p">],</span>
<span class="w">             </span><span class="s2">&quot;test_table.load&quot;</span><span class="p">)</span>
</code></pre></div>

<p>with the two files::
    &gt; cat file1.txt
    Category    Result
    length      12
    width       100</p>
<div class="codehilite"><pre><span></span><code>&gt; cat file2.txt
Category    Result
length      20
width       50
</code></pre></div>

<p>will be added into table <code>test_table</code> as::
    track   length   width
    file1   12       100
    file2   20       50</p>
<p>If row-wise is set::
    mergeAndLoad(['file1.txt', 'file2.txt'],
                 "test_table.load", row_wise=True)</p>
<p><code>test_table</code> will be transposed and look like this::
    track    file1 file2
    length   12    20
    width    20    50</p>
<h4 id="cgatcore.pipeline.merge_and_load--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.merge_and_load--arguments" title="Permanent link">&para;</a></h4>
<p>infiles : list
    Filenames of the input data
outfile : string
    Output filename. This will contain the logging information. The
    table name is derived from <code>outfile</code>.
suffix : string
    If <code>suffix</code> is given, the suffix will be removed from the filenames.
columns : list
    The columns to be taken. By default, the first two columns are
    taken with the first being the key. Filenames are stored in a
    <code>track</code> column. Directory names are chopped off.  If
    <code>columns</code> is set to None, all columns will be taken. Here,
    column names will receive a prefix given by <code>prefixes</code>. If
    <code>prefixes</code> is None, the filename will be added as a prefix.
regex : string
    If set, the full filename will be used to extract a
    track name via the supplied regular expression.
row_wise : bool
    If set to False, each table will be a column in the resulting
    table.  This is useful if histograms are being merged.
retry : bool
    If True, multiple attempts will be made if the data can
    not be loaded at the first try, for example if a table is locked.
options : string
    Command line options for the <code>csv2db.py</code> script.
prefixes : list
    If given, the respective prefix will be added to each
    column. The number of <code>prefixes</code> and <code>infiles</code> needs to be the
    same.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="k">def</span><span class="w"> </span><span class="nf">merge_and_load</span><span class="p">(</span><span class="n">infiles</span><span class="p">,</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>                   <span class="n">outfile</span><span class="p">,</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>                   <span class="n">suffix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>                   <span class="n">columns</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>                   <span class="n">regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>                   <span class="n">row_wise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>                   <span class="n">retry</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>                   <span class="n">options</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>                   <span class="n">prefixes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;merge multiple categorical tables and load into a database.</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="sd">    The tables are merged and entered row-wise, i.e, the contents of</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a><span class="sd">    each file are a row.</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="sd">    For example, the statement::</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="sd">        mergeAndLoad([&#39;file1.txt&#39;, &#39;file2.txt&#39;],</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">                     &quot;test_table.load&quot;)</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">    with the two files::</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">        &gt; cat file1.txt</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">        Category    Result</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">        length      12</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">        width       100</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="sd">        &gt; cat file2.txt</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="sd">        Category    Result</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">        length      20</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="sd">        width       50</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">    will be added into table ``test_table`` as::</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">        track   length   width</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">        file1   12       100</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">        file2   20       50</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="sd">    If row-wise is set::</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">        mergeAndLoad([&#39;file1.txt&#39;, &#39;file2.txt&#39;],</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="sd">                     &quot;test_table.load&quot;, row_wise=True)</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">    ``test_table`` will be transposed and look like this::</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">        track    file1 file2</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">        length   12    20</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="sd">        width    20    50</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">    infiles : list</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="sd">        Filenames of the input data</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="sd">    outfile : string</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a><span class="sd">        Output filename. This will contain the logging information. The</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">        table name is derived from `outfile`.</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="sd">    suffix : string</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">        If `suffix` is given, the suffix will be removed from the filenames.</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">    columns : list</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">        The columns to be taken. By default, the first two columns are</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">        taken with the first being the key. Filenames are stored in a</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="sd">        ``track`` column. Directory names are chopped off.  If</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="sd">        `columns` is set to None, all columns will be taken. Here,</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="sd">        column names will receive a prefix given by `prefixes`. If</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a><span class="sd">        `prefixes` is None, the filename will be added as a prefix.</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a><span class="sd">    regex : string</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="sd">        If set, the full filename will be used to extract a</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a><span class="sd">        track name via the supplied regular expression.</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a><span class="sd">    row_wise : bool</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="sd">        If set to False, each table will be a column in the resulting</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a><span class="sd">        table.  This is useful if histograms are being merged.</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a><span class="sd">    retry : bool</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a><span class="sd">        If True, multiple attempts will be made if the data can</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a><span class="sd">        not be loaded at the first try, for example if a table is locked.</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a><span class="sd">    options : string</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a><span class="sd">        Command line options for the `csv2db.py` script.</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a><span class="sd">    prefixes : list</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a><span class="sd">        If given, the respective prefix will be added to each</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a><span class="sd">        column. The number of `prefixes` and `infiles` needs to be the</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="sd">        same.</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">infiles</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;no files for merging&quot;</span><span class="p">)</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>    <span class="k">if</span> <span class="n">suffix</span><span class="p">:</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>        <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">snip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">suffix</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">infiles</span><span class="p">])</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>    <span class="k">elif</span> <span class="n">regex</span><span class="p">:</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>        <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">())</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>                           <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">infiles</span><span class="p">])</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>        <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">infiles</span><span class="p">])</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>    <span class="n">header_stmt</span> <span class="o">=</span> <span class="s2">&quot;--header-names=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">header</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>    <span class="k">if</span> <span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>        <span class="n">column_filter</span> <span class="o">=</span> <span class="s2">&quot;| cut -f </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>                                                     <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">]))</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>        <span class="n">column_filter</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>        <span class="k">if</span> <span class="n">prefixes</span><span class="p">:</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefixes</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">infiles</span><span class="p">)</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>            <span class="n">header_stmt</span> <span class="o">=</span> <span class="s2">&quot;--prefixes=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prefixes</span><span class="p">)</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>            <span class="n">header_stmt</span> <span class="o">=</span> <span class="s2">&quot;--add-file-prefix&quot;</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>    <span class="k">if</span> <span class="n">infiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.gz&quot;</span><span class="p">):</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>        <span class="n">filenames</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>            <span class="p">[</span><span class="s2">&quot;&lt;( zcat </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> )&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">column_filter</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">infiles</span><span class="p">])</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>        <span class="n">filenames</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>            <span class="p">[</span><span class="s2">&quot;&lt;( cat </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> )&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">column_filter</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">infiles</span><span class="p">])</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>    <span class="k">if</span> <span class="n">row_wise</span><span class="p">:</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>        <span class="n">transform</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;| perl -p -e &quot;s/bin/track/&quot;</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="s2">        | python -m cgatcore.table --transpose&quot;&quot;&quot;</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>        <span class="n">transform</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>    <span class="n">load_statement</span> <span class="o">=</span> <span class="n">build_load_statement</span><span class="p">(</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>        <span class="n">to_table</span><span class="p">(</span><span class="n">outfile</span><span class="p">),</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>        <span class="n">options</span><span class="o">=</span><span class="s2">&quot;--add-index=track &quot;</span> <span class="o">+</span> <span class="n">options</span><span class="p">,</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>        <span class="n">retry</span><span class="o">=</span><span class="n">retry</span><span class="p">)</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>    <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;python -m cgatcore.tables</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a><span class="s2">    </span><span class="si">%(header_stmt)s</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a><span class="s2">    --skip-titles</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a><span class="s2">    --missing-value=0</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a><span class="s2">    --ignore-empty</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a><span class="s2">    </span><span class="si">%(filenames)s</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="s2">    </span><span class="si">%(transform)s</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a><span class="s2">    | </span><span class="si">%(load_statement)s</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="s2">    &gt; </span><span class="si">%(outfile)s</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>    <span class="n">run</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.nested_update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">nested_update</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.nested_update" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Update potentially nested dictionaries. If both old[x] and new[x]
inherit from collections.abc.Mapping, then update old[x] with entries from
new[x], otherwise set old[x] to new[x]</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/parameters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="k">def</span><span class="w"> </span><span class="nf">nested_update</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">):</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Update potentially nested dictionaries. If both old[x] and new[x]</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">    inherit from collections.abc.Mapping, then update old[x] with entries from</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">    new[x], otherwise set old[x] to new[x]&#39;&#39;&#39;</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">new</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">)</span> <span class="ow">and</span> \
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>           <span class="nb">isinstance</span><span class="p">(</span><span class="n">old</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">()),</span> <span class="n">Mapping</span><span class="p">):</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>            <span class="n">old</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>            <span class="n">old</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">new</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.parse_commandline" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_commandline</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">optparse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.parse_commandline" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>parse command line.</p>
<p>Create option parser and parse command line.</p>
<h4 id="cgatcore.pipeline.parse_commandline--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.parse_commandline--arguments" title="Permanent link">&para;</a></h4>
<p>argv : list
    List of command line options to parse. If None, use sys.argv.</p>
<p>**kwargs: dict
    Additional arguments overwrite default option settings.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/control.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span>
<span class="normal"><a href="#__codelineno-0-839">839</a></span>
<span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span>
<span class="normal"><a href="#__codelineno-0-842">842</a></span>
<span class="normal"><a href="#__codelineno-0-843">843</a></span>
<span class="normal"><a href="#__codelineno-0-844">844</a></span>
<span class="normal"><a href="#__codelineno-0-845">845</a></span>
<span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span>
<span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span>
<span class="normal"><a href="#__codelineno-0-853">853</a></span>
<span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span>
<span class="normal"><a href="#__codelineno-0-865">865</a></span>
<span class="normal"><a href="#__codelineno-0-866">866</a></span>
<span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span>
<span class="normal"><a href="#__codelineno-0-869">869</a></span>
<span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span>
<span class="normal"><a href="#__codelineno-0-876">876</a></span>
<span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span>
<span class="normal"><a href="#__codelineno-0-881">881</a></span>
<span class="normal"><a href="#__codelineno-0-882">882</a></span>
<span class="normal"><a href="#__codelineno-0-883">883</a></span>
<span class="normal"><a href="#__codelineno-0-884">884</a></span>
<span class="normal"><a href="#__codelineno-0-885">885</a></span>
<span class="normal"><a href="#__codelineno-0-886">886</a></span>
<span class="normal"><a href="#__codelineno-0-887">887</a></span>
<span class="normal"><a href="#__codelineno-0-888">888</a></span>
<span class="normal"><a href="#__codelineno-0-889">889</a></span>
<span class="normal"><a href="#__codelineno-0-890">890</a></span>
<span class="normal"><a href="#__codelineno-0-891">891</a></span>
<span class="normal"><a href="#__codelineno-0-892">892</a></span>
<span class="normal"><a href="#__codelineno-0-893">893</a></span>
<span class="normal"><a href="#__codelineno-0-894">894</a></span>
<span class="normal"><a href="#__codelineno-0-895">895</a></span>
<span class="normal"><a href="#__codelineno-0-896">896</a></span>
<span class="normal"><a href="#__codelineno-0-897">897</a></span>
<span class="normal"><a href="#__codelineno-0-898">898</a></span>
<span class="normal"><a href="#__codelineno-0-899">899</a></span>
<span class="normal"><a href="#__codelineno-0-900">900</a></span>
<span class="normal"><a href="#__codelineno-0-901">901</a></span>
<span class="normal"><a href="#__codelineno-0-902">902</a></span>
<span class="normal"><a href="#__codelineno-0-903">903</a></span>
<span class="normal"><a href="#__codelineno-0-904">904</a></span>
<span class="normal"><a href="#__codelineno-0-905">905</a></span>
<span class="normal"><a href="#__codelineno-0-906">906</a></span>
<span class="normal"><a href="#__codelineno-0-907">907</a></span>
<span class="normal"><a href="#__codelineno-0-908">908</a></span>
<span class="normal"><a href="#__codelineno-0-909">909</a></span>
<span class="normal"><a href="#__codelineno-0-910">910</a></span>
<span class="normal"><a href="#__codelineno-0-911">911</a></span>
<span class="normal"><a href="#__codelineno-0-912">912</a></span>
<span class="normal"><a href="#__codelineno-0-913">913</a></span>
<span class="normal"><a href="#__codelineno-0-914">914</a></span>
<span class="normal"><a href="#__codelineno-0-915">915</a></span>
<span class="normal"><a href="#__codelineno-0-916">916</a></span>
<span class="normal"><a href="#__codelineno-0-917">917</a></span>
<span class="normal"><a href="#__codelineno-0-918">918</a></span>
<span class="normal"><a href="#__codelineno-0-919">919</a></span>
<span class="normal"><a href="#__codelineno-0-920">920</a></span>
<span class="normal"><a href="#__codelineno-0-921">921</a></span>
<span class="normal"><a href="#__codelineno-0-922">922</a></span>
<span class="normal"><a href="#__codelineno-0-923">923</a></span>
<span class="normal"><a href="#__codelineno-0-924">924</a></span>
<span class="normal"><a href="#__codelineno-0-925">925</a></span>
<span class="normal"><a href="#__codelineno-0-926">926</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-598" name="__codelineno-0-598"></a><span class="k">def</span><span class="w"> </span><span class="nf">parse_commandline</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">optparse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;parse command line.</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a><span class="sd">    Create option parser and parse command line.</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a><span class="sd">    argv : list</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a><span class="sd">        List of command line options to parse. If None, use sys.argv.</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a><span class="sd">    **kwargs: dict</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a><span class="sd">        Additional arguments overwrite default option settings.</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>    <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>        <span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>    <span class="k">if</span> <span class="n">optparse</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>        <span class="n">parser</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="s2">&quot;%prog version: $Id$&quot;</span><span class="p">,</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>                                <span class="n">usage</span><span class="o">=</span><span class="n">USAGE</span><span class="p">)</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--pipeline-action&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;pipeline_action&quot;</span><span class="p">,</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>                          <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;choice&quot;</span><span class="p">,</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>                          <span class="n">choices</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>                              <span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;show&quot;</span><span class="p">,</span> <span class="s2">&quot;plot&quot;</span><span class="p">,</span> <span class="s2">&quot;dump&quot;</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>                              <span class="s2">&quot;clone&quot;</span><span class="p">,</span> <span class="s2">&quot;check&quot;</span><span class="p">,</span> <span class="s2">&quot;regenerate&quot;</span><span class="p">,</span> <span class="s2">&quot;state&quot;</span><span class="p">,</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>                              <span class="s2">&quot;printconfig&quot;</span><span class="p">,</span> <span class="s2">&quot;svg&quot;</span><span class="p">),</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>                          <span class="n">help</span><span class="o">=</span><span class="s2">&quot;action to take [default=</span><span class="si">%d</span><span class="s2">efault].&quot;</span><span class="p">)</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--pipeline-format&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;pipeline_format&quot;</span><span class="p">,</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>                          <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;choice&quot;</span><span class="p">,</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>                          <span class="n">choices</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;dot&quot;</span><span class="p">,</span> <span class="s2">&quot;jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="s2">&quot;ps&quot;</span><span class="p">,</span> <span class="s2">&quot;png&quot;</span><span class="p">),</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>                          <span class="n">help</span><span class="o">=</span><span class="s2">&quot;pipeline format [default=</span><span class="si">%d</span><span class="s2">efault].&quot;</span><span class="p">)</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-n&quot;</span><span class="p">,</span> <span class="s2">&quot;--dry-run&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;dry_run&quot;</span><span class="p">,</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>                          <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>                          <span class="n">help</span><span class="o">=</span><span class="s2">&quot;perform a dry run (do not execute any shell &quot;</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>                          <span class="s2">&quot;commands) [default=</span><span class="si">%d</span><span class="s2">efault].&quot;</span><span class="p">)</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="s2">&quot;--config-file&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;config_file&quot;</span><span class="p">,</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>                          <span class="n">help</span><span class="o">=</span><span class="s2">&quot;benchmark configuration file &quot;</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>                          <span class="s2">&quot;[default=</span><span class="si">%d</span><span class="s2">efault].&quot;</span><span class="p">)</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;--force-run&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;force_run&quot;</span><span class="p">,</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>                          <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>                          <span class="n">help</span><span class="o">=</span><span class="s2">&quot;force running the pipeline even if there are &quot;</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>                          <span class="s2">&quot;up-to-date tasks. If option is &#39;all&#39;, all tasks &quot;</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>                          <span class="s2">&quot;will be rerun. Otherwise, only the tasks given as &quot;</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>                          <span class="s2">&quot;arguments will be rerun. &quot;</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>                          <span class="s2">&quot;[default=</span><span class="si">%d</span><span class="s2">efault].&quot;</span><span class="p">)</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-p&quot;</span><span class="p">,</span> <span class="s2">&quot;--multiprocess&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;multiprocess&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">,</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>                          <span class="n">help</span><span class="o">=</span><span class="s2">&quot;number of parallel processes to use on &quot;</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>                          <span class="s2">&quot;submit host &quot;</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>                          <span class="s2">&quot;(different from number of jobs to use for &quot;</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>                          <span class="s2">&quot;cluster jobs) &quot;</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>                          <span class="s2">&quot;[default=</span><span class="si">%d</span><span class="s2">efault].&quot;</span><span class="p">)</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-e&quot;</span><span class="p">,</span> <span class="s2">&quot;--exceptions&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;log_exceptions&quot;</span><span class="p">,</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>                          <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>                          <span class="n">help</span><span class="o">=</span><span class="s2">&quot;echo exceptions immediately as they occur &quot;</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>                          <span class="s2">&quot;[default=</span><span class="si">%d</span><span class="s2">efault].&quot;</span><span class="p">)</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-i&quot;</span><span class="p">,</span> <span class="s2">&quot;--terminate&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;terminate&quot;</span><span class="p">,</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>                          <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>                          <span class="n">help</span><span class="o">=</span><span class="s2">&quot;terminate immediately at the first exception &quot;</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>                          <span class="s2">&quot;[default=</span><span class="si">%d</span><span class="s2">efault].&quot;</span><span class="p">)</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-d&quot;</span><span class="p">,</span> <span class="s2">&quot;--debug&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>                          <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>                          <span class="n">help</span><span class="o">=</span><span class="s2">&quot;output debugging information on console, &quot;</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>                          <span class="s2">&quot;and not the logfile &quot;</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>                          <span class="s2">&quot;[default=</span><span class="si">%d</span><span class="s2">efault].&quot;</span><span class="p">)</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-s&quot;</span><span class="p">,</span> <span class="s2">&quot;--set&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;variables_to_set&quot;</span><span class="p">,</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>                          <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>                          <span class="n">help</span><span class="o">=</span><span class="s2">&quot;explicitely set paramater values &quot;</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>                          <span class="s2">&quot;[default=</span><span class="si">%d</span><span class="s2">efault].&quot;</span><span class="p">)</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--input-glob&quot;</span><span class="p">,</span> <span class="s2">&quot;--input-glob&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;input_globs&quot;</span><span class="p">,</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>                          <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>                          <span class="n">help</span><span class="o">=</span><span class="s2">&quot;glob expression for input filenames. The exact format &quot;</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>                          <span class="s2">&quot;is pipeline specific. If the pipeline expects only a single input, &quot;</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>                          <span class="s2">&quot;`--input-glob=*.bam` will be sufficient. If the pipeline expects &quot;</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>                          <span class="s2">&quot;multiple types of input, a qualifier might need to be added, for example &quot;</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>                          <span class="s2">&quot;`--input-glob=bam=*.bam` --input-glob=bed=*.bed.gz`. Giving this option &quot;</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a>                          <span class="s2">&quot;overrides the default of a pipeline looking for input in the current directory &quot;</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>                          <span class="s2">&quot;or specified the config file. &quot;</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>                          <span class="s2">&quot;[default=</span><span class="si">%d</span><span class="s2">efault].&quot;</span><span class="p">)</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--checksums&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;ruffus_checksums_level&quot;</span><span class="p">,</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>                          <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">,</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>                          <span class="n">help</span><span class="o">=</span><span class="s2">&quot;set the level of ruffus checksums&quot;</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>                          <span class="s2">&quot;[default=</span><span class="si">%d</span><span class="s2">efault].&quot;</span><span class="p">)</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-t&quot;</span><span class="p">,</span> <span class="s2">&quot;--is-test&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;is_test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>                          <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>                          <span class="n">help</span><span class="o">=</span><span class="s2">&quot;this is a test run&quot;</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>                          <span class="s2">&quot;[default=</span><span class="si">%d</span><span class="s2">efault].&quot;</span><span class="p">)</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--engine&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;engine&quot;</span><span class="p">,</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>                          <span class="n">choices</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;local&quot;</span><span class="p">,</span> <span class="s2">&quot;arvados&quot;</span><span class="p">),</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>                          <span class="n">help</span><span class="o">=</span><span class="s2">&quot;engine to use.&quot;</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>                          <span class="s2">&quot;[default=</span><span class="si">%d</span><span class="s2">efault].&quot;</span><span class="p">)</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>            <span class="s2">&quot;--always-mount&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;always_mount&quot;</span><span class="p">,</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>            <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;force mounting of arvados keep [</span><span class="si">%d</span><span class="s2">efault]&quot;</span><span class="p">)</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--only-info&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;only_info&quot;</span><span class="p">,</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>                          <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>                          <span class="n">help</span><span class="o">=</span><span class="s2">&quot;only update meta information, do not run &quot;</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>                          <span class="s2">&quot;[default=</span><span class="si">%d</span><span class="s2">efault].&quot;</span><span class="p">)</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--work-dir&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;work_dir&quot;</span><span class="p">,</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>                          <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>                          <span class="n">help</span><span class="o">=</span><span class="s2">&quot;working directory. Will be created if it does not exist &quot;</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>                          <span class="s2">&quot;[default=</span><span class="si">%d</span><span class="s2">efault].&quot;</span><span class="p">)</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>        <span class="n">group</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">OptionGroup</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="s2">&quot;pipeline logging configuration&quot;</span><span class="p">)</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>        <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--pipeline-logfile&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;pipeline_logfile&quot;</span><span class="p">,</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>                         <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>                         <span class="n">help</span><span class="o">=</span><span class="s2">&quot;primary logging destination.&quot;</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>                         <span class="s2">&quot;[default=</span><span class="si">%d</span><span class="s2">efault].&quot;</span><span class="p">)</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>        <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--shell-logfile&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;shell_logfile&quot;</span><span class="p">,</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>                         <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>                         <span class="n">help</span><span class="o">=</span><span class="s2">&quot;filename for shell debugging information. &quot;</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>                         <span class="s2">&quot;If it is not an absolute path, &quot;</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>                         <span class="s2">&quot;the output will be written into the current working &quot;</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>                         <span class="s2">&quot;directory. If unset, no logging will be output. &quot;</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>                         <span class="s2">&quot;[default=</span><span class="si">%d</span><span class="s2">efault].&quot;</span><span class="p">)</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--input-validation&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;input_validation&quot;</span><span class="p">,</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>                          <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>                          <span class="n">help</span><span class="o">=</span><span class="s2">&quot;perform input validation before starting &quot;</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>                          <span class="s2">&quot;[default=</span><span class="si">%d</span><span class="s2">efault].&quot;</span><span class="p">)</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_option_group</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>            <span class="n">pipeline_action</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>            <span class="n">pipeline_format</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>            <span class="n">pipeline_targets</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>            <span class="n">force_run</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>            <span class="n">multiprocess</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>            <span class="n">pipeline_logfile</span><span class="o">=</span><span class="s2">&quot;pipeline.log&quot;</span><span class="p">,</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>            <span class="n">shell_logfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>            <span class="n">dry_run</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>            <span class="n">log_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>            <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;local&quot;</span><span class="p">,</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>            <span class="n">exceptions_terminate_immediately</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>            <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>            <span class="n">variables_to_set</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>            <span class="n">is_test</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>            <span class="n">ruffus_checksums_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>            <span class="n">config_file</span><span class="o">=</span><span class="s2">&quot;pipeline.yml&quot;</span><span class="p">,</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>            <span class="n">work_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>            <span class="n">always_mount</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>            <span class="n">only_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>            <span class="n">input_globs</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>            <span class="n">input_validation</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>        <span class="k">if</span> <span class="s2">&quot;callback&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;callback&quot;</span><span class="p">](</span><span class="n">parser</span><span class="p">)</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>        <span class="n">logger_callback</span> <span class="o">=</span> <span class="n">setup_logging</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>        <span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">start</span><span class="p">(</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>            <span class="n">parser</span><span class="p">,</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>            <span class="n">add_cluster_options</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>            <span class="n">argv</span><span class="o">=</span><span class="n">argv</span><span class="p">,</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>            <span class="n">logger_callback</span><span class="o">=</span><span class="n">logger_callback</span><span class="p">)</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>        <span class="n">options</span><span class="o">.</span><span class="n">pipeline_name</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>            <span class="n">options</span><span class="o">.</span><span class="n">pipeline_action</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>            <span class="n">options</span><span class="o">.</span><span class="n">pipeline_targets</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>        <span class="n">parser</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">USAGE</span><span class="p">)</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--pipeline-action&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;pipeline_action&quot;</span><span class="p">,</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>                            <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>                            <span class="n">choices</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>                                <span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;show&quot;</span><span class="p">,</span> <span class="s2">&quot;plot&quot;</span><span class="p">,</span> <span class="s2">&quot;dump&quot;</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>                                <span class="s2">&quot;clone&quot;</span><span class="p">,</span> <span class="s2">&quot;check&quot;</span><span class="p">,</span> <span class="s2">&quot;regenerate&quot;</span><span class="p">,</span> <span class="s2">&quot;state&quot;</span><span class="p">,</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>                                <span class="s2">&quot;printconfig&quot;</span><span class="p">,</span> <span class="s2">&quot;svg&quot;</span><span class="p">),</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>                            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;action to take.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--pipeline-format&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;pipeline_format&quot;</span><span class="p">,</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>                            <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>                            <span class="n">choices</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;dot&quot;</span><span class="p">,</span> <span class="s2">&quot;jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="s2">&quot;ps&quot;</span><span class="p">,</span> <span class="s2">&quot;png&quot;</span><span class="p">),</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>                            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;pipeline format.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-n&quot;</span><span class="p">,</span> <span class="s2">&quot;--dry-run&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;dry_run&quot;</span><span class="p">,</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>                            <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>                            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;perform a dry run (do not execute any shell &quot;</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>                            <span class="s2">&quot;commands).&quot;</span><span class="p">)</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="s2">&quot;--config-file&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;config_file&quot;</span><span class="p">,</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>                            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;benchmark configuration file &quot;</span><span class="p">)</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;--force-run&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;force_run&quot;</span><span class="p">,</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>                            <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>                            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;force running the pipeline even if there are &quot;</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>                            <span class="s2">&quot;up-to-date tasks. If option is &#39;all&#39;, all tasks &quot;</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>                            <span class="s2">&quot;will be rerun. Otherwise, only the tasks given as &quot;</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>                            <span class="s2">&quot;arguments will be rerun. &quot;</span><span class="p">)</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-p&quot;</span><span class="p">,</span> <span class="s2">&quot;--multiprocess&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;multiprocess&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>                            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;number of parallel processes to use on &quot;</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>                            <span class="s2">&quot;submit host &quot;</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>                            <span class="s2">&quot;(different from number of jobs to use for &quot;</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>                            <span class="s2">&quot;cluster jobs) &quot;</span><span class="p">)</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-e&quot;</span><span class="p">,</span> <span class="s2">&quot;--exceptions&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;log_exceptions&quot;</span><span class="p">,</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>                            <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>                            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;echo exceptions immediately as they occur &quot;</span><span class="p">)</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-i&quot;</span><span class="p">,</span> <span class="s2">&quot;--terminate&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;terminate&quot;</span><span class="p">,</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>                            <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>                            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;terminate immediately at the first exception&quot;</span><span class="p">)</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-d&quot;</span><span class="p">,</span> <span class="s2">&quot;--debug&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>                            <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>                            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;output debugging information on console, &quot;</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>                            <span class="s2">&quot;and not the logfile &quot;</span><span class="p">)</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-s&quot;</span><span class="p">,</span> <span class="s2">&quot;--set&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;variables_to_set&quot;</span><span class="p">,</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>                            <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>                            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;explicitely set paramater values &quot;</span><span class="p">)</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--input-glob&quot;</span><span class="p">,</span> <span class="s2">&quot;--input-glob&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;input_globs&quot;</span><span class="p">,</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>                            <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>                            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;glob expression for input filenames. The exact format &quot;</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>                            <span class="s2">&quot;is pipeline specific. If the pipeline expects only a single input, &quot;</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>                            <span class="s2">&quot;`--input-glob=*.bam` will be sufficient. If the pipeline expects &quot;</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>                            <span class="s2">&quot;multiple types of input, a qualifier might need to be added, for example &quot;</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>                            <span class="s2">&quot;`--input-glob=bam=*.bam` --input-glob=bed=*.bed.gz`. Giving this option &quot;</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>                            <span class="s2">&quot;overrides the default of a pipeline looking for input in the current directory &quot;</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>                            <span class="s2">&quot;or specified the config file.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--checksums&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;ruffus_checksums_level&quot;</span><span class="p">,</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>                            <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>                            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;set the level of ruffus checksums&quot;</span><span class="p">)</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-t&quot;</span><span class="p">,</span> <span class="s2">&quot;--is-test&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;is_test&quot;</span><span class="p">,</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>                            <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>                            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;this is a test run&quot;</span><span class="p">)</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--engine&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;engine&quot;</span><span class="p">,</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>                            <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>                            <span class="n">choices</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;local&quot;</span><span class="p">,</span> <span class="s2">&quot;arvados&quot;</span><span class="p">),</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>                            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;engine to use.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>            <span class="s2">&quot;--always-mount&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;always_mount&quot;</span><span class="p">,</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>            <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;force mounting of arvados keep&quot;</span><span class="p">)</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--only-info&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;only_info&quot;</span><span class="p">,</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>                            <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>                            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;only update meta information, do not run&quot;</span><span class="p">)</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--work-dir&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;work_dir&quot;</span><span class="p">,</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>                            <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>                            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;working directory. Will be created if it does not exist&quot;</span><span class="p">)</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--cleanup-on-fail&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>                            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Enable cleanup of jobs on pipeline failure.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>        <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s2">&quot;pipeline logging configuration&quot;</span><span class="p">)</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>        <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--pipeline-logfile&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;pipeline_logfile&quot;</span><span class="p">,</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>                           <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>                           <span class="n">help</span><span class="o">=</span><span class="s2">&quot;primary logging destination.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>        <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--shell-logfile&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;shell_logfile&quot;</span><span class="p">,</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>                           <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>                           <span class="n">help</span><span class="o">=</span><span class="s2">&quot;filename for shell debugging information. &quot;</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>                           <span class="s2">&quot;If it is not an absolute path, &quot;</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>                           <span class="s2">&quot;the output will be written into the current working &quot;</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>                           <span class="s2">&quot;directory. If unset, no logging will be output.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>        <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--input-validation&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;input_validation&quot;</span><span class="p">,</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>                           <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>                           <span class="n">help</span><span class="o">=</span><span class="s2">&quot;perform input validation before starting&quot;</span><span class="p">)</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>            <span class="n">pipeline_action</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>            <span class="n">pipeline_format</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a>            <span class="n">pipeline_targets</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>            <span class="n">force_run</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>            <span class="n">multiprocess</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>            <span class="n">pipeline_logfile</span><span class="o">=</span><span class="s2">&quot;pipeline.log&quot;</span><span class="p">,</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>            <span class="n">shell_logfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>            <span class="n">dry_run</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>            <span class="n">log_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>            <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;local&quot;</span><span class="p">,</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>            <span class="n">exceptions_terminate_immediately</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a>            <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a>            <span class="n">variables_to_set</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a>            <span class="n">is_test</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>            <span class="n">ruffus_checksums_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>            <span class="n">config_file</span><span class="o">=</span><span class="s2">&quot;pipeline.yml&quot;</span><span class="p">,</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>            <span class="n">work_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>            <span class="n">always_mount</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>            <span class="n">only_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>            <span class="n">input_globs</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>            <span class="n">input_validation</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>        <span class="n">parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>        <span class="k">if</span> <span class="s2">&quot;callback&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;callback&quot;</span><span class="p">](</span><span class="n">parser</span><span class="p">)</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>        <span class="n">logger_callback</span> <span class="o">=</span> <span class="n">setup_logging</span>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>        <span class="n">args</span><span class="p">,</span> <span class="n">unknown</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">start</span><span class="p">(</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>            <span class="n">parser</span><span class="p">,</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>            <span class="n">add_cluster_options</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a>            <span class="n">argv</span><span class="o">=</span><span class="n">argv</span><span class="p">,</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a>            <span class="n">logger_callback</span><span class="o">=</span><span class="n">logger_callback</span><span class="p">,</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>            <span class="n">unknowns</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>        <span class="n">args</span><span class="o">.</span><span class="n">pipeline_name</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.peek_parameters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">peek_parameters</span><span class="p">(</span><span class="n">workingdir</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="n">on_error_raise</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">update_interface</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">restrict_interface</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.peek_parameters" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>peek configuration parameters from external pipeline.</p>
<p>As the paramater dictionary is built at runtime, this method
executes the pipeline in workingdir, dumping its configuration
values and reading them into a dictionary.</p>
<p>If either <code>pipeline</code> or <code>workingdir</code> are not found, an error is
raised. This behaviour can be changed by setting <code>on_error_raise</code>
to False. In that case, an empty dictionary is returned.</p>
<h4 id="cgatcore.pipeline.peek_parameters--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.peek_parameters--arguments" title="Permanent link">&para;</a></h4>
<p>workingdir : string
   Working directory. This is the directory that the pipeline
   was executed in.
pipeline : string
   Name of the pipeline script. The pipeline is assumed to live
   in the same directory as the current pipeline.
on_error_raise : Bool
   If set to a boolean, an error will be raised (or not) if there
   is an error during parameter peeking, for example if
   <code>workingdir</code> can not be found. If <code>on_error_raise</code> is None, it
   will be set to the default, which is to raise an exception
   unless the calling script is imported or the option
   <code>--is-test</code> has been passed at the command line.
prefix : string
   Add a prefix to all parameters. This is useful if the paramaters
   are added to the configuration dictionary of the calling pipeline.
update_interface : bool
   If True, this method will prefix any options in the
   <code>[interface]</code> section with <code>workingdir</code>. This allows
   transparent access to files in the external pipeline.
restrict_interface : bool
   If  True, only interface parameters will be imported.</p>
<h4 id="cgatcore.pipeline.peek_parameters--returns">Returns<a class="headerlink" href="#cgatcore.pipeline.peek_parameters--returns" title="Permanent link">&para;</a></h4>
<p>config : dict
    Dictionary of configuration values.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/control.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="k">def</span><span class="w"> </span><span class="nf">peek_parameters</span><span class="p">(</span><span class="n">workingdir</span><span class="p">,</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>                    <span class="n">pipeline</span><span class="p">,</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>                    <span class="n">on_error_raise</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>                    <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>                    <span class="n">update_interface</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>                    <span class="n">restrict_interface</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;peek configuration parameters from external pipeline.</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a><span class="sd">    As the paramater dictionary is built at runtime, this method</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="sd">    executes the pipeline in workingdir, dumping its configuration</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="sd">    values and reading them into a dictionary.</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="sd">    If either `pipeline` or `workingdir` are not found, an error is</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">    raised. This behaviour can be changed by setting `on_error_raise`</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">    to False. In that case, an empty dictionary is returned.</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">    workingdir : string</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">       Working directory. This is the directory that the pipeline</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="sd">       was executed in.</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="sd">    pipeline : string</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="sd">       Name of the pipeline script. The pipeline is assumed to live</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">       in the same directory as the current pipeline.</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="sd">    on_error_raise : Bool</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="sd">       If set to a boolean, an error will be raised (or not) if there</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">       is an error during parameter peeking, for example if</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">       `workingdir` can not be found. If `on_error_raise` is None, it</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">       will be set to the default, which is to raise an exception</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">       unless the calling script is imported or the option</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">       ``--is-test`` has been passed at the command line.</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="sd">    prefix : string</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">       Add a prefix to all parameters. This is useful if the paramaters</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="sd">       are added to the configuration dictionary of the calling pipeline.</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">    update_interface : bool</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">       If True, this method will prefix any options in the</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">       ``[interface]`` section with `workingdir`. This allows</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">       transparent access to files in the external pipeline.</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="sd">    restrict_interface : bool</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">       If  True, only interface parameters will be imported.</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">    -------</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="sd">    config : dict</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="sd">        Dictionary of configuration values.</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>    <span class="n">caller_locals</span> <span class="o">=</span> <span class="n">get_caller_locals</span><span class="p">()</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>    <span class="c1"># check if we should raise errors</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>    <span class="k">if</span> <span class="n">on_error_raise</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>        <span class="n">on_error_raise</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">is_test</span><span class="p">()</span> <span class="ow">and</span> \
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>            <span class="s2">&quot;__name__&quot;</span> <span class="ow">in</span> <span class="n">caller_locals</span> <span class="ow">and</span> \
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>            <span class="n">caller_locals</span><span class="p">[</span><span class="s2">&quot;__name__&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>    <span class="c1"># patch - if --help or -h in command line arguments,</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>    <span class="c1"># do not peek as there might be no config file.</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>    <span class="k">if</span> <span class="s2">&quot;--help&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="ow">or</span> <span class="s2">&quot;-h&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>        <span class="k">return</span> <span class="p">{}</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>    <span class="k">if</span> <span class="n">workingdir</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>        <span class="n">workingdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>    <span class="c1"># patch for the &quot;config&quot; target - use default</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>    <span class="c1"># pipeline directory if directory is not specified</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>    <span class="c1"># working dir is set to &quot;?!&quot;</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>    <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;config&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="ow">or</span> <span class="s2">&quot;check&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="ow">or</span> <span class="s2">&quot;clone&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="ow">and</span> <span class="n">workingdir</span> <span class="o">==</span> <span class="s2">&quot;?!&quot;</span><span class="p">):</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>        <span class="n">workingdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_params</span><span class="p">()[</span><span class="s2">&quot;pipelinedir&quot;</span><span class="p">],</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>                                  <span class="s2">&quot;pipeline_&quot;</span> <span class="o">+</span> <span class="n">pipeline</span><span class="p">)</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">workingdir</span><span class="p">):</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>        <span class="k">if</span> <span class="n">on_error_raise</span><span class="p">:</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>                <span class="s2">&quot;can&#39;t find working dir </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">workingdir</span><span class="p">)</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>            <span class="k">return</span> <span class="p">{}</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>    <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot;cgatflow </span><span class="si">{}</span><span class="s2"> dump -v 0&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pipeline</span><span class="p">)</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>        <span class="p">{</span><span class="s1">&#39;BASH_ENV&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span> <span class="s1">&#39;.bashrc&#39;</span><span class="p">)})</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>    <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>                               <span class="n">cwd</span><span class="o">=</span><span class="n">workingdir</span><span class="p">,</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>                               <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>                               <span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>                               <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>                               <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>                               <span class="n">env</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>    <span class="c1"># process.stdin.close()</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>    <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>    <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>        <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>            <span class="p">(</span><span class="s2">&quot;Child was terminated by signal </span><span class="si">%i</span><span class="s2">: </span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>             <span class="s2">&quot;Statement: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>             <span class="s2">&quot;The stderr was: </span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>             <span class="s2">&quot;Stdout: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">%</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>            <span class="p">(</span><span class="o">-</span><span class="n">process</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span> <span class="n">stderr</span><span class="p">,</span> <span class="n">stdout</span><span class="p">))</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>    <span class="c1"># subprocess only accepts encoding argument in py &gt;= 3.6 so</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>    <span class="c1"># decode here.</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>    <span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>    <span class="c1"># remove any log messages</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>    <span class="n">stdout</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">stdout</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stdout</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;received multiple configurations&quot;</span><span class="p">)</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>    <span class="n">dump</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">stdout</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>    <span class="c1"># update interface</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>    <span class="k">if</span> <span class="n">update_interface</span><span class="p">:</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">dump</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;interface&quot;</span><span class="p">):</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>                    <span class="n">dump</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workingdir</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>                    <span class="k">for</span> <span class="n">kkey</span><span class="p">,</span> <span class="n">vvalue</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>                        <span class="n">value</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workingdir</span><span class="p">,</span> <span class="n">vvalue</span><span class="p">)</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>    <span class="c1"># keep only interface if so required</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>    <span class="k">if</span> <span class="n">restrict_interface</span><span class="p">:</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>        <span class="n">dump</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dump</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>                     <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;interface&quot;</span><span class="p">)])</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>    <span class="c1"># prefix all parameters</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>    <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>        <span class="n">dump</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">dump</span><span class="o">.</span><span class="n">items</span><span class="p">())])</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>    <span class="k">return</span> <span class="n">dump</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.print_config_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">print_config_files</span><span class="p">()</span></code>

<a href="#cgatcore.pipeline.print_config_files" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Print the list of .ini files used to configure the pipeline
along with their associated priorities.
Priority 1 is the highest.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/control.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="k">def</span><span class="w"> </span><span class="nf">print_config_files</span><span class="p">():</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">        Print the list of .ini files used to configure the pipeline</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">        along with their associated priorities.</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">        Priority 1 is the highest.</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>    <span class="n">filenames</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">()[</span><span class="s1">&#39;pipeline_yml&#39;</span><span class="p">]</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> List of .yml files used to configure the pipeline&quot;</span><span class="p">)</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="n">s</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>    <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; No yml files passed!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="k">elif</span> <span class="n">s</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">%-11s</span><span class="s2">: </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;Priority&quot;</span><span class="p">,</span> <span class="s2">&quot;File&quot;</span><span class="p">))</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>            <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; (highest) </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">%-11s</span><span class="s2">: </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>            <span class="n">s</span> <span class="o">-=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.run" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.run" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>run a command line statement.</p>
<p>This function runs a single or multiple statements either locally
or on the cluster using drmaa. How a statement is executed or how
it is modified depends on the context.</p>
<p>The context is provided by keyword arguments provided as named
function arguments ('kwargs') but also from defaults (see
below). The following keyword arguments are recognized:</p>
<p>job_memory
    memory to use for the job per thread. Memory specification should be in a
    format that is accepted by the job scheduler. Note that memory
    is per thread. If you have 6 threads and the total memory is
    6Gb, use 1G as job_memory.
job_total_memory
    total memory to use for a job. This will be divided by the number of
    threads.
job_threads
    number of threads to request for the job.
job_options
    options to the job scheduler.
job_condaenv
    conda environment to use for the job.
job_array
    if set, run statement as an array job. Job_array should be
    tuple with start, end, and increment.</p>
<p>In addition, any additional variables will be used to interpolate
the command line string using python's '%' string interpolation
operator.</p>
<p>The context is build in a hierarchical manner with successive
operations overwriting previous values.</p>
<ol>
<li>Global variables
   The context is initialized
   with system-wide defaults stored in the global PARAMS
   singleton.</li>
<li>Context of caller
   The context of the calling function is examined
   and any local variables defined in this context are added.</li>
<li>kwargs
   Any options given explicitely as options to the run() method
   are added.</li>
<li>params
   If the context of the calling function contains a params
   variable, its contents are added to the context. This permits
   setting variables in configuration files in TaskLibrary
   functions.</li>
</ol>
<p>By default, a job is sent to the cluster, unless:</p>
<div class="codehilite"><pre><span></span><code><span class="o">*</span><span class="w"> </span><span class="n n-Quoted">``</span><span class="n">to_cluster</span><span class="n n-Quoted">``</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">present</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">None</span><span class="p">.</span>

<span class="o">*</span><span class="w"> </span><span class="n n-Quoted">``</span><span class="n">without_cluster</span><span class="n n-Quoted">``</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="no">True</span><span class="p">.</span>

<span class="o">*</span><span class="w"> </span><span class="n n-Quoted">``</span><span class="o">--</span><span class="k">local</span><span class="n n-Quoted">``</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">line</span>
<span class="w">  </span><span class="k">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">option</span><span class="w"> </span><span class="n n-Quoted">``</span><span class="n">without_cluster</span><span class="n n-Quoted">``</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="k">as</span>
<span class="w">  </span><span class="n">a</span><span class="w"> </span><span class="n">result</span><span class="p">.</span>

<span class="o">*</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">libdrmaa</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">present</span>

<span class="o">*</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">global</span><span class="w"> </span><span class="k">session</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">initialized</span><span class="w"> </span><span class="p">(</span><span class="n">GLOBAL_SESSION</span><span class="w"> </span><span class="k">is</span>
<span class="w">  </span><span class="k">None</span><span class="p">)</span>
</code></pre></div>

<p>Troubleshooting:</p>
<ol>
<li>
<p>DRMAA creates sessions and their is a limited number
      of sessions available. If there are two many or sessions
      become not available after failed jobs, use <code>qconf -secl</code>
      to list sessions and <code>qconf -kec #</code> to delete sessions.</p>
</li>
<li>
<p>Memory: 1G of free memory can be requested using the job_memory
      variable: <code>job_memory = "1G"</code>
      If there are error messages like "no available queue", then the
      problem could be that a particular complex attribute has
      not been defined (the code should be <code>hc</code> for <code>host:complex</code>
      and not <code>hl</code> for <code>host:local</code>. Note that qrsh/qsub directly
      still works.</p>
</li>
</ol>
<p>The job will be executed within PARAMS["work_dir"], unless
PARAMS["work_dir"] is not local. In that case, the job will
be executed in a shared temporary directory.</p>
<h4 id="cgatcore.pipeline.run--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.run--arguments" title="Permanent link">&para;</a></h4>
<p>statement : string or list of strings
    A command line statement or a list of command line statements
    to be executed.
kwargs : dictionary
    Context for job. The context is used to interpolate the command
    line statement.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1371">1371</a></span>
<span class="normal"><a href="#__codelineno-0-1372">1372</a></span>
<span class="normal"><a href="#__codelineno-0-1373">1373</a></span>
<span class="normal"><a href="#__codelineno-0-1374">1374</a></span>
<span class="normal"><a href="#__codelineno-0-1375">1375</a></span>
<span class="normal"><a href="#__codelineno-0-1376">1376</a></span>
<span class="normal"><a href="#__codelineno-0-1377">1377</a></span>
<span class="normal"><a href="#__codelineno-0-1378">1378</a></span>
<span class="normal"><a href="#__codelineno-0-1379">1379</a></span>
<span class="normal"><a href="#__codelineno-0-1380">1380</a></span>
<span class="normal"><a href="#__codelineno-0-1381">1381</a></span>
<span class="normal"><a href="#__codelineno-0-1382">1382</a></span>
<span class="normal"><a href="#__codelineno-0-1383">1383</a></span>
<span class="normal"><a href="#__codelineno-0-1384">1384</a></span>
<span class="normal"><a href="#__codelineno-0-1385">1385</a></span>
<span class="normal"><a href="#__codelineno-0-1386">1386</a></span>
<span class="normal"><a href="#__codelineno-0-1387">1387</a></span>
<span class="normal"><a href="#__codelineno-0-1388">1388</a></span>
<span class="normal"><a href="#__codelineno-0-1389">1389</a></span>
<span class="normal"><a href="#__codelineno-0-1390">1390</a></span>
<span class="normal"><a href="#__codelineno-0-1391">1391</a></span>
<span class="normal"><a href="#__codelineno-0-1392">1392</a></span>
<span class="normal"><a href="#__codelineno-0-1393">1393</a></span>
<span class="normal"><a href="#__codelineno-0-1394">1394</a></span>
<span class="normal"><a href="#__codelineno-0-1395">1395</a></span>
<span class="normal"><a href="#__codelineno-0-1396">1396</a></span>
<span class="normal"><a href="#__codelineno-0-1397">1397</a></span>
<span class="normal"><a href="#__codelineno-0-1398">1398</a></span>
<span class="normal"><a href="#__codelineno-0-1399">1399</a></span>
<span class="normal"><a href="#__codelineno-0-1400">1400</a></span>
<span class="normal"><a href="#__codelineno-0-1401">1401</a></span>
<span class="normal"><a href="#__codelineno-0-1402">1402</a></span>
<span class="normal"><a href="#__codelineno-0-1403">1403</a></span>
<span class="normal"><a href="#__codelineno-0-1404">1404</a></span>
<span class="normal"><a href="#__codelineno-0-1405">1405</a></span>
<span class="normal"><a href="#__codelineno-0-1406">1406</a></span>
<span class="normal"><a href="#__codelineno-0-1407">1407</a></span>
<span class="normal"><a href="#__codelineno-0-1408">1408</a></span>
<span class="normal"><a href="#__codelineno-0-1409">1409</a></span>
<span class="normal"><a href="#__codelineno-0-1410">1410</a></span>
<span class="normal"><a href="#__codelineno-0-1411">1411</a></span>
<span class="normal"><a href="#__codelineno-0-1412">1412</a></span>
<span class="normal"><a href="#__codelineno-0-1413">1413</a></span>
<span class="normal"><a href="#__codelineno-0-1414">1414</a></span>
<span class="normal"><a href="#__codelineno-0-1415">1415</a></span>
<span class="normal"><a href="#__codelineno-0-1416">1416</a></span>
<span class="normal"><a href="#__codelineno-0-1417">1417</a></span>
<span class="normal"><a href="#__codelineno-0-1418">1418</a></span>
<span class="normal"><a href="#__codelineno-0-1419">1419</a></span>
<span class="normal"><a href="#__codelineno-0-1420">1420</a></span>
<span class="normal"><a href="#__codelineno-0-1421">1421</a></span>
<span class="normal"><a href="#__codelineno-0-1422">1422</a></span>
<span class="normal"><a href="#__codelineno-0-1423">1423</a></span>
<span class="normal"><a href="#__codelineno-0-1424">1424</a></span>
<span class="normal"><a href="#__codelineno-0-1425">1425</a></span>
<span class="normal"><a href="#__codelineno-0-1426">1426</a></span>
<span class="normal"><a href="#__codelineno-0-1427">1427</a></span>
<span class="normal"><a href="#__codelineno-0-1428">1428</a></span>
<span class="normal"><a href="#__codelineno-0-1429">1429</a></span>
<span class="normal"><a href="#__codelineno-0-1430">1430</a></span>
<span class="normal"><a href="#__codelineno-0-1431">1431</a></span>
<span class="normal"><a href="#__codelineno-0-1432">1432</a></span>
<span class="normal"><a href="#__codelineno-0-1433">1433</a></span>
<span class="normal"><a href="#__codelineno-0-1434">1434</a></span>
<span class="normal"><a href="#__codelineno-0-1435">1435</a></span>
<span class="normal"><a href="#__codelineno-0-1436">1436</a></span>
<span class="normal"><a href="#__codelineno-0-1437">1437</a></span>
<span class="normal"><a href="#__codelineno-0-1438">1438</a></span>
<span class="normal"><a href="#__codelineno-0-1439">1439</a></span>
<span class="normal"><a href="#__codelineno-0-1440">1440</a></span>
<span class="normal"><a href="#__codelineno-0-1441">1441</a></span>
<span class="normal"><a href="#__codelineno-0-1442">1442</a></span>
<span class="normal"><a href="#__codelineno-0-1443">1443</a></span>
<span class="normal"><a href="#__codelineno-0-1444">1444</a></span>
<span class="normal"><a href="#__codelineno-0-1445">1445</a></span>
<span class="normal"><a href="#__codelineno-0-1446">1446</a></span>
<span class="normal"><a href="#__codelineno-0-1447">1447</a></span>
<span class="normal"><a href="#__codelineno-0-1448">1448</a></span>
<span class="normal"><a href="#__codelineno-0-1449">1449</a></span>
<span class="normal"><a href="#__codelineno-0-1450">1450</a></span>
<span class="normal"><a href="#__codelineno-0-1451">1451</a></span>
<span class="normal"><a href="#__codelineno-0-1452">1452</a></span>
<span class="normal"><a href="#__codelineno-0-1453">1453</a></span>
<span class="normal"><a href="#__codelineno-0-1454">1454</a></span>
<span class="normal"><a href="#__codelineno-0-1455">1455</a></span>
<span class="normal"><a href="#__codelineno-0-1456">1456</a></span>
<span class="normal"><a href="#__codelineno-0-1457">1457</a></span>
<span class="normal"><a href="#__codelineno-0-1458">1458</a></span>
<span class="normal"><a href="#__codelineno-0-1459">1459</a></span>
<span class="normal"><a href="#__codelineno-0-1460">1460</a></span>
<span class="normal"><a href="#__codelineno-0-1461">1461</a></span>
<span class="normal"><a href="#__codelineno-0-1462">1462</a></span>
<span class="normal"><a href="#__codelineno-0-1463">1463</a></span>
<span class="normal"><a href="#__codelineno-0-1464">1464</a></span>
<span class="normal"><a href="#__codelineno-0-1465">1465</a></span>
<span class="normal"><a href="#__codelineno-0-1466">1466</a></span>
<span class="normal"><a href="#__codelineno-0-1467">1467</a></span>
<span class="normal"><a href="#__codelineno-0-1468">1468</a></span>
<span class="normal"><a href="#__codelineno-0-1469">1469</a></span>
<span class="normal"><a href="#__codelineno-0-1470">1470</a></span>
<span class="normal"><a href="#__codelineno-0-1471">1471</a></span>
<span class="normal"><a href="#__codelineno-0-1472">1472</a></span>
<span class="normal"><a href="#__codelineno-0-1473">1473</a></span>
<span class="normal"><a href="#__codelineno-0-1474">1474</a></span>
<span class="normal"><a href="#__codelineno-0-1475">1475</a></span>
<span class="normal"><a href="#__codelineno-0-1476">1476</a></span>
<span class="normal"><a href="#__codelineno-0-1477">1477</a></span>
<span class="normal"><a href="#__codelineno-0-1478">1478</a></span>
<span class="normal"><a href="#__codelineno-0-1479">1479</a></span>
<span class="normal"><a href="#__codelineno-0-1480">1480</a></span>
<span class="normal"><a href="#__codelineno-0-1481">1481</a></span>
<span class="normal"><a href="#__codelineno-0-1482">1482</a></span>
<span class="normal"><a href="#__codelineno-0-1483">1483</a></span>
<span class="normal"><a href="#__codelineno-0-1484">1484</a></span>
<span class="normal"><a href="#__codelineno-0-1485">1485</a></span>
<span class="normal"><a href="#__codelineno-0-1486">1486</a></span>
<span class="normal"><a href="#__codelineno-0-1487">1487</a></span>
<span class="normal"><a href="#__codelineno-0-1488">1488</a></span>
<span class="normal"><a href="#__codelineno-0-1489">1489</a></span>
<span class="normal"><a href="#__codelineno-0-1490">1490</a></span>
<span class="normal"><a href="#__codelineno-0-1491">1491</a></span>
<span class="normal"><a href="#__codelineno-0-1492">1492</a></span>
<span class="normal"><a href="#__codelineno-0-1493">1493</a></span>
<span class="normal"><a href="#__codelineno-0-1494">1494</a></span>
<span class="normal"><a href="#__codelineno-0-1495">1495</a></span>
<span class="normal"><a href="#__codelineno-0-1496">1496</a></span>
<span class="normal"><a href="#__codelineno-0-1497">1497</a></span>
<span class="normal"><a href="#__codelineno-0-1498">1498</a></span>
<span class="normal"><a href="#__codelineno-0-1499">1499</a></span>
<span class="normal"><a href="#__codelineno-0-1500">1500</a></span>
<span class="normal"><a href="#__codelineno-0-1501">1501</a></span>
<span class="normal"><a href="#__codelineno-0-1502">1502</a></span>
<span class="normal"><a href="#__codelineno-0-1503">1503</a></span>
<span class="normal"><a href="#__codelineno-0-1504">1504</a></span>
<span class="normal"><a href="#__codelineno-0-1505">1505</a></span>
<span class="normal"><a href="#__codelineno-0-1506">1506</a></span>
<span class="normal"><a href="#__codelineno-0-1507">1507</a></span>
<span class="normal"><a href="#__codelineno-0-1508">1508</a></span>
<span class="normal"><a href="#__codelineno-0-1509">1509</a></span>
<span class="normal"><a href="#__codelineno-0-1510">1510</a></span>
<span class="normal"><a href="#__codelineno-0-1511">1511</a></span>
<span class="normal"><a href="#__codelineno-0-1512">1512</a></span>
<span class="normal"><a href="#__codelineno-0-1513">1513</a></span>
<span class="normal"><a href="#__codelineno-0-1514">1514</a></span>
<span class="normal"><a href="#__codelineno-0-1515">1515</a></span>
<span class="normal"><a href="#__codelineno-0-1516">1516</a></span>
<span class="normal"><a href="#__codelineno-0-1517">1517</a></span>
<span class="normal"><a href="#__codelineno-0-1518">1518</a></span>
<span class="normal"><a href="#__codelineno-0-1519">1519</a></span>
<span class="normal"><a href="#__codelineno-0-1520">1520</a></span>
<span class="normal"><a href="#__codelineno-0-1521">1521</a></span>
<span class="normal"><a href="#__codelineno-0-1522">1522</a></span>
<span class="normal"><a href="#__codelineno-0-1523">1523</a></span>
<span class="normal"><a href="#__codelineno-0-1524">1524</a></span>
<span class="normal"><a href="#__codelineno-0-1525">1525</a></span>
<span class="normal"><a href="#__codelineno-0-1526">1526</a></span>
<span class="normal"><a href="#__codelineno-0-1527">1527</a></span>
<span class="normal"><a href="#__codelineno-0-1528">1528</a></span>
<span class="normal"><a href="#__codelineno-0-1529">1529</a></span>
<span class="normal"><a href="#__codelineno-0-1530">1530</a></span>
<span class="normal"><a href="#__codelineno-0-1531">1531</a></span>
<span class="normal"><a href="#__codelineno-0-1532">1532</a></span>
<span class="normal"><a href="#__codelineno-0-1533">1533</a></span>
<span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1371" name="__codelineno-0-1371"></a><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-1372" name="__codelineno-0-1372"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;run a command line statement.</span>
<a id="__codelineno-0-1373" name="__codelineno-0-1373"></a>
<a id="__codelineno-0-1374" name="__codelineno-0-1374"></a><span class="sd">    This function runs a single or multiple statements either locally</span>
<a id="__codelineno-0-1375" name="__codelineno-0-1375"></a><span class="sd">    or on the cluster using drmaa. How a statement is executed or how</span>
<a id="__codelineno-0-1376" name="__codelineno-0-1376"></a><span class="sd">    it is modified depends on the context.</span>
<a id="__codelineno-0-1377" name="__codelineno-0-1377"></a>
<a id="__codelineno-0-1378" name="__codelineno-0-1378"></a><span class="sd">    The context is provided by keyword arguments provided as named</span>
<a id="__codelineno-0-1379" name="__codelineno-0-1379"></a><span class="sd">    function arguments (&#39;kwargs&#39;) but also from defaults (see</span>
<a id="__codelineno-0-1380" name="__codelineno-0-1380"></a><span class="sd">    below). The following keyword arguments are recognized:</span>
<a id="__codelineno-0-1381" name="__codelineno-0-1381"></a>
<a id="__codelineno-0-1382" name="__codelineno-0-1382"></a><span class="sd">    job_memory</span>
<a id="__codelineno-0-1383" name="__codelineno-0-1383"></a><span class="sd">        memory to use for the job per thread. Memory specification should be in a</span>
<a id="__codelineno-0-1384" name="__codelineno-0-1384"></a><span class="sd">        format that is accepted by the job scheduler. Note that memory</span>
<a id="__codelineno-0-1385" name="__codelineno-0-1385"></a><span class="sd">        is per thread. If you have 6 threads and the total memory is</span>
<a id="__codelineno-0-1386" name="__codelineno-0-1386"></a><span class="sd">        6Gb, use 1G as job_memory.</span>
<a id="__codelineno-0-1387" name="__codelineno-0-1387"></a><span class="sd">    job_total_memory</span>
<a id="__codelineno-0-1388" name="__codelineno-0-1388"></a><span class="sd">        total memory to use for a job. This will be divided by the number of</span>
<a id="__codelineno-0-1389" name="__codelineno-0-1389"></a><span class="sd">        threads.</span>
<a id="__codelineno-0-1390" name="__codelineno-0-1390"></a><span class="sd">    job_threads</span>
<a id="__codelineno-0-1391" name="__codelineno-0-1391"></a><span class="sd">        number of threads to request for the job.</span>
<a id="__codelineno-0-1392" name="__codelineno-0-1392"></a><span class="sd">    job_options</span>
<a id="__codelineno-0-1393" name="__codelineno-0-1393"></a><span class="sd">        options to the job scheduler.</span>
<a id="__codelineno-0-1394" name="__codelineno-0-1394"></a><span class="sd">    job_condaenv</span>
<a id="__codelineno-0-1395" name="__codelineno-0-1395"></a><span class="sd">        conda environment to use for the job.</span>
<a id="__codelineno-0-1396" name="__codelineno-0-1396"></a><span class="sd">    job_array</span>
<a id="__codelineno-0-1397" name="__codelineno-0-1397"></a><span class="sd">        if set, run statement as an array job. Job_array should be</span>
<a id="__codelineno-0-1398" name="__codelineno-0-1398"></a><span class="sd">        tuple with start, end, and increment.</span>
<a id="__codelineno-0-1399" name="__codelineno-0-1399"></a>
<a id="__codelineno-0-1400" name="__codelineno-0-1400"></a><span class="sd">    In addition, any additional variables will be used to interpolate</span>
<a id="__codelineno-0-1401" name="__codelineno-0-1401"></a><span class="sd">    the command line string using python&#39;s &#39;%&#39; string interpolation</span>
<a id="__codelineno-0-1402" name="__codelineno-0-1402"></a><span class="sd">    operator.</span>
<a id="__codelineno-0-1403" name="__codelineno-0-1403"></a>
<a id="__codelineno-0-1404" name="__codelineno-0-1404"></a><span class="sd">    The context is build in a hierarchical manner with successive</span>
<a id="__codelineno-0-1405" name="__codelineno-0-1405"></a><span class="sd">    operations overwriting previous values.</span>
<a id="__codelineno-0-1406" name="__codelineno-0-1406"></a>
<a id="__codelineno-0-1407" name="__codelineno-0-1407"></a><span class="sd">    1. Global variables</span>
<a id="__codelineno-0-1408" name="__codelineno-0-1408"></a><span class="sd">       The context is initialized</span>
<a id="__codelineno-0-1409" name="__codelineno-0-1409"></a><span class="sd">       with system-wide defaults stored in the global PARAMS</span>
<a id="__codelineno-0-1410" name="__codelineno-0-1410"></a><span class="sd">       singleton.</span>
<a id="__codelineno-0-1411" name="__codelineno-0-1411"></a><span class="sd">    2. Context of caller</span>
<a id="__codelineno-0-1412" name="__codelineno-0-1412"></a><span class="sd">       The context of the calling function is examined</span>
<a id="__codelineno-0-1413" name="__codelineno-0-1413"></a><span class="sd">       and any local variables defined in this context are added.</span>
<a id="__codelineno-0-1414" name="__codelineno-0-1414"></a><span class="sd">    3. kwargs</span>
<a id="__codelineno-0-1415" name="__codelineno-0-1415"></a><span class="sd">       Any options given explicitely as options to the run() method</span>
<a id="__codelineno-0-1416" name="__codelineno-0-1416"></a><span class="sd">       are added.</span>
<a id="__codelineno-0-1417" name="__codelineno-0-1417"></a><span class="sd">    4. params</span>
<a id="__codelineno-0-1418" name="__codelineno-0-1418"></a><span class="sd">       If the context of the calling function contains a params</span>
<a id="__codelineno-0-1419" name="__codelineno-0-1419"></a><span class="sd">       variable, its contents are added to the context. This permits</span>
<a id="__codelineno-0-1420" name="__codelineno-0-1420"></a><span class="sd">       setting variables in configuration files in TaskLibrary</span>
<a id="__codelineno-0-1421" name="__codelineno-0-1421"></a><span class="sd">       functions.</span>
<a id="__codelineno-0-1422" name="__codelineno-0-1422"></a>
<a id="__codelineno-0-1423" name="__codelineno-0-1423"></a><span class="sd">    By default, a job is sent to the cluster, unless:</span>
<a id="__codelineno-0-1424" name="__codelineno-0-1424"></a>
<a id="__codelineno-0-1425" name="__codelineno-0-1425"></a><span class="sd">        * ``to_cluster`` is present and set to None.</span>
<a id="__codelineno-0-1426" name="__codelineno-0-1426"></a>
<a id="__codelineno-0-1427" name="__codelineno-0-1427"></a><span class="sd">        * ``without_cluster`` is True.</span>
<a id="__codelineno-0-1428" name="__codelineno-0-1428"></a>
<a id="__codelineno-0-1429" name="__codelineno-0-1429"></a><span class="sd">        * ``--local`` has been specified on the command line</span>
<a id="__codelineno-0-1430" name="__codelineno-0-1430"></a><span class="sd">          and the option ``without_cluster`` has been set as</span>
<a id="__codelineno-0-1431" name="__codelineno-0-1431"></a><span class="sd">          a result.</span>
<a id="__codelineno-0-1432" name="__codelineno-0-1432"></a>
<a id="__codelineno-0-1433" name="__codelineno-0-1433"></a><span class="sd">        * no libdrmaa is present</span>
<a id="__codelineno-0-1434" name="__codelineno-0-1434"></a>
<a id="__codelineno-0-1435" name="__codelineno-0-1435"></a><span class="sd">        * the global session is not initialized (GLOBAL_SESSION is</span>
<a id="__codelineno-0-1436" name="__codelineno-0-1436"></a><span class="sd">          None)</span>
<a id="__codelineno-0-1437" name="__codelineno-0-1437"></a>
<a id="__codelineno-0-1438" name="__codelineno-0-1438"></a><span class="sd">    Troubleshooting:</span>
<a id="__codelineno-0-1439" name="__codelineno-0-1439"></a>
<a id="__codelineno-0-1440" name="__codelineno-0-1440"></a><span class="sd">       1. DRMAA creates sessions and their is a limited number</span>
<a id="__codelineno-0-1441" name="__codelineno-0-1441"></a><span class="sd">          of sessions available. If there are two many or sessions</span>
<a id="__codelineno-0-1442" name="__codelineno-0-1442"></a><span class="sd">          become not available after failed jobs, use ``qconf -secl``</span>
<a id="__codelineno-0-1443" name="__codelineno-0-1443"></a><span class="sd">          to list sessions and ``qconf -kec #`` to delete sessions.</span>
<a id="__codelineno-0-1444" name="__codelineno-0-1444"></a>
<a id="__codelineno-0-1445" name="__codelineno-0-1445"></a><span class="sd">       2. Memory: 1G of free memory can be requested using the job_memory</span>
<a id="__codelineno-0-1446" name="__codelineno-0-1446"></a><span class="sd">          variable: ``job_memory = &quot;1G&quot;``</span>
<a id="__codelineno-0-1447" name="__codelineno-0-1447"></a><span class="sd">          If there are error messages like &quot;no available queue&quot;, then the</span>
<a id="__codelineno-0-1448" name="__codelineno-0-1448"></a><span class="sd">          problem could be that a particular complex attribute has</span>
<a id="__codelineno-0-1449" name="__codelineno-0-1449"></a><span class="sd">          not been defined (the code should be ``hc`` for ``host:complex``</span>
<a id="__codelineno-0-1450" name="__codelineno-0-1450"></a><span class="sd">          and not ``hl`` for ``host:local``. Note that qrsh/qsub directly</span>
<a id="__codelineno-0-1451" name="__codelineno-0-1451"></a><span class="sd">          still works.</span>
<a id="__codelineno-0-1452" name="__codelineno-0-1452"></a>
<a id="__codelineno-0-1453" name="__codelineno-0-1453"></a><span class="sd">    The job will be executed within PARAMS[&quot;work_dir&quot;], unless</span>
<a id="__codelineno-0-1454" name="__codelineno-0-1454"></a><span class="sd">    PARAMS[&quot;work_dir&quot;] is not local. In that case, the job will</span>
<a id="__codelineno-0-1455" name="__codelineno-0-1455"></a><span class="sd">    be executed in a shared temporary directory.</span>
<a id="__codelineno-0-1456" name="__codelineno-0-1456"></a>
<a id="__codelineno-0-1457" name="__codelineno-0-1457"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-1458" name="__codelineno-0-1458"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-1459" name="__codelineno-0-1459"></a><span class="sd">    statement : string or list of strings</span>
<a id="__codelineno-0-1460" name="__codelineno-0-1460"></a><span class="sd">        A command line statement or a list of command line statements</span>
<a id="__codelineno-0-1461" name="__codelineno-0-1461"></a><span class="sd">        to be executed.</span>
<a id="__codelineno-0-1462" name="__codelineno-0-1462"></a><span class="sd">    kwargs : dictionary</span>
<a id="__codelineno-0-1463" name="__codelineno-0-1463"></a><span class="sd">        Context for job. The context is used to interpolate the command</span>
<a id="__codelineno-0-1464" name="__codelineno-0-1464"></a><span class="sd">        line statement.</span>
<a id="__codelineno-0-1465" name="__codelineno-0-1465"></a>
<a id="__codelineno-0-1466" name="__codelineno-0-1466"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1467" name="__codelineno-0-1467"></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">()</span>
<a id="__codelineno-0-1468" name="__codelineno-0-1468"></a>
<a id="__codelineno-0-1469" name="__codelineno-0-1469"></a>    <span class="c1"># Combine options using priority</span>
<a id="__codelineno-0-1470" name="__codelineno-0-1470"></a>    <span class="n">options</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">get_params</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
<a id="__codelineno-0-1471" name="__codelineno-0-1471"></a>    <span class="n">caller_options</span> <span class="o">=</span> <span class="n">get_caller_locals</span><span class="p">()</span>
<a id="__codelineno-0-1472" name="__codelineno-0-1472"></a>    <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">caller_options</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
<a id="__codelineno-0-1473" name="__codelineno-0-1473"></a>
<a id="__codelineno-0-1474" name="__codelineno-0-1474"></a>    <span class="k">if</span> <span class="s2">&quot;self&quot;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
<a id="__codelineno-0-1475" name="__codelineno-0-1475"></a>        <span class="k">del</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;self&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1476" name="__codelineno-0-1476"></a>    <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
<a id="__codelineno-0-1477" name="__codelineno-0-1477"></a>
<a id="__codelineno-0-1478" name="__codelineno-0-1478"></a>    <span class="c1"># Inject params named tuple from TaskLibrary functions into option</span>
<a id="__codelineno-0-1479" name="__codelineno-0-1479"></a>    <span class="c1"># dict. This allows overriding options set in the code with options set</span>
<a id="__codelineno-0-1480" name="__codelineno-0-1480"></a>    <span class="c1"># in a .yml file</span>
<a id="__codelineno-0-1481" name="__codelineno-0-1481"></a>    <span class="k">if</span> <span class="s2">&quot;params&quot;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
<a id="__codelineno-0-1482" name="__codelineno-0-1482"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1483" name="__codelineno-0-1483"></a>            <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">_asdict</span><span class="p">())</span>
<a id="__codelineno-0-1484" name="__codelineno-0-1484"></a>        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
<a id="__codelineno-0-1485" name="__codelineno-0-1485"></a>            <span class="k">pass</span>
<a id="__codelineno-0-1486" name="__codelineno-0-1486"></a>
<a id="__codelineno-0-1487" name="__codelineno-0-1487"></a>    <span class="c1"># Insert parameters supplied through simplified interface such</span>
<a id="__codelineno-0-1488" name="__codelineno-0-1488"></a>    <span class="c1"># as job_memory, job_options, job_queue</span>
<a id="__codelineno-0-1489" name="__codelineno-0-1489"></a>    <span class="n">options</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">][</span><span class="s1">&#39;options&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-1490" name="__codelineno-0-1490"></a>        <span class="s1">&#39;job_options&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">][</span><span class="s1">&#39;options&#39;</span><span class="p">])</span>
<a id="__codelineno-0-1491" name="__codelineno-0-1491"></a>    <span class="n">options</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">][</span><span class="s1">&#39;queue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-1492" name="__codelineno-0-1492"></a>        <span class="s1">&#39;job_queue&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">][</span><span class="s1">&#39;queue&#39;</span><span class="p">])</span>
<a id="__codelineno-0-1493" name="__codelineno-0-1493"></a>    <span class="n">options</span><span class="p">[</span><span class="s1">&#39;without_cluster&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;without_cluster&#39;</span><span class="p">)</span>
<a id="__codelineno-0-1494" name="__codelineno-0-1494"></a>
<a id="__codelineno-0-1495" name="__codelineno-0-1495"></a>    <span class="c1"># SGE compatible job_name</span>
<a id="__codelineno-0-1496" name="__codelineno-0-1496"></a>    <span class="n">name_substrate</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;outfile&quot;</span><span class="p">,</span> <span class="s2">&quot;cgatcore&quot;</span><span class="p">))</span>
<a id="__codelineno-0-1497" name="__codelineno-0-1497"></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">name_substrate</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1498" name="__codelineno-0-1498"></a>        <span class="n">name_substrate</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">name_substrate</span><span class="p">))</span>
<a id="__codelineno-0-1499" name="__codelineno-0-1499"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1500" name="__codelineno-0-1500"></a>        <span class="n">name_substrate</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">name_substrate</span><span class="p">)</span>
<a id="__codelineno-0-1501" name="__codelineno-0-1501"></a>
<a id="__codelineno-0-1502" name="__codelineno-0-1502"></a>    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;job_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;[:]&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">name_substrate</span><span class="p">)</span>
<a id="__codelineno-0-1503" name="__codelineno-0-1503"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1504" name="__codelineno-0-1504"></a>        <span class="n">calling_module</span> <span class="o">=</span> <span class="n">get_caller</span><span class="p">()</span><span class="o">.</span><span class="vm">__name__</span>
<a id="__codelineno-0-1505" name="__codelineno-0-1505"></a>    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
<a id="__codelineno-0-1506" name="__codelineno-0-1506"></a>        <span class="n">calling_module</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
<a id="__codelineno-0-1507" name="__codelineno-0-1507"></a>
<a id="__codelineno-0-1508" name="__codelineno-0-1508"></a>    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;task_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calling_module</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">get_calling_function</span><span class="p">()</span>
<a id="__codelineno-0-1509" name="__codelineno-0-1509"></a>
<a id="__codelineno-0-1510" name="__codelineno-0-1510"></a>    <span class="c1"># Build statements using parameter interpolation</span>
<a id="__codelineno-0-1511" name="__codelineno-0-1511"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-1512" name="__codelineno-0-1512"></a>        <span class="n">statement_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">interpolate_statement</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span> <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">statement</span><span class="p">]</span>
<a id="__codelineno-0-1513" name="__codelineno-0-1513"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1514" name="__codelineno-0-1514"></a>        <span class="n">statement_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">interpolate_statement</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">options</span><span class="p">)]</span>
<a id="__codelineno-0-1515" name="__codelineno-0-1515"></a>
<a id="__codelineno-0-1516" name="__codelineno-0-1516"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">statement_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1517" name="__codelineno-0-1517"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No statements found - no execution&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1518" name="__codelineno-0-1518"></a>        <span class="k">return</span> <span class="p">[]</span>
<a id="__codelineno-0-1519" name="__codelineno-0-1519"></a>
<a id="__codelineno-0-1520" name="__codelineno-0-1520"></a>    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dryrun&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-1521" name="__codelineno-0-1521"></a>        <span class="k">for</span> <span class="n">statement</span> <span class="ow">in</span> <span class="n">statement_list</span><span class="p">:</span>
<a id="__codelineno-0-1522" name="__codelineno-0-1522"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dry-run: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">statement</span><span class="p">))</span>
<a id="__codelineno-0-1523" name="__codelineno-0-1523"></a>        <span class="k">return</span> <span class="p">[]</span>
<a id="__codelineno-0-1524" name="__codelineno-0-1524"></a>
<a id="__codelineno-0-1525" name="__codelineno-0-1525"></a>    <span class="c1"># Use get_executor to get the appropriate executor</span>
<a id="__codelineno-0-1526" name="__codelineno-0-1526"></a>    <span class="n">executor</span> <span class="o">=</span> <span class="n">get_executor</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>  <span class="c1"># Updated to use get_executor</span>
<a id="__codelineno-0-1527" name="__codelineno-0-1527"></a>
<a id="__codelineno-0-1528" name="__codelineno-0-1528"></a>    <span class="c1"># Execute statement list within the context of the executor</span>
<a id="__codelineno-0-1529" name="__codelineno-0-1529"></a>    <span class="k">with</span> <span class="n">executor</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1530" name="__codelineno-0-1530"></a>        <span class="n">benchmark_data</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">statement_list</span><span class="p">)</span>
<a id="__codelineno-0-1531" name="__codelineno-0-1531"></a>
<a id="__codelineno-0-1532" name="__codelineno-0-1532"></a>    <span class="c1"># Log benchmark data</span>
<a id="__codelineno-0-1533" name="__codelineno-0-1533"></a>    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">benchmark_data</span><span class="p">:</span>
<a id="__codelineno-0-1534" name="__codelineno-0-1534"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<a id="__codelineno-0-1535" name="__codelineno-0-1535"></a>
<a id="__codelineno-0-1536" name="__codelineno-0-1536"></a>    <span class="n">BenchmarkData</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;BenchmarkData&#39;</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">benchmark_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<a id="__codelineno-0-1537" name="__codelineno-0-1537"></a>    <span class="k">return</span> <span class="p">[</span><span class="n">BenchmarkData</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">benchmark_data</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.run_pickled" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_pickled</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.run_pickled" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>run a function whose arguments have been pickled.</p>
<p>expects that params is [module_name, function_name, arguments_file]</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1655">1655</a></span>
<span class="normal"><a href="#__codelineno-0-1656">1656</a></span>
<span class="normal"><a href="#__codelineno-0-1657">1657</a></span>
<span class="normal"><a href="#__codelineno-0-1658">1658</a></span>
<span class="normal"><a href="#__codelineno-0-1659">1659</a></span>
<span class="normal"><a href="#__codelineno-0-1660">1660</a></span>
<span class="normal"><a href="#__codelineno-0-1661">1661</a></span>
<span class="normal"><a href="#__codelineno-0-1662">1662</a></span>
<span class="normal"><a href="#__codelineno-0-1663">1663</a></span>
<span class="normal"><a href="#__codelineno-0-1664">1664</a></span>
<span class="normal"><a href="#__codelineno-0-1665">1665</a></span>
<span class="normal"><a href="#__codelineno-0-1666">1666</a></span>
<span class="normal"><a href="#__codelineno-0-1667">1667</a></span>
<span class="normal"><a href="#__codelineno-0-1668">1668</a></span>
<span class="normal"><a href="#__codelineno-0-1669">1669</a></span>
<span class="normal"><a href="#__codelineno-0-1670">1670</a></span>
<span class="normal"><a href="#__codelineno-0-1671">1671</a></span>
<span class="normal"><a href="#__codelineno-0-1672">1672</a></span>
<span class="normal"><a href="#__codelineno-0-1673">1673</a></span>
<span class="normal"><a href="#__codelineno-0-1674">1674</a></span>
<span class="normal"><a href="#__codelineno-0-1675">1675</a></span>
<span class="normal"><a href="#__codelineno-0-1676">1676</a></span>
<span class="normal"><a href="#__codelineno-0-1677">1677</a></span>
<span class="normal"><a href="#__codelineno-0-1678">1678</a></span>
<span class="normal"><a href="#__codelineno-0-1679">1679</a></span>
<span class="normal"><a href="#__codelineno-0-1680">1680</a></span>
<span class="normal"><a href="#__codelineno-0-1681">1681</a></span>
<span class="normal"><a href="#__codelineno-0-1682">1682</a></span>
<span class="normal"><a href="#__codelineno-0-1683">1683</a></span>
<span class="normal"><a href="#__codelineno-0-1684">1684</a></span>
<span class="normal"><a href="#__codelineno-0-1685">1685</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1655" name="__codelineno-0-1655"></a><span class="k">def</span><span class="w"> </span><span class="nf">run_pickled</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
<a id="__codelineno-0-1656" name="__codelineno-0-1656"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39; run a function whose arguments have been pickled.</span>
<a id="__codelineno-0-1657" name="__codelineno-0-1657"></a>
<a id="__codelineno-0-1658" name="__codelineno-0-1658"></a><span class="sd">    expects that params is [module_name, function_name, arguments_file] &#39;&#39;&#39;</span>
<a id="__codelineno-0-1659" name="__codelineno-0-1659"></a>
<a id="__codelineno-0-1660" name="__codelineno-0-1660"></a>    <span class="n">module_name</span><span class="p">,</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">args_file</span> <span class="o">=</span> <span class="n">params</span>
<a id="__codelineno-0-1661" name="__codelineno-0-1661"></a>    <span class="n">location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
<a id="__codelineno-0-1662" name="__codelineno-0-1662"></a>    <span class="k">if</span> <span class="n">location</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1663" name="__codelineno-0-1663"></a>        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>
<a id="__codelineno-0-1664" name="__codelineno-0-1664"></a>
<a id="__codelineno-0-1665" name="__codelineno-0-1665"></a>    <span class="n">module_base_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
<a id="__codelineno-0-1666" name="__codelineno-0-1666"></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">()</span>
<a id="__codelineno-0-1667" name="__codelineno-0-1667"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;importing module &#39;</span><span class="si">%s</span><span class="s2">&#39; &quot;</span> <span class="o">%</span> <span class="n">module_base_name</span><span class="p">)</span>
<a id="__codelineno-0-1668" name="__codelineno-0-1668"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;sys.path is: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
<a id="__codelineno-0-1669" name="__codelineno-0-1669"></a>
<a id="__codelineno-0-1670" name="__codelineno-0-1670"></a>    <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">module_base_name</span><span class="p">)</span>
<a id="__codelineno-0-1671" name="__codelineno-0-1671"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1672" name="__codelineno-0-1672"></a>        <span class="n">function</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">func_name</span><span class="p">)</span>
<a id="__codelineno-0-1673" name="__codelineno-0-1673"></a>    <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
<a id="__codelineno-0-1674" name="__codelineno-0-1674"></a>        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">message</span>
<a id="__codelineno-0-1675" name="__codelineno-0-1675"></a>                             <span class="o">+</span> <span class="s2">&quot;unknown function, available functions are: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
<a id="__codelineno-0-1676" name="__codelineno-0-1676"></a>                             <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
<a id="__codelineno-0-1677" name="__codelineno-0-1677"></a>                                       <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)]))</span>
<a id="__codelineno-0-1678" name="__codelineno-0-1678"></a>
<a id="__codelineno-0-1679" name="__codelineno-0-1679"></a>    <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">args_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
<a id="__codelineno-0-1680" name="__codelineno-0-1680"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;arguments = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
<a id="__codelineno-0-1681" name="__codelineno-0-1681"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;keyword arguments = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span>
<a id="__codelineno-0-1682" name="__codelineno-0-1682"></a>
<a id="__codelineno-0-1683" name="__codelineno-0-1683"></a>    <span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-1684" name="__codelineno-0-1684"></a>
<a id="__codelineno-0-1685" name="__codelineno-0-1685"></a>    <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">args_file</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.shellquote" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">shellquote</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.shellquote" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>shell quote a string to be used as a function argument.</p>
<p>from http://stackoverflow.com/questions/967443/
python-module-to-shellquote-unshellquote</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="k">def</span><span class="w"> </span><span class="nf">shellquote</span><span class="p">(</span><span class="n">statement</span><span class="p">):</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;shell quote a string to be used as a function argument.</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">    from http://stackoverflow.com/questions/967443/</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">    python-module-to-shellquote-unshellquote</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>    <span class="n">_quote_pos</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(?=[^-0-9a-zA-Z_./</span><span class="se">\n</span><span class="s1">])&#39;</span><span class="p">)</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>    <span class="k">if</span> <span class="n">statement</span><span class="p">:</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="k">return</span> <span class="n">_quote_pos</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">statement</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;</span><span class="se">\n</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>        <span class="k">return</span> <span class="s2">&quot;&#39;&#39;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.snip" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">snip</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alt_extension</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">strip_path</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.snip" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>return prefix of <code>filename</code>, that is the part without the
extension.</p>
<p>If <code>extension</code> is given, make sure that filename has the
extension (or <code>alt_extension</code>). Both extension or alt_extension
can be list of extensions.</p>
<p>If <code>strip_path</code> is set to true, the path is stripped from the file
name.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/iotools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-490" name="__codelineno-0-490"></a><span class="k">def</span><span class="w"> </span><span class="nf">snip</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alt_extension</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>         <span class="n">strip_path</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;return prefix of `filename`, that is the part without the</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a><span class="sd">    extension.</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a><span class="sd">    If `extension` is given, make sure that filename has the</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a><span class="sd">    extension (or `alt_extension`). Both extension or alt_extension</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a><span class="sd">    can be list of extensions.</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a><span class="sd">    If `strip_path` is set to true, the path is stripped from the file</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="sd">    name.</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>    <span class="k">if</span> <span class="n">extension</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>        <span class="n">extension</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">extension</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>        <span class="n">extension</span> <span class="o">=</span> <span class="p">[</span><span class="n">extension</span><span class="p">]</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>    <span class="k">if</span> <span class="n">alt_extension</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>        <span class="n">alt_extension</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alt_extension</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>        <span class="n">alt_extension</span> <span class="o">=</span> <span class="p">[</span><span class="n">alt_extension</span><span class="p">]</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>    <span class="k">if</span> <span class="n">extension</span><span class="p">:</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>        <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">extension</span> <span class="o">+</span> <span class="n">alt_extension</span><span class="p">:</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>            <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">ext</span><span class="p">):</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>                <span class="n">root</span> <span class="o">=</span> <span class="n">filename</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ext</span><span class="p">)]</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>                <span class="k">break</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; expected to end in &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>                             <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>                                 <span class="n">extension</span> <span class="o">+</span> <span class="n">alt_extension</span><span class="p">)))</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>        <span class="n">root</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>    <span class="k">if</span> <span class="n">strip_path</span><span class="p">:</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>        <span class="n">snipped</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>        <span class="n">snipped</span> <span class="o">=</span> <span class="n">root</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>    <span class="k">return</span> <span class="n">snipped</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.start_session" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">start_session</span><span class="p">()</span></code>

<a href="#cgatcore.pipeline.start_session" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>start and initialize the global DRMAA session.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="k">def</span><span class="w"> </span><span class="nf">start_session</span><span class="p">():</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;start and initialize the global DRMAA session.&quot;&quot;&quot;</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>    <span class="k">global</span> <span class="n">GLOBAL_SESSION</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>    <span class="k">if</span> <span class="n">HAS_DRMAA</span> <span class="ow">and</span> <span class="n">GLOBAL_SESSION</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="n">GLOBAL_SESSION</span> <span class="o">=</span> <span class="n">drmaa</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>            <span class="n">GLOBAL_SESSION</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="k">except</span> <span class="n">drmaa</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">InternalException</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>            <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;could not initialize global drmaa session: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>                <span class="n">ex</span><span class="p">))</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>            <span class="n">GLOBAL_SESSION</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>        <span class="k">return</span> <span class="n">GLOBAL_SESSION</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.submit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">submit</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">infiles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outfiles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">to_cluster</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">job_options</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">job_threads</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">job_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.submit" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>submit a python <em>function</em> as a job to the cluster.</p>
<p>This method runs the script :file:<code>run_function</code> using the
:func:<code>run</code> method in this module thus providing the same
control options as for command line tools.</p>
<h4 id="cgatcore.pipeline.submit--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.submit--arguments" title="Permanent link">&para;</a></h4>
<p>module : string
    Module name that contains the function. If <code>module</code> is
    not part of the PYTHONPATH, an absolute path can be given.
function : string
    Name of function to execute
infiles : string or list
    Filenames of input data
outfiles : string or list
    Filenames of output data
logfile : filename
    Logfile to provide to the <code>--log</code> option
job_options : string
    String for generic job options for the queuing system
job_threads : int
    Number of slots (threads/cores/CPU) to use for the task
job_memory : string
    Amount of memory to reserve for the job.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span>
<span class="normal"><a href="#__codelineno-0-1547">1547</a></span>
<span class="normal"><a href="#__codelineno-0-1548">1548</a></span>
<span class="normal"><a href="#__codelineno-0-1549">1549</a></span>
<span class="normal"><a href="#__codelineno-0-1550">1550</a></span>
<span class="normal"><a href="#__codelineno-0-1551">1551</a></span>
<span class="normal"><a href="#__codelineno-0-1552">1552</a></span>
<span class="normal"><a href="#__codelineno-0-1553">1553</a></span>
<span class="normal"><a href="#__codelineno-0-1554">1554</a></span>
<span class="normal"><a href="#__codelineno-0-1555">1555</a></span>
<span class="normal"><a href="#__codelineno-0-1556">1556</a></span>
<span class="normal"><a href="#__codelineno-0-1557">1557</a></span>
<span class="normal"><a href="#__codelineno-0-1558">1558</a></span>
<span class="normal"><a href="#__codelineno-0-1559">1559</a></span>
<span class="normal"><a href="#__codelineno-0-1560">1560</a></span>
<span class="normal"><a href="#__codelineno-0-1561">1561</a></span>
<span class="normal"><a href="#__codelineno-0-1562">1562</a></span>
<span class="normal"><a href="#__codelineno-0-1563">1563</a></span>
<span class="normal"><a href="#__codelineno-0-1564">1564</a></span>
<span class="normal"><a href="#__codelineno-0-1565">1565</a></span>
<span class="normal"><a href="#__codelineno-0-1566">1566</a></span>
<span class="normal"><a href="#__codelineno-0-1567">1567</a></span>
<span class="normal"><a href="#__codelineno-0-1568">1568</a></span>
<span class="normal"><a href="#__codelineno-0-1569">1569</a></span>
<span class="normal"><a href="#__codelineno-0-1570">1570</a></span>
<span class="normal"><a href="#__codelineno-0-1571">1571</a></span>
<span class="normal"><a href="#__codelineno-0-1572">1572</a></span>
<span class="normal"><a href="#__codelineno-0-1573">1573</a></span>
<span class="normal"><a href="#__codelineno-0-1574">1574</a></span>
<span class="normal"><a href="#__codelineno-0-1575">1575</a></span>
<span class="normal"><a href="#__codelineno-0-1576">1576</a></span>
<span class="normal"><a href="#__codelineno-0-1577">1577</a></span>
<span class="normal"><a href="#__codelineno-0-1578">1578</a></span>
<span class="normal"><a href="#__codelineno-0-1579">1579</a></span>
<span class="normal"><a href="#__codelineno-0-1580">1580</a></span>
<span class="normal"><a href="#__codelineno-0-1581">1581</a></span>
<span class="normal"><a href="#__codelineno-0-1582">1582</a></span>
<span class="normal"><a href="#__codelineno-0-1583">1583</a></span>
<span class="normal"><a href="#__codelineno-0-1584">1584</a></span>
<span class="normal"><a href="#__codelineno-0-1585">1585</a></span>
<span class="normal"><a href="#__codelineno-0-1586">1586</a></span>
<span class="normal"><a href="#__codelineno-0-1587">1587</a></span>
<span class="normal"><a href="#__codelineno-0-1588">1588</a></span>
<span class="normal"><a href="#__codelineno-0-1589">1589</a></span>
<span class="normal"><a href="#__codelineno-0-1590">1590</a></span>
<span class="normal"><a href="#__codelineno-0-1591">1591</a></span>
<span class="normal"><a href="#__codelineno-0-1592">1592</a></span>
<span class="normal"><a href="#__codelineno-0-1593">1593</a></span>
<span class="normal"><a href="#__codelineno-0-1594">1594</a></span>
<span class="normal"><a href="#__codelineno-0-1595">1595</a></span>
<span class="normal"><a href="#__codelineno-0-1596">1596</a></span>
<span class="normal"><a href="#__codelineno-0-1597">1597</a></span>
<span class="normal"><a href="#__codelineno-0-1598">1598</a></span>
<span class="normal"><a href="#__codelineno-0-1599">1599</a></span>
<span class="normal"><a href="#__codelineno-0-1600">1600</a></span>
<span class="normal"><a href="#__codelineno-0-1601">1601</a></span>
<span class="normal"><a href="#__codelineno-0-1602">1602</a></span>
<span class="normal"><a href="#__codelineno-0-1603">1603</a></span>
<span class="normal"><a href="#__codelineno-0-1604">1604</a></span>
<span class="normal"><a href="#__codelineno-0-1605">1605</a></span>
<span class="normal"><a href="#__codelineno-0-1606">1606</a></span>
<span class="normal"><a href="#__codelineno-0-1607">1607</a></span>
<span class="normal"><a href="#__codelineno-0-1608">1608</a></span>
<span class="normal"><a href="#__codelineno-0-1609">1609</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1540" name="__codelineno-0-1540"></a><span class="k">def</span><span class="w"> </span><span class="nf">submit</span><span class="p">(</span><span class="n">module</span><span class="p">,</span>
<a id="__codelineno-0-1541" name="__codelineno-0-1541"></a>           <span class="n">function</span><span class="p">,</span>
<a id="__codelineno-0-1542" name="__codelineno-0-1542"></a>           <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1543" name="__codelineno-0-1543"></a>           <span class="n">infiles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1544" name="__codelineno-0-1544"></a>           <span class="n">outfiles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1545" name="__codelineno-0-1545"></a>           <span class="n">to_cluster</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1546" name="__codelineno-0-1546"></a>           <span class="n">logfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1547" name="__codelineno-0-1547"></a>           <span class="n">job_options</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1548" name="__codelineno-0-1548"></a>           <span class="n">job_threads</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1549" name="__codelineno-0-1549"></a>           <span class="n">job_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-1550" name="__codelineno-0-1550"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;submit a python *function* as a job to the cluster.</span>
<a id="__codelineno-0-1551" name="__codelineno-0-1551"></a>
<a id="__codelineno-0-1552" name="__codelineno-0-1552"></a><span class="sd">    This method runs the script :file:`run_function` using the</span>
<a id="__codelineno-0-1553" name="__codelineno-0-1553"></a><span class="sd">    :func:`run` method in this module thus providing the same</span>
<a id="__codelineno-0-1554" name="__codelineno-0-1554"></a><span class="sd">    control options as for command line tools.</span>
<a id="__codelineno-0-1555" name="__codelineno-0-1555"></a>
<a id="__codelineno-0-1556" name="__codelineno-0-1556"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-1557" name="__codelineno-0-1557"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-1558" name="__codelineno-0-1558"></a><span class="sd">    module : string</span>
<a id="__codelineno-0-1559" name="__codelineno-0-1559"></a><span class="sd">        Module name that contains the function. If `module` is</span>
<a id="__codelineno-0-1560" name="__codelineno-0-1560"></a><span class="sd">        not part of the PYTHONPATH, an absolute path can be given.</span>
<a id="__codelineno-0-1561" name="__codelineno-0-1561"></a><span class="sd">    function : string</span>
<a id="__codelineno-0-1562" name="__codelineno-0-1562"></a><span class="sd">        Name of function to execute</span>
<a id="__codelineno-0-1563" name="__codelineno-0-1563"></a><span class="sd">    infiles : string or list</span>
<a id="__codelineno-0-1564" name="__codelineno-0-1564"></a><span class="sd">        Filenames of input data</span>
<a id="__codelineno-0-1565" name="__codelineno-0-1565"></a><span class="sd">    outfiles : string or list</span>
<a id="__codelineno-0-1566" name="__codelineno-0-1566"></a><span class="sd">        Filenames of output data</span>
<a id="__codelineno-0-1567" name="__codelineno-0-1567"></a><span class="sd">    logfile : filename</span>
<a id="__codelineno-0-1568" name="__codelineno-0-1568"></a><span class="sd">        Logfile to provide to the ``--log`` option</span>
<a id="__codelineno-0-1569" name="__codelineno-0-1569"></a><span class="sd">    job_options : string</span>
<a id="__codelineno-0-1570" name="__codelineno-0-1570"></a><span class="sd">        String for generic job options for the queuing system</span>
<a id="__codelineno-0-1571" name="__codelineno-0-1571"></a><span class="sd">    job_threads : int</span>
<a id="__codelineno-0-1572" name="__codelineno-0-1572"></a><span class="sd">        Number of slots (threads/cores/CPU) to use for the task</span>
<a id="__codelineno-0-1573" name="__codelineno-0-1573"></a><span class="sd">    job_memory : string</span>
<a id="__codelineno-0-1574" name="__codelineno-0-1574"></a><span class="sd">        Amount of memory to reserve for the job.</span>
<a id="__codelineno-0-1575" name="__codelineno-0-1575"></a>
<a id="__codelineno-0-1576" name="__codelineno-0-1576"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-1577" name="__codelineno-0-1577"></a>
<a id="__codelineno-0-1578" name="__codelineno-0-1578"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">job_memory</span><span class="p">:</span>
<a id="__codelineno-0-1579" name="__codelineno-0-1579"></a>        <span class="n">job_memory</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cluster_memory_default&quot;</span><span class="p">,</span> <span class="s2">&quot;2G&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1580" name="__codelineno-0-1580"></a>
<a id="__codelineno-0-1581" name="__codelineno-0-1581"></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">infiles</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
<a id="__codelineno-0-1582" name="__codelineno-0-1582"></a>        <span class="n">infiles</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;--input=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">infiles</span><span class="p">])</span>
<a id="__codelineno-0-1583" name="__codelineno-0-1583"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1584" name="__codelineno-0-1584"></a>        <span class="n">infiles</span> <span class="o">=</span> <span class="s2">&quot;--input=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">infiles</span>
<a id="__codelineno-0-1585" name="__codelineno-0-1585"></a>
<a id="__codelineno-0-1586" name="__codelineno-0-1586"></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">outfiles</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
<a id="__codelineno-0-1587" name="__codelineno-0-1587"></a>        <span class="n">outfiles</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;--output-section=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">outfiles</span><span class="p">])</span>
<a id="__codelineno-0-1588" name="__codelineno-0-1588"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1589" name="__codelineno-0-1589"></a>        <span class="n">outfiles</span> <span class="o">=</span> <span class="s2">&quot;--output-section=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">outfiles</span>
<a id="__codelineno-0-1590" name="__codelineno-0-1590"></a>
<a id="__codelineno-0-1591" name="__codelineno-0-1591"></a>    <span class="k">if</span> <span class="n">logfile</span><span class="p">:</span>
<a id="__codelineno-0-1592" name="__codelineno-0-1592"></a>        <span class="n">logfile</span> <span class="o">=</span> <span class="s2">&quot;--log=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">logfile</span>
<a id="__codelineno-0-1593" name="__codelineno-0-1593"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1594" name="__codelineno-0-1594"></a>        <span class="n">logfile</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-1595" name="__codelineno-0-1595"></a>
<a id="__codelineno-0-1596" name="__codelineno-0-1596"></a>    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
<a id="__codelineno-0-1597" name="__codelineno-0-1597"></a>        <span class="n">args</span> <span class="o">=</span> <span class="s2">&quot;--args=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<a id="__codelineno-0-1598" name="__codelineno-0-1598"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1599" name="__codelineno-0-1599"></a>        <span class="n">args</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-1600" name="__codelineno-0-1600"></a>
<a id="__codelineno-0-1601" name="__codelineno-0-1601"></a>    <span class="n">statement</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1602" name="__codelineno-0-1602"></a>        <span class="s2">&quot;python -m cgatcore.pipeline.run_function &quot;</span>
<a id="__codelineno-0-1603" name="__codelineno-0-1603"></a>        <span class="s2">&quot;--module=</span><span class="si">%(module)s</span><span class="s2"> &quot;</span>
<a id="__codelineno-0-1604" name="__codelineno-0-1604"></a>        <span class="s2">&quot;--function=</span><span class="si">%(function)s</span><span class="s2"> &quot;</span>
<a id="__codelineno-0-1605" name="__codelineno-0-1605"></a>        <span class="s2">&quot;</span><span class="si">%(logfile)s</span><span class="s2"> &quot;</span>
<a id="__codelineno-0-1606" name="__codelineno-0-1606"></a>        <span class="s2">&quot;</span><span class="si">%(infiles)s</span><span class="s2"> &quot;</span>
<a id="__codelineno-0-1607" name="__codelineno-0-1607"></a>        <span class="s2">&quot;</span><span class="si">%(outfiles)s</span><span class="s2"> &quot;</span>
<a id="__codelineno-0-1608" name="__codelineno-0-1608"></a>        <span class="s2">&quot;</span><span class="si">%(args)s</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1609" name="__codelineno-0-1609"></a>    <span class="n">run</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.substitute_parameters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">substitute_parameters</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.substitute_parameters" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>return a parameter dictionary.</p>
<p>This method builds a dictionary of parameter values to
apply for a specific task. The dictionary is built in
the following order:</p>
<ol>
<li>take values from the global dictionary (:py:data:<code>PARAMS</code>)</li>
<li>substitute values appearing in <code>kwargs</code>.</li>
<li>Apply task specific configuration values by looking for the
   presence of <code>outfile</code> in kwargs.</li>
</ol>
<p>The substition of task specific values works by looking for any
parameter values starting with the value of <code>outfile</code>.  The
suffix of the parameter value will then be substituted.</p>
<p>For example::</p>
<div class="codehilite"><pre><span></span><code>PARAMS = {&quot;tophat_threads&quot;: 4,
          &quot;tophat_cutoff&quot;: 0.5,
          &quot;sample1.bam.gz_tophat_threads&quot; : 6}
outfile = &quot;sample1.bam.gz&quot;
print(substitute_parameters(**locals()))
{&quot;tophat_cutoff&quot;: 0.5, &quot;tophat_threads&quot;: 6}
</code></pre></div>

<h4 id="cgatcore.pipeline.substitute_parameters--returns">Returns<a class="headerlink" href="#cgatcore.pipeline.substitute_parameters--returns" title="Permanent link">&para;</a></h4>
<p>params : dict
    Dictionary with parameter values.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/parameters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="k">def</span><span class="w"> </span><span class="nf">substitute_parameters</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;return a parameter dictionary.</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="sd">    This method builds a dictionary of parameter values to</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a><span class="sd">    apply for a specific task. The dictionary is built in</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a><span class="sd">    the following order:</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a><span class="sd">    1. take values from the global dictionary (:py:data:`PARAMS`)</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a><span class="sd">    2. substitute values appearing in `kwargs`.</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a><span class="sd">    3. Apply task specific configuration values by looking for the</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a><span class="sd">       presence of ``outfile`` in kwargs.</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a><span class="sd">    The substition of task specific values works by looking for any</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="sd">    parameter values starting with the value of ``outfile``.  The</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a><span class="sd">    suffix of the parameter value will then be substituted.</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="sd">    For example::</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">        PARAMS = {&quot;tophat_threads&quot;: 4,</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">                  &quot;tophat_cutoff&quot;: 0.5,</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="sd">                  &quot;sample1.bam.gz_tophat_threads&quot; : 6}</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="sd">        outfile = &quot;sample1.bam.gz&quot;</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a><span class="sd">        print(substitute_parameters(**locals()))</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">        {&quot;tophat_cutoff&quot;: 0.5, &quot;tophat_threads&quot;: 6}</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a><span class="sd">    -------</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="sd">    params : dict</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="sd">        Dictionary with parameter values.</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>    <span class="c1"># build parameter dictionary</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>    <span class="c1"># note the order of addition to make sure that kwargs takes precedence</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>    <span class="n">local_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">PARAMS</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>    <span class="k">if</span> <span class="s2">&quot;outfile&quot;</span> <span class="ow">in</span> <span class="n">local_params</span><span class="p">:</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>        <span class="c1"># replace specific parameters with task (outfile) specific parameters</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>        <span class="n">outfile</span> <span class="o">=</span> <span class="n">local_params</span><span class="p">[</span><span class="s2">&quot;outfile&quot;</span><span class="p">]</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">local_params</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>            <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">outfile</span><span class="p">):</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>                <span class="n">p</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>                <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">local_params</span><span class="p">:</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>                    <span class="c1"># do not raise error, argument might be a prefix</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>                <span class="n">get_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;substituting task specific parameter &quot;</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>                                 <span class="s2">&quot;for </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>                                 <span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">local_params</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>                <span class="n">local_params</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">local_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>    <span class="k">return</span> <span class="n">local_params</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.tablequote" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tablequote</span><span class="p">(</span><span class="n">track</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.tablequote" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>quote a track name such that is suitable as a table name.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="k">def</span><span class="w"> </span><span class="nf">tablequote</span><span class="p">(</span><span class="n">track</span><span class="p">):</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;quote a track name such that is suitable as a table name.&#39;&#39;&#39;</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[-(),\[\].]&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">track</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.to_table" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_table</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.to_table" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>convert a filename from a load statement into a table name.</p>
<p>This method checks if the filename ends with ".load". The suffix
is then removed and the filename quoted so that it is suitable
as a table name.</p>
<h4 id="cgatcore.pipeline.to_table--arguments">Arguments<a class="headerlink" href="#cgatcore.pipeline.to_table--arguments" title="Permanent link">&para;</a></h4>
<p>outfile : string
    A filename ending in ".load".</p>
<h4 id="cgatcore.pipeline.to_table--returns">Returns<a class="headerlink" href="#cgatcore.pipeline.to_table--returns" title="Permanent link">&para;</a></h4>
<p>tablename : string</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="k">def</span><span class="w"> </span><span class="nf">to_table</span><span class="p">(</span><span class="n">outfile</span><span class="p">):</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;convert a filename from a load statement into a table name.</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    This method checks if the filename ends with &quot;.load&quot;. The suffix</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    is then removed and the filename quoted so that it is suitable</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    as a table name.</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    Arguments</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    ---------</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    outfile : string</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">        A filename ending in &quot;.load&quot;.</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    -------</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    tablename : string</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="k">assert</span> <span class="n">outfile</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.load&quot;</span><span class="p">)</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">outfile</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="s2">&quot;.load&quot;</span><span class="p">)])</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="k">return</span> <span class="n">tablequote</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.touch_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">touch_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="mi">438</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dir_fd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.touch_file" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>update/create a sentinel file.</p>
<p>modified from: https://stackoverflow.com/questions/1158076/implement-touch-using-python</p>
<p>Compressed files (ending in .gz) are created as empty 'gzip'
files, i.e., with a header.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/iotools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="k">def</span><span class="w"> </span><span class="nf">touch_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="mo">0o666</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dir_fd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;update/create a sentinel file.</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">    modified from: https://stackoverflow.com/questions/1158076/implement-touch-using-python</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">    Compressed files (ending in .gz) are created as empty &#39;gzip&#39;</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">    files, i.e., with a header.</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="n">flags</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">O_CREAT</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">O_APPEND</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>    <span class="n">existed</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>    <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.gz&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">existed</span><span class="p">:</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>        <span class="c1"># this will automatically add a gzip header</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">GzipFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fhandle</span><span class="p">:</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>            <span class="k">pass</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>    <span class="k">if</span> <span class="n">ref</span><span class="p">:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="n">stattime</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="n">times</span> <span class="o">=</span> <span class="p">(</span><span class="n">stattime</span><span class="o">.</span><span class="n">st_atime</span><span class="p">,</span> <span class="n">stattime</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">)</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>    <span class="k">with</span> <span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>            <span class="n">filename</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">dir_fd</span><span class="o">=</span><span class="n">dir_fd</span><span class="p">))</span> <span class="k">as</span> <span class="n">fhandle</span><span class="p">:</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="n">os</span><span class="o">.</span><span class="n">utime</span><span class="p">(</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>            <span class="n">fhandle</span><span class="o">.</span><span class="n">fileno</span><span class="p">()</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">utime</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">supports_fd</span> <span class="k">else</span> <span class="n">filename</span><span class="p">,</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>            <span class="n">dir_fd</span><span class="o">=</span><span class="kc">None</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">supports_fd</span> <span class="k">else</span> <span class="n">dir_fd</span><span class="p">,</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.update_params_with_commandline_options" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_params_with_commandline_options</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.update_params_with_commandline_options" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>add and update selected parameters in the parameter
dictionary with command line args.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/control.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-929">929</a></span>
<span class="normal"><a href="#__codelineno-0-930">930</a></span>
<span class="normal"><a href="#__codelineno-0-931">931</a></span>
<span class="normal"><a href="#__codelineno-0-932">932</a></span>
<span class="normal"><a href="#__codelineno-0-933">933</a></span>
<span class="normal"><a href="#__codelineno-0-934">934</a></span>
<span class="normal"><a href="#__codelineno-0-935">935</a></span>
<span class="normal"><a href="#__codelineno-0-936">936</a></span>
<span class="normal"><a href="#__codelineno-0-937">937</a></span>
<span class="normal"><a href="#__codelineno-0-938">938</a></span>
<span class="normal"><a href="#__codelineno-0-939">939</a></span>
<span class="normal"><a href="#__codelineno-0-940">940</a></span>
<span class="normal"><a href="#__codelineno-0-941">941</a></span>
<span class="normal"><a href="#__codelineno-0-942">942</a></span>
<span class="normal"><a href="#__codelineno-0-943">943</a></span>
<span class="normal"><a href="#__codelineno-0-944">944</a></span>
<span class="normal"><a href="#__codelineno-0-945">945</a></span>
<span class="normal"><a href="#__codelineno-0-946">946</a></span>
<span class="normal"><a href="#__codelineno-0-947">947</a></span>
<span class="normal"><a href="#__codelineno-0-948">948</a></span>
<span class="normal"><a href="#__codelineno-0-949">949</a></span>
<span class="normal"><a href="#__codelineno-0-950">950</a></span>
<span class="normal"><a href="#__codelineno-0-951">951</a></span>
<span class="normal"><a href="#__codelineno-0-952">952</a></span>
<span class="normal"><a href="#__codelineno-0-953">953</a></span>
<span class="normal"><a href="#__codelineno-0-954">954</a></span>
<span class="normal"><a href="#__codelineno-0-955">955</a></span>
<span class="normal"><a href="#__codelineno-0-956">956</a></span>
<span class="normal"><a href="#__codelineno-0-957">957</a></span>
<span class="normal"><a href="#__codelineno-0-958">958</a></span>
<span class="normal"><a href="#__codelineno-0-959">959</a></span>
<span class="normal"><a href="#__codelineno-0-960">960</a></span>
<span class="normal"><a href="#__codelineno-0-961">961</a></span>
<span class="normal"><a href="#__codelineno-0-962">962</a></span>
<span class="normal"><a href="#__codelineno-0-963">963</a></span>
<span class="normal"><a href="#__codelineno-0-964">964</a></span>
<span class="normal"><a href="#__codelineno-0-965">965</a></span>
<span class="normal"><a href="#__codelineno-0-966">966</a></span>
<span class="normal"><a href="#__codelineno-0-967">967</a></span>
<span class="normal"><a href="#__codelineno-0-968">968</a></span>
<span class="normal"><a href="#__codelineno-0-969">969</a></span>
<span class="normal"><a href="#__codelineno-0-970">970</a></span>
<span class="normal"><a href="#__codelineno-0-971">971</a></span>
<span class="normal"><a href="#__codelineno-0-972">972</a></span>
<span class="normal"><a href="#__codelineno-0-973">973</a></span>
<span class="normal"><a href="#__codelineno-0-974">974</a></span>
<span class="normal"><a href="#__codelineno-0-975">975</a></span>
<span class="normal"><a href="#__codelineno-0-976">976</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-929" name="__codelineno-0-929"></a><span class="k">def</span><span class="w"> </span><span class="nf">update_params_with_commandline_options</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;add and update selected parameters in the parameter</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a><span class="sd">    dictionary with command line args.</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;pipeline_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">pipeline_name</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;dryrun&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">dry_run</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>    <span class="c1"># translate cluster options into dict</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;cluster&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>        <span class="n">arg_key</span> <span class="o">=</span> <span class="s2">&quot;cluster_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">arg_key</span><span class="p">):</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>            <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">arg_key</span><span class="p">)</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a>                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;cluster&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">without_cluster</span><span class="p">:</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;without_cluster&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;shell_logfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">shell_logfile</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;ruffus_checksums_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">ruffus_checksums_level</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>    <span class="c1"># always create an &quot;input&quot; section</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;input_globs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>    <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">input_globs</span><span class="p">:</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>        <span class="k">if</span> <span class="s2">&quot;=&quot;</span> <span class="ow">in</span> <span class="n">variable</span><span class="p">:</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>            <span class="n">variable</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;input_globs&quot;</span><span class="p">][</span><span class="n">variable</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;input_globs&quot;</span><span class="p">][</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>    <span class="k">for</span> <span class="n">variables</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">variables_to_set</span><span class="p">:</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>        <span class="n">variable</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">variables</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>        <span class="n">value</span> <span class="o">=</span> <span class="n">iotools</span><span class="o">.</span><span class="n">str2val</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>        <span class="c1"># enter old style</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a>        <span class="n">params</span><span class="p">[</span><span class="n">variable</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>        <span class="c1"># enter new style</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>        <span class="n">parts</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)):</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>            <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">[:</span><span class="n">x</span><span class="p">])</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>            <span class="k">if</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a>                <span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="n">x</span><span class="p">:])</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>                <span class="n">params</span><span class="p">[</span><span class="n">prefix</span><span class="p">][</span><span class="n">suffix</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">work_dir</span><span class="p">:</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;work_dir&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">work_dir</span><span class="p">)</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;work_dir&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;start_dir&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cgatcore.pipeline.write_config_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_config_files</span><span class="p">(</span><span class="n">pipeline_path</span><span class="p">,</span> <span class="n">general_path</span><span class="p">)</span></code>

<a href="#cgatcore.pipeline.write_config_files" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>create default configuration files in <code>path</code>.</p>

            <details class="quote">
              <summary>Source code in <code>cgatcore/pipeline/control.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="k">def</span><span class="w"> </span><span class="nf">write_config_files</span><span class="p">(</span><span class="n">pipeline_path</span><span class="p">,</span> <span class="n">general_path</span><span class="p">):</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;create default configuration files in `path`.</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">pipeline_path</span><span class="p">,</span> <span class="n">general_path</span><span class="p">]</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="n">config_files</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pipeline.yml&#39;</span><span class="p">]</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="k">for</span> <span class="n">dest</span> <span class="ow">in</span> <span class="n">config_files</span><span class="p">:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dest</span><span class="p">):</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>            <span class="n">E</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;file `</span><span class="si">%s</span><span class="s2">` already exists - skipped&quot;</span> <span class="o">%</span> <span class="n">dest</span><span class="p">)</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="k">continue</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="n">src</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>                <span class="n">E</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;created new configuration file `</span><span class="si">%s</span><span class="s2">` &quot;</span> <span class="o">%</span> <span class="n">dest</span><span class="p">)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>                <span class="k">break</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>                <span class="s2">&quot;default config file `</span><span class="si">%s</span><span class="s2">` not found in </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>                <span class="p">(</span><span class="n">config_files</span><span class="p">,</span> <span class="n">paths</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.60a45f97.min.js"></script>
      
    
  </body>
</html>